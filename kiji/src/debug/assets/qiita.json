[{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:14\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\u003cp data-sourcepos=\"3:1-4:132\"\u003eNestJS の環境を Docker コンテナを使って作成しようとしたところ、NestJS とTypeORM の最新バージョンが上がっていました。\u003cbr\u003e\nせっかくなので、最新のバージョンを使いましたが、断片的な情報しかなくて結構苦労しました。\u003c/p\u003e\n\u003cp data-sourcepos=\"6:1-7:60\"\u003eこれから触る方に参考となればと思い、一通り全ての作業記録を載せておきます。\u003cbr\u003e\n指定した主なバージョンは次のとおりです。\u003c/p\u003e\n\u003ctable data-sourcepos=\"9:1-14:11\"\u003e\n\u003cthead\u003e\n\u003ctr data-sourcepos=\"9:1-9:33\"\u003e\n\u003cth data-sourcepos=\"9:2-9:16\"\u003eライブラリ\u003c/th\u003e\n\u003cth data-sourcepos=\"9:18-9:32\"\u003eバージョン\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr data-sourcepos=\"11:1-11:17\"\u003e\n\u003ctd data-sourcepos=\"11:2-11:8\"\u003eNode.js\u003c/td\u003e\n\u003ctd data-sourcepos=\"11:10-11:16\"\u003e16.17.0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"12:1-12:14\"\u003e\n\u003ctd data-sourcepos=\"12:2-12:7\"\u003eNestJS\u003c/td\u003e\n\u003ctd data-sourcepos=\"12:9-12:13\"\u003e9.1.2\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"13:1-13:15\"\u003e\n\u003ctd data-sourcepos=\"13:2-13:8\"\u003eTypeORM\u003c/td\u003e\n\u003ctd data-sourcepos=\"13:10-13:14\"\u003e0.3.9\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"14:1-14:11\"\u003e\n\u003ctd data-sourcepos=\"14:2-14:6\"\u003eMySQL\u003c/td\u003e\n\u003ctd data-sourcepos=\"14:8-14:10\"\u003e8.0\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp data-sourcepos=\"16:1-23:101\"\u003e＜\u003cstrong\u003e参考記事\u003c/strong\u003e＞\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/Aurum64/items/f5962bd2a643447dbef9\" id=\"reference-235d3ac28c6d5c3dac64\"\u003eTypeORM 0.3系のマイグレーション\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://zenn.dev/hasegawasatoshi/articles/8110ce79119dd0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNestJSをTypeORM 0.3 で使う\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://docs.nestjs.com/techniques/database#migrations\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNestJS公式 - Database\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://zenn.dev/senri/articles/331162304a78e0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDockerを利用してNestJS＋TypeORM+MySQLの環境構築する\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/mball/items/3defb402b23d3d14ea86\" id=\"reference-df3feedbe802761291b3\"\u003eNestJSとDockerコンテナで立ち上げたMySQLサーバーを接続する\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://go-tech.blog/nestjs-typeorm-mysql/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNestJS + TypeORM + MySQL を使ってテーブルを作ってみる\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://ysuzuki19.github.io/post/nestjs-cource3-rest-api-db\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNestJS 入門コース３ DBとCRUD\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"25:1-25:11\"\u003e\n\u003cspan id=\"1-準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 準備\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"27:1-27:36\"\u003e\n\u003cspan id=\"1-1-nestjs-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-1-nestjs-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-1. NestJS のインストール\u003c/h2\u003e\n\u003cp data-sourcepos=\"29:1-30:70\"\u003eNode.js がインストールされていることが前提です（Node のインストールは省略します）。\u003cbr\u003e\n手元のバージョンは次のとおりです（現在の LTS）。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"32:1-35:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ node -v\nv16.17.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"37:1-38:105\"\u003eバージョンアップなどは次の記事を参照ください。\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/tora_oba/items/2761452fe8c2b0035ba0\" id=\"reference-342802a53d69fb1cb415\"\u003en (Node.js管理) のインストール手順\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"40:1-40:226\"\u003eNestJS は次のコマンドでインストール（またはアップグレード）します。バージョンは \u003ccode\u003e9.1.2\u003c/code\u003e を指定しています（エラーが出たら sudo を付けて実行してみてください）。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"42:1-44:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ npm i -g @nestjs/cli@9.1.2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"46:1-46:120\"\u003eなお、これを書いている時点では、\u003ccode\u003e$ npm i -g @nestjs/cli\u003c/code\u003e で v9.1.2 がインストールされます。\u003c/p\u003e\n\u003cp data-sourcepos=\"48:1-48:55\"\u003e\u003ccode\u003enest -v\u003c/code\u003e でバージョンの確認ができます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"50:1-53:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ nest -v\n9.1.2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"55:1-55:39\"\u003e\n\u003cspan id=\"1-2-nestjs-プロジェクト作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-2-nestjs-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1-2. NestJS プロジェクト作成\u003c/h2\u003e\n\u003cp data-sourcepos=\"57:1-58:92\"\u003e適当なフォルダを選んで NestJS のプロジェクトを１つ作ります。\u003cbr\u003e\nプロジェクト名を nest-docker-sample として次のコマンドを実行します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"60:1-62:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ nest new nest-docker-sample\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"64:1-66:66\"\u003eコマンドを実行すると、どの package manager を使用するか聞かれますので、ここでは npm を選びます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f5e8d5fde666c5ee3a21e950db4ae1c730ae0d7b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f30613332323633302d393132622d626532662d656562392d3665313363373365623666632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F0a322630-912b-be2f-eeb9-6e13c73eb6fc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=249ffc3be30d4ae8fa10cf8847779c2e\" alt=\"package-manager.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/0a322630-912b-be2f-eeb9-6e13c73eb6fc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F0a322630-912b-be2f-eeb9-6e13c73eb6fc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c3d88be094a532d17ca0516e8bcb57aa 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nしばらくすると、プロジェクトが作成されます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"68:1-68:48\"\u003e\n\u003cspan id=\"2-dockerfile-と-docker-composeyml-の作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-dockerfile-%E3%81%A8-docker-composeyml-%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. Dockerfile と docker-compose.yml の作成\u003c/h1\u003e\n\u003cp data-sourcepos=\"70:1-70:189\"\u003eプロジェクトが作成されたら、ルートディレクトリ直下に３つのファイル（\u003ccode\u003eDockerfile\u003c/code\u003e, \u003ccode\u003edocker-compose.yml\u003c/code\u003e, \u003ccode\u003e.dockerignore\u003c/code\u003e）を作成します（下図）。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"72:1-80:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enest-docker-sample\n├──Dockerfile  # 作成\n├──docker-compose.yml  # 作成\n├──.dockerignore  # 作成\n├──package.json\n├──package-lock.json\n└──(...先に作成したその他の nest のファイル)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"83:1-84:150\"\u003e＜\u003cstrong\u003e参考記事\u003c/strong\u003e＞\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/gold-kou/items/44860fbda1a34a001fc1#build\" id=\"reference-d9439bedfc47f3533118\"\u003eいまさらだけどDockerに入門したので分かりやすくまとめてみた\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"86:1-86:18\"\u003e\n\u003cspan id=\"2-1-dockerfile\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-1-dockerfile\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-1. Dockerfile\u003c/h2\u003e\n\u003cp data-sourcepos=\"88:1-88:59\"\u003eDockerfile に記載する内容は次のとおりです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"DockerFile\" data-sourcepos=\"90:1-96:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eDockerfile\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"s\"\u003e node:16-alpine3.16\u003c/span\u003e\n\u003cspan class=\"k\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"s\"\u003e /api\u003c/span\u003e\n\u003cspan class=\"k\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"s\"\u003e package*.json ./\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003enpm ci\n\u003cspan class=\"k\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"s\"\u003e . .\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"98:1-98:57\"\u003e指定した内容は、ざっと次のとおりです。\u003c/p\u003e\n\u003ctable data-sourcepos=\"100:1-105:257\"\u003e\n\u003cthead\u003e\n\u003ctr data-sourcepos=\"100:1-100:40\"\u003e\n\u003cth data-sourcepos=\"100:2-100:25\"\u003eコマンド（命令）\u003c/th\u003e\n\u003cth data-sourcepos=\"100:27-100:32\"\u003e概要\u003c/th\u003e\n\u003cth data-sourcepos=\"100:34-100:39\"\u003e備考\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr data-sourcepos=\"102:1-102:296\"\u003e\n\u003ctd data-sourcepos=\"102:2-102:70\"\u003e\u003cstrong\u003e\u003ca href=\"https://docs.docker.jp/engine/reference/builder.html#from\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFROM\u003c/a\u003e\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"102:72-102:113\"\u003eベースイメージを指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"102:115-102:295\"\u003eここでは、\u003ca href=\"https://hub.docker.com/_/node/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNode.js の公式 Docker イメージ\u003c/a\u003eを使用しています（OS は \u003ca href=\"https://ja.wikipedia.org/wiki/Alpine_Linux\" rel=\"nofollow noopener\" target=\"_blank\"\u003ealpine\u003c/a\u003e※）。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"103:1-103:200\"\u003e\n\u003ctd data-sourcepos=\"103:1-103:75\"\u003e\u003cstrong\u003e\u003ca href=\"https://docs.docker.jp/engine/reference/builder.html#workdir\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWORKDIR\u003c/a\u003e\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"103:77-103:151\"\u003eコンテナ内での「コマンドの実行場所」を指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"103:153-103:199\"\u003eここでは \u003ccode\u003e/api\u003c/code\u003e と指定しています。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"104:1-104:553\"\u003e\n\u003ctd data-sourcepos=\"104:2-104:70\"\u003e\u003cstrong\u003e\u003ca href=\"https://docs.docker.jp/engine/reference/builder.html#copy\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCOPY\u003c/a\u003e\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"104:72-104:206\"\u003e左側にコピー元（ホスト側）\u003cbr\u003e右側にコピー先（コンテナ側）\u003cbr\u003eのディレクトリを指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"104:208-104:552\"\u003e\n\u003cstrong\u003e① \u003ccode\u003eCOPY package*.json ./\u003c/code\u003e\u003c/strong\u003e\u003cbr\u003eコピー元の \u003ccode\u003epackage*.json\u003c/code\u003e は、package.json と package-lock.json の２つのファイルです。\u003cbr\u003eコピー先の \u003ccode\u003e./\u003c/code\u003e は上記の WORKDIR の直下（つまり \u003ccode\u003e/api/\u003c/code\u003e）です。\u003cbr\u003e\u003cstrong\u003e② \u003ccode\u003eCOPY . .\u003c/code\u003e\u003c/strong\u003e\u003cbr\u003eホスト側に作成したファイルをコンテナにコピーしています。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"105:1-105:257\"\u003e\n\u003ctd data-sourcepos=\"105:2-105:68\"\u003e\u003cstrong\u003e\u003ca href=\"https://docs.docker.jp/engine/reference/builder.html#run\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRUN\u003c/a\u003e\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"105:70-105:114\"\u003e実行するコマンドを指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"105:116-105:256\"\u003eコンテナに COPY された package-lock.json と package-lock.json を元に \u003ccode\u003enpm ci\u003c/code\u003e でライブラリをインストールします。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp data-sourcepos=\"107:1-107:299\"\u003e※ alpine は厳密には OS そのものではないですが、ここでは OS と呼んでおきます（参考: \u003ca href=\"https://ja.wikipedia.org/wiki/Linux%E3%83%87%E3%82%A3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLinuxディストリビューション\u003c/a\u003e）。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"109:1-109:26\"\u003e\n\u003cspan id=\"2-2-docker-composeyml\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-2-docker-composeyml\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-2. docker-compose.yml\u003c/h2\u003e\n\u003cp data-sourcepos=\"111:1-111:58\"\u003edocker-compose.yml には次のように記載します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"113:1-142:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edocker-compose.yml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e3.8'\u003c/span\u003e\n\u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eapi\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003econtext\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e.\u003c/span\u003e\n      \u003cspan class=\"na\"\u003edockerfile\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eDockerfile\u003c/span\u003e\n    \u003cspan class=\"na\"\u003erestart\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ealways\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eports\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e3000:3000\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etty\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ebind\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esource\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e.\u003c/span\u003e\n        \u003cspan class=\"na\"\u003etarget\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/api\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edepends_on\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003edb\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edb\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emysql:8.0\u003c/span\u003e\n    \u003cspan class=\"na\"\u003erestart\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ealways\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eports\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e3306:3306\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eenvironment\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eMYSQL_DATABASE\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003esample\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eMYSQL_ROOT_PASSWORD\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epassword\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eMYSQL_USER\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003euser\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eMYSQL_PASSWORD\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003epassword\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./db/data:/var/lib/mysql\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"144:1-144:69\"\u003e指定した内容をざっと書き出すと次のとおりです。\u003c/p\u003e\n\u003ctable data-sourcepos=\"146:1-156:276\"\u003e\n\u003cthead\u003e\n\u003ctr data-sourcepos=\"146:1-146:22\"\u003e\n\u003cth data-sourcepos=\"146:2-146:7\"\u003e項目\u003c/th\u003e\n\u003cth data-sourcepos=\"146:9-146:14\"\u003e内容\u003c/th\u003e\n\u003cth data-sourcepos=\"146:16-146:21\"\u003e備考\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr data-sourcepos=\"148:1-148:204\"\u003e\n\u003ctd data-sourcepos=\"148:2-148:13\"\u003e\u003cstrong\u003eversion:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"148:15-148:154\"\u003e\n\u003ca href=\"https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v3/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCompose ファイルのバージョン\u003c/a\u003e です。\u003c/td\u003e\n\u003ctd data-sourcepos=\"148:156-148:203\"\u003e今は \u003ccode\u003e3\u003c/code\u003e とか \u003ccode\u003e3.8\u003c/code\u003e で良いようです。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"149:1-149:175\"\u003e\n\u003ctd data-sourcepos=\"149:2-149:13\"\u003e\u003cstrong\u003eservice:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"149:15-149:68\"\u003e以下に、コンテナの定義を記載します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"149:70-149:174\"\u003eここでは、\u003cstrong\u003eservice 名\u003c/strong\u003eを\u003ccode\u003eapi\u003c/code\u003e と \u003ccode\u003edb\u003c/code\u003e とした２つのコンテナを作成しています。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"150:1-150:238\"\u003e\n\u003ctd data-sourcepos=\"150:2-150:11\"\u003e\u003cstrong\u003ebuild:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"150:13-150:88\"\u003e指定された Dockerfile から、Docker イメージを作成します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"150:90-150:237\"\u003e\n\u003ccode\u003econtext:\u003c/code\u003e ワーキングディレクトリを指定\u003cbr\u003e\u003ccode\u003edockerfile:\u003c/code\u003e ドッカーファイルのファイル名（ディレクトリ）を指定\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"151:1-151:70\"\u003e\n\u003ctd data-sourcepos=\"151:2-151:13\"\u003e\u003cstrong\u003erestart:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"151:15-151:68\"\u003eコンテナの再起動について指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"151:70-151:69\"\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"152:1-152:215\"\u003e\n\u003ctd data-sourcepos=\"152:2-152:11\"\u003e\u003cstrong\u003eports:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"152:13-152:105\"\u003e左側にホスト側のポート、右側にコンテナ側のポートを指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"152:107-152:214\"\u003eMySQL のホスト側の port を変えたい場合は、\u003ccode\u003e3307:3306\u003c/code\u003e のように記載したりします。\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"153:1-153:154\"\u003e\n\u003ctd data-sourcepos=\"153:2-153:9\"\u003e\u003cstrong\u003etty:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"153:11-153:70\"\u003eコンテナを起動させ続けるために記載します\u003c/td\u003e\n\u003ctd data-sourcepos=\"153:72-153:153\"\u003e参考：\u003ca href=\"https://zenn.dev/hohner/articles/43a0da20181d34\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDockerのTTYって何?\u003c/a\u003e\n\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"154:1-154:515\"\u003e\n\u003ctd data-sourcepos=\"154:2-154:13\"\u003e\u003cstrong\u003evolumes:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"154:15-154:108\"\u003eホスト側のデータと、docker コンテナ側のデータをバインドさせます。\u003c/td\u003e\n\u003ctd data-sourcepos=\"154:110-154:514\"\u003e\n\u003cstrong\u003e① long syntax\u003c/strong\u003e\u003cbr\u003e　\u003ccode\u003etype:\u003c/code\u003e \u003ca href=\"https://docs.docker.jp/compose/compose-file/compose-file-v3.html#id20\" rel=\"nofollow noopener\" target=\"_blank\"\u003eマウントの種類\u003c/a\u003eを指定\u003cbr\u003e　\u003ccode\u003esource:\u003c/code\u003e ホスト側ディレクトリを指定\u003cbr\u003e　\u003ccode\u003etarget:\u003c/code\u003e コンテナ側ディレクトリを指定\u003cbr\u003e\u003cstrong\u003e② short syntax\u003c/strong\u003e\u003cbr\u003e　左側: ホスト側のディレクトリを指定\u003cbr\u003e　右側: コンテナ側のディレクトリを指定\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"155:1-155:218\"\u003e\n\u003ctd data-sourcepos=\"155:2-155:17\"\u003e\u003cstrong\u003eenvironment:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"155:19-155:51\"\u003e環境変数を指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"155:53-155:217\"\u003e\n\u003ccode\u003eMYSQL_DATABASE:\u003c/code\u003e DB 名\u003cbr\u003e\u003ccode\u003eMYSQL_ROOT_PASSWORD:\u003c/code\u003e root のパスワード\u003cbr\u003e\u003ccode\u003eMYSQL_USER:\u003c/code\u003e ユーザー名\u003cbr\u003e\u003ccode\u003eMYSQL_PASSWORD:\u003c/code\u003e ユーザーのパスワード\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"156:1-156:276\"\u003e\n\u003ctd data-sourcepos=\"156:2-156:16\"\u003e\u003cstrong\u003edepends_on:\u003c/strong\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"156:18-156:147\"\u003eサービス間の\u003ca href=\"https://docs.docker.jp/compose/compose-file/compose-file-v3.html#depends-on\" rel=\"nofollow noopener\" target=\"_blank\"\u003e依存関係\u003c/a\u003eを指定します。\u003c/td\u003e\n\u003ctd data-sourcepos=\"156:149-156:275\"\u003e\n\u003ccode\u003eapi:\u003c/code\u003e\u003cbr\u003e\u003ccode\u003e　depends_on:\u003c/code\u003e\u003cbr\u003e\u003ccode\u003e　　- db\u003c/code\u003e\u003cbr\u003eこの例では api より前に db が起動することになります。\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp data-sourcepos=\"158:1-159:201\"\u003eコンテナが消えても DB の内容を保持できるように、ホスト側に \u003ccode\u003e/db\u003c/code\u003e というディレクトリを作成して、MySQL のデータを保存するようにしています。\u003cbr\u003e\n保存場所については、Docker の volume に保存する方法もありますので、そのあたりは他のサイトなどで確認してみてください（ここでは行いません）。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"yml\" data-sourcepos=\"161:1-164:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edocker-compose.yml 抜粋\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e./db/data:/var/lib/mysql\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"166:1-168:125\"\u003e＜参考サイト＞\u003cbr\u003e\n・\u003ca href=\"https://docs.docker.jp/v1.12/compose/compose-file.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCompose ファイル・リファレンス\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/yuta-ushijima/items/d3d98177e1b28f736f04\" id=\"reference-7cb06f9071f4bb067cfc\"\u003edocker-compose.ymlの書き方について解説してみた\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"170:1-170:32\"\u003e\n\u003cspan id=\"2-3-その他のファイル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-3-%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-3. その他のファイル\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"172:1-172:24\"\u003e\n\u003cspan id=\"2-3-1-dockerignore\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-3-1-dockerignore\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-3-1. .dockerignore\u003c/h3\u003e\n\u003cp data-sourcepos=\"174:1-174:128\"\u003e.dockerignore ファイルには、Dockerのビルド時に無視するディレクトリ（ファイル）を指定します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"176:1-179:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.dockerignore\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e.git/\nnode_modules\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"181:1-181:37\"\u003e\n\u003cspan id=\"2-3-2-gitignore-に１行追加\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-3-2-gitignore-%E3%81%AB%EF%BC%91%E8%A1%8C%E8%BF%BD%E5%8A%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-3-2. .gitignore に１行追加\u003c/h3\u003e\n\u003cp data-sourcepos=\"183:1-183:67\"\u003e\u003ccode\u003e.gitignore\u003c/code\u003e ファイルに、\u003ccode\u003e/db\u003c/code\u003e を追加しておきます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"185:1-192:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.gitignore\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# compiled output\n/dist\n/node_modules\n/db # これを追加\n\n# 以下略\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"194:1-194:179\"\u003e先述のとおり \u003ccode\u003e/db\u003c/code\u003e には、MySQL のコンテナ内のデータを保存していますので、これを更に \u003ccode\u003eapi\u003c/code\u003e コンテナ側に保存しないようにします。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"196:1-196:30\"\u003e\n\u003cspan id=\"2-4-docker-の起動確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-4-docker-%E3%81%AE%E8%B5%B7%E5%8B%95%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2-4. Docker の起動確認\u003c/h2\u003e\n\u003cp data-sourcepos=\"198:1-199:55\"\u003eプロジェクトのルートディレクトリに移動します。\u003cbr\u003e\n次のコマンドで、docker を起動させます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"201:1-203:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker compose up -d\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"205:1-205:81\"\u003e\u003ccode\u003edocker ps\u003c/code\u003e コマンドでコンテナが起動しているか確認します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"207:1-212:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker ps\nCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                               NAMES\n78918ab18ad4   nest-docker-sample_api   \"docker-entrypoint.s…\"   36 seconds ago   Up 33 seconds   0.0.0.0:3000-\u0026gt;3000/tcp              nest-docker-sample-api-1\n3fdc62a476f7   mysql:8.0                \"docker-entrypoint.s…\"   36 seconds ago   Up 35 seconds   0.0.0.0:3306-\u0026gt;3306/tcp, 33060/tcp   nest-docker-sample-db-1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"214:1-215:193\"\u003e確認のため、\u003ccode\u003enpm run start\u003c/code\u003e コマンドでサーバを起動してみます。\u003cbr\u003e\nコンテナ内でコマンドを実行するので、頭に \u003ccode\u003edocker compose exec api\u003c/code\u003e を付けています（\u003ccode\u003eapi\u003c/code\u003e は docker-compose.yml ファイルで指定した service名です。）。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"217:1-219:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker compose exec api npm run start\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"221:1-225:82\"\u003e無事に実行できれば、次のように表示されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ee8d97eac5af58fc6b8b630c630f2b6eca7e5b30/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f35643732636135632d323930332d613461372d633835362d6235323133343437393139352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F5d72ca5c-2903-a4a7-c856-b52134479195.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4b541b302e7917e0037e3cef1fbc83d1\" alt=\"npm-run-start.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/5d72ca5c-2903-a4a7-c856-b52134479195.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F5d72ca5c-2903-a4a7-c856-b52134479195.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6b900a905e27de590ac32b254a676287 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"http://localhost:3000/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://localhost:3000/\u003c/a\u003e にアクセスして「Hello World!」が表示されればコンテナの起動は成功です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b7f79f1606a7723cf67f28b14d68f9f9596edce5/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f62646239646138332d366463312d656164352d616232642d3032303232633363393564612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2Fbdb9da83-6dc1-ead5-ab2d-02022c3c95da.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cfbd76fd12132d7cbf4382b77713e2cd\" alt=\"HelloWorld_1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/bdb9da83-6dc1-ead5-ab2d-02022c3c95da.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2Fbdb9da83-6dc1-ead5-ab2d-02022c3c95da.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=57391a048176894d5062fe202bbd57dd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n作業を続けるため、一旦、\u003cstrong\u003eCtrl + C\u003c/strong\u003e でサーバを停止します。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"227:1-227:28\"\u003e\n\u003cspan id=\"3-vscode-remote-container\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-vscode-remote-container\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. VSCode Remote-Container\u003c/h1\u003e\n\u003cp data-sourcepos=\"229:1-230:203\"\u003eここでは、VSCode Remote-Container を使用します。\u003cbr\u003e\n特に必須の内容ではなく、コンテナ内に入ってコマンドが実行できれば良いので、不要な人は「\u003ca href=\"#4-typeorm-%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003e4. TypeORM の導入\u003c/a\u003e」に進んでください。\u003c/p\u003e\n\u003cp data-sourcepos=\"232:1-235:155\"\u003e＜\u003cstrong\u003e参考記事\u003c/strong\u003e＞\u003cbr\u003e\n・\u003ca href=\"https://qiita.com/d0ne1s/items/d2649801c6f804019db7\" id=\"reference-fbfa165e314ee6baca12\"\u003eVSCode Remote Containerが良い\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://bufferings.hatenablog.com/entry/2020/06/11/233201\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVS Code Remote - Containers を Docker Compose で使うのだー！\u003c/a\u003e\u003cbr\u003e\n・\u003ca href=\"https://zenn.dev/niisan/articles/9abd372ae86fc1\" rel=\"nofollow noopener\" target=\"_blank\"\u003eみんながきっと１万回は聞いている、VS Code Remoteでコンテナ開発をやる方法\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"237:1-237:59\"\u003e\n\u003cspan id=\"3-1-コンテナでのコマンド実行方法の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-1-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%A7%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C%E6%96%B9%E6%B3%95%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-1. コンテナでのコマンド実行方法の確認\u003c/h2\u003e\n\u003cp data-sourcepos=\"239:1-241:55\"\u003e\u003cstrong\u003e① コンテナの外からコマンドを実行する\u003c/strong\u003e\u003cbr\u003e\nコンテナに対してコマンドを実行するには、実行したいコマンドの前に、\u003ccode\u003edocker compose exec \u0026lt;service名\u0026gt;\u003c/code\u003e と付ければ操作できます（servise名は docker-compose.yml で指定した名称となります）。\u003cbr\u003e\n以下は、\u003ccode\u003enpm run start\u003c/code\u003e を実行する例です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"243:1-245:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker compose exec api npm run start\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"247:1-248:123\"\u003e\u003cstrong\u003e② コンテナに入ってコマンドを実行する\u003c/strong\u003e\u003cbr\u003e\n次のコマンドで、コンテナに入れば、docker compose exec api と頭に付けなくとも操作できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"250:1-252:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker exec -it \u0026lt;コンテナID\u0026gt; sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"254:1-254:191\"\u003eOS（Linuxディストリビューション） で ubuntu を使用する場合は、末尾は \u003ccode\u003ebash\u003c/code\u003e ですが、ここでは alpine を使用しているので \u003ccode\u003esh\u003c/code\u003e となっています。\u003c/p\u003e\n\u003cp data-sourcepos=\"256:1-258:51\"\u003e\u003cstrong\u003e③ Remote-Container を使用する\u003c/strong\u003e\u003cbr\u003e\nここでは、手軽にコンテナに入るために、Remote-Container を使用します。\u003cbr\u003e\n導入方法は、次項以下のとおりです。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"260:1-260:34\"\u003e\n\u003cspan id=\"3-2-remote-container-の導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-remote-container-%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2. Remote-Container の導入\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"262:1-262:29\"\u003e\n\u003cspan id=\"3-2-1-インストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-1-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2-1. インストール\u003c/h3\u003e\n\u003cp data-sourcepos=\"264:1-264:94\"\u003eVSCode の拡張機能として、以下の Remote-Container をインストールします。\u003c/p\u003e\n\u003cp data-sourcepos=\"266:1-266:86\"\u003e\u003cqiita-embed-ogp src=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"268:1-268:42\"\u003e\n\u003cspan id=\"3-2-2-vscode-でコンテナを開く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-2-vscode-%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E9%96%8B%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2-2. VSCode でコンテナを開く\u003c/h3\u003e\n\u003cp data-sourcepos=\"270:1-289:30\"\u003e\u003cstrong\u003e① Remote-Container の使用\u003c/strong\u003e\u003cbr\u003e\nインストールが完了すると、VSCode の左下に緑のアイコンが表示されますので、これをクリックします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5b169a50fbb1b655341f91c6ecea2ae79b1043e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f61333966653434352d383233302d393939612d663665632d3437623164376431333133332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2Fa39fe445-8230-999a-f6ec-47b1d7d13133.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=86692d78c8b82bd2b8159f262b5918f6\" alt=\"remote1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/a39fe445-8230-999a-f6ec-47b1d7d13133.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2Fa39fe445-8230-999a-f6ec-47b1d7d13133.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=393bf596df0d108b629fb55f6834e31b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003e② 操作の選択\u003c/strong\u003e\u003cbr\u003e\n選択肢が現れますので、Reopen in Container を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d3fc3112ca1633a89b8c2939c0372fbbc76f3e4d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f36326536653966362d366436372d333065612d316134342d6364653166353164663362362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F62e6e9f6-6d67-30ea-1a44-cde1f51df3b6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=033aa39ef3203721f98dd3c1907e84c6\" alt=\"remote2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/62e6e9f6-6d67-30ea-1a44-cde1f51df3b6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F62e6e9f6-6d67-30ea-1a44-cde1f51df3b6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7d04991c96f59a0697e2b3074a95a7c5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003e③ Remote-Container を実行するファイルを選択\u003c/strong\u003e\u003cbr\u003e\nFrom 'docker-compose.yml' を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d4ba2a33c55e14f024678a3b77455d2bafdb8836/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f36396635616234332d646231372d363230392d363865382d6461633163343239653336352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F69f5ab43-db17-6209-68e8-dac1c429e365.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=75ea740ee91ae99d8540c3e5e394a421\" alt=\"remote3.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/69f5ab43-db17-6209-68e8-dac1c429e365.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F69f5ab43-db17-6209-68e8-dac1c429e365.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c9be9aec4534be0509b49ab9b8f3cd99 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003e④ service名を選択\u003c/strong\u003e\u003cbr\u003e\nservice 名を聞かれますので、\u003ccode\u003eapi\u003c/code\u003e を選択します。\u003cbr\u003e\nこの service 名は、docker-compose.yml で指定した service 名となります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b39930d67556b7f159ce416f487d2c4f8716d6ed/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f32376464303437342d316335332d343765622d643665622d3839363330366338616364622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F27dd0474-1c53-47eb-d6eb-896306c8acdb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=937ecb07fe52a17411469a2adcc38d44\" alt=\"remote4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/27dd0474-1c53-47eb-d6eb-896306c8acdb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F27dd0474-1c53-47eb-d6eb-896306c8acdb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2fe57c7cfa4b9865d3271a2ceff52d2a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003e⑤ WorkSpace の選択\u003c/strong\u003e\u003cbr\u003e\nWorkspace が存在しないというメッセージが出てきたら、Open Workspace をクリックします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b6a17e272e5d588d2bb549c66869f4cefa1e28a6/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f37373132333137302d323635362d366234312d383436332d3065393765316566323433322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F77123170-2656-6b41-8463-0e97e1ef2432.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=390071969eb92ba8bcaea66843abd9fc\" alt=\"remote5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/77123170-2656-6b41-8463-0e97e1ef2432.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F77123170-2656-6b41-8463-0e97e1ef2432.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3eba219297c37f0aad20c88268d3a033 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nフォルダーは \u003ccode\u003e/api\u003c/code\u003e を選択して、OK をクリックします。\u003cbr\u003e\nこの \u003ccode\u003e/api\u003c/code\u003e は、Dockerfile の WORKDIR で指定したディレクトリです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b65842b0bec6fc6c7dd46e76bf086a5272db6c69/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f38613664383830392d383231652d313830372d383230622d6630613433653435616139632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F8a6d8809-821e-1807-820b-f0a43e45aa9c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e565a28c8ca103d204692e2e5e68aed7\" alt=\"remote6.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/8a6d8809-821e-1807-820b-f0a43e45aa9c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F8a6d8809-821e-1807-820b-f0a43e45aa9c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8515c96097b83fccafee282e533096d4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n初期設定は以上です。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"291:1-291:44\"\u003e\n\u003cspan id=\"3-2-3-状態の確認と若干の補正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-3-%E7%8A%B6%E6%85%8B%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%81%A8%E8%8B%A5%E5%B9%B2%E3%81%AE%E8%A3%9C%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2-3. 状態の確認と若干の補正\u003c/h3\u003e\n\u003cp data-sourcepos=\"293:1-297:142\"\u003eコンテナに入ると、次のような画面になっています。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/afb2a50e979f8986658d5e57d918ff2fa34e3ed8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f38663462623538322d343764322d363239322d636535662d6361663162663332393537632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F8f4bb582-47d2-6292-ce5f-caf1bf32957c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=752b52a07b7487498f84d6c695e6712b\" alt=\"remote7.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/8f4bb582-47d2-6292-ce5f-caf1bf32957c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F8f4bb582-47d2-6292-ce5f-caf1bf32957c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=70faf389d1ff662c99db2e76ae2089e6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003cstrong\u003e① ターミナル\u003c/strong\u003e\u003cbr\u003e\n入力部分が \u003ccode\u003e78918ab18ad4:/api#\u003c/code\u003e というようになっています。\u003cbr\u003e\nこれは \u003ccode\u003e\u0026lt;コンテナID\u0026gt;:\u0026lt;service名\u0026gt;#\u003c/code\u003e の形式で、ここで直接コンテナに対してコマンドを打つことができます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"299:1-301:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e78918ab18ad4:/api#\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"303:1-304:141\"\u003e\u003cstrong\u003e② 作成されるファイル\u003c/strong\u003e\u003cbr\u003e\nRemote-Containerを導入すると、ルートの直下にディレクトリ \u003ccode\u003e.devcontainer\u003c/code\u003e と２つのファイルが作成されます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"306:1-313:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enest-docker-sample\n├─ .devcontainer\n│   ├── devcontainer.json\n│   └── docker-compose.yml\n└──(...その他のファイル)\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"315:1-316:161\"\u003e\u003cstrong\u003e③ WorkSpace のディレクトリを修正\u003c/strong\u003e\u003cbr\u003e\ndevcontainer.json ファイルに \"workspaceFolder\" を指定するプロパティがあるので、ここを \"/workspace\" から \"/api\" に書き換えます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"json\" data-sourcepos=\"318:1-321:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.devcontainer/devcontainer.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e書き換え前\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"workspaceFolder\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"/workspace\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"json\" data-sourcepos=\"323:1-326:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.devcontainer/devcontainer.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e書き換え後\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"workspaceFolder\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"/api\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"328:1-328:78\"\u003e\u003ccode\u003e/api\u003c/code\u003e は、Dockerfile の WORKDIR で指定したディレクトリです。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"330:1-330:49\"\u003e\n\u003cspan id=\"3-2-4-remote-container-の終了と再実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-4-remote-container-%E3%81%AE%E7%B5%82%E4%BA%86%E3%81%A8%E5%86%8D%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2-4. Remote-Container の終了と再実行\u003c/h3\u003e\n\u003cp data-sourcepos=\"332:1-335:123\"\u003eRemote-Container を終了するには、左下の緑の部分をクリックして、\u003ccode\u003eClose Remote Connection\u003c/code\u003e を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2eaa6dbac5d742bed5cd549e6a8f7a07331e684d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f66383862313339332d636336392d613439612d386231302d6462303231306639613563332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2Ff88b1393-cc69-a49a-8b10-db0210f9a5c3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0889475df17a27caac47d9d7151f7517\" alt=\"remote8.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/f88b1393-cc69-a49a-8b10-db0210f9a5c3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2Ff88b1393-cc69-a49a-8b10-db0210f9a5c3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=39f0bcf5e008326610bdba999ca4e937 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n再度コンテナの中に入るには、左下の緑のアイコンをクリックして、Reopen in Container を選択します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/76001bcc26573a3b7d995505e7ab5c3c35871614/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f34636233343063392d653261312d316361642d323463612d6261663366663230353433302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F4cb340c9-e2a1-1cad-24ca-baf3ff205430.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3068df00b4bbfc1dfeab25b19810da5b\" alt=\"remote9.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/4cb340c9-e2a1-1cad-24ca-baf3ff205430.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F4cb340c9-e2a1-1cad-24ca-baf3ff205430.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fc821e48d9ed345f94b1d61b4461e84b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"337:1-337:22\"\u003e\n\u003cspan id=\"4-typeorm-の導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-typeorm-%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. TypeORM の導入\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"339:1-339:37\"\u003e\n\u003cspan id=\"4-1-typeorm-のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-1-typeorm-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-1. TypeORM のインストール\u003c/h2\u003e\n\u003cp data-sourcepos=\"341:1-341:93\"\u003e次のコマンドで TypeORM のバージョンを指定してインストールします。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"343:1-345:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# npm install --save @nestjs/typeorm typeorm@0.3.9 mysql2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"347:1-347:210\"\u003eこれを書いている時点では、\u003ccode\u003etypeorm@0.3.9\u003c/code\u003e のところを \u003ccode\u003etypeorm\u003c/code\u003e というようにバージョンを指定しなくとも、同じバージョンの TypeORM がインストールされます。\u003c/p\u003e\n\u003cp data-sourcepos=\"350:1-350:102\"\u003e次のコマンドで、インストールされた TypeORM のバージョンが確認できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"352:1-355:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# npm info typeorm version\n0.3.9\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"357:1-357:88\"\u003e参考までに、設定が完了した後の \u003ccode\u003epackage.json\u003c/code\u003e を貼っておきます。\u003c/p\u003e\n\u003cdetails\u003e\u003csummary\u003e\u003cfont color=\"blue\"\u003epackage.json\u003c/font\u003e\u003c/summary\u003e\u003cdiv\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"json\" data-sourcepos=\"360:1-435:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epackage.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"nest-docker-sample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"0.0.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"description\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"author\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"private\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"license\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"UNLICENSED\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"scripts\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"prebuild\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"rimraf dist\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"nest build\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"format\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"prettier --write \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esrc/**/*.ts\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etest/**/*.ts\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"start\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"nest start\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"start:dev\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"nest start --watch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"start:debug\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"nest start --debug --watch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"start:prod\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"node dist/main\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"lint\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"eslint \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e{src,apps,libs,test}/**/*.ts\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e --fix\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"jest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"test:watch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"jest --watch\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"test:cov\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"jest --coverage\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"test:debug\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"test:e2e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"jest --config ./test/jest-e2e.json\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/common\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/core\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/platform-express\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/typeorm\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"mysql2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^2.3.3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"reflect-metadata\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^0.1.13\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"rimraf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^3.0.2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"rxjs\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^7.2.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"typeorm\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^0.3.9\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/cli\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/schematics\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@nestjs/testing\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@types/express\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^4.17.13\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@types/jest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"28.1.8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@types/node\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^16.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@types/supertest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^2.0.11\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@typescript-eslint/eslint-plugin\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^5.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"@typescript-eslint/parser\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^5.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"eslint\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^8.0.1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"eslint-config-prettier\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^8.3.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"eslint-plugin-prettier\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^4.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"jest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"28.1.3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"prettier\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^2.3.2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"source-map-support\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^0.5.20\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"supertest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^6.1.3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ts-jest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"28.0.8\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ts-loader\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^9.2.3\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"ts-node\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^10.0.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"tsconfig-paths\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"4.1.0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"typescript\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"^4.7.4\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"jest\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"moduleFileExtensions\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"js\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"json\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ts\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"rootDir\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"src\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"testRegex\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\".*\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e.spec\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003e.ts$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"transform\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"^.+\\\\.(t|j)s$\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"ts-jest\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"collectCoverageFrom\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n      \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"**/*.(t|j)s\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"coverageDirectory\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"../coverage\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"testEnvironment\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"node\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003c/details\u003e\n\u003ch2 data-sourcepos=\"438:1-438:24\"\u003e\n\u003cspan id=\"4-2-entity-の作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-2-entity-%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-2. Entity の作成\u003c/h2\u003e\n\u003cp data-sourcepos=\"440:1-442:78\"\u003eテーブル定義として、テスト用の Entity クラスを作成します。\u003cbr\u003e\n以下のように、\u003ccode\u003esrc/entities/\u003c/code\u003e ディレクトリに \u003ccode\u003ecomment.entity.ts\u003c/code\u003e というファイルを作成しました（中身は適当です）。\u003cbr\u003e\nこれを元に、DB にテーブルが作成されることになります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"444:1-471:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esrc/entities/comment.entity.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eCreateDateColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ePrimaryGeneratedColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eUpdateDateColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003etypeorm\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"nd\"\u003eEntity\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eComment\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"nd\"\u003ePrimaryGeneratedColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"nd\"\u003eColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"nd\"\u003eCreateDateColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ecreatedAt\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"nd\"\u003eUpdateDateColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eupdatedAt\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"473:1-473:28\"\u003e\n\u003cspan id=\"4-3-datasource-の作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-3-datasource-%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-3. DataSource の作成\u003c/h2\u003e\n\u003cp data-sourcepos=\"475:1-476:142\"\u003eTypeORM v0.3 では、データベースの接続を定義する DataSource ファイルを作成します。\u003cbr\u003e\nTypeORM v0.2 においては、\u003ccode\u003eormconfig.js\u003c/code\u003e のようなファイルを作成していました（現在は非推奨のようです。）。\u003c/p\u003e\n\u003cp data-sourcepos=\"478:1-479:66\"\u003e\u003ccode\u003esrc/\u003c/code\u003e ディレクトリの直下に以下のように \u003ccode\u003edata-source.ts\u003c/code\u003e ファイルを作成します。\u003cbr\u003e\n設定内容は、コード中のコメントのとおりです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"481:1-497:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esrc/data-source.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eComment\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./entities/comment.entity\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eDataSource\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003etypeorm\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eAppDataSource\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eDataSource\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003emysql\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// MySQL の場合\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edb\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// docker-compose.yml で指定したコンテナの service 名\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3306\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// ホスト側のポート（docker-compose.yml の ports: の左側に対応）\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eusername\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003euser\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// docker-compose.yml の MYSQL_USER\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epassword\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// docker-compose.yml の MYSQL_PASSWORD\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edatabase\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003esample\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// docker-compose.yml の MYSQL_DATABASE\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elogging\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// コンソール画面に実行したSQLが表示される\u003c/span\u003e\n  \u003cspan class=\"na\"\u003esynchronize\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true にすると migration が自動で実行されます。\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eentities\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eComment\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"c1\"\u003e// エンティティクラスを指定する（複数の場合はカンマで区切る）\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emigrations\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edist/migration/*.js\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"c1\"\u003e// dist ディレクトリ内の js ファイルを指定する\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"499:1-500:57\"\u003e＜\u003cstrong\u003e参考サイト\u003c/strong\u003e＞\u003cbr\u003e\n・\u003ca href=\"https://www.npmjs.com/package/typeorm\" rel=\"nofollow noopener\" target=\"_blank\"\u003enpm - TypeORM\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"502:1-502:31\"\u003e\n\u003cspan id=\"4-4-appmodulets-の修正\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-4-appmodulets-%E3%81%AE%E4%BF%AE%E6%AD%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-4. app.module.ts の修正\u003c/h2\u003e\n\u003cp data-sourcepos=\"504:1-504:89\"\u003eDataSource ファイルを読み込むために \u003ccode\u003esrc/app.module.ts\u003c/code\u003e を編集します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"506:1-519:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esrc/app.module.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eModule\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e@nestjs/common\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eTypeOrmModule\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e@nestjs/typeorm\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eAppController\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./app.controller\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eAppService\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./app.service\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eAppDataSource\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./data-source\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 追加\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"nd\"\u003eModule\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eimports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eTypeOrmModule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforRoot\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eAppDataSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)],\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 修正\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econtrollers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eAppController\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eproviders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eAppService\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eAppModule\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"521:1-521:166\"\u003eTypeOrmModule.forRoot() の引数には、DataSource から import した AppDataSource　の option プロパティを指定します（\u003ccode\u003eAppDataSource.options\u003c/code\u003e）。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"523:1-523:77\"\u003e\n\u003cspan id=\"4-5-マイグレーションファイルの生成migrationgenerate\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-5-%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%94%9F%E6%88%90migrationgenerate\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-5. マイグレーションファイルの生成（migration:generate）\u003c/h2\u003e\n\u003cp data-sourcepos=\"525:1-525:120\"\u003eマイグレーションファイルの生成コマンド（migration:generate）も書き方が変わっています。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"527:1-529:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# npx typeorm-ts-node-commonjs migration:generate src/migration/CommentMigration -d src/data-source.ts\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"531:1-534:158\"\u003e冒頭の \u003ccode\u003enpx typeorm-ts-node-commonjs migration:generate\u003c/code\u003e は共通です。\u003cbr\u003e\n次の \u003ccode\u003esrc/migration/CommentMigration\u003c/code\u003e は、マイグレーションファイルを作成するディレクトリ/ファイル名を指定しています。\u003cbr\u003e\n最後の \u003ccode\u003e-d src/data-source.ts\u003c/code\u003e には、接続情報となる DataSource ファイルを指定しています。\u003cbr\u003e\nこの辺りは、冒頭にも紹介した\u003ca href=\"https://qiita.com/Aurum64/items/f5962bd2a643447dbef9\"\u003eこの記事\u003c/a\u003eを参考とさせていただいています。\u003c/p\u003e\n\u003cp data-sourcepos=\"536:1-538:162\"\u003eコマンドを実行すると、ターミナルに次のような表示がされます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d5feee9d2943360452593e2f9e3c260b3bcee869/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f32363962323737392d626263312d376534612d626437392d6165333439356361636538652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F269b2779-bbc1-7e4a-bd79-ae3495cace8e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9a945583779285c2d91804eb16d7b530\" alt=\"migration_g2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/269b2779-bbc1-7e4a-bd79-ae3495cace8e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F269b2779-bbc1-7e4a-bd79-ae3495cace8e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b073e64504ef0382937f3c8337c1d9d2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n無事に成功すれば、指定した \u003ccode\u003esrc/migration/\u003c/code\u003e フォルダに以下のようなマイグレーションファイルができていると思います。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"540:1-555:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esrc/migration/1663429464503-CommentMigration.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eMigrationInterface\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eQueryRunner\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etypeorm\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eCommentMigration1663489067218\u003c/span\u003e \u003cspan class=\"k\"\u003eimplements\u003c/span\u003e \u003cspan class=\"nx\"\u003eMigrationInterface\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eCommentMigration1663489067218\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003eup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equeryRunner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eQueryRunner\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003equeryRunner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`CREATE TABLE \u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003ecomment\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e (\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003eid\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e int NOT NULL AUTO_INCREMENT, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003ebody\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e varchar(255) NOT NULL, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003ecreatedAt\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003eupdatedAt\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), PRIMARY KEY (\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003eid\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e)) ENGINE=InnoDB`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003edown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equeryRunner\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eQueryRunner\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003equeryRunner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`DROP TABLE \u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003ecomment\u003c/span\u003e\u003cspan class=\"se\"\u003e\\`\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"557:1-557:60\"\u003e\n\u003cspan id=\"4-6-マイグレーションの実行migrationrun\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-6-%E3%83%9E%E3%82%A4%E3%82%B0%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%AE%9F%E8%A1%8Cmigrationrun\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-6. マイグレーションの実行（migration:run）\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"559:1-559:44\"\u003e\n\u003cspan id=\"4-6-1-先にアプリをビルドする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-6-1-%E5%85%88%E3%81%AB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-6-1. 先にアプリをビルドする\u003c/h3\u003e\n\u003cp data-sourcepos=\"561:1-562:39\"\u003edist の中身を書き換えないと、マイグレーションが実行されないので、実行前に一度ビルドします。\u003cbr\u003e\n次のコマンドを実行します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"564:1-566:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# npm run build\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"568:1-568:191\"\u003eなお、ここではしませんが、\u003ccode\u003enpm run start\u003c/code\u003e などでサーバを立ち上げても、dist が更新されます（つまり、dist が更新できれば何でも良いです）。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"570:1-570:24\"\u003e\n\u003cspan id=\"4-6-2-migrationrun\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-6-2-migrationrun\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-6-2. migration:run\u003c/h3\u003e\n\u003cp data-sourcepos=\"572:1-573:42\"\u003eさて、いよいよ migration:run を実行します。\u003cbr\u003e\nコマンドは、次のとおりです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"575:1-577:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# npx typeorm-ts-node-commonjs migration:run -d src/data-source.ts\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"579:1-580:77\"\u003e\u003ccode\u003enpx typeorm-ts-node-commonjs migration:run\u003c/code\u003e はコマンド実行時の共通部分です。\u003cbr\u003e\n\u003ccode\u003e-d src/data-source.ts\u003c/code\u003e には、DataSource ファイルを指定します。\u003c/p\u003e\n\u003cp data-sourcepos=\"582:1-585:45\"\u003eコマンドを実行すると、次のようにコンソール画面に表示されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3f01eaf72bca230d33d2ba304f08f0158d4937d3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3535313431322f34623632326662632d353261342d623062662d636430632d3564623336353138313438332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F4b622fbc-52a4-b0bf-cd0c-5db365181483.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0150557fb4c642052e818fe2ed6bde6d\" alt=\"migration_r.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/4b622fbc-52a4-b0bf-cd0c-5db365181483.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F551412%2F4b622fbc-52a4-b0bf-cd0c-5db365181483.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=57c1ca2d57d4ef272f275de7c16e3147 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n無事に実行できたら、サーバを立ち上げてみます。\u003cbr\u003e\nエラーが起きなければ成功です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"587:1-589:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# npm run start\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"591:1-591:26\"\u003e\n\u003cspan id=\"4-7-db-を確認する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-7-db-%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-7. DB を確認する\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"593:1-593:41\"\u003e\n\u003cspan id=\"4-7-1-mysql-のコンテナに入る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-7-1-mysql-%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AB%E5%85%A5%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-7-1. MySQL のコンテナに入る\u003c/h3\u003e\n\u003cp data-sourcepos=\"595:1-596:133\"\u003eテーブルが作成されているかの確認をしておきます。\u003cbr\u003e\nDocker コンテナ内のターミナルでは実行できませんので、別途、新しいターミナルを起動させます。\u003c/p\u003e\n\u003cp data-sourcepos=\"598:1-598:87\"\u003edocker ps コマンドで、実行中の MySQL のコンテナ ID を確認します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"600:1-605:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker ps\nCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                               NAMES\n78918ab18ad4   nest-docker-sample_api   \"docker-entrypoint.s…\"   4 hours ago    Up 29 minutes   0.0.0.0:3000-\u0026gt;3000/tcp              nest-docker-sample-api-1\n3fdc62a476f7   mysql:8.0                \"docker-entrypoint.s…\"   4 hours ago    Up 30 minutes   0.0.0.0:3306-\u0026gt;3306/tcp, 33060/tcp   nest-docker-sample-db-1\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"607:1-607:165\"\u003e私の手元では、MySQL のコンテナIDは \u003ccode\u003e3fdc62a476f7\u003c/code\u003e なので、次のようにコマンドを実行することで、コンテナの中に入れます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"609:1-611:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker exec -it 3fdc62a476f7 sh\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch3 data-sourcepos=\"613:1-613:38\"\u003e\n\u003cspan id=\"4-7-2-db-の内容を確認する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-7-2-db-%E3%81%AE%E5%86%85%E5%AE%B9%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4-7-2. DB の内容を確認する\u003c/h3\u003e\n\u003cp data-sourcepos=\"615:1-615:102\"\u003eコンテナに入ったら、次のコマンドを実行して、MySQL の操作を開始します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"617:1-619:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# mysql -u root -p\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"621:1-622:135\"\u003eパスワードが求められるので、\u003ccode\u003epassword\u003c/code\u003e と入力します。\u003cbr\u003e\nいうまでもないですが、このパスワードは、docker-compose.yml の \u003ccode\u003eMYSQL_ROOT_PASSWORD\u003c/code\u003e で指定したものです。\u003c/p\u003e\n\u003cp data-sourcepos=\"624:1-625:48\"\u003e無事に、MySQL に入れたら、\u003ccode\u003eshow databases\u003c/code\u003e コマンドでデータベースの一覧を確認してみます。\u003cbr\u003e\n次のように sample とあれば OK です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"627:1-639:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sample             |\n| sys                |\n+--------------------+\n5 rows in set (0.01 sec)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"641:1-641:68\"\u003euse コマンドで、sample データベースを選択します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"643:1-645:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026gt; use sample;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"647:1-648:54\"\u003e\u003ccode\u003eshow tables;\u003c/code\u003e コマンドで、テーブル一覧を確認します。\u003cbr\u003e\ncomment というテーブルがあれば OK です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"650:1-659:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026gt; show tables;\n+------------------+\n| Tables_in_sample |\n+------------------+\n| comment          |\n| migrations       |\n+------------------+\n2 rows in set (0.01 sec)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"661:1-663:85\"\u003e最後に、comment テーブルの定義を確認します。\u003cbr\u003e\n\u003ccode\u003eshow create table \u0026lt;テーブル名\u0026gt;\u003c/code\u003e コマンドを実行します。\u003cbr\u003e\nコマンドの末尾は、\u003ccode\u003e;\u003c/code\u003e ではなく \u003ccode\u003e\\G\u003c/code\u003e とした方が見やすいです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"665:1-677:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026gt; show create table comment\\G\n*************************** 1. row ***************************\n       Table: comment\nCreate Table: CREATE TABLE `comment` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `body` varchar(255) NOT NULL,\n  `createdAt` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),\n  `updatedAt` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci\n1 row in set (0.00 sec)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"679:1-679:75\"\u003e以上の感じで、テーブルが作成されていれば成功です。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"681:1-681:14\"\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\u003cp data-sourcepos=\"683:1-685:81\"\u003eNestJS と TypeORM v0.3 については、記事があまり見当たらないところなので、備忘として残しておきました。\u003cbr\u003e\nDocker など、詳しい分野ではないので、間違い等があるかもしれません。\u003cbr\u003e\nお気づきのことなどあれば、ご教示いただけると幸いです。\u003c/p\u003e\n","body":"# はじめに\n\nNestJS の環境を Docker コンテナを使って作成しようとしたところ、NestJS とTypeORM の最新バージョンが上がっていました。\nせっかくなので、最新のバージョンを使いましたが、断片的な情報しかなくて結構苦労しました。\n\nこれから触る方に参考となればと思い、一通り全ての作業記録を載せておきます。\n指定した主なバージョンは次のとおりです。\n\n|ライブラリ|バージョン|\n|---|---|\n|Node.js|16.17.0|\n|NestJS|9.1.2|\n|TypeORM|0.3.9|\n|MySQL|8.0|\n\n＜**参考記事**＞\n・[TypeORM 0.3系のマイグレーション](https://qiita.com/Aurum64/items/f5962bd2a643447dbef9)\n・[NestJSをTypeORM 0.3 で使う](https://zenn.dev/hasegawasatoshi/articles/8110ce79119dd0)\n・[NestJS公式 - Database](https://docs.nestjs.com/techniques/database#migrations)\n・[Dockerを利用してNestJS＋TypeORM+MySQLの環境構築する](https://zenn.dev/senri/articles/331162304a78e0)\n・[NestJSとDockerコンテナで立ち上げたMySQLサーバーを接続する](https://qiita.com/mball/items/3defb402b23d3d14ea86)\n・[NestJS + TypeORM + MySQL を使ってテーブルを作ってみる](https://go-tech.blog/nestjs-typeorm-mysql/)\n・[NestJS 入門コース３ DBとCRUD](https://ysuzuki19.github.io/post/nestjs-cource3-rest-api-db)\n\n# 1. 準備\n\n## 1-1. NestJS のインストール\n\nNode.js がインストールされていることが前提です（Node のインストールは省略します）。\n手元のバージョンは次のとおりです（現在の LTS）。\n\n```\n$ node -v\nv16.17.0\n```\n\nバージョンアップなどは次の記事を参照ください。\n・[n (Node.js管理) のインストール手順](https://qiita.com/tora_oba/items/2761452fe8c2b0035ba0)\n\nNestJS は次のコマンドでインストール（またはアップグレード）します。バージョンは `9.1.2` を指定しています（エラーが出たら sudo を付けて実行してみてください）。\n\n```\n$ npm i -g @nestjs/cli@9.1.2\n```\n\nなお、これを書いている時点では、`$ npm i -g @nestjs/cli` で v9.1.2 がインストールされます。\n\n`nest -v` でバージョンの確認ができます。\n\n```\n$ nest -v\n9.1.2\n```\n\n## 1-2. NestJS プロジェクト作成\n\n適当なフォルダを選んで NestJS のプロジェクトを１つ作ります。\nプロジェクト名を nest-docker-sample として次のコマンドを実行します。\n\n```\n$ nest new nest-docker-sample\n```\n\nコマンドを実行すると、どの package manager を使用するか聞かれますので、ここでは npm を選びます。\n![package-manager.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/0a322630-912b-be2f-eeb9-6e13c73eb6fc.png)\nしばらくすると、プロジェクトが作成されます。\n\n# 2. Dockerfile と docker-compose.yml の作成\n\nプロジェクトが作成されたら、ルートディレクトリ直下に３つのファイル（`Dockerfile`, `docker-compose.yml`, `.dockerignore`）を作成します（下図）。\n\n```\nnest-docker-sample\n├──Dockerfile  # 作成\n├──docker-compose.yml  # 作成\n├──.dockerignore  # 作成\n├──package.json\n├──package-lock.json\n└──(...先に作成したその他の nest のファイル)\n```\n\n\n＜**参考記事**＞\n・[いまさらだけどDockerに入門したので分かりやすくまとめてみた](https://qiita.com/gold-kou/items/44860fbda1a34a001fc1#build)\n\n## 2-1. Dockerfile\n\nDockerfile に記載する内容は次のとおりです。\n\n```DockerFile:Dockerfile\nFROM node:16-alpine3.16\nWORKDIR /api\nCOPY package*.json ./\nRUN npm ci\nCOPY . .\n```\n\n指定した内容は、ざっと次のとおりです。\n\n|コマンド（命令）|概要|備考|\n|---|---|---|\n|**[FROM](https://docs.docker.jp/engine/reference/builder.html#from)**|ベースイメージを指定します。|ここでは、[Node.js の公式 Docker イメージ](https://hub.docker.com/_/node/)を使用しています（OS は [alpine](https://ja.wikipedia.org/wiki/Alpine_Linux)※）。|\n**[WORKDIR](https://docs.docker.jp/engine/reference/builder.html#workdir)**|コンテナ内での「コマンドの実行場所」を指定します。|ここでは `/api` と指定しています。|\n|**[COPY](https://docs.docker.jp/engine/reference/builder.html#copy)**|左側にコピー元（ホスト側）\u003cbr /\u003e右側にコピー先（コンテナ側）\u003cbr /\u003eのディレクトリを指定します。|**① `COPY package*.json ./`**\u003cbr /\u003eコピー元の `package*.json` は、package.json と package-lock.json の２つのファイルです。\u003cbr/\u003eコピー先の `./` は上記の WORKDIR の直下（つまり `/api/`）です。\u003cbr /\u003e**② `COPY . .`**\u003cbr /\u003eホスト側に作成したファイルをコンテナにコピーしています。|\n|**[RUN](https://docs.docker.jp/engine/reference/builder.html#run)**|実行するコマンドを指定します。|コンテナに COPY された package-lock.json と package-lock.json を元に `npm ci` でライブラリをインストールします。|\n\n※ alpine は厳密には OS そのものではないですが、ここでは OS と呼んでおきます（参考: [Linuxディストリビューション](https://ja.wikipedia.org/wiki/Linux%E3%83%87%E3%82%A3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3)）。\n\n## 2-2. docker-compose.yml\n\ndocker-compose.yml には次のように記載します。\n\n```docker-compose.yml\nversion: '3.8'\nservices:\n  api:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    restart: always\n    ports:\n      - 3000:3000\n    tty: true\n    volumes:\n      - type: bind\n        source: .\n        target: /api\n    depends_on:\n      - db\n  db:\n    image: mysql:8.0\n    restart: always\n    ports:\n      - 3306:3306\n    environment:\n      MYSQL_DATABASE: sample\n      MYSQL_ROOT_PASSWORD: password\n      MYSQL_USER: user\n      MYSQL_PASSWORD: password\n    volumes:\n      - ./db/data:/var/lib/mysql\n```\n\n指定した内容をざっと書き出すと次のとおりです。\n\n|項目|内容|備考|\n|---|---|---|\n|**version:**|[Compose ファイルのバージョン](https://matsuand.github.io/docs.docker.jp.onthefly/compose/compose-file/compose-file-v3/) です。|今は `3` とか `3.8` で良いようです。|\n|**service:**|以下に、コンテナの定義を記載します。|ここでは、**service 名**を`api` と `db` とした２つのコンテナを作成しています。|\n|**build:**|指定された Dockerfile から、Docker イメージを作成します。|`context:` ワーキングディレクトリを指定\u003cbr /\u003e`dockerfile:` ドッカーファイルのファイル名（ディレクトリ）を指定|\n|**restart:**|コンテナの再起動について指定します。||\n|**ports:**|左側にホスト側のポート、右側にコンテナ側のポートを指定します。|MySQL のホスト側の port を変えたい場合は、`3307:3306` のように記載したりします。|\n|**tty:**|コンテナを起動させ続けるために記載します|参考：[DockerのTTYって何?](https://zenn.dev/hohner/articles/43a0da20181d34)|\n|**volumes:**|ホスト側のデータと、docker コンテナ側のデータをバインドさせます。|**① long syntax**\u003cbr /\u003e　`type:` [マウントの種類](https://docs.docker.jp/compose/compose-file/compose-file-v3.html#id20)を指定\u003cbr /\u003e　`source:` ホスト側ディレクトリを指定\u003cbr /\u003e　`target:` コンテナ側ディレクトリを指定\u003cbr /\u003e**② short syntax**\u003cbr /\u003e　左側: ホスト側のディレクトリを指定\u003cbr /\u003e　右側: コンテナ側のディレクトリを指定|\n|**environment:**|環境変数を指定します。|`MYSQL_DATABASE:` DB 名\u003cbr /\u003e`MYSQL_ROOT_PASSWORD:` root のパスワード\u003cbr /\u003e`MYSQL_USER:` ユーザー名\u003cbr /\u003e`MYSQL_PASSWORD:` ユーザーのパスワード|\n|**depends_on:**|サービス間の[依存関係](https://docs.docker.jp/compose/compose-file/compose-file-v3.html#depends-on)を指定します。|`api:`\u003cbr /\u003e`　depends_on:`\u003cbr /\u003e`　　- db`\u003cbr /\u003eこの例では api より前に db が起動することになります。|\n\nコンテナが消えても DB の内容を保持できるように、ホスト側に `/db` というディレクトリを作成して、MySQL のデータを保存するようにしています。\n保存場所については、Docker の volume に保存する方法もありますので、そのあたりは他のサイトなどで確認してみてください（ここでは行いません）。\n\n```yml:docker-compose.yml 抜粋\n    volumes:\n      - ./db/data:/var/lib/mysql\n```\n\n＜参考サイト＞\n・[Compose ファイル・リファレンス](https://docs.docker.jp/v1.12/compose/compose-file.html)\n・[docker-compose.ymlの書き方について解説してみた](https://qiita.com/yuta-ushijima/items/d3d98177e1b28f736f04)\n\n## 2-3. その他のファイル\n\n### 2-3-1. .dockerignore\n\n.dockerignore ファイルには、Dockerのビルド時に無視するディレクトリ（ファイル）を指定します。\n\n```.dockerignore\n.git/\nnode_modules\n```\n\n### 2-3-2. .gitignore に１行追加\n\n`.gitignore` ファイルに、`/db` を追加しておきます。\n\n```.gitignore\n# compiled output\n/dist\n/node_modules\n/db # これを追加\n\n# 以下略\n```\n\n先述のとおり `/db` には、MySQL のコンテナ内のデータを保存していますので、これを更に `api` コンテナ側に保存しないようにします。\n\n## 2-4. Docker の起動確認\n\nプロジェクトのルートディレクトリに移動します。\n次のコマンドで、docker を起動させます。\n\n```\n$ docker compose up -d\n```\n\n`docker ps` コマンドでコンテナが起動しているか確認します。\n\n```\n$ docker ps\nCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                               NAMES\n78918ab18ad4   nest-docker-sample_api   \"docker-entrypoint.s…\"   36 seconds ago   Up 33 seconds   0.0.0.0:3000-\u003e3000/tcp              nest-docker-sample-api-1\n3fdc62a476f7   mysql:8.0                \"docker-entrypoint.s…\"   36 seconds ago   Up 35 seconds   0.0.0.0:3306-\u003e3306/tcp, 33060/tcp   nest-docker-sample-db-1\n```\n\n確認のため、`npm run start` コマンドでサーバを起動してみます。\nコンテナ内でコマンドを実行するので、頭に `docker compose exec api` を付けています（`api` は docker-compose.yml ファイルで指定した service名です。）。\n\n```\n$ docker compose exec api npm run start\n```\n\n無事に実行できれば、次のように表示されます。\n![npm-run-start.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/5d72ca5c-2903-a4a7-c856-b52134479195.png)\nhttp://localhost:3000/ にアクセスして「Hello World!」が表示されればコンテナの起動は成功です。\n![HelloWorld_1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/bdb9da83-6dc1-ead5-ab2d-02022c3c95da.png)\n作業を続けるため、一旦、**Ctrl + C** でサーバを停止します。\n\n# 3. VSCode Remote-Container\n\nここでは、VSCode Remote-Container を使用します。\n特に必須の内容ではなく、コンテナ内に入ってコマンドが実行できれば良いので、不要な人は「[4. TypeORM の導入](#4-typeorm-の導入)」に進んでください。\n\n＜**参考記事**＞\n・[VSCode Remote Containerが良い](https://qiita.com/d0ne1s/items/d2649801c6f804019db7)\n・[VS Code Remote - Containers を Docker Compose で使うのだー！](https://bufferings.hatenablog.com/entry/2020/06/11/233201)\n・[みんながきっと１万回は聞いている、VS Code Remoteでコンテナ開発をやる方法](https://zenn.dev/niisan/articles/9abd372ae86fc1)\n\n## 3-1. コンテナでのコマンド実行方法の確認\n\n**① コンテナの外からコマンドを実行する**\nコンテナに対してコマンドを実行するには、実行したいコマンドの前に、`docker compose exec \u003cservice名\u003e` と付ければ操作できます（servise名は docker-compose.yml で指定した名称となります）。\n以下は、`npm run start` を実行する例です。\n\n```\n$ docker compose exec api npm run start\n```\n\n**② コンテナに入ってコマンドを実行する**\n次のコマンドで、コンテナに入れば、docker compose exec api と頭に付けなくとも操作できます。\n\n```\n$ docker exec -it \u003cコンテナID\u003e sh\n```\n\nOS（Linuxディストリビューション） で ubuntu を使用する場合は、末尾は `bash` ですが、ここでは alpine を使用しているので `sh` となっています。\n\n**③ Remote-Container を使用する**\nここでは、手軽にコンテナに入るために、Remote-Container を使用します。\n導入方法は、次項以下のとおりです。\n\n## 3-2. Remote-Container の導入\n\n### 3-2-1. インストール\n\nVSCode の拡張機能として、以下の Remote-Container をインストールします。\n\nhttps://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers\n\n### 3-2-2. VSCode でコンテナを開く\n\n**① Remote-Container の使用**\nインストールが完了すると、VSCode の左下に緑のアイコンが表示されますので、これをクリックします。\n![remote1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/a39fe445-8230-999a-f6ec-47b1d7d13133.png)\n**② 操作の選択**\n選択肢が現れますので、Reopen in Container を選択します。\n![remote2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/62e6e9f6-6d67-30ea-1a44-cde1f51df3b6.png)\n**③ Remote-Container を実行するファイルを選択**\nFrom 'docker-compose.yml' を選択します。\n![remote3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/69f5ab43-db17-6209-68e8-dac1c429e365.png)\n**④ service名を選択**\nservice 名を聞かれますので、`api` を選択します。\nこの service 名は、docker-compose.yml で指定した service 名となります。\n![remote4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/27dd0474-1c53-47eb-d6eb-896306c8acdb.png)\n**⑤ WorkSpace の選択**\nWorkspace が存在しないというメッセージが出てきたら、Open Workspace をクリックします。\n![remote5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/77123170-2656-6b41-8463-0e97e1ef2432.png)\nフォルダーは `/api` を選択して、OK をクリックします。\nこの `/api` は、Dockerfile の WORKDIR で指定したディレクトリです。\n![remote6.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/8a6d8809-821e-1807-820b-f0a43e45aa9c.png)\n初期設定は以上です。\n\n### 3-2-3. 状態の確認と若干の補正\n\nコンテナに入ると、次のような画面になっています。\n![remote7.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/8f4bb582-47d2-6292-ce5f-caf1bf32957c.png)\n**① ターミナル**\n入力部分が `78918ab18ad4:/api#` というようになっています。\nこれは `\u003cコンテナID\u003e:\u003cservice名\u003e#` の形式で、ここで直接コンテナに対してコマンドを打つことができます。\n\n```\n78918ab18ad4:/api#\n```\n\n**② 作成されるファイル**\nRemote-Containerを導入すると、ルートの直下にディレクトリ `.devcontainer` と２つのファイルが作成されます。\n\n```\nnest-docker-sample\n├─ .devcontainer\n│   ├── devcontainer.json\n│   └── docker-compose.yml\n└──(...その他のファイル)\n\n```\n\n**③ WorkSpace のディレクトリを修正**\ndevcontainer.json ファイルに \"workspaceFolder\" を指定するプロパティがあるので、ここを \"/workspace\" から \"/api\" に書き換えます。\n\n```.devcontainer/devcontainer.json\n# 書き換え前\n\"workspaceFolder\": \"/workspace\"\n```\n\n```.devcontainer/devcontainer.json\n# 書き換え後\n\"workspaceFolder\": \"/api\"\n```\n\n`/api` は、Dockerfile の WORKDIR で指定したディレクトリです。\n\n### 3-2-4. Remote-Container の終了と再実行\n\nRemote-Container を終了するには、左下の緑の部分をクリックして、`Close Remote Connection` を選択します。\n![remote8.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/f88b1393-cc69-a49a-8b10-db0210f9a5c3.png)\n再度コンテナの中に入るには、左下の緑のアイコンをクリックして、Reopen in Container を選択します。\n![remote9.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/4cb340c9-e2a1-1cad-24ca-baf3ff205430.png)\n\n# 4. TypeORM の導入\n\n## 4-1. TypeORM のインストール\n\n次のコマンドで TypeORM のバージョンを指定してインストールします。\n\n```\n# npm install --save @nestjs/typeorm typeorm@0.3.9 mysql2\n```\n\nこれを書いている時点では、`typeorm@0.3.9` のところを `typeorm` というようにバージョンを指定しなくとも、同じバージョンの TypeORM がインストールされます。\n\n\n次のコマンドで、インストールされた TypeORM のバージョンが確認できます。\n\n```\n# npm info typeorm version\n0.3.9\n```\n\n参考までに、設定が完了した後の `package.json` を貼っておきます。\n\u003cdetails\u003e\u003csummary\u003e\u003cfont color=\"blue\"\u003epackage.json\u003c/font\u003e\u003c/summary\u003e\u003cdiv\u003e\n\n```package.json\n{\n  \"name\": \"nest-docker-sample\",\n  \"version\": \"0.0.1\",\n  \"description\": \"\",\n  \"author\": \"\",\n  \"private\": true,\n  \"license\": \"UNLICENSED\",\n  \"scripts\": {\n    \"prebuild\": \"rimraf dist\",\n    \"build\": \"nest build\",\n    \"format\": \"prettier --write \\\"src/**/*.ts\\\" \\\"test/**/*.ts\\\"\",\n    \"start\": \"nest start\",\n    \"start:dev\": \"nest start --watch\",\n    \"start:debug\": \"nest start --debug --watch\",\n    \"start:prod\": \"node dist/main\",\n    \"lint\": \"eslint \\\"{src,apps,libs,test}/**/*.ts\\\" --fix\",\n    \"test\": \"jest\",\n    \"test:watch\": \"jest --watch\",\n    \"test:cov\": \"jest --coverage\",\n    \"test:debug\": \"node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand\",\n    \"test:e2e\": \"jest --config ./test/jest-e2e.json\"\n  },\n  \"dependencies\": {\n    \"@nestjs/common\": \"^9.0.0\",\n    \"@nestjs/core\": \"^9.0.0\",\n    \"@nestjs/platform-express\": \"^9.0.0\",\n    \"@nestjs/typeorm\": \"^9.0.1\",\n    \"mysql2\": \"^2.3.3\",\n    \"reflect-metadata\": \"^0.1.13\",\n    \"rimraf\": \"^3.0.2\",\n    \"rxjs\": \"^7.2.0\",\n    \"typeorm\": \"^0.3.9\"\n  },\n  \"devDependencies\": {\n    \"@nestjs/cli\": \"^9.0.0\",\n    \"@nestjs/schematics\": \"^9.0.0\",\n    \"@nestjs/testing\": \"^9.0.0\",\n    \"@types/express\": \"^4.17.13\",\n    \"@types/jest\": \"28.1.8\",\n    \"@types/node\": \"^16.0.0\",\n    \"@types/supertest\": \"^2.0.11\",\n    \"@typescript-eslint/eslint-plugin\": \"^5.0.0\",\n    \"@typescript-eslint/parser\": \"^5.0.0\",\n    \"eslint\": \"^8.0.1\",\n    \"eslint-config-prettier\": \"^8.3.0\",\n    \"eslint-plugin-prettier\": \"^4.0.0\",\n    \"jest\": \"28.1.3\",\n    \"prettier\": \"^2.3.2\",\n    \"source-map-support\": \"^0.5.20\",\n    \"supertest\": \"^6.1.3\",\n    \"ts-jest\": \"28.0.8\",\n    \"ts-loader\": \"^9.2.3\",\n    \"ts-node\": \"^10.0.0\",\n    \"tsconfig-paths\": \"4.1.0\",\n    \"typescript\": \"^4.7.4\"\n  },\n  \"jest\": {\n    \"moduleFileExtensions\": [\n      \"js\",\n      \"json\",\n      \"ts\"\n    ],\n    \"rootDir\": \"src\",\n    \"testRegex\": \".*\\\\.spec\\\\.ts$\",\n    \"transform\": {\n      \"^.+\\\\.(t|j)s$\": \"ts-jest\"\n    },\n    \"collectCoverageFrom\": [\n      \"**/*.(t|j)s\"\n    ],\n    \"coverageDirectory\": \"../coverage\",\n    \"testEnvironment\": \"node\"\n  }\n}\n```\n\u003c/div\u003e\u003c/details\u003e\n\n## 4-2. Entity の作成\n\nテーブル定義として、テスト用の Entity クラスを作成します。\n以下のように、`src/entities/` ディレクトリに `comment.entity.ts` というファイルを作成しました（中身は適当です）。\nこれを元に、DB にテーブルが作成されることになります。\n\n```src/entities/comment.entity.ts\nimport {\n  Column,\n  CreateDateColumn,\n  Entity,\n  PrimaryGeneratedColumn,\n  UpdateDateColumn,\n} from 'typeorm';\n\n@Entity()\nexport class Comment {\n  @PrimaryGeneratedColumn()\n  id?: number;\n\n  @Column()\n  body: string;\n\n  @CreateDateColumn()\n  createdAt?: Date;\n\n  @UpdateDateColumn()\n  updatedAt?: Date;\n\n  constructor(body: string) {\n    this.body = body;\n  }\n}\n```\n\n## 4-3. DataSource の作成\n\nTypeORM v0.3 では、データベースの接続を定義する DataSource ファイルを作成します。\nTypeORM v0.2 においては、`ormconfig.js` のようなファイルを作成していました（現在は非推奨のようです。）。\n\n`src/` ディレクトリの直下に以下のように `data-source.ts` ファイルを作成します。\n設定内容は、コード中のコメントのとおりです。\n\n```src/data-source.ts\nimport { Comment } from './entities/comment.entity';\nimport { DataSource } from 'typeorm';\n\nexport const AppDataSource = new DataSource({\n  type: 'mysql', // MySQL の場合\n  host: 'db', // docker-compose.yml で指定したコンテナの service 名\n  port: 3306, // ホスト側のポート（docker-compose.yml の ports: の左側に対応）\n  username: 'user', // docker-compose.yml の MYSQL_USER\n  password: 'password', // docker-compose.yml の MYSQL_PASSWORD\n  database: 'sample', // docker-compose.yml の MYSQL_DATABASE\n  logging: true, // コンソール画面に実行したSQLが表示される\n  synchronize: false, // true にすると migration が自動で実行されます。\n  entities: [Comment], // エンティティクラスを指定する（複数の場合はカンマで区切る）\n  migrations: ['dist/migration/*.js'], // dist ディレクトリ内の js ファイルを指定する\n});\n```\n\n＜**参考サイト**＞\n・[npm - TypeORM](https://www.npmjs.com/package/typeorm)\n\n## 4-4. app.module.ts の修正\n\nDataSource ファイルを読み込むために `src/app.module.ts` を編集します。\n\n```src/app.module.ts\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm'; // 追加\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { AppDataSource } from './data-source'; // 追加\n\n@Module({\n  imports: [TypeOrmModule.forRoot(AppDataSource.options)], // 修正\n  controllers: [AppController],\n  providers: [AppService],\n})\nexport class AppModule {}\n```\n\nTypeOrmModule.forRoot() の引数には、DataSource から import した AppDataSource　の option プロパティを指定します（`AppDataSource.options`）。\n\n## 4-5. マイグレーションファイルの生成（migration:generate）\n\nマイグレーションファイルの生成コマンド（migration:generate）も書き方が変わっています。\n\n```\n# npx typeorm-ts-node-commonjs migration:generate src/migration/CommentMigration -d src/data-source.ts\n```\n\n冒頭の `npx typeorm-ts-node-commonjs migration:generate` は共通です。\n次の `src/migration/CommentMigration` は、マイグレーションファイルを作成するディレクトリ/ファイル名を指定しています。\n最後の `-d src/data-source.ts` には、接続情報となる DataSource ファイルを指定しています。\nこの辺りは、冒頭にも紹介した[この記事](https://qiita.com/Aurum64/items/f5962bd2a643447dbef9)を参考とさせていただいています。\n\nコマンドを実行すると、ターミナルに次のような表示がされます。\n![migration_g2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/269b2779-bbc1-7e4a-bd79-ae3495cace8e.png)\n無事に成功すれば、指定した `src/migration/` フォルダに以下のようなマイグレーションファイルができていると思います。\n\n```src/migration/1663429464503-CommentMigration.ts\nimport { MigrationInterface, QueryRunner } from \"typeorm\";\n\nexport class CommentMigration1663489067218 implements MigrationInterface {\n    name = 'CommentMigration1663489067218'\n\n    public async up(queryRunner: QueryRunner): Promise\u003cvoid\u003e {\n        await queryRunner.query(`CREATE TABLE \\`comment\\` (\\`id\\` int NOT NULL AUTO_INCREMENT, \\`body\\` varchar(255) NOT NULL, \\`createdAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6), \\`updatedAt\\` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6), PRIMARY KEY (\\`id\\`)) ENGINE=InnoDB`);\n    }\n\n    public async down(queryRunner: QueryRunner): Promise\u003cvoid\u003e {\n        await queryRunner.query(`DROP TABLE \\`comment\\``);\n    }\n\n}\n```\n\n## 4-6. マイグレーションの実行（migration:run）\n\n### 4-6-1. 先にアプリをビルドする\n\ndist の中身を書き換えないと、マイグレーションが実行されないので、実行前に一度ビルドします。\n次のコマンドを実行します。\n\n```\n# npm run build\n```\n\nなお、ここではしませんが、`npm run start` などでサーバを立ち上げても、dist が更新されます（つまり、dist が更新できれば何でも良いです）。\n\n### 4-6-2. migration:run\n\nさて、いよいよ migration:run を実行します。\nコマンドは、次のとおりです。\n\n```\n# npx typeorm-ts-node-commonjs migration:run -d src/data-source.ts\n```\n\n`npx typeorm-ts-node-commonjs migration:run` はコマンド実行時の共通部分です。\n`-d src/data-source.ts` には、DataSource ファイルを指定します。\n\nコマンドを実行すると、次のようにコンソール画面に表示されます。\n![migration_r.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/551412/4b622fbc-52a4-b0bf-cd0c-5db365181483.png)\n無事に実行できたら、サーバを立ち上げてみます。\nエラーが起きなければ成功です。\n\n```\n# npm run start\n```\n\n## 4-7. DB を確認する\n\n### 4-7-1. MySQL のコンテナに入る\n\nテーブルが作成されているかの確認をしておきます。\nDocker コンテナ内のターミナルでは実行できませんので、別途、新しいターミナルを起動させます。\n\ndocker ps コマンドで、実行中の MySQL のコンテナ ID を確認します。\n\n```\n$ docker ps\nCONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                               NAMES\n78918ab18ad4   nest-docker-sample_api   \"docker-entrypoint.s…\"   4 hours ago    Up 29 minutes   0.0.0.0:3000-\u003e3000/tcp              nest-docker-sample-api-1\n3fdc62a476f7   mysql:8.0                \"docker-entrypoint.s…\"   4 hours ago    Up 30 minutes   0.0.0.0:3306-\u003e3306/tcp, 33060/tcp   nest-docker-sample-db-1\n```\n\n私の手元では、MySQL のコンテナIDは `3fdc62a476f7` なので、次のようにコマンドを実行することで、コンテナの中に入れます。\n\n```\n$ docker exec -it 3fdc62a476f7 sh\n```\n\n### 4-7-2. DB の内容を確認する\n\nコンテナに入ったら、次のコマンドを実行して、MySQL の操作を開始します。\n\n```\n# mysql -u root -p\n```\n\nパスワードが求められるので、`password` と入力します。\nいうまでもないですが、このパスワードは、docker-compose.yml の `MYSQL_ROOT_PASSWORD` で指定したものです。\n\n無事に、MySQL に入れたら、`show databases` コマンドでデータベースの一覧を確認してみます。\n次のように sample とあれば OK です。\n\n```\n\u003e show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sample             |\n| sys                |\n+--------------------+\n5 rows in set (0.01 sec)\n```\n\nuse コマンドで、sample データベースを選択します。\n\n```\n\u003e use sample;\n```\n\n`show tables;` コマンドで、テーブル一覧を確認します。\ncomment というテーブルがあれば OK です。\n\n```\n\u003e show tables;\n+------------------+\n| Tables_in_sample |\n+------------------+\n| comment          |\n| migrations       |\n+------------------+\n2 rows in set (0.01 sec)\n```\n\n最後に、comment テーブルの定義を確認します。\n`show create table \u003cテーブル名\u003e` コマンドを実行します。\nコマンドの末尾は、`;` ではなく `\\G` とした方が見やすいです。\n\n```\n\u003e show create table comment\\G\n*************************** 1. row ***************************\n       Table: comment\nCreate Table: CREATE TABLE `comment` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `body` varchar(255) NOT NULL,\n  `createdAt` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),\n  `updatedAt` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci\n1 row in set (0.00 sec)\n```\n\n以上の感じで、テーブルが作成されていれば成功です。\n\n# さいごに\n\nNestJS と TypeORM v0.3 については、記事があまり見当たらないところなので、備忘として残しておきました。\nDocker など、詳しい分野ではないので、間違い等があるかもしれません。\nお気づきのことなどあれば、ご教示いただけると幸いです。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T22:04:38+09:00","group":null,"id":"fa2113fcabf84e0a20e6","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"MySQL","versions":[]},{"name":"Docker","versions":[]},{"name":"TypeORM","versions":[]},{"name":"NestJS","versions":[]}],"title":"NestJS v9 + TypeORM v0.3 + MySQL + Docker で開発環境を構築する","updated_at":"2022-09-18T22:04:38+09:00","url":"https://qiita.com/t-yama-3/items/fa2113fcabf84e0a20e6","user":{"description":"","facebook_id":"","followees_count":6,"followers_count":17,"github_login_name":"t-yama-3","id":"t-yama-3","items_count":53,"linkedin_id":"","location":"東京都","name":"","organization":"","permanent_id":551412,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/551412/6f7f1d35eb40027b0627c7ff855739a76e55e737/x_large.png?1577145641","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:21\"\u003e\n\u003cspan id=\"今回の備忘録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E5%82%99%E5%BF%98%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回の備忘録\u003c/h2\u003e\n\u003cp data-sourcepos=\"2:1-3:98\"\u003e「org.apache.commons.lang3」の「StringUtils」についてです。\u003cbr\u003e\n\u003ca href=\"https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/StringUtils.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/StringUtils.html\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"5:1-5:39\"\u003e\n\u003cspan id=\"空文字チェックをする場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A9%BA%E6%96%87%E5%AD%97%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%92%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e空文字チェックをする場合\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"6:1-6:29\"\u003e\n\u003cspan id=\"stringutilsisempty\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stringutilsisempty\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「StringUtils.isEmpty」\u003c/h3\u003e\n\u003cp data-sourcepos=\"7:1-8:35\"\u003e→空文字の場合、true\u003cbr\u003e\n→空文字でない場合、false\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"10:5-44:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    import org.apache.commons.lang3.StringUtils;　← 参照\n\n    @SpringBootApplication\n    public class InputPractice3 {\n\n\tpublic static void main(String[] args) {\n\n\t\tString testA = \"　\";     // スペース\n\t\tString testB = \"あいう\";  // 設定文字\n\t\tString testC = \"\";       // 空文字\n\t\tString testD = null;     // NULL\n\n\t\t// testAで判定\n\t\tif (StringUtils.isEmpty(testA)) {\n\t\t\tSystem.out.println(\"testA:(1)空文字です\");\n\t\t}\n\t\t// testBで判定\n\t\tif (StringUtils.isEmpty(testB)) {\n\t\t\tSystem.out.println(\"testB:(1)空文字です\");\n\t\t}\n\t\t// testCで判定\n\t\tif (StringUtils.isEmpty(testC)) {\n\t\t\tSystem.out.println(\"testC︎:(1)空文字です\"); // 通る\n\t\t}\n\t\t// testDで判定\n\t\tif (StringUtils.isEmpty(testD)) {\n\t\t\tSystem.out.println(\"testD:(1)空文字です\"); // 通る\n\t\t}\n    }\n}\n\n// 結果\n// testC︎:(1)空文字です\n// testD:(1)空文字です\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"45:1-47:58\"\u003e結論：\u003cbr\u003e\n　スペースは「空文字」とは認定されない。\u003cbr\u003e\n　空文字とNULLは「空文字」と認定される。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"50:1-50:57\"\u003e\n\u003cspan id=\"空文字でないことをチェックをする場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A9%BA%E6%96%87%E5%AD%97%E3%81%A7%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%92%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e空文字でないことをチェックをする場合\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"51:1-51:32\"\u003e\n\u003cspan id=\"stringutilsisnotempty\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stringutilsisnotempty\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「StringUtils.isNotEmpty」\u003c/h3\u003e\n\u003cp data-sourcepos=\"52:1-53:29\"\u003e→空文字でないの場合、true\u003cbr\u003e\n→空文字の場合、false\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"55:5-89:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    import org.apache.commons.lang3.StringUtils;　← 参照\n\n    @SpringBootApplication\n    public class InputPractice3 {\n\n\tpublic static void main(String[] args) {\n\n\t\tString testA = \"　\";     // スペース\n\t\tString testB = \"あいう\";  // 設定文字\n\t\tString testC = \"\";       // 空文字\n\t\tString testD = null;     // NULL\n\n\t\t// testAで判定\n\t\tif (StringUtils.isNotEmpty(testA)) {\n\t\t\tSystem.out.println(\"testA:(2)空文字ではありません\"); // 通る\n\t\t}\n\t\t// testBで判定\n\t\tif (StringUtils.isNotEmpty(testB)) {\n\t\t\tSystem.out.println(\"testB:(2)空文字ではありません\"); // 通る\n\t\t}\n\t\t// testCで判定\n\t\tif (StringUtils.isNotEmpty(testC)) {\n\t\t\tSystem.out.println(\"testC:(2)空文字ではありません\");\n\t\t}\n\t\t// testDで判定\n\t\tif (StringUtils.isNotEmpty(testD)) {\n\t\t\tSystem.out.println(\"testD:(2)空文字ではありません\");\n\t\t}\n    }\n}\n\n// 結果\n// testA:(2)空文字ではありません\n// testB:(2)空文字ではありません\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"90:1-91:80\"\u003e結論：\u003cbr\u003e\n　isNotEmptyというだけあって、isEmptyと全く逆の結果になる。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"93:1-93:45\"\u003e\n\u003cspan id=\"スペースをチェックをする場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%92%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスペースをチェックをする場合\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"94:1-94:29\"\u003e\n\u003cspan id=\"stringutilsisblank\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stringutilsisblank\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「StringUtils.isBlank」\u003c/h3\u003e\n\u003cp data-sourcepos=\"95:1-96:56\"\u003e→スペース（ブランク）の場合、true\u003cbr\u003e\n→スペース（ブランク）でない場合、false\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"98:5-133:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    import org.apache.commons.lang3.StringUtils;　← 参照\n\n    @SpringBootApplication\n    public class InputPractice3 {\n\n\tpublic static void main(String[] args) {\n\n\t\tString testA = \"　\";     // スペース\n\t\tString testB = \"あいう\";  // 設定文字\n\t\tString testC = \"\";       // 空文字\n\t\tString testD = null;     // NULL\n\n\t\t// testAで判定\n\t\tif (StringUtils.isBlank(testA)) {\n\t\t\tSystem.out.println(\"testA:(3)空白文字です\"); // 通る\n\t\t}\n\t\t// testBで判定\n\t\tif (StringUtils.isBlank(testB)) {\n\t\t\tSystem.out.println(\"testB:(3)空白文字です\");\n\t\t}\n\t\t// testCで判定\n\t\tif (StringUtils.isBlank(testC)) {\n\t\t\tSystem.out.println(\"testC:(3)空白文字です\"); // 通る\n\t\t}\n\t\t// testDで判定\n\t\tif (StringUtils.isBlank(testD)) {\n\t\t\tSystem.out.println(\"testD:(3)空白文字です\"); // 通る\n\t\t}\n    }\n}\n\n// 結果\n// testA:(3)空白文字です\n// testC:(3)空白文字です\n// testD:(3)空白文字です\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"134:1-136:69\"\u003e結論：\u003cbr\u003e\n　isEmptyの結果+αで、スペースも検知される。\u003cbr\u003e\n（空文字とブランクを共に見たい場合におすすめ）\u003c/p\u003e\n\u003ch2 data-sourcepos=\"138:1-138:66\"\u003e\n\u003cspan id=\"スペース文字でないことをチェックをする場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E6%96%87%E5%AD%97%E3%81%A7%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%82%92%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスペース文字でないことをチェックをする場合\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"139:1-139:32\"\u003e\n\u003cspan id=\"stringutilsisnotblank\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stringutilsisnotblank\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「StringUtils.isNotBlank」\u003c/h3\u003e\n\u003cp data-sourcepos=\"140:1-141:50\"\u003e→スペース（ブランク）でない場合、true\u003cbr\u003e\n→スペース（ブランク）の場合、false\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"143:5-176:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    import org.apache.commons.lang3.StringUtils;　← 参照\n\n    @SpringBootApplication\n    public class InputPractice3 {\n\n\tpublic static void main(String[] args) {\n\n\t\tString testA = \"　\";     // スペース\n\t\tString testB = \"あいう\";  // 設定文字\n\t\tString testC = \"\";       // 空文字\n\t\tString testD = null;     // NULL\n\n\t\t// testAで判定\n\t\tif (StringUtils.isNotBlank(testA)) {\n\t\t\tSystem.out.println(\"testA:(4)空白文字ではありません\");\n\t\t}\n\t\t// testBで判定\n\t\tif (StringUtils.isNotBlank(testB)) {\n\t\t\tSystem.out.println(\"testB:(4)空白文字ではありません\"); // 通る\n\t\t}\n\t\t// testCで判定\n\t\tif (StringUtils.isNotBlank(testC)) {\n\t\t\tSystem.out.println(\"testC:(4)空白文字ではありません\");\n\t\t}\n\t\t// testDで判定\n\t\tif (StringUtils.isNotBlank(testD)) {\n\t\t\tSystem.out.println(\"testD:(4)空白文字ではありません\");\n\t\t}\n    }\n}\n\n// 結果\n// testB:(4)空白文字ではありません\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"177:1-178:92\"\u003e結論：\u003cbr\u003e\n　こちらもisNotBlankというだけあって、isBlankと全く逆の結果になる。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"180:1-180:15\"\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h2\u003e\n\u003cp data-sourcepos=\"181:1-182:140\"\u003eこれまではisEmptyを使うことしかほとんどなかったのですが、isBlankを積極的に使っていこうと思いました。isEmptyに指定する際に、isEmpty(文字列.trim())を使用でも、isBlankとの併用と同じ結果になるので、そちらでも良いかもです。\u003cbr\u003e\nStringUtilsはよく使うチェックに使えるものが多いので、しばらくいろいろ試していこうと思っています。\u003c/p\u003e\n","body":"## 今回の備忘録\n「org.apache.commons.lang3」の「StringUtils」についてです。\n\u003chttps://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/StringUtils.html\u003e\n\n## 空文字チェックをする場合\n### 「StringUtils.isEmpty」\n→空文字の場合、true\n→空文字でない場合、false\n\n        import org.apache.commons.lang3.StringUtils;　← 参照\n\n        @SpringBootApplication\n        public class InputPractice3 {\n\n    \tpublic static void main(String[] args) {\n\n    \t\tString testA = \"　\";     // スペース\n    \t\tString testB = \"あいう\";  // 設定文字\n    \t\tString testC = \"\";       // 空文字\n    \t\tString testD = null;     // NULL\n\n    \t\t// testAで判定\n    \t\tif (StringUtils.isEmpty(testA)) {\n    \t\t\tSystem.out.println(\"testA:(1)空文字です\");\n    \t\t}\n    \t\t// testBで判定\n    \t\tif (StringUtils.isEmpty(testB)) {\n    \t\t\tSystem.out.println(\"testB:(1)空文字です\");\n    \t\t}\n    \t\t// testCで判定\n    \t\tif (StringUtils.isEmpty(testC)) {\n    \t\t\tSystem.out.println(\"testC︎:(1)空文字です\"); // 通る\n    \t\t}\n    \t\t// testDで判定\n    \t\tif (StringUtils.isEmpty(testD)) {\n    \t\t\tSystem.out.println(\"testD:(1)空文字です\"); // 通る\n    \t\t}\n        }\n    }\n\n    // 結果\n    // testC︎:(1)空文字です\n    // testD:(1)空文字です\n\n結論：\n　スペースは「空文字」とは認定されない。\n　空文字とNULLは「空文字」と認定される。\n\n\n## 空文字でないことをチェックをする場合\n### 「StringUtils.isNotEmpty」\n→空文字でないの場合、true\n→空文字の場合、false\n\n        import org.apache.commons.lang3.StringUtils;　← 参照\n\n        @SpringBootApplication\n        public class InputPractice3 {\n\n    \tpublic static void main(String[] args) {\n\n    \t\tString testA = \"　\";     // スペース\n    \t\tString testB = \"あいう\";  // 設定文字\n    \t\tString testC = \"\";       // 空文字\n    \t\tString testD = null;     // NULL\n\n    \t\t// testAで判定\n    \t\tif (StringUtils.isNotEmpty(testA)) {\n    \t\t\tSystem.out.println(\"testA:(2)空文字ではありません\"); // 通る\n    \t\t}\n    \t\t// testBで判定\n    \t\tif (StringUtils.isNotEmpty(testB)) {\n    \t\t\tSystem.out.println(\"testB:(2)空文字ではありません\"); // 通る\n    \t\t}\n    \t\t// testCで判定\n    \t\tif (StringUtils.isNotEmpty(testC)) {\n    \t\t\tSystem.out.println(\"testC:(2)空文字ではありません\");\n    \t\t}\n    \t\t// testDで判定\n    \t\tif (StringUtils.isNotEmpty(testD)) {\n    \t\t\tSystem.out.println(\"testD:(2)空文字ではありません\");\n    \t\t}\n        }\n    }\n\n    // 結果\n    // testA:(2)空文字ではありません\n    // testB:(2)空文字ではありません\n\n結論：\n　isNotEmptyというだけあって、isEmptyと全く逆の結果になる。\n\n## スペースをチェックをする場合\n### 「StringUtils.isBlank」\n→スペース（ブランク）の場合、true\n→スペース（ブランク）でない場合、false\n\n        import org.apache.commons.lang3.StringUtils;　← 参照\n\n        @SpringBootApplication\n        public class InputPractice3 {\n\n    \tpublic static void main(String[] args) {\n\n    \t\tString testA = \"　\";     // スペース\n    \t\tString testB = \"あいう\";  // 設定文字\n    \t\tString testC = \"\";       // 空文字\n    \t\tString testD = null;     // NULL\n\n    \t\t// testAで判定\n    \t\tif (StringUtils.isBlank(testA)) {\n    \t\t\tSystem.out.println(\"testA:(3)空白文字です\"); // 通る\n    \t\t}\n    \t\t// testBで判定\n    \t\tif (StringUtils.isBlank(testB)) {\n    \t\t\tSystem.out.println(\"testB:(3)空白文字です\");\n    \t\t}\n    \t\t// testCで判定\n    \t\tif (StringUtils.isBlank(testC)) {\n    \t\t\tSystem.out.println(\"testC:(3)空白文字です\"); // 通る\n    \t\t}\n    \t\t// testDで判定\n    \t\tif (StringUtils.isBlank(testD)) {\n    \t\t\tSystem.out.println(\"testD:(3)空白文字です\"); // 通る\n    \t\t}\n        }\n    }\n\n    // 結果\n    // testA:(3)空白文字です\n    // testC:(3)空白文字です\n    // testD:(3)空白文字です\n\n結論：\n　isEmptyの結果+αで、スペースも検知される。\n（空文字とブランクを共に見たい場合におすすめ）\n\n## スペース文字でないことをチェックをする場合\n### 「StringUtils.isNotBlank」\n→スペース（ブランク）でない場合、true\n→スペース（ブランク）の場合、false\n\n        import org.apache.commons.lang3.StringUtils;　← 参照\n\n        @SpringBootApplication\n        public class InputPractice3 {\n\n    \tpublic static void main(String[] args) {\n\n    \t\tString testA = \"　\";     // スペース\n    \t\tString testB = \"あいう\";  // 設定文字\n    \t\tString testC = \"\";       // 空文字\n    \t\tString testD = null;     // NULL\n\n    \t\t// testAで判定\n    \t\tif (StringUtils.isNotBlank(testA)) {\n    \t\t\tSystem.out.println(\"testA:(4)空白文字ではありません\");\n    \t\t}\n    \t\t// testBで判定\n    \t\tif (StringUtils.isNotBlank(testB)) {\n    \t\t\tSystem.out.println(\"testB:(4)空白文字ではありません\"); // 通る\n    \t\t}\n    \t\t// testCで判定\n    \t\tif (StringUtils.isNotBlank(testC)) {\n    \t\t\tSystem.out.println(\"testC:(4)空白文字ではありません\");\n    \t\t}\n    \t\t// testDで判定\n    \t\tif (StringUtils.isNotBlank(testD)) {\n    \t\t\tSystem.out.println(\"testD:(4)空白文字ではありません\");\n    \t\t}\n        }\n    }\n\n    // 結果\n    // testB:(4)空白文字ではありません\n\n結論：\n　こちらもisNotBlankというだけあって、isBlankと全く逆の結果になる。\n\n## 終わりに\nこれまではisEmptyを使うことしかほとんどなかったのですが、isBlankを積極的に使っていこうと思いました。isEmptyに指定する際に、isEmpty(文字列.trim())を使用でも、isBlankとの併用と同じ結果になるので、そちらでも良いかもです。\nStringUtilsはよく使うチェックに使えるものが多いので、しばらくいろいろ試していこうと思っています。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:59:10+09:00","group":null,"id":"25cdc9bc72cf5348e1da","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Java入門","versions":[]}],"title":"現場で覚えたJava文法知識【備忘録】③","updated_at":"2022-09-18T22:10:26+09:00","url":"https://qiita.com/yu-F/items/25cdc9bc72cf5348e1da","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"Fukuta-Y","id":"yu-F","items_count":7,"linkedin_id":"","location":"TOKYO","name":"yu F","organization":"","permanent_id":583781,"profile_image_url":"https://avatars2.githubusercontent.com/u/57815910?v=4","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:137\"\u003e今回はjoystickを使って、オブジェクトの操作とジャンプボタンを作る機能についてまとめていきます！\u003c/p\u003e\n\u003cdiv data-sourcepos=\"3:1-7:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"4:1-6:33\"\u003e使用PC： MacBook Pro (13-inch, M1, 2020)\u003cbr\u003e\nOSバージョン: 11.5.2\u003cbr\u003e\nUnityバージョン：2021.3.2f1\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"9:1-9:29\"\u003e\n\u003cspan id=\"実際にプレイすると\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%83%97%E3%83%AC%E3%82%A4%E3%81%99%E3%82%8B%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実際にプレイすると\u003c/h1\u003e\n\u003cp data-sourcepos=\"10:1-11:45\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/11ff30ae5c42e623b3b6aea8055164b1ea375ad3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3839303431392f38303637383531312d343463632d613765382d626663352d3534346232373932656632622e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/80678511-44cc-a7e8-bfc5-544b2792ef2b.gif\" alt=\"画面収録-2022-08-06-16.27.52_out.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/80678511-44cc-a7e8-bfc5-544b2792ef2b.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこんな感じになったら完成です！\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-19:48\"\u003eサンプル動画では\u003cbr\u003e\n①Sphere→Rigidbodyを加えておく\u003cbr\u003e\n②Plane\u003cbr\u003e\n③Material（緑色）→Planeにつける\u003cbr\u003e\n④\u003ca href=\"https://assetstore.unity.com/packages/tools/input-management/joystick-pack-107631\" rel=\"nofollow noopener\" target=\"_blank\"\u003ejoystick\u003c/a\u003e→unityにインポートしておく\u003cbr\u003e\n⑤Canvas\u003cbr\u003e\nをアセットとして使用しています。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"21:1-21:29\"\u003e\n\u003cspan id=\"オブジェクトの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eオブジェクトの準備\u003c/h1\u003e\n\u003cp data-sourcepos=\"22:1-23:162\"\u003eオブジェクトを画面のようにいい感じに収まるように配置します。笑\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/639bb94ae392c05381536c66eed16f0ffb1605e9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3839303431392f64616336623461662d313335652d643631332d623034642d6662646535343739373831302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F890419%2Fdac6b4af-135e-d613-b04d-fbde54797810.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fb467b3b5a9f9bc39ea3ac85ff3d94c9\" alt=\"スクリーンショット 2022-09-17 1.27.15.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/dac6b4af-135e-d613-b04d-fbde54797810.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F890419%2Fdac6b4af-135e-d613-b04d-fbde54797810.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a6699a2d057de6b7347c334430472ac9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"25:1-25:61\"\u003e\n\u003cspan id=\"移動用のjoystickとジャンプ用のボタンを作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%A7%BB%E5%8B%95%E7%94%A8%E3%81%AEjoystick%E3%81%A8%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E7%94%A8%E3%81%AE%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e移動用のjoystickとジャンプ用のボタンを作成\u003c/h1\u003e\n\u003cp data-sourcepos=\"26:1-30:72\"\u003e\u003cstrong\u003e①canvasにjoystickを入れる\u003c/strong\u003e\u003cbr\u003e\n今回は\u003ccode\u003eFixed Joystick\u003c/code\u003eを使います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/da3c235af5482685927e7c1517910e098a33ecdb/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3839303431392f32653536636530352d346137642d346161322d343134392d3330613631396366636231302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F890419%2F2e56ce05-4a7d-4aa2-4149-30a619cfcb10.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4c99d14779c06f8081ca1fb29178aba2\" alt=\"スクリーンショット 2022-09-17 1.29.26.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/2e56ce05-4a7d-4aa2-4149-30a619cfcb10.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F890419%2F2e56ce05-4a7d-4aa2-4149-30a619cfcb10.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=375ee4eb44975b6db4d34a275c736ef3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\njoystickのパッケージの中から\u003ccode\u003eFixed joystick\u003c/code\u003eをcanvasの中にドラッグ\u0026amp;ドロップします。\u003cbr\u003e\n画面左側にいい感じの位置になるように調整します。\u003c/p\u003e\n\u003cp data-sourcepos=\"32:1-34:163\"\u003e\u003cstrong\u003e②ボタンの作成\u003c/strong\u003e\u003cbr\u003e\nHierarchyビューから、\u003ccode\u003eCreate\u003c/code\u003e→\u003ccode\u003eUI\u003c/code\u003e→\u003ccode\u003eImage\u003c/code\u003eを作成し、こちらも画面右側にいいな感じになるように調整します。今回は名前をFixed Joystickにしました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b98551297d48d41789ec652519203e7e9a53346c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3839303431392f38336563643364642d636366302d366365312d633866312d3861613231306564313936382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F890419%2F83ecd3dd-ccf0-6ce1-c8f1-8aa210ed1968.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6dd94f234c67975c0af20e0394534d4b\" alt=\"スクリーンショット 2022-09-18 21.06.18.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/83ecd3dd-ccf0-6ce1-c8f1-8aa210ed1968.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F890419%2F83ecd3dd-ccf0-6ce1-c8f1-8aa210ed1968.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=58cdb8191ab9a7caa2bc4673b22e1acb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"36:1-38:152\"\u003eSource ImageにはJoystickのパックに付属しているものを使用します。\u003cbr\u003e\nここは以下の動画を参考にして、お好きなものを選択してください！\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/35fc3ab087542811bdf51f674ad5852fdbfc6260/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3839303431392f30303432303330642d643634322d653338312d613836342d6238643162363164356365632e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/0042030d-d642-e381-a864-b8d1b61d5cec.gif\" alt=\"画面収録-2022-09-18-21.13.56_out.gif\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/0042030d-d642-e381-a864-b8d1b61d5cec.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"42:1-42:26\"\u003e\n\u003cspan id=\"スクリプトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクリプトの作成\u003c/h1\u003e\n\u003cp data-sourcepos=\"43:1-43:117\"\u003e\u003ccode\u003eMyScript\u003c/code\u003eと\u003ccode\u003eJoybutton\u003c/code\u003eの二つのスクリプトを作成し、それぞれ以下のコードを入力します。\u003c/p\u003e\n\u003cp data-sourcepos=\"45:1-45:46\"\u003e\u003ccode\u003eMyScript\u003c/code\u003eはSphereにアタッチします。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"cs\" data-sourcepos=\"46:1-85:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMyScript\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eJoystick\u003c/span\u003e \u003cspan class=\"n\"\u003ejoystick\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"n\"\u003eJoybutton\u003c/span\u003e \u003cspan class=\"n\"\u003ejoybutton\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprotected\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ejump\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Start is called before the first frame update\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ejoystick\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFindObjectOfType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eJoystick\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ejoybutton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFindObjectOfType\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eJoybutton\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Update is called once per frame\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003erigidibody\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetComponent\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRigidbody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;();\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003erigidibody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evelocity\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejoystick\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eHorizontal\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e10f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erigidibody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evelocity\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejoystick\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eVertical\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e10f\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(!\u003c/span\u003e\u003cspan class=\"n\"\u003ejump\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ejoybutton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePressed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ejump\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003erigidibody\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evelocity\u003c/span\u003e \u003cspan class=\"p\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eVector3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eup\u003c/span\u003e \u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"m\"\u003e10f\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejump\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003ejoybutton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePressed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ejump\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"87:1-87:63\"\u003e\u003ccode\u003eJoybutton\u003c/code\u003eはImageのFixed Joystickにアタッチします。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"cs\" data-sourcepos=\"88:1-120:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eSystem.Collections.Generic\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"nn\"\u003eUnityEngine.EventSystems\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eJoybutton\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMonoBehaviour\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIPointerUpHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIPointerDownHandler\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003ePressed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Start is called before the first frame update\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eStart\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Update is called once per frame\u003c/span\u003e\n    \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnPointerDown\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePointerEventData\u003c/span\u003e \u003cspan class=\"n\"\u003eeventData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePressed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnPointerUp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePointerEventData\u003c/span\u003e \u003cspan class=\"n\"\u003eeventData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ePressed\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch1 data-sourcepos=\"122:1-122:11\"\u003e\n\u003cspan id=\"以上\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%A5%E4%B8%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e以上！\u003c/h1\u003e\n\u003ch1 data-sourcepos=\"124:1-124:8\"\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h1\u003e\n\u003cp data-sourcepos=\"125:1-125:46\"\u003e・\u003ca href=\"https://www.youtube.com/watch?v=8-X3BmvtXT0\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.youtube.com/watch?v=8-X3BmvtXT0\u003c/a\u003e\u003c/p\u003e\n","body":"今回はjoystickを使って、オブジェクトの操作とジャンプボタンを作る機能についてまとめていきます！\n\n:::note info\n使用PC： MacBook Pro (13-inch, M1, 2020)\nOSバージョン: 11.5.2\nUnityバージョン：2021.3.2f1\n:::\n\n# 実際にプレイすると\n![画面収録-2022-08-06-16.27.52_out.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/80678511-44cc-a7e8-bfc5-544b2792ef2b.gif)\nこんな感じになったら完成です！\n\nサンプル動画では\n①Sphere→Rigidbodyを加えておく\n②Plane\n③Material（緑色）→Planeにつける\n④[joystick](https://assetstore.unity.com/packages/tools/input-management/joystick-pack-107631)→unityにインポートしておく\n⑤Canvas\nをアセットとして使用しています。\n\n# オブジェクトの準備\nオブジェクトを画面のようにいい感じに収まるように配置します。笑\n![スクリーンショット 2022-09-17 1.27.15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/dac6b4af-135e-d613-b04d-fbde54797810.png)\n\n# 移動用のjoystickとジャンプ用のボタンを作成\n**①canvasにjoystickを入れる**\n今回は`Fixed Joystick`を使います。\n![スクリーンショット 2022-09-17 1.29.26.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/2e56ce05-4a7d-4aa2-4149-30a619cfcb10.png)\njoystickのパッケージの中から`Fixed joystick`をcanvasの中にドラッグ\u0026ドロップします。\n画面左側にいい感じの位置になるように調整します。\n\n**②ボタンの作成**\nHierarchyビューから、`Create`→`UI`→`Image`を作成し、こちらも画面右側にいいな感じになるように調整します。今回は名前をFixed Joystickにしました。\n![スクリーンショット 2022-09-18 21.06.18.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/83ecd3dd-ccf0-6ce1-c8f1-8aa210ed1968.png)\n\nSource ImageにはJoystickのパックに付属しているものを使用します。\nここは以下の動画を参考にして、お好きなものを選択してください！\n![画面収録-2022-09-18-21.13.56_out.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/890419/0042030d-d642-e381-a864-b8d1b61d5cec.gif)\n\n\n\n# スクリプトの作成\n`MyScript`と`Joybutton`の二つのスクリプトを作成し、それぞれ以下のコードを入力します。\n\n`MyScript`はSphereにアタッチします。\n```cs\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\npublic class MyScript : MonoBehaviour\n{\n    protected Joystick joystick;\n    protected Joybutton joybutton;\n\n    protected bool jump;\n\n    // Start is called before the first frame update\n    void Start()\n    {\n        joystick = FindObjectOfType\u003cJoystick\u003e();\n        joybutton = FindObjectOfType\u003cJoybutton\u003e();\n    }\n\n    // Update is called once per frame\n    void Update()\n    {\n        var rigidibody = GetComponent\u003cRigidbody\u003e();\n\n        rigidibody.velocity = new Vector3(joystick.Horizontal * 10f, rigidibody.velocity.y, joystick.Vertical * 10f);\n\n        if(!jump \u0026\u0026 joybutton.Pressed)\n        {\n            jump = true;\n            rigidibody.velocity += Vector3.up * 10f;\n        }\n\n        if(jump \u0026\u0026 !joybutton.Pressed)\n        {\n            jump = false;\n        }\n    }\n}\n\n```\n\n`Joybutton`はImageのFixed Joystickにアタッチします。\n```cs\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\nusing UnityEngine.EventSystems;\n\npublic class Joybutton : MonoBehaviour, IPointerUpHandler, IPointerDownHandler\n{\n    public bool Pressed;\n\n    // Start is called before the first frame update\n    void Start()\n    {\n        \n    }\n\n    // Update is called once per frame\n    void Update()\n    {\n        \n    }\n\n    public void OnPointerDown(PointerEventData eventData)\n    {\n        Pressed = true;\n    }\n\n    public void OnPointerUp(PointerEventData eventData)\n    {\n        Pressed = false;\n    }\n}\n```\n\n# 以上！\n\n# 参考\n・https://www.youtube.com/watch?v=8-X3BmvtXT0\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:56:50+09:00","group":null,"id":"8e800bbdcda0a2bececc","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"C#","versions":[]},{"name":"Unity3D","versions":[]},{"name":"Unity","versions":[]}],"title":"[Unity] joystickとbuttonの作り方","updated_at":"2022-09-18T21:56:50+09:00","url":"https://qiita.com/1230/items/8e800bbdcda0a2bececc","user":{"description":"unityやらC#やら触ってる文系大学生。","facebook_id":"","followees_count":4,"followers_count":1,"github_login_name":"natsuko1225","id":"1230","items_count":12,"linkedin_id":"","location":"","name":"K.N","organization":"GeekSalon","permanent_id":890419,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/890419/8ad798703c0447156576675c39d0ea48a7e23c02/x_large.png?1663381973","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-3:39\"\u003eアプリ界隈ではよくstripeの導入を見かけるが、squareを使う必要性が出てきたので要所を整理する。\u003cbr\u003e\n\u003ca href=\"https://developer.squareup.com/docs/subscriptions/overview\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://developer.squareup.com/docs/subscriptions/overview\u003c/a\u003e\u003cbr\u003e\n今回はこの記事やっていく。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"5:1-5:18\"\u003e\n\u003cspan id=\"squareの利点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#square%E3%81%AE%E5%88%A9%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003esquareの利点\u003c/h2\u003e\n\u003cp data-sourcepos=\"6:1-6:73\"\u003esquareの利点については、以下の3点が挙げられている。\u003c/p\u003e\n\u003ch5 data-sourcepos=\"7:1-7:30\"\u003e\n\u003cspan id=\"1-シンプルな課金\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AA%E8%AA%B2%E9%87%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. シンプルな課金\u003c/h5\u003e\n\u003cp data-sourcepos=\"8:1-10:165\"\u003eSquareは定期購入（サブスク）の請求を簡素化する。\u003cbr\u003e\nいつ請求するか、誰が支払ったか、誰が未払いかを気にする必要はない。\u003cbr\u003e\nSquareは、顧客のメールアドレスに請求書を送ったり、自動的に課金したりと、購読プランに応じたフォローアップを行う。\u003c/p\u003e\n\u003ch5 data-sourcepos=\"12:1-12:65\"\u003e\n\u003cspan id=\"2顧客カード請求書のシームレスな管理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E9%A1%A7%E5%AE%A2%E3%82%AB%E3%83%BC%E3%83%89%E8%AB%8B%E6%B1%82%E6%9B%B8%E3%81%AE%E3%82%B7%E3%83%BC%E3%83%A0%E3%83%AC%E3%82%B9%E3%81%AA%E7%AE%A1%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.顧客、カード、請求書のシームレスな管理\u003c/h5\u003e\n\u003cp data-sourcepos=\"13:1-13:284\"\u003eサブスクリプションAPIは、サブスクリプションのサービスを提供する場合、顧客、顧客カード、請求書の作成と管理を解決するCustomersやInvoicesなどのAPIを含むSquareプラットフォームの他の部分と統合しています。\u003c/p\u003e\n\u003ch5 data-sourcepos=\"15:1-15:58\"\u003e\n\u003cspan id=\"3square-seller-dashboardで利用できる請求書\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3square-seller-dashboard%E3%81%A7%E5%88%A9%E7%94%A8%E3%81%A7%E3%81%8D%E3%82%8B%E8%AB%8B%E6%B1%82%E6%9B%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.Square Seller Dashboardで利用できる請求書\u003c/h5\u003e\n\u003cp data-sourcepos=\"16:1-16:143\"\u003e販売者は、Square Seller Dashboardでサブスクリプションによって生成された請求書を確認することができます。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"18:1-18:57\"\u003e\n\u003cspan id=\"squareでのサブスクリプションの管理方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#square%E3%81%A7%E3%81%AE%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%AE%A1%E7%90%86%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003esquareでのサブスクリプションの管理方法\u003c/h2\u003e\n\u003cp data-sourcepos=\"19:1-19:113\"\u003esquareでのサブスクリプションの管理の仕方について、以下の2stepが挙げられている。\u003c/p\u003e\n\u003ch5 data-sourcepos=\"21:1-21:339\"\u003e\n\u003cspan id=\"1-サブスクリプションプランを設定するcatalog-api-を使用してサブスクリプションプランをセットアップしますプランはカタログオブジェクトとして保存されます詳細については購読プランのセットアップと管理を参照してください\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%97%E3%83%A9%E3%83%B3%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8Bcatalog-api-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%97%E3%83%A9%E3%83%B3%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%97%E3%81%BE%E3%81%99%E3%83%97%E3%83%A9%E3%83%B3%E3%81%AF%E3%82%AB%E3%82%BF%E3%83%AD%E3%82%B0%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%A8%E3%81%97%E3%81%A6%E4%BF%9D%E5%AD%98%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E8%A9%B3%E7%B4%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AF%E8%B3%BC%E8%AA%AD%E3%83%97%E3%83%A9%E3%83%B3%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%A8%E7%AE%A1%E7%90%86%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. サブスクリプションプランを設定するCatalog API を使用して、サブスクリプションプランをセットアップします。プランは、カタログオブジェクトとして保存されます。詳細については、「購読プランのセットアップと管理」を参照してください。\u003c/h5\u003e\n\u003ch5 data-sourcepos=\"24:1-24:284\"\u003e\n\u003cspan id=\"2サブスクリプションを管理しますsubscriptions-api-を使用してサブスクリプションを作成および管理します詳細についてはsubscriptions-api-を使用したサブスクリプションの管理を参照してください\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E7%AE%A1%E7%90%86%E3%81%97%E3%81%BE%E3%81%99subscriptions-api-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90%E3%81%8A%E3%82%88%E3%81%B3%E7%AE%A1%E7%90%86%E3%81%97%E3%81%BE%E3%81%99%E8%A9%B3%E7%B4%B0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AFsubscriptions-api-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%82%B5%E3%83%96%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E7%AE%A1%E7%90%86%E3%82%92%E5%8F%82%E7%85%A7%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.サブスクリプションを管理します。Subscriptions API を使用して、サブスクリプションを作成および管理します。詳細については、「Subscriptions API を使用したサブスクリプションの管理」を参照してください。\u003c/h5\u003e\n\u003cp data-sourcepos=\"26:1-26:211\"\u003eカタログAPIを利用して、サブスクリプションのプランを作成し、誰のどのカードに対してサブスクを契約するか、についてはsubscription apiを利用するみたい。\u003c/p\u003e\n","body":"アプリ界隈ではよくstripeの導入を見かけるが、squareを使う必要性が出てきたので要所を整理する。\nhttps://developer.squareup.com/docs/subscriptions/overview\n今回はこの記事やっていく。\n\n## squareの利点\nsquareの利点については、以下の3点が挙げられている。\n##### 1. シンプルな課金\nSquareは定期購入（サブスク）の請求を簡素化する。\nいつ請求するか、誰が支払ったか、誰が未払いかを気にする必要はない。\nSquareは、顧客のメールアドレスに請求書を送ったり、自動的に課金したりと、購読プランに応じたフォローアップを行う。\n\n##### 2.顧客、カード、請求書のシームレスな管理\nサブスクリプションAPIは、サブスクリプションのサービスを提供する場合、顧客、顧客カード、請求書の作成と管理を解決するCustomersやInvoicesなどのAPIを含むSquareプラットフォームの他の部分と統合しています。\n\n##### 3.Square Seller Dashboardで利用できる請求書\n販売者は、Square Seller Dashboardでサブスクリプションによって生成された請求書を確認することができます。\n\n## squareでのサブスクリプションの管理方法\nsquareでのサブスクリプションの管理の仕方について、以下の2stepが挙げられている。\n\n##### 1. サブスクリプションプランを設定するCatalog API を使用して、サブスクリプションプランをセットアップします。プランは、カタログオブジェクトとして保存されます。詳細については、「購読プランのセットアップと管理」を参照してください。\n\n\n##### 2.サブスクリプションを管理します。Subscriptions API を使用して、サブスクリプションを作成および管理します。詳細については、「Subscriptions API を使用したサブスクリプションの管理」を参照してください。\n\nカタログAPIを利用して、サブスクリプションのプランを作成し、誰のどのカードに対してサブスクを契約するか、についてはsubscription apiを利用するみたい。\n\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:56:01+09:00","group":null,"id":"748a05724c1d8b4e7f18","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Node.js","versions":[]},{"name":"square","versions":[]},{"name":"Flutter","versions":[]},{"name":"cloudfunctions","versions":[]}],"title":"Square Subscriptionを訳して理解する","updated_at":"2022-09-18T21:56:01+09:00","url":"https://qiita.com/tatessy/items/748a05724c1d8b4e7f18","user":{"description":"FlutterとFirebaseを用いてアプリを開発しています。","facebook_id":"","followees_count":24,"followers_count":7,"github_login_name":null,"id":"tatessy","items_count":20,"linkedin_id":"","location":"","name":"yamori","organization":"","permanent_id":998564,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/998564/daa5f3baa2485a24bdceec6f6e44ed9da78a1326/x_large.png?1637151409","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:14\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-3:71\"\u003e2022/8に画像生成AI「Stable Diffusion」が登場した。\u003cbr\u003e\nこちら、英Stability AIが発表した画像生成AI。すごい！\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-7:95\"\u003e紹介されているサイトでも画像は生成できるので十分楽しめるそうなんだけれども\u003cbr\u003e\nAPIも公開されてるようで、Google Colaboratoryを使って実行することで\u003cbr\u003e\n安ＰＣでもこのAIの恩恵をあずかれるってことでやってみようと思う。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"9:1-9:32\"\u003e\n\u003cspan id=\"まずはアカウント登録\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%9A%E3%81%AF%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E7%99%BB%E9%8C%B2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまずはアカウント登録\u003c/h1\u003e\n\u003cp data-sourcepos=\"10:1-10:70\"\u003e\u003cqiita-embed-ogp src=\"https://awajifishing.com/cryptocurrency/nft/stable-diffusion-20220904/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"12:1-12:105\"\u003eを参考にやってみる。まずは、Hugging Faceのサイトに行ってアカウントを作成。\u003c/p\u003e\n\u003cp data-sourcepos=\"14:1-14:23\"\u003e\u003cqiita-embed-ogp src=\"https://huggingface.co/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"16:1-17:121\"\u003e画面右上の「Sign UP」クリック\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3d12d9fe8e65e62a4cb07c5dd1a137275cbd4350/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f36356335383237352d303565312d393235312d636430662d3539336163306239353730632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F65c58275-05e1-9251-cd0f-593ac0b9570c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4989e832349968aba537788c293c56f5\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/65c58275-05e1-9251-cd0f-593ac0b9570c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F65c58275-05e1-9251-cd0f-593ac0b9570c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f8385d3b675e4db5e51a9dcd250a7957 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"19:1-20:121\"\u003eメアドとログインに使用するパスワードを入力して　Next\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/fa3ee2e21742b27c676de3d94ac2689d936ae6e2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f64356366663837362d666265632d366566382d323065332d3437656430636532353536372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd5cff876-fbec-6ef8-20e3-47ed0ce25567.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dbea20eef1c684f538b28c02dda26bae\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d5cff876-fbec-6ef8-20e3-47ed0ce25567.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd5cff876-fbec-6ef8-20e3-47ed0ce25567.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=68c1eb09339a16c6027923032e133a4e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"22:1-23:121\"\u003eプロファイル情報を入力\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b63e4b2e689ca4a758b1eaacecf103225d8ceb3e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f61323631623037382d313636342d373736662d313430382d6464353031653962663036392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fa261b078-1664-776f-1408-dd501e9bf069.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c97243856449bd573e7ed4852729aec8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/a261b078-1664-776f-1408-dd501e9bf069.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fa261b078-1664-776f-1408-dd501e9bf069.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=38e795293b16f8dc374adbb555fac707 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"25:1-26:30\"\u003e登録完了。\u003cbr\u003e\n\u003ca href=\"https://huggingface.co/welcome\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://huggingface.co/welcome\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"28:1-29:121\"\u003eこんな感じでどうやって使うのか紹介してくれた\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/71b381a58570c5a959805b31e26e68e3ee1e5876/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f39623834663032642d616438332d346431622d316563332d6135653266383030346435642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F9b84f02d-ad83-4d1b-1ec3-a5e2f8004d5d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bc1608e1e2a623445723aeb46ef7bbca\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/9b84f02d-ad83-4d1b-1ec3-a5e2f8004d5d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F9b84f02d-ad83-4d1b-1ec3-a5e2f8004d5d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6adbca120636018d9628833b8016bf92 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"31:1-33:121\"\u003egmailにメアド確認メールが届いていたのでリンクをクリック。\u003cbr\u003e\nリンク先で↓↓の画面がでて、無事に承認されたことが確認できた。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/274bb4f9bc00641c804c84c8154832fb79db18e2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f34646230373534322d363239342d376338382d656262332d6263666365363033353165322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F4db07542-6294-7c88-ebb3-bcfce60351e2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3cdd18c8960f0f6805eb34c8a5abad4c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/4db07542-6294-7c88-ebb3-bcfce60351e2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F4db07542-6294-7c88-ebb3-bcfce60351e2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e16cba45c9fd3b717a16aa8f57a32609 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"35:1-35:41\"\u003e\n\u003cspan id=\"アクセストークンを入手する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E3%82%92%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアクセストークンを入手する\u003c/h1\u003e\n\u003cp data-sourcepos=\"36:1-37:121\"\u003e画面右上のアイコン画像をクリック＞Settingクリック\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1b571f91138417868f70b6a1dde4e15e1107e3dc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f64333165336637342d323132352d366564332d343863342d3230613964663030373033312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd31e3f74-2125-6ed3-48c4-20a9df007031.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26bcf55ff3751dfa39cc6704be83e6cf\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d31e3f74-2125-6ed3-48c4-20a9df007031.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd31e3f74-2125-6ed3-48c4-20a9df007031.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=69815293be2a44c0529cb852fa4e2542 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"39:1-40:121\"\u003e画面左側より　Access Tokens クリック\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/daa6bc25caa6a1798565c7cc92484fd40c23ff16/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f34393063333361362d363461302d363534662d383933382d3361393032363664643933372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F490c33a6-64a0-654f-8938-3a90266dd937.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ce6f53a7bd8d54acaf8fcca5a275be75\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/490c33a6-64a0-654f-8938-3a90266dd937.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F490c33a6-64a0-654f-8938-3a90266dd937.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ac89ed210d4f8fc1ccb3658515edc28c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"42:1-43:121\"\u003eNew Token クリック\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4c569eae5800a95429904097331c87051caaeff2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f33353438313061302d356562362d303630362d396630652d6661333666306131656638362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F354810a0-5eb6-0606-9f0e-fa36f0a1ef86.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f0a9ee9e1e5e3bbcaa98196704009fc7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/354810a0-5eb6-0606-9f0e-fa36f0a1ef86.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F354810a0-5eb6-0606-9f0e-fa36f0a1ef86.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=369ac8b9b700957ae2d6924285101230 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"45:1-48:121\"\u003eNameは適当な名前を入れて、、、\u003cbr\u003e\nRoleはread\u003cbr\u003e\nで、 Gnenerate a token\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2bfce1437fdef4d3da2d42419c314d552b855de3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f34333936303366352d373831392d366463352d643735362d3666353133313935303734342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F439603f5-7819-6dc5-d756-6f5131950744.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ead6596c0d8ba8631bf8b08655aef3b3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/439603f5-7819-6dc5-d756-6f5131950744.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F439603f5-7819-6dc5-d756-6f5131950744.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=edfe036eb1503861dd592b141098f7ba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"50:1-52:121\"\u003e無事アクセストークンの生成に成功　Show をクリックしたら内容が読める\u003cbr\u003e\nこの内容は後で使うのでコピーしておく\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cd86d3ee7f6c8c161ab608c0f71760db1e16de2a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f63326638636137622d646339612d366265632d643634302d3938653030363264643238302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fc2f8ca7b-dc9a-6bec-d640-98e0062dd280.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=db18849ae885dd228cdf27903079231e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/c2f8ca7b-dc9a-6bec-d640-98e0062dd280.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fc2f8ca7b-dc9a-6bec-d640-98e0062dd280.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=138d7fc85acda0d62c4916fe5adac2c4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"54:1-54:60\"\u003e\n\u003cspan id=\"colaboratoryでstable-diffusionをセットアップする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#colaboratory%E3%81%A7stable-diffusion%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eColaboratoryでStable Diffusionをセットアップする\u003c/h1\u003e\n\u003cp data-sourcepos=\"55:1-56:121\"\u003eGoogle ドライブより、Google Colaboratoryを起動する\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a5968201ae5be335f46d1210ce5d8866058075c0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f32363032653161652d376566622d616165642d303239382d6161623066306135656561362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F2602e1ae-7efb-aaed-0298-aab0f0a5eea6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=253082ebc90db0aff04c91148023dc59\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/2602e1ae-7efb-aaed-0298-aab0f0a5eea6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F2602e1ae-7efb-aaed-0298-aab0f0a5eea6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1eb1aa0a8c2529947ecffa975598919d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"58:1-59:121\"\u003eノートブックの設定　クリック\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c9742b1b84718f52ee285712bd147f2c10f6d79f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f36666338376232332d303862312d336566652d356531302d3966303934623763363964662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F6fc87b23-08b1-3efe-5e10-9f094b7c69df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f77a93dfcdf3147f9ffd625a46af0c1a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/6fc87b23-08b1-3efe-5e10-9f094b7c69df.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F6fc87b23-08b1-3efe-5e10-9f094b7c69df.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5fff34c149e6890be13ed6de0ca5d478 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"61:1-62:121\"\u003eGPUを選択して　保存\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/65952dff0c532d71f03adeaa641bcad07a1867aa/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f64383530666164652d653236382d613030332d663438662d6463353137383263333366332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd850fade-e268-a003-f48f-dc51782c33f3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=40a8b25af5c46763803901f9a82067da\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d850fade-e268-a003-f48f-dc51782c33f3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd850fade-e268-a003-f48f-dc51782c33f3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=82e97de27effa969785271b1042798bd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"64:1-64:54\"\u003e\n\u003cspan id=\"pipで必要なライブラリをインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pip%E3%81%A7%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003epipで必要なライブラリをインストール\u003c/h2\u003e\n\u003cp data-sourcepos=\"65:1-65:69\"\u003eここからはColaboratoryにプログラムを入力していく。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"67:1-69:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003epip install diffusers==0.2.4 transformers scipy ftfy\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"71:1-72:121\"\u003eしばし待つ…\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/69b702ad504a95863423dec233562fc0dab65fac/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f64326337386464612d633136642d623932302d636562382d3635386334663031623763662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd2c78dda-c16d-b920-ceb8-658c4f01b7cf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=14165672bb356916f2f9311fdb7c5b2e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d2c78dda-c16d-b920-ceb8-658c4f01b7cf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Fd2c78dda-c16d-b920-ceb8-658c4f01b7cf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=930da9a2b97095e073b42d034d67c2a4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"74:1-75:121\"\u003e１分くらいで完了。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/184ba148c58f650526cd9b31a21feaf40e72805b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f30616233393738632d386661632d656563652d386533612d3532393232306266636238662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F0ab3978c-8fac-eece-8e3a-529220bfcb8f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=644438207f8fc68338ea68e2a681ce20\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/0ab3978c-8fac-eece-8e3a-529220bfcb8f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F0ab3978c-8fac-eece-8e3a-529220bfcb8f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f923fddc9f331535ee6ab5247d283b1f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"77:1-77:34\"\u003e\n\u003cspan id=\"stable-diffusionを呼び出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stable-diffusion%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStable Diffusionを呼び出す\u003c/h2\u003e\n\u003cp data-sourcepos=\"78:1-78:54\"\u003eさっき拾ってきたトークンを変数に代入\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"80:1-82:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eYOUR_TOKEN=”Hugging Faceで発行したトークン”\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"84:1-84:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/f19e373b43f7fcd292cfdded5a6a75f9469e2593/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f34373965373439642d633234372d396230362d393832342d6163626238646366396333612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F479e749d-c247-9b06-9824-acbb8dcf9c3a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e3d98c6b8c53f830b5eed1e4a260c7bf\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/479e749d-c247-9b06-9824-acbb8dcf9c3a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F479e749d-c247-9b06-9824-acbb8dcf9c3a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=83012c54825f8dea816e737120feaec0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"86:1-86:33\"\u003e以下のコードを実行する\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"88:1-92:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003efrom diffusers import StableDiffusionPipeline\n\npipe = StableDiffusionPipeline.from_pretrained(\"CompVis/stable-diffusion-v1-4\", use_auth_token=YOUR_TOKEN)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"94:1-95:121\"\u003e２分くらいかかったけど成功した\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1cd7f4251d8cdfa7dc3c1086156889ad50f9781d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f32303339326632322d623536622d313137642d616533302d3837333362633139643939312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F20392f22-b56b-117d-ae30-8733bc19d991.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=594b08c6eaaa6a35c412257fa3a14084\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/20392f22-b56b-117d-ae30-8733bc19d991.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F20392f22-b56b-117d-ae30-8733bc19d991.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=04f84ca1830618dcb2f61ebffe955376 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"97:1-97:66\"\u003e最後に↓↓のコードを実行してセットアップ完了\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"99:1-101:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003epipe.to(\"cuda\")\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"102:1-102:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/e6faef262f93a5ff758b354e8848c782e0a5f5a8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f66353964336539332d383431362d366161352d663333662d6565313135326537663563632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Ff59d3e93-8416-6aa5-f33f-ee1152e7f5cc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=301e52f836925fc301146138d592eef3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/f59d3e93-8416-6aa5-f33f-ee1152e7f5cc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2Ff59d3e93-8416-6aa5-f33f-ee1152e7f5cc.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2db37f1ac4fde342d794f662864d23fb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"104:1-104:42\"\u003e\n\u003cspan id=\"stable-diffusionで画像を生成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stable-diffusion%E3%81%A7%E7%94%BB%E5%83%8F%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStable Diffusionで画像を生成する\u003c/h1\u003e\n\u003cp data-sourcepos=\"105:1-105:27\"\u003e以下のコードを実行\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"107:1-113:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eprompt = \"cute cat paly with ball\"\n\nimage = pipe(prompt)[\"sample\"][0]\n\nimage.save(f\"cat.png\")\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"114:1-114:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/2e16f5aad3de505dbb7ec41155f6d01a55fa26b9/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f32386536393664622d366664622d353836632d393037342d3462353563646230356138322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F28e696db-6fdb-586c-9074-4b55cdb05a82.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1d604c687e85fa509995fc8c76adb7bf\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/28e696db-6fdb-586c-9074-4b55cdb05a82.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F28e696db-6fdb-586c-9074-4b55cdb05a82.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6cbc1236ce0142d4cbec95e1b0f78a67 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"116:1-117:121\"\u003eファイル一覧を見ると、cat.pngが生成されてることがわかる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/219146c194d7da4f761e82cd9f4a6ae445bb4cc7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f36626138366536392d633664342d336563372d653134372d3161303036373939313261332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F6ba86e69-c6d4-3ec7-e147-1a00679912a3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ac19853357ffe7652da74a491326205a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/6ba86e69-c6d4-3ec7-e147-1a00679912a3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F6ba86e69-c6d4-3ec7-e147-1a00679912a3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=766b6505ea79eb5f637782247dd115d7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"119:1-120:121\"\u003ecat.pngをダブルクリックすると、画面右側に画像が表示された。成功！\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c9861db1347be15ba38b3aa86a5ba951498311f7/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3431363236332f34643537316234342d393764642d323737322d313333382d3833343030653237336637312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F4d571b44-97dd-2772-1338-83400e273f71.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=59bdd2754c2e23febe2298985801e9f7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/4d571b44-97dd-2772-1338-83400e273f71.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F416263%2F4d571b44-97dd-2772-1338-83400e273f71.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fcffbc3042de0326a250e242a1719d61 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"122:1-122:14\"\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h1\u003e\n\u003cp data-sourcepos=\"123:1-124:63\"\u003eオープンソースで画像AIが利用できるってすごい時代が始まったな。。。って素直に思いました。\u003cbr\u003e\nしばらくはStableDiffusionで遊んでみようと思う。\u003c/p\u003e\n","body":"# はじめに\n2022/8に画像生成AI「Stable Diffusion」が登場した。\nこちら、英Stability AIが発表した画像生成AI。すごい！\n\n紹介されているサイトでも画像は生成できるので十分楽しめるそうなんだけれども\nAPIも公開されてるようで、Google Colaboratoryを使って実行することで\n安ＰＣでもこのAIの恩恵をあずかれるってことでやってみようと思う。\n\n# まずはアカウント登録\nhttps://awajifishing.com/cryptocurrency/nft/stable-diffusion-20220904/\n\nを参考にやってみる。まずは、Hugging Faceのサイトに行ってアカウントを作成。\n\nhttps://huggingface.co/\n\n画面右上の「Sign UP」クリック\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/65c58275-05e1-9251-cd0f-593ac0b9570c.png)\n\nメアドとログインに使用するパスワードを入力して　Next\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d5cff876-fbec-6ef8-20e3-47ed0ce25567.png)\n\nプロファイル情報を入力\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/a261b078-1664-776f-1408-dd501e9bf069.png)\n\n登録完了。\nhttps://huggingface.co/welcome\n\nこんな感じでどうやって使うのか紹介してくれた\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/9b84f02d-ad83-4d1b-1ec3-a5e2f8004d5d.png)\n\ngmailにメアド確認メールが届いていたのでリンクをクリック。\nリンク先で↓↓の画面がでて、無事に承認されたことが確認できた。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/4db07542-6294-7c88-ebb3-bcfce60351e2.png)\n\n# アクセストークンを入手する\n画面右上のアイコン画像をクリック＞Settingクリック\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d31e3f74-2125-6ed3-48c4-20a9df007031.png)\n\n画面左側より　Access Tokens クリック\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/490c33a6-64a0-654f-8938-3a90266dd937.png)\n\nNew Token クリック\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/354810a0-5eb6-0606-9f0e-fa36f0a1ef86.png)\n\nNameは適当な名前を入れて、、、\nRoleはread\nで、 Gnenerate a token \n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/439603f5-7819-6dc5-d756-6f5131950744.png)\n\n無事アクセストークンの生成に成功　Show をクリックしたら内容が読める\nこの内容は後で使うのでコピーしておく\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/c2f8ca7b-dc9a-6bec-d640-98e0062dd280.png)\n\n# ColaboratoryでStable Diffusionをセットアップする\nGoogle ドライブより、Google Colaboratoryを起動する\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/2602e1ae-7efb-aaed-0298-aab0f0a5eea6.png)\n\nノートブックの設定　クリック\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/6fc87b23-08b1-3efe-5e10-9f094b7c69df.png)\n\nGPUを選択して　保存\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d850fade-e268-a003-f48f-dc51782c33f3.png)\n\n## pipで必要なライブラリをインストール\nここからはColaboratoryにプログラムを入力していく。\n\n```\npip install diffusers==0.2.4 transformers scipy ftfy\n```\n\nしばし待つ…\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/d2c78dda-c16d-b920-ceb8-658c4f01b7cf.png)\n\n１分くらいで完了。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/0ab3978c-8fac-eece-8e3a-529220bfcb8f.png)\n\n## Stable Diffusionを呼び出す\nさっき拾ってきたトークンを変数に代入\n\n```\nYOUR_TOKEN=”Hugging Faceで発行したトークン”\n```\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/479e749d-c247-9b06-9824-acbb8dcf9c3a.png)\n\n以下のコードを実行する\n\n```\nfrom diffusers import StableDiffusionPipeline\n\npipe = StableDiffusionPipeline.from_pretrained(\"CompVis/stable-diffusion-v1-4\", use_auth_token=YOUR_TOKEN)\n```\n\n２分くらいかかったけど成功した\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/20392f22-b56b-117d-ae30-8733bc19d991.png)\n\n最後に↓↓のコードを実行してセットアップ完了\n\n```\npipe.to(\"cuda\")\n```\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/f59d3e93-8416-6aa5-f33f-ee1152e7f5cc.png)\n\n# Stable Diffusionで画像を生成する\n以下のコードを実行\n\n```\nprompt = \"cute cat paly with ball\"\n\nimage = pipe(prompt)[\"sample\"][0]\n\nimage.save(f\"cat.png\")\n```\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/28e696db-6fdb-586c-9074-4b55cdb05a82.png)\n\nファイル一覧を見ると、cat.pngが生成されてることがわかる。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/6ba86e69-c6d4-3ec7-e147-1a00679912a3.png)\n\ncat.pngをダブルクリックすると、画面右側に画像が表示された。成功！\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/416263/4d571b44-97dd-2772-1338-83400e273f71.png)\n\n# おわりに\nオープンソースで画像AIが利用できるってすごい時代が始まったな。。。って素直に思いました。\nしばらくはStableDiffusionで遊んでみようと思う。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:54:15+09:00","group":null,"id":"c2a8b75fe3a480563d12","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"StableDiffusion","versions":[]}],"title":"画像生成AI「Stable Diffusion」でテキストから画像を生成に挑戦","updated_at":"2022-09-18T21:54:15+09:00","url":"https://qiita.com/watyanabe164/items/c2a8b75fe3a480563d12","user":{"description":"会社ではインフラエンジニアやってます。最近はガッツリAzureをいじくりまくってます。\r\n","facebook_id":"hiroshi.watanabe.399","followees_count":1,"followers_count":15,"github_login_name":null,"id":"watyanabe164","items_count":101,"linkedin_id":"hiroshi-watanabe-0130b4187/","location":"岡山県倉敷市","name":"","organization":"","permanent_id":416263,"profile_image_url":"https://abs.twimg.com/sticky/default_profile_images/default_profile_bigger.png","team_only":false,"twitter_screen_name":"watyanabe164","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:286\"\u003eSwaggerを使用してAPIの仕様書を作成する際、Swagger EditorやStoplight Studioを使用する選択肢などが考えられます。\u003cbr\u003e\n新規APIの場合はそれらを使用し０から作成する必要がありますが、既存APIの場合\u003ca href=\"https://inspector.swagger.io/builder\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSwagger Inspector\u003c/a\u003eを使用することで\u003cstrong\u003eある程度の仕様を反映させた仕様書\u003c/strong\u003eを自動生成することができます。\u003c/p\u003e\n\u003cp data-sourcepos=\"4:1-4:277\"\u003e現在の業務で「SwaggerHubを使用した既存APIのドキュメント化」を行う必要があるのですが、「１からすべて作成していくのが面倒・・・」と思い探していたところこちらのツールを発見し、試してみました。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"6:1-6:44\"\u003e\n\u003cspan id=\"注意apiの公開設定について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8Fapi%E3%81%AE%E5%85%AC%E9%96%8B%E8%A8%AD%E5%AE%9A%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e【注意】APIの公開設定について\u003c/h1\u003e\n\u003cp data-sourcepos=\"7:1-8:110\"\u003e今回はSwaggerHubの無料プランを使用していますが、APIの公開設定はPublicしか選択することができません。\u003cbr\u003e\nPrivateを選択するにはTeamプラン以上を登録する必要があるため、注意が必要です。\u003c/p\u003e\n\u003cp data-sourcepos=\"10:1-10:44\"\u003e\u003cqiita-embed-ogp src=\"https://swagger.io/tools/swaggerhub/pricing/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"12:1-12:41\"\u003e\n\u003cspan id=\"既存apiから仕様書作成の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A2%E5%AD%98api%E3%81%8B%E3%82%89%E4%BB%95%E6%A7%98%E6%9B%B8%E4%BD%9C%E6%88%90%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e既存APIから仕様書作成の流れ\u003c/h1\u003e\n\u003cp data-sourcepos=\"13:1-15:40\"\u003e\u003ca href=\"#1-Swagger%E3%80%80Inspector%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3\"\u003e1.Swagger Inspectorにログイン\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"#2-API%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e2.APIを実行\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"#3-%E5%86%85%E5%AE%B9%E3%82%8D\"\u003e3.SwaggerHub上で表示\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"17:1-17:37\"\u003e\n\u003cspan id=\"1-swagger-inspectorにログイン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-swagger-inspector%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. Swagger Inspectorにログイン\u003c/h1\u003e\n\u003cp data-sourcepos=\"18:1-18:148\"\u003eはじめに\u003ca href=\"https://inspector.swagger.io/builder\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSwaggaer Inspector\u003c/a\u003eのページを表示し、右上の「LOG IN」からログインします。\u003c/p\u003e\n\u003cp data-sourcepos=\"20:1-20:163\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/c82bcffea54279c1a13f4a8fec4ea5fd8127b837/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f38386138306132392d383436652d353665312d613265352d6235373932336163656238302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F88a80a29-846e-56e1-a2e5-b57923aceb80.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=21e87344c34f43391e6bd57b6ba38e84\" alt=\"スクリーンショット 2022-09-18 20.45.20.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/88a80a29-846e-56e1-a2e5-b57923aceb80.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F88a80a29-846e-56e1-a2e5-b57923aceb80.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=489a7aa00058457e65d6dd2666128f6c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"22:1-22:17\"\u003e\n\u003cspan id=\"2-apiを実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-api%E3%82%92%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. APIを実行\u003c/h1\u003e\n\u003cp data-sourcepos=\"23:1-25:94\"\u003e実際にAPIを実行してみます。\u003cbr\u003e\n今回は\u003ca href=\"https://jsonplaceholder.typicode.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJSONPlaceholder\u003c/a\u003eのユーザー取得とユーザー登録APIを実行します。\u003cbr\u003e\n基本的にはPOSTMANのようなAPIテストツールと同様の使い方ができます。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"27:1-27:19\"\u003e\n\u003cspan id=\"会員取得api\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BC%9A%E5%93%A1%E5%8F%96%E5%BE%97api\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e会員取得API\u003c/h3\u003e\n\u003cp data-sourcepos=\"28:1-28:163\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/cda1cb1148fda64546ae50a76b08aa048dcbb102/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f35623234353062322d363265342d656331662d613335342d6431336235626534316462322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F5b2450b2-62e4-ec1f-a354-d13b5be41db2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e4131a42f1d7e2004fe1bb05790de270\" alt=\"スクリーンショット 2022-09-18 21.38.05.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/5b2450b2-62e4-ec1f-a354-d13b5be41db2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F5b2450b2-62e4-ec1f-a354-d13b5be41db2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=633fd63f3a424462f98cc267a781d476 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"30:1-30:19\"\u003e\n\u003cspan id=\"会員登録api\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BC%9A%E5%93%A1%E7%99%BB%E9%8C%B2api\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e会員登録API\u003c/h3\u003e\n\u003cp data-sourcepos=\"31:1-31:163\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/43c8ff051857b0d23cefdd1a7fdf65e695140c47/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f63666661343461612d396362312d643330322d353838382d3832333739336564393762312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2Fcffa44aa-9cb1-d302-5888-823793ed97b1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=53d8d3ce93fd3f892b982ffe93243469\" alt=\"スクリーンショット 2022-09-18 21.40.01.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/cffa44aa-9cb1-d302-5888-823793ed97b1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2Fcffa44aa-9cb1-d302-5888-823793ed97b1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=490ea4bd0663dbfcc4e07008cb06118c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"33:1-33:27\"\u003e\n\u003cspan id=\"3-swaggerhub上で表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-swaggerhub%E4%B8%8A%E3%81%A7%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. SwaggerHub上で表示\u003c/h1\u003e\n\u003cp data-sourcepos=\"34:1-36:120\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/2aa1c7225eae4a0d194b641dbb5675b2659a7a5c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f36363963323630372d333162312d383166652d633036342d6665356535356437303734642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F669c2607-31b1-81fe-c064-fe5e55d7074d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=03a6a958a5d0be339a22e5b5ed07a997\" alt=\"スクリーンショット 2022-09-18 21.41.40.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/669c2607-31b1-81fe-c064-fe5e55d7074d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F669c2607-31b1-81fe-c064-fe5e55d7074d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bffc38ea9e42e8006b8b2aa43e853fca 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n実行したAPIはHistory欄に追加されます。\u003cbr\u003e\n仕様書を作成したいAPIをチェックボックスで選択し、「CREATE API DEFINITION」を選択します。\u003c/p\u003e\n\u003cp data-sourcepos=\"38:1-39:49\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/25f56d6e3ed65fa7d52767e74d409465727f2678/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f33343035323662322d626434302d353932612d393130382d3633646166396435326235332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F340526b2-bd40-592a-9108-63daf9d52b53.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a37bf7356b84ffdd6892ff02d5c2cca1\" alt=\"スクリーンショット 2022-09-18 21.43.12.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/340526b2-bd40-592a-9108-63daf9d52b53.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F340526b2-bd40-592a-9108-63daf9d52b53.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=02278e51e46d6786c02d2e120be4d9be 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n「GO TO SWAGGERHUB」をクリックします。\u003c/p\u003e\n\u003cp data-sourcepos=\"41:1-43:83\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/279259545e37dcb0b90b4b9cd473ab1bab72ff1c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f38633566316339642d623134612d363732352d313734392d3361313036633732393232362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F8c5f1c9d-b14a-6725-1749-3a106c729226.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c458c6967589a27596ca43b7d4419c6d\" alt=\"スクリーンショット 2022-09-18 21.45.39.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/8c5f1c9d-b14a-6725-1749-3a106c729226.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2F8c5f1c9d-b14a-6725-1749-3a106c729226.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f16a375e11ae41e0072d543cb787193a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n作成する仕様書のタイトル入力や、公開設定を選択します。\u003cbr\u003e\nSwaggerHubのfreeプランではAPIを非公開にすることはできません。\u003c/p\u003e\n\u003cp data-sourcepos=\"45:1-46:63\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/1a0ac4d5936002448d4b1855ebff5e2dd1024bdd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3633373434312f61303132313238322d623263612d333135622d396162622d6239626633393535373538302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2Fa0121282-b2ca-315b-9abb-b9bf39557580.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bbbd038afaf19a578c8ad5235fdb9005\" alt=\"スクリーンショット 2022-09-18 21.48.15.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/a0121282-b2ca-315b-9abb-b9bf39557580.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F637441%2Fa0121282-b2ca-315b-9abb-b9bf39557580.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7abde2ad837925f757fd2ae5ae6fede3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n仕様書が生成されていることが確認できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"47:1-102:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eopenapi\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e3.0.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003einfo\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etitle\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefaultTitle\u003c/span\u003e\n  \u003cspan class=\"na\"\u003edescription\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefaultDescription\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e0.1'\u003c/span\u003e\n\u003cspan class=\"na\"\u003eservers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://jsonplaceholder.typicode.com\u003c/span\u003e\n\u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e/posts/1\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eget\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003edescription\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuto generated using Swagger Inspector\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eresponses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e200'\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003edescription\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuto generated using Swagger Inspector\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econtent\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"s\"\u003eapplication/json; charset=utf-8\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eschema\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estring\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eexamples\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eservers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://jsonplaceholder.typicode.com\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eservers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://jsonplaceholder.typicode.com\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e/posts\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epost\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"na\"\u003edescription\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuto generated using Swagger Inspector\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erequestBody\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003econtent\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"s\"\u003eapplication/json\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eschema\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eobject\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eproperties\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eexamples\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e0'\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|-\u003c/span\u003e\n                  \u003cspan class=\"s\"\u003e[\u003c/span\u003e\n                      \u003cspan class=\"s\"\u003e{\u003c/span\u003e\n                          \u003cspan class=\"s\"\u003e\"title\": \"a1 test\",\u003c/span\u003e\n                          \u003cspan class=\"s\"\u003e\"body\": \"this is test by a1\",\u003c/span\u003e\n                          \u003cspan class=\"s\"\u003e\"userId\": 1\u003c/span\u003e\n                      \u003cspan class=\"s\"\u003e}\u003c/span\u003e\n                  \u003cspan class=\"s\"\u003e]\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eresponses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003e201'\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"na\"\u003edescription\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eAuto generated using Swagger Inspector\u003c/span\u003e\n          \u003cspan class=\"na\"\u003econtent\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"s\"\u003eapplication/json; charset=utf-8\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eschema\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003estring\u003c/span\u003e\n              \u003cspan class=\"na\"\u003eexamples\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e{}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eservers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://jsonplaceholder.typicode.com\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eservers\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ehttps://jsonplaceholder.typicode.com\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch1 data-sourcepos=\"104:1-104:11\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\u003cp data-sourcepos=\"105:1-107:106\"\u003eSwagger Inspectorを使用して既存APIのOpen API Specificationを作成しました。\u003cbr\u003e\nSchemaを別途設定したり、他の項目についても追加する必要はありますが、ある程度のパラメータやレスポンスは自動で生成してくれます。\u003cbr\u003e\n1から自分で書くよりは非常に楽なので、今後も使用していきたいと思います。\u003c/p\u003e\n","body":"Swaggerを使用してAPIの仕様書を作成する際、Swagger EditorやStoplight Studioを使用する選択肢などが考えられます。\n新規APIの場合はそれらを使用し０から作成する必要がありますが、既存APIの場合[Swagger Inspector](https://inspector.swagger.io/builder)を使用することで**ある程度の仕様を反映させた仕様書**を自動生成することができます。\n\n現在の業務で「SwaggerHubを使用した既存APIのドキュメント化」を行う必要があるのですが、「１からすべて作成していくのが面倒・・・」と思い探していたところこちらのツールを発見し、試してみました。\n\n# 【注意】APIの公開設定について\n今回はSwaggerHubの無料プランを使用していますが、APIの公開設定はPublicしか選択することができません。\nPrivateを選択するにはTeamプラン以上を登録する必要があるため、注意が必要です。\n\nhttps://swagger.io/tools/swaggerhub/pricing/\n\n# 既存APIから仕様書作成の流れ\n[1.Swagger Inspectorにログイン](#1-Swagger　Inspectorにログイン)\n[2.APIを実行](#2-APIを実行)\n[3.SwaggerHub上で表示](#3-内容ろ)\n\n# 1. Swagger Inspectorにログイン\nはじめに[Swaggaer Inspector](https://inspector.swagger.io/builder)のページを表示し、右上の「LOG IN」からログインします。\n\n![スクリーンショット 2022-09-18 20.45.20.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/88a80a29-846e-56e1-a2e5-b57923aceb80.png)\n\n# 2. APIを実行\n実際にAPIを実行してみます。\n今回は[JSONPlaceholder](https://jsonplaceholder.typicode.com/)のユーザー取得とユーザー登録APIを実行します。\n基本的にはPOSTMANのようなAPIテストツールと同様の使い方ができます。\n\n### 会員取得API\n![スクリーンショット 2022-09-18 21.38.05.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/5b2450b2-62e4-ec1f-a354-d13b5be41db2.png)\n\n### 会員登録API\n![スクリーンショット 2022-09-18 21.40.01.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/cffa44aa-9cb1-d302-5888-823793ed97b1.png)\n\n# 3. SwaggerHub上で表示\n![スクリーンショット 2022-09-18 21.41.40.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/669c2607-31b1-81fe-c064-fe5e55d7074d.png)\n実行したAPIはHistory欄に追加されます。\n仕様書を作成したいAPIをチェックボックスで選択し、「CREATE API DEFINITION」を選択します。\n\n![スクリーンショット 2022-09-18 21.43.12.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/340526b2-bd40-592a-9108-63daf9d52b53.png)\n「GO TO SWAGGERHUB」をクリックします。\n\n![スクリーンショット 2022-09-18 21.45.39.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/8c5f1c9d-b14a-6725-1749-3a106c729226.png)\n作成する仕様書のタイトル入力や、公開設定を選択します。\nSwaggerHubのfreeプランではAPIを非公開にすることはできません。\n\n![スクリーンショット 2022-09-18 21.48.15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/637441/a0121282-b2ca-315b-9abb-b9bf39557580.png)\n仕様書が生成されていることが確認できます。\n```yaml\nopenapi: 3.0.1\ninfo:\n  title: defaultTitle\n  description: defaultDescription\n  version: '0.1'\nservers:\n  - url: https://jsonplaceholder.typicode.com\npaths:\n  /posts/1:\n    get:\n      description: Auto generated using Swagger Inspector\n      responses:\n        '200':\n          description: Auto generated using Swagger Inspector\n          content:\n            application/json; charset=utf-8:\n              schema:\n                type: string\n              examples: {}\n      servers:\n        - url: https://jsonplaceholder.typicode.com\n    servers:\n      - url: https://jsonplaceholder.typicode.com\n  /posts:\n    post:\n      description: Auto generated using Swagger Inspector\n      requestBody:\n        content:\n          application/json:\n            schema:\n              type: object\n              properties: {}\n            examples:\n              '0':\n                value: |-\n                  [\n                      {\n                          \"title\": \"a1 test\",\n                          \"body\": \"this is test by a1\",\n                          \"userId\": 1\n                      }\n                  ]\n      responses:\n        '201':\n          description: Auto generated using Swagger Inspector\n          content:\n            application/json; charset=utf-8:\n              schema:\n                type: string\n              examples: {}\n      servers:\n        - url: https://jsonplaceholder.typicode.com\n    servers:\n      - url: https://jsonplaceholder.typicode.com\n```\n\n# まとめ\nSwagger Inspectorを使用して既存APIのOpen API Specificationを作成しました。\nSchemaを別途設定したり、他の項目についても追加する必要はありますが、ある程度のパラメータやレスポンスは自動で生成してくれます。\n1から自分で書くよりは非常に楽なので、今後も使用していきたいと思います。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:53:58+09:00","group":null,"id":"1855a0dacc7b6773e26d","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"api","versions":[]},{"name":"swagger","versions":[]},{"name":"OpenAPI","versions":[]}],"title":"Swagger Inspectorを使用して既存APIのOpen API Specificationを作成する","updated_at":"2022-09-18T22:00:37+09:00","url":"https://qiita.com/ten20200502/items/1855a0dacc7b6773e26d","user":{"description":"PHP/Laravel/javascript/Vue.js/Docker","facebook_id":"","followees_count":4,"followers_count":0,"github_login_name":"TR0205","id":"ten20200502","items_count":21,"linkedin_id":"","location":"","name":"tenryu","organization":"","permanent_id":637441,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/637441/b28361b4102c1c31100ad7ed5c31a36e445d933e/large.png?1589695797","team_only":false,"twitter_screen_name":"TR_20200502","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:25\"\u003e最近良く使ってるVSCodeの拡張機能をまとめました！\u003cbr\u003e\n今回は5つです〜。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"4:1-4:14\"\u003e\n\u003cspan id=\"partial-diff\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#partial-diff\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePartial Diff\u003c/h1\u003e\n\u003cp data-sourcepos=\"6:1-6:71\"\u003e\u003cqiita-embed-ogp src=\"https://marketplace.visualstudio.com/items?itemName=ryu1kn.partial-diff\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"8:1-8:107\"\u003eエディタ上で範囲選択した2つの箇所のdiffを新しいタブ上に表示してくれます。\u003c/p\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1db7c825706967b3c7d896ea71da3f734fde7ae4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323833353834302f37363030653639352d343839662d373634622d353539312d3763636137353037666135652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg width=\"500\" alt=\"PartialDiff\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2835840%2F7600e695-489f-764b-5591-7cca7507fa5e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1018074c426612c297d6fcd63f920571\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2835840/7600e695-489f-764b-5591-7cca7507fa5e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2835840%2F7600e695-489f-764b-5591-7cca7507fa5e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f44b5b580c97c140bf3ba7d8008b1dac 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003cp data-sourcepos=\"12:1-12:70\"\u003eこんな感じで手軽にdiffを見れるので重宝してます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"14:1-14:11\"\u003e\n\u003cspan id=\"bookmarks\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bookmarks\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBookmarks\u003c/h1\u003e\n\u003cp data-sourcepos=\"16:1-16:73\"\u003e\u003cqiita-embed-ogp src=\"https://marketplace.visualstudio.com/items?itemName=alefragnani.Bookmarks\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"18:1-20:93\"\u003eコード上の行を指定してブックマークできます。\u003cbr\u003e\nリストでどこをブックマークしたか確認できたり、ショートカットキーで順番に移動したりできます。\u003cbr\u003e\n複数ファイル間で関連する箇所を移動したりするのに使っています。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"22:1-22:11\"\u003e\n\u003cspan id=\"todo-tree\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#todo-tree\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTodo Tree\u003c/h1\u003e\n\u003cp data-sourcepos=\"24:1-24:73\"\u003e\u003cqiita-embed-ogp src=\"https://marketplace.visualstudio.com/items?itemName=Gruntfuggly.todo-tree\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"26:1-27:88\"\u003eファイルツリーでどこにTODOコメントがあるのか確認できます。\u003cbr\u003e\n確認後、たくさんTODOあるなぁって凹むまでがルーティーンです。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"29:1-29:9\"\u003e\n\u003cspan id=\"vsnotes\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vsnotes\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVSNotes\u003c/h1\u003e\n\u003cp data-sourcepos=\"31:1-31:70\"\u003e\u003cqiita-embed-ogp src=\"https://marketplace.visualstudio.com/items?itemName=patricklee.vsnotes\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"33:1-36:129\"\u003e作業中どこにメモ取っておこうかなぁって悩んでいたのですが、この拡張機能で解決しました。\u003cbr\u003e\nコマンドからタイトルを入力すると日時フォーマットの付いたファイル名でマークダウンファイルを作成してくれます。\u003cbr\u003e\n\u003ccode\u003eyyyy-MM-dd_hh_mm_title.md\u003c/code\u003e\u003cbr\u003e\n作成したファイルは特定のディレクトリに保存されて、拡張機能のタブでリスト表示されます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"38:1-38:26\"\u003e\n\u003cspan id=\"vscode-styled-components\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vscode-styled-components\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003evscode-styled-components\u003c/h1\u003e\n\u003cp data-sourcepos=\"40:1-40:94\"\u003e\u003cqiita-embed-ogp src=\"https://marketplace.visualstudio.com/items?itemName=styled-components.vscode-styled-components\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"42:1-43:240\"\u003estyled-componentsとかEmotionでtsxファイルにスタイルを実装してるときにあると便利なやつですね。\u003cbr\u003e\nハイライトとインテリセンスをしてくれるので、タイポが避けられるのはもちろんなんですが、なんだっけあのプロパティ？とかなったときも入力候補が提示されて助かります。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"45:1-45:11\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\u003cp data-sourcepos=\"47:1-48:123\"\u003evscode-styled-components以外は言語に関係なく使えるものでした。\u003cbr\u003e\n作業効率が全然違うのでこういうツールは色々試して自分に合うものを探したいですね〜。\u003c/p\u003e\n","body":"最近良く使ってるVSCodeの拡張機能をまとめました！\n今回は5つです〜。\n\n# Partial Diff\n\nhttps://marketplace.visualstudio.com/items?itemName=ryu1kn.partial-diff\n\nエディタ上で範囲選択した2つの箇所のdiffを新しいタブ上に表示してくれます。\n\n\u003cimg width=500 alt=\"PartialDiff\" src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2835840/7600e695-489f-764b-5591-7cca7507fa5e.png\" /\u003e\n\nこんな感じで手軽にdiffを見れるので重宝してます。\n\n# Bookmarks\n\nhttps://marketplace.visualstudio.com/items?itemName=alefragnani.Bookmarks\n\nコード上の行を指定してブックマークできます。\nリストでどこをブックマークしたか確認できたり、ショートカットキーで順番に移動したりできます。\n複数ファイル間で関連する箇所を移動したりするのに使っています。\n\n# Todo Tree\n\nhttps://marketplace.visualstudio.com/items?itemName=Gruntfuggly.todo-tree\n\nファイルツリーでどこにTODOコメントがあるのか確認できます。\n確認後、たくさんTODOあるなぁって凹むまでがルーティーンです。\n\n# VSNotes\n\nhttps://marketplace.visualstudio.com/items?itemName=patricklee.vsnotes\n\n作業中どこにメモ取っておこうかなぁって悩んでいたのですが、この拡張機能で解決しました。\nコマンドからタイトルを入力すると日時フォーマットの付いたファイル名でマークダウンファイルを作成してくれます。\n`yyyy-MM-dd_hh_mm_title.md`\n作成したファイルは特定のディレクトリに保存されて、拡張機能のタブでリスト表示されます。\n\n# vscode-styled-components\n\nhttps://marketplace.visualstudio.com/items?itemName=styled-components.vscode-styled-components\n\nstyled-componentsとかEmotionでtsxファイルにスタイルを実装してるときにあると便利なやつですね。\nハイライトとインテリセンスをしてくれるので、タイポが避けられるのはもちろんなんですが、なんだっけあのプロパティ？とかなったときも入力候補が提示されて助かります。\n\n# まとめ\n\nvscode-styled-components以外は言語に関係なく使えるものでした。\n作業効率が全然違うのでこういうツールは色々試して自分に合うものを探したいですね〜。\n\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:53:06+09:00","group":null,"id":"019b2bc32c3d1a95673a","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"TypeScript","versions":[]},{"name":"拡張機能","versions":[]},{"name":"React","versions":[]},{"name":"VSCode","versions":[]},{"name":"styled-components","versions":[]}],"title":"VSCodeのおすすめ拡張機能","updated_at":"2022-09-18T22:08:40+09:00","url":"https://qiita.com/ckbys/items/019b2bc32c3d1a95673a","user":{"description":"","facebook_id":"","followees_count":6,"followers_count":4,"github_login_name":null,"id":"ckbys","items_count":7,"linkedin_id":"","location":"","name":"ヨシヒコ コバヤシ","organization":"Catallaxy","permanent_id":2835840,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/2835840/40e37a76a354e8ac0f3939f32f175c6315f10b40/x_large.png?1662519116","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:58\"\u003e\u003ccode\u003e※プログラミングをし初めの頃に感覚的に思っていた個人的な考えです。 （ちなみに２０年ほど前の古い考えです）\u003c/code\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"4:1-4:11\"\u003e\n\u003cspan id=\"1-概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 概要\u003c/h1\u003e\n\u003cp data-sourcepos=\"5:1-9:150\"\u003e若い時、学校でプログラミングを習って、初めて仕事で「この処理書いて」と言われた時...\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b1804c063a94ad316960e9bcd2c97e2201291565/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433353237342f30333835666664322d633139642d353266392d306432312d3530393233386233386437332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2F0385ffd2-c19d-52f9-0d21-509238b38d73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=11725fea4b1dfc9f6e6261ec910920f6\" alt=\"kaisya_komaru_man.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/0385ffd2-c19d-52f9-0d21-509238b38d73.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2F0385ffd2-c19d-52f9-0d21-509238b38d73.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ad9eab2ea4947addcb7db52c2ddb6724 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n何からすればいいのか分からない。\u003cbr\u003e\nとりあえず、自分の作る流れのコメントを書いてみようとするが、よく分からない。手が動かない。\u003cbr\u003e\nそんな時先輩に言われたのが、\u003cb\u003e「プログラミングは、必ず [入力-\u0026gt;処理-\u0026gt;出力] の順でできている」\u003c/b\u003eでした。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"11:1-11:62\"\u003e\n\u003cspan id=\"2-コンピュータにさせたいことはなんだろう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%AB%E3%81%95%E3%81%9B%E3%81%9F%E3%81%84%E3%81%93%E3%81%A8%E3%81%AF%E3%81%AA%E3%82%93%E3%81%A0%E3%82%8D%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. コンピュータにさせたいことはなんだろう\u003c/h1\u003e\n\u003cp data-sourcepos=\"12:1-12:206\"\u003eコンピューター作るものによっては、自分のPCだったり、サーバーサイドならサーバー、組み込み系なら組み込み機器。それにさせたいことは何だろう。\u003c/p\u003e\n\u003cul data-sourcepos=\"13:1-14:80\"\u003e\n\u003cli data-sourcepos=\"13:1-13:41\"\u003e大量の情報を加工すること？\u003c/li\u003e\n\u003cli data-sourcepos=\"14:1-14:80\"\u003e情報を通信して多数のコンピュータでやり取りすること？\u003c/li\u003e\n\u003c/ul\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/560b9cb746ceacef5a3c0304f4b2978ab5ffd0b4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433353237342f63623635323538392d303834372d353531392d313339662d3630363039623362643361312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2Fcb652589-0847-5519-139f-60609b3bd3a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=aa996b8923dd381833d9e6355d574a8c\" width=\"300px\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/cb652589-0847-5519-139f-60609b3bd3a1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2Fcb652589-0847-5519-139f-60609b3bd3a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2111ab52c2f181b6bbee1484bf0883f6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003cp data-sourcepos=\"17:1-18:54\"\u003e自分の作っているシステムやアプリのしたいことは何だろう。\u003cbr\u003e\n全体を見ると一つには絞れないと思う。\u003c/p\u003e\n\u003cp data-sourcepos=\"20:1-22:183\"\u003e自分はその時Web系の顧客管理システムに携わっていたので、\u003cbr\u003e\n「DBにある大量の情報、プラスDBの情報を元に他のサーバーから通信で情報を取得し、表示する形に加工して、画面や帳票に出力する」を仮説として考えた。\u003cbr\u003e\n仮説でいい。もっと長く業務にいるともっと多くのことをしていると知るが、パッと思いつくものを仮説として持てばいい感じだった。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"25:1-25:29\"\u003e\n\u003cspan id=\"3入力-処理-出力\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E5%85%A5%E5%8A%9B-%E5%87%A6%E7%90%86-%E5%87%BA%E5%8A%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3.　入力-\u0026gt;処理-\u0026gt;出力\u003c/h1\u003e\n\u003cp data-sourcepos=\"26:1-31:24\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/9996868cab8a5a27cd3bacea32fa63f844d0306f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433353237342f39653733373865622d626130622d623664652d653035622d6236643635343761626165652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2F9e7378eb-ba0b-b6de-e05b-b6d6547abaee.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8ca298f427a356a6c8f1126ca5e38ea1\" alt=\"図1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/9e7378eb-ba0b-b6de-e05b-b6d6547abaee.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2F9e7378eb-ba0b-b6de-e05b-b6d6547abaee.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=573c362ab2623a1c87a0070b4a9e850d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n先輩の「プログラミングは、必ず [入力-\u0026gt;処理-\u0026gt;出力] の順でできている」という言葉から、\u003cbr\u003e\n入力...元となるデータだ。\u003cbr\u003e\n処理...加工やら編集やら何やらだ。\u003cbr\u003e\n出力...元となるデータからやりたかったことだ。\u003cbr\u003e\nと自分は考えた。\u003c/p\u003e\n\u003cp data-sourcepos=\"33:1-38:33\"\u003e自分の携わっているアプリでは\u003cbr\u003e\n「(入力)DBにある大量の情報、\u003cbr\u003e\n　(入力か処理)プラスDBの情報を元に他のサーバーから通信で情報を取得し、\u003cbr\u003e\n　(処理)表示する形に加工して、\u003cbr\u003e\n　(出力)画面や帳票に出力する」\u003cbr\u003e\nそれが全体のすること。\u003c/p\u003e\n\u003cp data-sourcepos=\"40:1-41:46\"\u003e入力なのか処理なのかあやふやだけど必ず入力-\u0026gt;処理-\u0026gt;出力の順。\u003cbr\u003e\n出力-\u0026gt;入力-\u0026gt;処理とかはならない。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"43:1-43:50\"\u003e\n\u003cspan id=\"4自分の担当の入力-処理-出力\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4%E8%87%AA%E5%88%86%E3%81%AE%E6%8B%85%E5%BD%93%E3%81%AE%E5%85%A5%E5%8A%9B-%E5%87%A6%E7%90%86-%E5%87%BA%E5%8A%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4.　自分の担当の、入力-\u0026gt;処理-\u0026gt;出力\u003c/h1\u003e\n\u003cp data-sourcepos=\"44:1-49:133\"\u003e自分の担当では、モデルから値を取ってきて編集して違うモデルに入れる処理だった。（アプリ全体の仮説の処理の部分）\u003cbr\u003e\n入力...値を取ってくるモデル\u003cbr\u003e\n処理...編集\u003cbr\u003e\n出力...違うモデルに入れる\u003cbr\u003e\nと考えた。当時SEだったから設計書にマーカーで入力、処理、出力を引いて整理した。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/34de292d36a5b08b99022da3f79b89fc907c2f56/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433353237342f61303831646536612d663232632d623762632d346433642d6432326539323462633461312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2Fa081de6a-f22c-b7bc-4d3d-d22e924bc4a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=541953fab82b510159ec91c0a7fff7b4\" width=\"200px\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/a081de6a-f22c-b7bc-4d3d-d22e924bc4a1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2Fa081de6a-f22c-b7bc-4d3d-d22e924bc4a1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5e58e112f43a22298e504e845e7a415a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"52:1-52:69\"\u003e\n\u003cspan id=\"5-一つ一つの処理のやコード上の入力-処理-出力\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-%E4%B8%80%E3%81%A4%E4%B8%80%E3%81%A4%E3%81%AE%E5%87%A6%E7%90%86%E3%81%AE%E3%82%84%E3%82%B3%E3%83%BC%E3%83%89%E4%B8%8A%E3%81%AE%E5%85%A5%E5%8A%9B-%E5%87%A6%E7%90%86-%E5%87%BA%E5%8A%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. 一つ一つの処理のやコード上の入力-\u0026gt;処理-\u0026gt;出力\u003c/h1\u003e\n\u003cp data-sourcepos=\"53:1-53:144\"\u003e一つ一つのコードにも入力や出力がある。よく考えれば当たり前だったんだけど、当時は分からなかった。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"54:1-57:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003econst before = 'あいう置換文字えお';\nconst after = before.replace('置換文字', '置き換わったよ');\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"58:1-62:12\"\u003e置換する時も\u003cbr\u003e\n(入力)置換前の変数 brefore\u003cbr\u003e\n(処理)置換する処理 replace\u003cbr\u003e\n(出力)置換した結果 after\u003cbr\u003e\nがある。\u003c/p\u003e\n\u003cp data-sourcepos=\"64:1-65:69\"\u003eプログラムは細部で見ても、大きく見ても同じ[入力-\u0026gt;処理-\u0026gt;出力]の繰り返しで出来ている。\u003cbr\u003e\nそう思えた時、すごく面白かったのを覚えている。\u003c/p\u003e\n\u003cp data-sourcepos=\"67:1-69:133\"\u003e時にトップダウンから、[アプリ、システム -\u0026gt; 自分の担当 -\u0026gt; 一つ一つの処理]について考え\u003cbr\u003e\nそれで分からなくなったら逆のボトムダウンから考えて、最初はそんな感じで何とかやっていった。という昔話です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7d3e16aa8645d45a51fedaeda678cbc44438fcc2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3433353237342f62656165663530612d653763642d326562312d323564352d6430306439353938336336362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2Fbeaef50a-e7cd-2eb1-25d5-d00d95983c66.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b936cc4f83a9e6e62cb536e5d3b3ed1c\" width=\"200px\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/beaef50a-e7cd-2eb1-25d5-d00d95983c66.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F435274%2Fbeaef50a-e7cd-2eb1-25d5-d00d95983c66.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e4e7c43e5180c47198aee6e9f4b546c2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"`※プログラミングをし初めの頃に感覚的に思っていた個人的な考えです。\n（ちなみに２０年ほど前の古い考えです）`\n\n# 1. 概要\n若い時、学校でプログラミングを習って、初めて仕事で「この処理書いて」と言われた時...\n![kaisya_komaru_man.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/0385ffd2-c19d-52f9-0d21-509238b38d73.png)\n何からすればいいのか分からない。\nとりあえず、自分の作る流れのコメントを書いてみようとするが、よく分からない。手が動かない。\nそんな時先輩に言われたのが、\u003cb\u003e「プログラミングは、必ず [入力-\u003e処理-\u003e出力] の順でできている」\u003c/b\u003eでした。\n\n# 2. コンピュータにさせたいことはなんだろう\nコンピューター作るものによっては、自分のPCだったり、サーバーサイドならサーバー、組み込み系なら組み込み機器。それにさせたいことは何だろう。\n* 大量の情報を加工すること？\n* 情報を通信して多数のコンピュータでやり取りすること？\n\u003cimg src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/cb652589-0847-5519-139f-60609b3bd3a1.png\" width=\"300px\"\u003e\n\n自分の作っているシステムやアプリのしたいことは何だろう。\n全体を見ると一つには絞れないと思う。\n\n自分はその時Web系の顧客管理システムに携わっていたので、\n「DBにある大量の情報、プラスDBの情報を元に他のサーバーから通信で情報を取得し、表示する形に加工して、画面や帳票に出力する」を仮説として考えた。\n仮説でいい。もっと長く業務にいるともっと多くのことをしていると知るが、パッと思いつくものを仮説として持てばいい感じだった。\n\n\n# 3.　入力-\u003e処理-\u003e出力\n![図1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/9e7378eb-ba0b-b6de-e05b-b6d6547abaee.png)\n先輩の「プログラミングは、必ず [入力-\u003e処理-\u003e出力] の順でできている」という言葉から、\n入力...元となるデータだ。\n処理...加工やら編集やら何やらだ。\n出力...元となるデータからやりたかったことだ。\nと自分は考えた。\n\n自分の携わっているアプリでは\n「(入力)DBにある大量の情報、\n　(入力か処理)プラスDBの情報を元に他のサーバーから通信で情報を取得し、\n　(処理)表示する形に加工して、\n　(出力)画面や帳票に出力する」\nそれが全体のすること。\n\n入力なのか処理なのかあやふやだけど必ず入力-\u003e処理-\u003e出力の順。\n出力-\u003e入力-\u003e処理とかはならない。\n\n# 4.　自分の担当の、入力-\u003e処理-\u003e出力\n自分の担当では、モデルから値を取ってきて編集して違うモデルに入れる処理だった。（アプリ全体の仮説の処理の部分）\n入力...値を取ってくるモデル\n処理...編集\n出力...違うモデルに入れる\nと考えた。当時SEだったから設計書にマーカーで入力、処理、出力を引いて整理した。\n\u003cimg src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/a081de6a-f22c-b7bc-4d3d-d22e924bc4a1.png\" width=\"200px\"\u003e\n\n\n# 5. 一つ一つの処理のやコード上の入力-\u003e処理-\u003e出力\n一つ一つのコードにも入力や出力がある。よく考えれば当たり前だったんだけど、当時は分からなかった。\n```\nconst before = 'あいう置換文字えお';\nconst after = before.replace('置換文字', '置き換わったよ');\n```\n置換する時も\n(入力)置換前の変数 brefore\n(処理)置換する処理 replace\n(出力)置換した結果 after\nがある。\n\nプログラムは細部で見ても、大きく見ても同じ[入力-\u003e処理-\u003e出力]の繰り返しで出来ている。\nそう思えた時、すごく面白かったのを覚えている。\n\n時にトップダウンから、[アプリ、システム -\u003e 自分の担当 -\u003e 一つ一つの処理]について考え\nそれで分からなくなったら逆のボトムダウンから考えて、最初はそんな感じで何とかやっていった。という昔話です。\n\u003cimg src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/435274/beaef50a-e7cd-2eb1-25d5-d00d95983c66.png\" width=\"200px\"\u003e\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:51:47+09:00","group":null,"id":"56b6d6cb5965ae126a3d","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"プログラミング初心者","versions":[]},{"name":"プログラミング勉強日記","versions":[]}],"title":"初心者向けプログラミングの仕方","updated_at":"2022-09-18T22:00:36+09:00","url":"https://qiita.com/mae616/items/56b6d6cb5965ae126a3d","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"mae616","items_count":1,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":435274,"profile_image_url":"https://secure.gravatar.com/avatar/3eb8f2604f2effe9ce23bc606be911e7","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:380\"\u003eAzure Monitor エージェントを使ったLinux仮想マシンのディスク使用率監視を行います。 Log Analytics エージェントの場合は難しいことなく実現できたのですが、後継の Azure Monitor エージェントだと「/」という合計のディスク使用率しかログに表示されず、少しカスタマイズが必要でした。\u003c/p\u003e\n\u003cp data-sourcepos=\"3:1-3:37\"\u003eポイントは以下の3点です。\u003c/p\u003e\n\u003col data-sourcepos=\"4:1-7:0\"\u003e\n\u003cli data-sourcepos=\"4:1-4:108\"\u003eLinux OS 上で ディスク容量確認結果を syslog に定期的に吐き出すように設定する\u003c/li\u003e\n\u003cli data-sourcepos=\"5:1-5:76\"\u003eAzure Monitor | データ収集ルール で Linux Syslog を収集する\u003c/li\u003e\n\u003cli data-sourcepos=\"6:1-7:0\"\u003eAzure Monitor ログアラートを設定する\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp data-sourcepos=\"8:1-10:117\"\u003eAzure Monitor エージェントの初期設定や仮想マシンへのエージェントインストール方法については、公式ドキュメントをご確認下さい。\u003cbr\u003e\n\u003ca href=\"https://learn.microsoft.com/ja-jp/azure/azure-monitor/vm/tutorial-monitor-vm-enable\" rel=\"nofollow noopener\" target=\"_blank\"\u003eチュートリアル: Azure 仮想マシンに対する監視を有効にする\u003cbr\u003e\n| Microsoft ドキュメント\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"12:1-12:111\"\u003e\n\u003cspan id=\"1-linux-os-上で-ディスク容量確認結果を-syslog-に定期的に吐き出すように設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-linux-os-%E4%B8%8A%E3%81%A7-%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E5%AE%B9%E9%87%8F%E7%A2%BA%E8%AA%8D%E7%B5%90%E6%9E%9C%E3%82%92-syslog-%E3%81%AB%E5%AE%9A%E6%9C%9F%E7%9A%84%E3%81%AB%E5%90%90%E3%81%8D%E5%87%BA%E3%81%99%E3%82%88%E3%81%86%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. Linux OS 上で ディスク容量確認結果を syslog に定期的に吐き出すように設定する\u003c/h2\u003e\n\u003cp data-sourcepos=\"13:1-15:109\"\u003eOS上で以下のコマンドを実行します。\u003cbr\u003e\n※ 権限が足りない場合は root で実行するとうまくいくと思います。\u003cbr\u003e\n※ Ubuntu など、 SELinux が動いてない環境の場合は \u003ccode\u003erestorecon\u003c/code\u003e は不要だと思います。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"17:1-34:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# df の結果を syslog に吐き出すシェルスクリプトを作成\u003c/span\u003e\n\u003cspan class=\"nb\"\u003els\u003c/span\u003e \u003cspan class=\"nt\"\u003e-lZ\u003c/span\u003e /usr/local/bin/\n\u003cspan class=\"nb\"\u003ecat\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;-\u003c/span\u003e \u003cspan class=\"no\"\u003eEOT\u003c/span\u003e\u003cspan class=\"sh\"\u003e \u0026gt; /usr/local/bin/dfInfo\n#! /bin/bash\nLANG=C df -m | tr -s ' ' ' ' | sed -e '1d' | sed 's/\u003c/span\u003e\u003cspan class=\"se\"\u003e\\%\u003c/span\u003e\u003cspan class=\"sh\"\u003e//g' | logger -p syslog.info\n\u003c/span\u003e\u003cspan class=\"no\"\u003eEOT\n\u003c/span\u003erestorecon /usr/local/bin/dfInfo\n\u003cspan class=\"nb\"\u003echmod \u003c/span\u003e744 /usr/local/bin/dfInfo\n\u003cspan class=\"nb\"\u003els\u003c/span\u003e \u003cspan class=\"nt\"\u003e-lZ\u003c/span\u003e /usr/local/bin/\n\n\u003cspan class=\"c\"\u003e# 10分ごとに作成したスクリプトを実行する\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecat\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;-\u003c/span\u003e \u003cspan class=\"no\"\u003eEOT\u003c/span\u003e\u003cspan class=\"sh\"\u003e \u0026gt; /etc/cron.d/dfInfo\n0,10,20,30,40,50 * * * * root /usr/local/bin/dfInfo\n\u003c/span\u003e\u003cspan class=\"no\"\u003eEOT\n\u003c/span\u003erestorecon /etc/cron.d/dfInfo\n\u003cspan class=\"nb\"\u003els\u003c/span\u003e \u003cspan class=\"nt\"\u003e-lZ\u003c/span\u003e /etc/cron.d/\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"36:1-36:110\"\u003eこれで、10分ごとに syslog に df コマンドの結果がいい感じに出力されるはずです。\u003c/p\u003e\n\u003cp data-sourcepos=\"38:1-38:122\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/e7c02e2816036d01697ab459e282d59d518c665c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3339353435372f30613364303539642d663437632d313361612d363133322d3064393563616663306161352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F395457%2F0a3d059d-f47c-13aa-6132-0d95cafc0aa5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b20fabbf31dff6d570f6159cf05855e0\" alt=\"syslog.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/395457/0a3d059d-f47c-13aa-6132-0d95cafc0aa5.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F395457%2F0a3d059d-f47c-13aa-6132-0d95cafc0aa5.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b386b8932b27b53244345b9ea83421cb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"40:1-40:79\"\u003e\n\u003cspan id=\"2-azure-monitor--データ収集ルール-で-linux-syslog-を収集する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-azure-monitor--%E3%83%87%E3%83%BC%E3%82%BF%E5%8F%8E%E9%9B%86%E3%83%AB%E3%83%BC%E3%83%AB-%E3%81%A7-linux-syslog-%E3%82%92%E5%8F%8E%E9%9B%86%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. Azure Monitor | データ収集ルール で Linux Syslog を収集する\u003c/h2\u003e\n\u003cp data-sourcepos=\"41:1-41:142\"\u003esyslog の INFO レベルのログを Log Analytics ワークスペールに収集するためのデータ収集ルールを作成します。\u003c/p\u003e\n\u003cp data-sourcepos=\"43:1-44:181\"\u003eAzure Portal にて、 モニター \u0026gt; データ収集ルール 画面で \u003cstrong\u003e[＋作成]\u003c/strong\u003e をクリックします。\u003cbr\u003e\n\u003cstrong\u003e[収集と配信]\u003c/strong\u003e でデータソースを追加し、以下のように設定します。その他の設定項目は各環境に合わせて適切に設定してください。\u003c/p\u003e\n\u003ctable data-sourcepos=\"46:1-51:26\"\u003e\n\u003cthead\u003e\n\u003ctr data-sourcepos=\"46:1-46:33\"\u003e\n\u003cth data-sourcepos=\"46:2-46:15\"\u003e設定項目\u003c/th\u003e\n\u003cth data-sourcepos=\"46:17-46:17\"\u003e\u003c/th\u003e\n\u003cth data-sourcepos=\"46:19-46:32\"\u003e値（例）\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr data-sourcepos=\"48:1-48:47\"\u003e\n\u003ctd data-sourcepos=\"48:2-48:36\"\u003eプラットフォームの種類\u003c/td\u003e\n\u003ctd data-sourcepos=\"48:38-48:38\"\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"48:40-48:46\"\u003eLinux\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"49:1-49:49\"\u003e\n\u003ctd data-sourcepos=\"49:2-49:31\"\u003eデータ ソースの種類\u003c/td\u003e\n\u003ctd data-sourcepos=\"49:33-49:33\"\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"49:35-49:48\"\u003eLinux Syslog\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"50:1-50:46\"\u003e\n\u003ctd data-sourcepos=\"50:2-50:21\"\u003eファシリティ\u003c/td\u003e\n\u003ctd data-sourcepos=\"50:23-50:34\"\u003eLOG_SYSLOG\u003c/td\u003e\n\u003ctd data-sourcepos=\"50:36-50:45\"\u003eLOG_INFO\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"51:1-51:26\"\u003e\n\u003ctd data-sourcepos=\"51:2-51:3\"\u003e\u003c/td\u003e\n\u003ctd data-sourcepos=\"51:5-51:18\"\u003eそれ以外\u003c/td\u003e\n\u003ctd data-sourcepos=\"51:20-51:25\"\u003enone\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp data-sourcepos=\"53:1-53:66\"\u003e設定内容を確認し、ルールを作成してください。\u003c/p\u003e\n\u003cp data-sourcepos=\"55:1-57:100\"\u003eこれで、設定した Log Analytics ワークスペースに df の情報が収集されるようになりました。\u003cbr\u003e\n試しに Log Analytics でログを見てみましょう。ログの収集に時間がかかる \u003cstrong\u003e(*1)\u003c/strong\u003e ので、上記設定のあと15分後くらいに見ると良いです。\u003cbr\u003e\n設定した Log Analytics ワークスペース のログで以下のクエリを実行します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"59:1-62:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSyslog\n| where Facility contains \"syslog\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"64:1-64:124\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/9007ad6919686133211200c550a15f21478ad36a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3339353435372f34643836303838352d613462332d353930662d343239662d3335373333376534333066392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F395457%2F4d860885-a4b3-590f-429f-357337e430f9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f18401efd8bfa10c9f2ea2fcd400d0b4\" alt=\"logana_1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/395457/4d860885-a4b3-590f-429f-357337e430f9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F395457%2F4d860885-a4b3-590f-429f-357337e430f9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=585fb4a3b681535de43ab0b68f0948b5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"66:1-66:330\"\u003eここまでの設定がうまくできていれば、\u003ccode\u003esyslog\u003c/code\u003e が収集できています。しかし、メッセージの内容が \u003ccode\u003eSyslogMessage\u003c/code\u003e の1カラムにまとめられており、このままではアラートで閾値を設定することができません。そこで、クエリでいい感じに表示します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"68:1-78:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSyslog\n| where Facility contains \"syslog\"\n| extend Fields = split(SyslogMessage, ' ')\n| extend Filesystem = tostring(Fields[0])\n| extend 1Mblocks = toint(Fields[1])\n| extend UsedMiB = toint(Fields[2])\n| extend AvailableMiB = toint(Fields[3])\n| extend UsePercent = toint(Fields[4])\n| extend MountedOn = tostring(Fields[5])\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"80:1-80:124\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/9469330b14f8d07e43dc56b9a88b86a332e34bbe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3339353435372f61356539666335312d376233652d376166302d346336362d3739656335333838313763612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F395457%2Fa5e9fc51-7b3e-7af0-4c66-79ec538817ca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=354aa7c660165c19f7303cdb19f3adff\" alt=\"logana_2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/395457/a5e9fc51-7b3e-7af0-4c66-79ec538817ca.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F395457%2Fa5e9fc51-7b3e-7af0-4c66-79ec538817ca.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f1a1eb57a023c38bf8bc345f66103ad9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"82:1-82:57\"\u003eこれでアラートを作る準備が整いました。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"84:1-84:53\"\u003e\n\u003cspan id=\"3-azure-monitor-ログアラートを設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-azure-monitor-%E3%83%AD%E3%82%B0%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. Azure Monitor ログアラートを設定する\u003c/h2\u003e\n\u003cp data-sourcepos=\"85:1-85:104\"\u003eLog Analytics のクエリを軽くするため、検査するログの時間を範囲指定します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"87:1-98:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSyslog\n| where TimeGenerated \u0026gt; ago(30m)\n| where Facility contains \"syslog\"\n| extend Fields = split(SyslogMessage, ' ')\n| extend Filesystem = tostring(Fields[0])\n| extend 1Mblocks = toint(Fields[1])\n| extend UsedMiB = toint(Fields[2])\n| extend AvailableMiB = toint(Fields[3])\n| extend UsePercent = toint(Fields[4])\n| extend MountedOn = tostring(Fields[5])\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"100:1-101:96\"\u003eLog Analytics のクエリの画面で \u003cstrong\u003e[+新しいアラートルール]\u003c/strong\u003e をクリックします。アラート作成の画面に遷移します。\u003cbr\u003e\n\u003cstrong\u003eアラートルールの作成 \u0026gt; 条件 \u0026gt; 測定\u003c/strong\u003e  にて、以下の設定を入れます。\u003c/p\u003e\n\u003ctable data-sourcepos=\"103:1-107:27\"\u003e\n\u003cthead\u003e\n\u003ctr data-sourcepos=\"103:1-103:31\"\u003e\n\u003cth data-sourcepos=\"103:2-103:15\"\u003e設定項目\u003c/th\u003e\n\u003cth data-sourcepos=\"103:17-103:30\"\u003e値（例）\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr data-sourcepos=\"105:1-105:29\"\u003e\n\u003ctd data-sourcepos=\"105:2-105:15\"\u003eメジャー\u003c/td\u003e\n\u003ctd data-sourcepos=\"105:17-105:28\"\u003eUsePercent\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"106:1-106:31\"\u003e\n\u003ctd data-sourcepos=\"106:2-106:18\"\u003e集計の種類\u003c/td\u003e\n\u003ctd data-sourcepos=\"106:20-106:30\"\u003e最大値\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"107:1-107:27\"\u003e\n\u003ctd data-sourcepos=\"107:2-107:18\"\u003e集計の粒度\u003c/td\u003e\n\u003ctd data-sourcepos=\"107:20-107:26\"\u003e30分\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp data-sourcepos=\"109:1-109:114\"\u003e\u003cstrong\u003eアラートルールの作成 \u0026gt; 条件 \u0026gt; アラートロジック\u003c/strong\u003e  にて、以下の設定を入れます。\u003c/p\u003e\n\u003ctable data-sourcepos=\"111:1-115:27\"\u003e\n\u003cthead\u003e\n\u003ctr data-sourcepos=\"111:1-111:31\"\u003e\n\u003cth data-sourcepos=\"111:2-111:15\"\u003e設定項目\u003c/th\u003e\n\u003cth data-sourcepos=\"111:17-111:30\"\u003e値（例）\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr data-sourcepos=\"113:1-113:40\"\u003e\n\u003ctd data-sourcepos=\"113:2-113:12\"\u003e演算子\u003c/td\u003e\n\u003ctd data-sourcepos=\"113:14-113:39\"\u003e次の値より大きい\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"114:1-114:21\"\u003e\n\u003ctd data-sourcepos=\"114:2-114:15\"\u003eしきい値\u003c/td\u003e\n\u003ctd data-sourcepos=\"114:17-114:20\"\u003e80\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr data-sourcepos=\"115:1-115:27\"\u003e\n\u003ctd data-sourcepos=\"115:2-115:18\"\u003e評価の頻度\u003c/td\u003e\n\u003ctd data-sourcepos=\"115:20-115:26\"\u003e30分\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp data-sourcepos=\"117:1-117:102\"\u003eその他の設定項目については、各環境に合わせて適切に設定してください。\u003c/p\u003e\n\u003cp data-sourcepos=\"119:1-119:164\"\u003e以上の設定にて、Azure Monitor エージェントを利用する場合にもディスク使用率を監視することができるようになりました。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"122:1-122:15\"\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h2\u003e\n\u003cp data-sourcepos=\"123:1-123:625\"\u003e今回は、Azure Monitor エージェントを使った Linux 仮想マシンのディスク使用率監視アラートを作ってみました。Log Analytics エージェントは \u003cstrong\u003e2024年8月31日 にサポート終了予定\u003c/strong\u003e \u003cstrong\u003e(*2)\u003c/strong\u003e だそうです。現在 Log Analytics エージェントを使用している場合は、Azure Monitor エージェント への切り替えが必要になってくるかと思います。その際にご参考になれば幸いです。（いずれ Azure Monitor エージェントそのままでもいい感じにディスク使用率監視できるようになる気はします）\u003c/p\u003e\n\u003ch2 data-sourcepos=\"125:1-125:9\"\u003e\n\u003cspan id=\"注釈\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E9%87%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注釈\u003c/h2\u003e\n\u003cul data-sourcepos=\"126:1-130:157\"\u003e\n\u003cli data-sourcepos=\"126:1-128:0\"\u003e\n\u003cp data-sourcepos=\"126:3-127:175\"\u003e\u003cstrong\u003e(*1)\u003c/strong\u003e \u003cem\u003eログ データを取り込むための一般的な待ち時間は 20 秒から 3 分です。\u003c/em\u003e\u003cbr\u003e\n\u003ca href=\"https://learn.microsoft.com/ja-jp/azure/azure-monitor/logs/data-ingestion-time\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAzure Monitor でのログ データ インジェスト時間 | Microsoft ドキュメント\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"129:1-130:157\"\u003e\n\u003cp data-sourcepos=\"129:3-130:157\"\u003e\u003cstrong\u003e(*2)\u003c/strong\u003e \u003cem\u003eLog Analytics エージェントは廃止予定で、2024 年 8 月 31 日を過ぎるとサポートされなくなります。\u003c/em\u003e\u003cbr\u003e\n\u003ca href=\"https://learn.microsoft.com/ja-jp/azure/azure-monitor/agents/log-analytics-agent\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLog Analytics エージェントの概要 | Microsoft ドキュメント\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n","body":"Azure Monitor エージェントを使ったLinux仮想マシンのディスク使用率監視を行います。 Log Analytics エージェントの場合は難しいことなく実現できたのですが、後継の Azure Monitor エージェントだと「/」という合計のディスク使用率しかログに表示されず、少しカスタマイズが必要でした。\n\nポイントは以下の3点です。\n1. Linux OS 上で ディスク容量確認結果を syslog に定期的に吐き出すように設定する\n1. Azure Monitor | データ収集ルール で Linux Syslog を収集する\n1. Azure Monitor ログアラートを設定する\n\nAzure Monitor エージェントの初期設定や仮想マシンへのエージェントインストール方法については、公式ドキュメントをご確認下さい。\n[チュートリアル: Azure 仮想マシンに対する監視を有効にする\n | Microsoft ドキュメント](https://learn.microsoft.com/ja-jp/azure/azure-monitor/vm/tutorial-monitor-vm-enable)\n\n## 1. Linux OS 上で ディスク容量確認結果を syslog に定期的に吐き出すように設定する\nOS上で以下のコマンドを実行します。\n※ 権限が足りない場合は root で実行するとうまくいくと思います。\n※ Ubuntu など、 SELinux が動いてない環境の場合は `restorecon` は不要だと思います。\n\n```sh\n# df の結果を syslog に吐き出すシェルスクリプトを作成\nls -lZ /usr/local/bin/\ncat \u003c\u003c- EOT \u003e /usr/local/bin/dfInfo\n#! /bin/bash\nLANG=C df -m | tr -s ' ' ' ' | sed -e '1d' | sed 's/\\%//g' | logger -p syslog.info\nEOT\nrestorecon /usr/local/bin/dfInfo\nchmod 744 /usr/local/bin/dfInfo\nls -lZ /usr/local/bin/\n\n# 10分ごとに作成したスクリプトを実行する\ncat \u003c\u003c- EOT \u003e /etc/cron.d/dfInfo\n0,10,20,30,40,50 * * * * root /usr/local/bin/dfInfo\nEOT\nrestorecon /etc/cron.d/dfInfo\nls -lZ /etc/cron.d/\n```\n\nこれで、10分ごとに syslog に df コマンドの結果がいい感じに出力されるはずです。\n\n![syslog.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/395457/0a3d059d-f47c-13aa-6132-0d95cafc0aa5.png)\n\n## 2. Azure Monitor | データ収集ルール で Linux Syslog を収集する\nsyslog の INFO レベルのログを Log Analytics ワークスペールに収集するためのデータ収集ルールを作成します。\n\nAzure Portal にて、 モニター \u003e データ収集ルール 画面で __[＋作成]__ をクリックします。\n__[収集と配信]__ でデータソースを追加し、以下のように設定します。その他の設定項目は各環境に合わせて適切に設定してください。\n\n| 設定項目 | | 値（例） |\n| -- | -- | -- |\n| プラットフォームの種類 | | Linux |\n| データ ソースの種類 | | Linux Syslog |\n| ファシリティ | LOG_SYSLOG | LOG_INFO |\n|  | それ以外 | none |\n\n設定内容を確認し、ルールを作成してください。\n\nこれで、設定した Log Analytics ワークスペースに df の情報が収集されるようになりました。\n試しに Log Analytics でログを見てみましょう。ログの収集に時間がかかる __(*1)__ ので、上記設定のあと15分後くらいに見ると良いです。\n設定した Log Analytics ワークスペース のログで以下のクエリを実行します。\n\n```\nSyslog\n| where Facility contains \"syslog\"\n```\n\n![logana_1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/395457/4d860885-a4b3-590f-429f-357337e430f9.png)\n\nここまでの設定がうまくできていれば、`syslog` が収集できています。しかし、メッセージの内容が `SyslogMessage` の1カラムにまとめられており、このままではアラートで閾値を設定することができません。そこで、クエリでいい感じに表示します。\n\n```\nSyslog\n| where Facility contains \"syslog\"\n| extend Fields = split(SyslogMessage, ' ')\n| extend Filesystem = tostring(Fields[0])\n| extend 1Mblocks = toint(Fields[1])\n| extend UsedMiB = toint(Fields[2])\n| extend AvailableMiB = toint(Fields[3])\n| extend UsePercent = toint(Fields[4])\n| extend MountedOn = tostring(Fields[5])\n```\n\n![logana_2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/395457/a5e9fc51-7b3e-7af0-4c66-79ec538817ca.png)\n\nこれでアラートを作る準備が整いました。\n\n## 3. Azure Monitor ログアラートを設定する\nLog Analytics のクエリを軽くするため、検査するログの時間を範囲指定します。\n\n```\nSyslog\n| where TimeGenerated \u003e ago(30m)\n| where Facility contains \"syslog\"\n| extend Fields = split(SyslogMessage, ' ')\n| extend Filesystem = tostring(Fields[0])\n| extend 1Mblocks = toint(Fields[1])\n| extend UsedMiB = toint(Fields[2])\n| extend AvailableMiB = toint(Fields[3])\n| extend UsePercent = toint(Fields[4])\n| extend MountedOn = tostring(Fields[5])\n```\n\nLog Analytics のクエリの画面で __[+新しいアラートルール]__ をクリックします。アラート作成の画面に遷移します。\n__アラートルールの作成 \u003e 条件 \u003e 測定__  にて、以下の設定を入れます。\n\n| 設定項目 | 値（例） |\n| -- | -- |\n| メジャー | UsePercent |\n| 集計の種類 | 最大値 |\n| 集計の粒度 | 30分 |\n\n__アラートルールの作成 \u003e 条件 \u003e アラートロジック__  にて、以下の設定を入れます。\n\n| 設定項目 | 値（例） |\n| -- | -- |\n| 演算子 | 次の値より大きい |\n| しきい値 | 80 |\n| 評価の頻度 | 30分 |\n\nその他の設定項目については、各環境に合わせて適切に設定してください。\n\n以上の設定にて、Azure Monitor エージェントを利用する場合にもディスク使用率を監視することができるようになりました。\n\n\n## おわりに\n今回は、Azure Monitor エージェントを使った Linux 仮想マシンのディスク使用率監視アラートを作ってみました。Log Analytics エージェントは __2024年8月31日 にサポート終了予定__ __(*2)__ だそうです。現在 Log Analytics エージェントを使用している場合は、Azure Monitor エージェント への切り替えが必要になってくるかと思います。その際にご参考になれば幸いです。（いずれ Azure Monitor エージェントそのままでもいい感じにディスク使用率監視できるようになる気はします）\n\n## 注釈\n* __(*1)__ _ログ データを取り込むための一般的な待ち時間は 20 秒から 3 分です。_  \n [Azure Monitor でのログ データ インジェスト時間 | Microsoft ドキュメント](https://learn.microsoft.com/ja-jp/azure/azure-monitor/logs/data-ingestion-time)\n\n* __(*2)__ _Log Analytics エージェントは廃止予定で、2024 年 8 月 31 日を過ぎるとサポートされなくなります。_  \n [Log Analytics エージェントの概要 | Microsoft ドキュメント](https://learn.microsoft.com/ja-jp/azure/azure-monitor/agents/log-analytics-agent)\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:51:42+09:00","group":null,"id":"9513e88ad7e909187eba","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Linux","versions":[]},{"name":"Azure","versions":[]}],"title":"Azure Monitor エージェントでLinux仮想マシンのディスク使用率を監視する","updated_at":"2022-09-18T21:51:42+09:00","url":"https://qiita.com/yukit7s/items/9513e88ad7e909187eba","user":{"description":"主に Microsoft Azure に関する Tips を公開していきます。","facebook_id":"","followees_count":10,"followers_count":3,"github_login_name":"yukit7s","id":"yukit7s","items_count":12,"linkedin_id":"yukit7s","location":"","name":"","organization":"","permanent_id":395457,"profile_image_url":"https://avatars2.githubusercontent.com/u/46600832?v=4","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:14\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\u003cp data-sourcepos=\"3:1-3:113\"\u003e\u003ca href=\"/GORO_Neko\" class=\"user-mention js-hovercard\" title=\"GORO_Neko\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"GORO_Neko\"\u003e@GORO_Neko\u003c/a\u003e です。ご存知の方ご無沙汰してます。初めての方お初にお目にかかります。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:45\"\u003e最初にいつも通りのお断りをば。\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-7:114\"\u003e自分、仕事では一切マイコンボードを利用した業務に携わったことがございません。\u003c/p\u003e\n\u003cp data-sourcepos=\"9:1-9:186\"\u003e以下は、自分が所属する会社の意向を反映したものでもスタンスを示すものでもなく、単なる一個人の趣味の活動から産まれた記述です。\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-11:13\"\u003e… はい。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"13:1-13:97\"\u003e\n\u003cspan id=\"raspberry-pi-pico-用の-mruby-を使えるようになっていた凄い-嬉しい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#raspberry-pi-pico-%E7%94%A8%E3%81%AE-mruby-%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%9F%E5%87%84%E3%81%84-%E5%AC%89%E3%81%97%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRaspberry Pi Pico 用の mruby を使えるようになっていた（凄い！ 嬉しい！）\u003c/h1\u003e\n\u003cp data-sourcepos=\"15:1-15:255\"\u003eいつものごとくネットをサーフィンしていて、\u003ca href=\"https://www.raspberrypi.com/products/raspberry-pi-pico/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRaspberry Pi Pico\u003c/a\u003e 用の mruby を使えるようにしてくださった方がおられることに、先日気が付きました。\u003c/p\u003e\n\u003cp data-sourcepos=\"17:1-17:191\"\u003eRaspberry Pi Pico って \u003ca href=\"https://micropython.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicroPython\u003c/a\u003e とか使って弄くっても良いんですが、やっぱり Ruby 言語使って操作したいんですよ、自分は。\u003c/p\u003e\n\u003cp data-sourcepos=\"19:1-19:290\"\u003e早速、使えるようにしてくださった方が書かれた \u003ca href=\"https://qiita.com/k-mana/items/c64967b88e9bf50f760b\" id=\"reference-95200e2705dd9f0559e5\"\u003eqiita の記事\u003c/a\u003e と  \u003ca href=\"https://github.com/k-mana/pico-mruby\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGithub の記事\u003c/a\u003eを拝見して、Raspberry Pi Pico 用の mruby 実行環境を作成してみました。\u003c/p\u003e\n\u003cp data-sourcepos=\"21:1-21:193\"\u003e実行環境は前述の各記事で説明された操作をそのまま繰り返すだけであっさり作成でき、自分所有の Raspberry Pi Pico でもあっさり動作しました。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"23:1-23:23\"\u003e\n\u003cspan id=\"今回やったこと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回やったこと\u003c/h1\u003e\n\u003cp data-sourcepos=\"25:1-25:134\"\u003e上記の通り、Raspberry Pi Pico 用の mruby の実行環境に相当するアプリケーションを Build してみました。\u003c/p\u003e\n\u003cp data-sourcepos=\"27:1-27:401\"\u003e色々試したところ、上記の各記事には明記されていないんだけど、作業時に Python3 がいることがわかったり、前述の各記事を読んでいくと色々なツールチェーン（クロス開発用の gcc-arm-none-eabi libnewlib-arm-none-eabi libstdc++-arm-none-eabi-newlib 等）を導入しないといけなかったりすることが見えてきました。\u003c/p\u003e\n\u003cp data-sourcepos=\"29:1-29:356\"\u003eそれらを物理マシンに直接導入しちゃうと、他のものとコンフリクトしちゃったりしそうだったので、仮想環境（今回はコンテナを利用）に入れて、その中で Build を行うことで、Raspberry Pi Pico 用の mruby の実行環境に相当するアプリケーションを作成してみました。\u003c/p\u003e\n\u003cp data-sourcepos=\"31:1-31:161\"\u003eコンテナの構築は手作業で行わず、Dockerfile 化して、別環境での利用も容易化してみましたが、誰か再利用されますか？\u003c/p\u003e\n\u003cp data-sourcepos=\"33:1-33:113\"\u003e※ Dockerfile は\u003ca href=\"https://github.com/YoshihikoHara/Dockerfile-for-pico-mruby\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eで公開してます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"35:1-35:25\"\u003e\n\u003cspan id=\"dockerfile-について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dockerfile-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDockerfile について\u003c/h1\u003e\n\u003cp data-sourcepos=\"37:1-37:65\"\u003eDockerfile の中では特に難しいことはしていません\u003c/p\u003e\n\u003cp data-sourcepos=\"39:1-39:24\"\u003e上から見ていくと\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"41:1-60:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e#\n# Last Updete: 2022/09/16\n#\n# Author: Yoshihiko Hara\n#\n# Overview:\n#   Create a container containing development environment of pico-mruby (mruby for Raspberry Pi Pico).\n#\n\n# Specify the image (Ubuntu 22.04) to be the base of the container.\nFrom ubuntu:22.04\n\n# Specify working directory (/root).\nWORKDIR /root\n\n# Update applications and others.\nRUN apt -y update\nRUN apt -y upgrade\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"62:1-64:69\"\u003e① Ubuntu 22.04 のコンテナを作る\u003cbr\u003e\n②  \"/root\" ディレクトリに移動して（ここが開発ディレクトリの起点）\u003cbr\u003e\n③ OS（というかコンテナのユーザランド）を最新化\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"66:1-73:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# Install working tools (vim, wget, curl, git, python3).\n# Note: Ubuntu:22.04 container images do not have Python3 installed by default.\nRUN apt -y install vim wget curl git python3\n\n# Install build tools.\nRUN apt -y install cmake build-essential gcc-arm-none-eabi libnewlib-arm-none-eabi libstdc++-arm-none-eabi-newlib rake\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"75:1-75:88\"\u003e④ 開発に必要そうなツール類と、ツールチェーンをごそっと導入\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"77:1-85:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# Get \"pico-mruby\" source code \u0026amp; Build.\nRUN git clone https://github.com/k-mana/pico-mruby.git --recursive\nWORKDIR /root/pico-mruby\nRUN mkdir build\nWORKDIR /root/pico-mruby/build\nRUN cmake ..\nRUN cmake --build .\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"87:1-89:19\"\u003e⑤ Github から Build 用のリソース一式を Get\u003cbr\u003e\n⑥ 作業に必要なサブディレクトリ作成し、移動\u003cbr\u003e\n⑦ Build を実行\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"91:1-96:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# Specify the locale.\nRUN apt -y install locales\nRUN echo \"ja_JP UTF-8\" \u0026gt; /etc/locale.gen\nRUN locale-gen\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"98:1-99:96\"\u003e最後は、自分の趣味。\u003cbr\u003e\nコンテナのロケールに \"ja_JP UTF-8\" を追加しただけです（蛇足です♪）。\u003c/p\u003e\n\u003cp data-sourcepos=\"101:1-101:69\"\u003eこの Dockerfile が誰かのお役立ちとなると良いなぁ。\u003c/p\u003e\n\u003cp data-sourcepos=\"103:1-103:18\"\u003eでは、また。\u003c/p\u003e\n","body":"# はじめに\n\n@GORO_Neko です。ご存知の方ご無沙汰してます。初めての方お初にお目にかかります。\n\n最初にいつも通りのお断りをば。\n\n自分、仕事では一切マイコンボードを利用した業務に携わったことがございません。\n\n以下は、自分が所属する会社の意向を反映したものでもスタンスを示すものでもなく、単なる一個人の趣味の活動から産まれた記述です。\n\n… はい。\n\n# Raspberry Pi Pico 用の mruby を使えるようになっていた（凄い！ 嬉しい！）\n\nいつものごとくネットをサーフィンしていて、[Raspberry Pi Pico](https://www.raspberrypi.com/products/raspberry-pi-pico/) 用の mruby を使えるようにしてくださった方がおられることに、先日気が付きました。\n\nRaspberry Pi Pico って [MicroPython](https://micropython.org/) とか使って弄くっても良いんですが、やっぱり Ruby 言語使って操作したいんですよ、自分は。\n\n早速、使えるようにしてくださった方が書かれた [qiita の記事](https://qiita.com/k-mana/items/c64967b88e9bf50f760b) と  [Github の記事](https://github.com/k-mana/pico-mruby)を拝見して、Raspberry Pi Pico 用の mruby 実行環境を作成してみました。\n\n実行環境は前述の各記事で説明された操作をそのまま繰り返すだけであっさり作成でき、自分所有の Raspberry Pi Pico でもあっさり動作しました。\n\n# 今回やったこと\n\n上記の通り、Raspberry Pi Pico 用の mruby の実行環境に相当するアプリケーションを Build してみました。\n\n色々試したところ、上記の各記事には明記されていないんだけど、作業時に Python3 がいることがわかったり、前述の各記事を読んでいくと色々なツールチェーン（クロス開発用の gcc-arm-none-eabi libnewlib-arm-none-eabi libstdc++-arm-none-eabi-newlib 等）を導入しないといけなかったりすることが見えてきました。\n\nそれらを物理マシンに直接導入しちゃうと、他のものとコンフリクトしちゃったりしそうだったので、仮想環境（今回はコンテナを利用）に入れて、その中で Build を行うことで、Raspberry Pi Pico 用の mruby の実行環境に相当するアプリケーションを作成してみました。\n\nコンテナの構築は手作業で行わず、Dockerfile 化して、別環境での利用も容易化してみましたが、誰か再利用されますか？\n\n※ Dockerfile は[こちら](https://github.com/YoshihikoHara/Dockerfile-for-pico-mruby)で公開してます。\n\n# Dockerfile について\n\nDockerfile の中では特に難しいことはしていません\n\n上から見ていくと\n\n```\n#\n# Last Updete: 2022/09/16\n#\n# Author: Yoshihiko Hara\n#\n# Overview:\n#   Create a container containing development environment of pico-mruby (mruby for Raspberry Pi Pico).\n#\n\n# Specify the image (Ubuntu 22.04) to be the base of the container.\nFrom ubuntu:22.04\n\n# Specify working directory (/root).\nWORKDIR /root\n\n# Update applications and others.\nRUN apt -y update\nRUN apt -y upgrade\n```\n\n① Ubuntu 22.04 のコンテナを作る\n②  \"/root\" ディレクトリに移動して（ここが開発ディレクトリの起点）\n③ OS（というかコンテナのユーザランド）を最新化\n\n```\n# Install working tools (vim, wget, curl, git, python3).\n# Note: Ubuntu:22.04 container images do not have Python3 installed by default.\nRUN apt -y install vim wget curl git python3\n\n# Install build tools.\nRUN apt -y install cmake build-essential gcc-arm-none-eabi libnewlib-arm-none-eabi libstdc++-arm-none-eabi-newlib rake\n```\n\n④ 開発に必要そうなツール類と、ツールチェーンをごそっと導入\n\n```\n# Get \"pico-mruby\" source code \u0026 Build.\nRUN git clone https://github.com/k-mana/pico-mruby.git --recursive\nWORKDIR /root/pico-mruby\nRUN mkdir build\nWORKDIR /root/pico-mruby/build\nRUN cmake ..\nRUN cmake --build .\n```\n\n⑤ Github から Build 用のリソース一式を Get\n⑥ 作業に必要なサブディレクトリ作成し、移動\n⑦ Build を実行\n\n```\n# Specify the locale.\nRUN apt -y install locales\nRUN echo \"ja_JP UTF-8\" \u003e /etc/locale.gen\nRUN locale-gen\n```\n\n最後は、自分の趣味。\nコンテナのロケールに \"ja_JP UTF-8\" を追加しただけです（蛇足です♪）。\n\nこの Dockerfile が誰かのお役立ちとなると良いなぁ。\n\nでは、また。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:40:12+09:00","group":null,"id":"4a14ef35d3243729d442","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Ruby","versions":[]},{"name":"mruby","versions":[]},{"name":"dockerfile","versions":[]},{"name":"RaspberryPiPico","versions":[]}],"title":"Raspberry Pi Pico 用の mruby を Build するためのコンテナ作成用 Dockerfile を書いてみた","updated_at":"2022-09-18T21:51:30+09:00","url":"https://qiita.com/GORO_Neko/items/4a14ef35d3243729d442","user":{"description":"関東の片隅で某ベンダのエンジニアとして、同居ニャんと生きています。\r\n\r\n基本、ココに何か書くときは、野良エンジニアというかコンピュータ技術好きな市井のヒトのスタンスなのでよろしくです。\r\n","facebook_id":"yoshihiko.hara","followees_count":10,"followers_count":10,"github_login_name":null,"id":"GORO_Neko","items_count":24,"linkedin_id":"","location":"","name":"原 嘉彦","organization":" FUJITSU LIMITED. ","permanent_id":89832,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/89832/profile-images/1530777676","team_only":false,"twitter_screen_name":"GORO_Neko","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-8:273\"\u003eこんにちにゃんです。\u003cbr\u003e\n水色桜（みずいろさくら）です。\u003cbr\u003e\n今回は言語商会・長岡技術科学大学、山本先生の日本語感情表現辞書( \u003ca href=\"https://www.jnlp.org/GengoHouse/snow/d18\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.jnlp.org/GengoHouse/snow/d18\u003c/a\u003e )を用いて夏目漱石さんの「こころ」（青空文庫（　\u003ca href=\"https://www.aozora.gr.jp/%E3%80%80%E3%80%80%E3%80%80%E3%80%80\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.aozora.gr.jp/　　　　\u003c/a\u003e\u003cbr\u003e\n））の感情分析を行っていきたいと思います。\u003cbr\u003e\n山本先生のコーパスは単語に対して被験者の３人が48の感情のうちどの感情を感じたかが記されています。このコーパスを用いることで、文章に含まれている最も強い感情を特定することが可能です。\u003cbr\u003e\n解析結果は次のような感じです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/74d7869b556f21331ff9b0c13d6f7eb9e381a77c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834373334392f31343863636535632d343331622d306333302d343538312d6164346266653530643038312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2847349%2F148cce5c-431b-0c30-4581-ad4bfe50d081.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7dcf0a129db33c1c545956c443cc4b08\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2847349/148cce5c-431b-0c30-4581-ad4bfe50d081.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2847349%2F148cce5c-431b-0c30-4581-ad4bfe50d081.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cda6f3b2f11023a7582d87147bf25740 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n内訳を見ると、好きという感情が最も多く出現していることがわかります。ネタバレになってしまうので詳しくは言えませんが、「こころ」という文章の内容を鑑みると適切な内訳であると感じました。\u003c/p\u003e\n\u003cp data-sourcepos=\"10:1-12:302\"\u003e前置きはこのくらいにしてプログラムの構成について話していきます。\u003cbr\u003e\n文章の形態素解析には自然言語処理ライブラリGiNZAを用いました。GiNZAはリクルートさんと国立国語研究所さんが開発したものであり、高精度な解析が可能なライブラリです。\u003cbr\u003e\n形態素解析で単語に分割した後、言語商会・長岡技術科学大学山本先生の日本語感情表現辞書( \u003ca href=\"https://www.jnlp.org/GengoHouse/snow/d18\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.jnlp.org/GengoHouse/snow/d18\u003c/a\u003e )に検索をかけます。そして、単語ごとに含まれている感情を抽出し、文全体の感情を計測します。\u003c/p\u003e\n\u003cp data-sourcepos=\"14:1-14:57\"\u003eでは早速ソースコードを見てみましょう。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"16:1-265:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esent_analy.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003espacy\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etkinter\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003etk\u003c/span\u003e \n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ere\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003estatistics\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003est\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ematplotlib.pyplot\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eplt\u003c/span\u003e \n\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ercParams\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'font.family'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'MS Mincho'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# tkinterを用いてGUIを作成\n\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTk\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e# ウィンドウを作成\n\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003eu\u003c/span\u003e\u003cspan class=\"s\"\u003e'GiNZAによるコメントの感情分析プログラム'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# タイトルの定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egeometry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'500x500'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# ウィンドウサイズを定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ebg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'red'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# テキストボックスなどを載せるフレームを定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epack\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e# フレームを設置\n\u003c/span\u003e\u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eScrollbar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# スクロールバーの定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'right'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'y'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# スクロールバーを設置\n\u003c/span\u003e\u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eListbox\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e70\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e27\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eyscrollcommand\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ebg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'black'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'white'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# テキストボックスの定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'left'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'both'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003epady\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# テキストボックスの設置\n\u003c/span\u003e\u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'分析したいファイル名を入力してください。'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# テキストの表示\n\u003c/span\u003e\n\u003cspan class=\"n\"\u003enlp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espacy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'ja_ginza_electra'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# GiNZAのロード\n\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efeel\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"c1\"\u003e#ボタンを押したらこの関数を実行\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"c1\"\u003e#ラベルの位置を決めるための変数\n\u003c/span\u003e    \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etextF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e#入力したテキストを取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#テキスト（ラベル）を設定 \n\u003c/span\u003e    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etextF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#テキストボックスの文字を削除\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 感情を保持する配列\n\u003c/span\u003e    \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eg1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# テキストファイルの読み込み\n\u003c/span\u003e      \u003cspan class=\"n\"\u003eg2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eg1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"c1\"\u003e# テキストファイルを変数に格納\n\u003c/span\u003e      \u003cspan class=\"n\"\u003eg3\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eg2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \\nで区切る\n\u003c/span\u003e      \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eg3\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enlp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eg3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"c1\"\u003e#GiNZAによる入力したテキストの解析\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esen1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003esent\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esents\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#文章群の中から文章を一つずつ抽出\n\u003c/span\u003e            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#文章の中から形態素を一つずつ抽出\n\u003c/span\u003e                \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elemma_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 原形を保存\n\u003c/span\u003e        \u003cspan class=\"c1\"\u003e# 感情辞書を用いて感情を検索\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿被験者１.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \\nと\\tで分割\n\u003c/span\u003e        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e \n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 感情辞書にその単語があるか検索\n\u003c/span\u003e                    \u003cspan class=\"n\"\u003esen1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"c1\"\u003e#リストに追加\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esen2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿被験者２.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esen2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e   \n        \u003cspan class=\"n\"\u003esen3\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿被験者３.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esen3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003esen4\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003esen1\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003esen2\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003esen3\u003c/span\u003e \u003cspan class=\"c1\"\u003e# リストを結合\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esen4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# もしリストが空の場合\n\u003c/span\u003e            \u003cspan class=\"n\"\u003esen5\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 空を返す\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esen5\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003est\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esen4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#一番出現回数の多い感情を返す\n\u003c/span\u003e        \n        \u003cspan class=\"k\"\u003eglobal\u003c/span\u003e \u003cspan class=\"n\"\u003esen\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 感情を保持するリスト\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esen\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"c1\"\u003e# エラーが起きないように一応値を代入しておく\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿感情分類.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \\nで分割\n\u003c/span\u003e            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e49\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esen5\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esen\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# マッチした感情を代入\n\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esen\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# リストに追加\n\u003c/span\u003e    \n    \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeros\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e49\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 感情の出現回数を保持するリスト\n\u003c/span\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'安らぎ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'楽しさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'親しみ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'尊敬・尊さ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'感謝'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'気持ちが良い'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'誇らしい'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'感動'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'喜び'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'悲しさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'寂しさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'不満'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'切なさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'苦しさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'不安'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'憂鬱'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'辛さ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'好き'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e17\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e17\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'嫌悪'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'恥ずかしい'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e19\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e19\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'焦り'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'驚き'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e21\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e21\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'怒り'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e22\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'幸福感'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e23\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e23\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'恨み'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e24\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e24\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'恐れ（恐縮等の意味で）'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e25\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'恐怖'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e26\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e26\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'悔しさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e27\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e27\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'祝う気持ち'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e28\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e28\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'困惑'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e29\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e29\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'きまずさ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'興奮'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e31\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e31\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'悩み'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e32\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'願望'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e33\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e33\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'失望'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e34\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e34\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'あわれみ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e35\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e35\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'見下し'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e36\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e36\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'謝罪'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e37\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e37\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'ためらい'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e38\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e38\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'不快'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e39\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e39\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'怠さ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'あきれ'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e41\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e41\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'心配'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e42\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e42\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'緊張'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e43\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e43\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'妬み'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e44\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e44\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'憎い'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e45\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e45\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'残念'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e46\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e46\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'情けない'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e47\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e47\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003esss\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"s\"\u003e'穏やか'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargsort\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e)[::\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 出現回数が多い順に並び替え\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# 出現した感情、上位12位まで表示\n\u003c/span\u003e    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情１位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情２位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e        \n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情３位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情４位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情５位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情６位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e        \n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情７位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情８位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情９位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情１０位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e        \n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情１１位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eni\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emsgs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'end'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現した感情１２位は'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'です。出現回数'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'回'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 棒グラフを生成\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003eff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]]])\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003enff\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e]]]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003etick_label\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'center'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'#ADFF2F'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'図１　出現回数上位１２位までの感情'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003exlabel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'感情名'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eylabel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'出現回数'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshow\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\n\n\u003cspan class=\"c1\"\u003e#ボタンとテキストボックスの定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003ebtn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eButton\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'送信'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8_sig'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"n\"\u003ebg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'cyan'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ecommand\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003efeel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebtn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'right'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003etextF\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etk\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eEntry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8_sig'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003etextF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epack\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eside\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'right'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#画面の保持\n\u003c/span\u003e\u003cspan class=\"n\"\u003eroot\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emainloop\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"267:1-267:48\"\u003e流れは先ほど説明したとおりです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"269:1-277:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eg3\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enlp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eg3\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"c1\"\u003e#GiNZAによる入力したテキストの解析\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esen1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003esent\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esents\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#文章群の中から文章を一つずつ抽出\n\u003c/span\u003e            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e#文章の中から形態素を一つずつ抽出\n\u003c/span\u003e                \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elemma_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 原形を保存\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"279:1-279:41\"\u003eまずGiNZAで文章の解析を行い、\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"281:1-306:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e \u003cspan class=\"c1\"\u003e# 感情辞書を用いて感情を検索\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿被験者１.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \\nと\\tで分割\n\u003c/span\u003e        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e \n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 感情辞書にその単語があるか検索\n\u003c/span\u003e                    \u003cspan class=\"n\"\u003esen1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"c1\"\u003e#リストに追加\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esen2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿被験者２.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esen2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e   \n        \u003cspan class=\"n\"\u003esen3\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'長岡技術科学大学＿被験者３.txt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e\\t\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esen3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"308:1-311:24\"\u003eその文章の持つ感情を辞書から取得します。あとは感情の出現回数を記録してグラフとして表示するだけです。\u003cbr\u003e\n意外と簡単だと思われたのではないでしょうか？\u003cbr\u003e\nもしよろしければ皆さんもいろいろな文章の感情分析を行ってみてください。\u003cbr\u003e\nではばいにゃん～\u003c/p\u003e\n","body":"こんにちにゃんです。\n水色桜（みずいろさくら）です。\n今回は言語商会・長岡技術科学大学、山本先生の日本語感情表現辞書( https://www.jnlp.org/GengoHouse/snow/d18 )を用いて夏目漱石さんの「こころ」（青空文庫（　https://www.aozora.gr.jp/　　　　\n））の感情分析を行っていきたいと思います。\n山本先生のコーパスは単語に対して被験者の３人が48の感情のうちどの感情を感じたかが記されています。このコーパスを用いることで、文章に含まれている最も強い感情を特定することが可能です。\n解析結果は次のような感じです。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2847349/148cce5c-431b-0c30-4581-ad4bfe50d081.png)\n内訳を見ると、好きという感情が最も多く出現していることがわかります。ネタバレになってしまうので詳しくは言えませんが、「こころ」という文章の内容を鑑みると適切な内訳であると感じました。\n\n前置きはこのくらいにしてプログラムの構成について話していきます。\n文章の形態素解析には自然言語処理ライブラリGiNZAを用いました。GiNZAはリクルートさんと国立国語研究所さんが開発したものであり、高精度な解析が可能なライブラリです。\n形態素解析で単語に分割した後、言語商会・長岡技術科学大学山本先生の日本語感情表現辞書( https://www.jnlp.org/GengoHouse/snow/d18 )に検索をかけます。そして、単語ごとに含まれている感情を抽出し、文全体の感情を計測します。\n\nでは早速ソースコードを見てみましょう。\n\n```python:sent_analy.py\nimport spacy\nimport tkinter as tk \nimport re\nimport statistics as st\nimport numpy as np\nimport matplotlib.pyplot as plt \n\nplt.rcParams['font.family']='MS Mincho'\n\n# tkinterを用いてGUIを作成\nroot = tk.Tk() # ウィンドウを作成\nroot.title(u'GiNZAによるコメントの感情分析プログラム') # タイトルの定義\nroot.geometry('500x500') # ウィンドウサイズを定義\nframe=tk.Frame(root,bg='red') # テキストボックスなどを載せるフレームを定義\nframe.pack() # フレームを設置\nsc=tk.Scrollbar(frame) # スクロールバーの定義\nsc.pack(side='right',fill='y') # スクロールバーを設置\nmsgs=tk.Listbox(frame,width=70,height=27,x=0,y=0,yscrollcommand=sc.set,bg='black',fg='white') # テキストボックスの定義\nmsgs.pack(side='left',fill='both',pady=4) # テキストボックスの設置\nmsgs.insert('end','分析したいファイル名を入力してください。') # テキストの表示\n\nnlp = spacy.load('ja_ginza_electra') # GiNZAのロード\nt=1\ndef feel(): #ボタンを押したらこの関数を実行\n    global t #ラベルの位置を決めるための変数\n    s=textF.get() #入力したテキストを取得\n    msgs.insert('end',s) #テキスト（ラベル）を設定 \n    t=t+1\n    textF.delete(0,'end') #テキストボックスの文字を削除\n    sss=[] # 感情を保持する配列\n    with open(s,encoding='utf-8') as g1: # テキストファイルの読み込み\n      g2=g1.read() # テキストファイルを変数に格納\n      g3=g2.split('\\n') # \\nで区切る\n      for j in range(len(g3)):\n        doc=nlp(g3[j]) #GiNZAによる入力したテキストの解析\n        words=[]\n        sen1=[]\n        for sent in doc.sents: #文章群の中から文章を一つずつ抽出\n            for token in sent: #文章の中から形態素を一つずつ抽出\n                words.append(token.lemma_) # 原形を保存\n        # 感情辞書を用いて感情を検索\n        with open('長岡技術科学大学＿被験者１.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\t|\\n',lines) # \\nと\\tで分割\n        for word in words: \n            for i in range(int(len(dic)/4)): \n                if word==dic[4*i]: # 感情辞書にその単語があるか検索\n                    sen1.append(dic[4*i+2]) #リストに追加\n        sen2=[]\n        with open('長岡技術科学大学＿被験者２.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\n|\\t',lines)\n        for word in words:\n            for i in range(int(len(dic)/4)):\n                if word==dic[4*i]:\n                    sen2.append(dic[4*i+2])   \n        sen3=[]\n        with open('長岡技術科学大学＿被験者３.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\n|\\t',lines)\n        for word in words:\n            for i in range(int(len(dic)/4)):\n                if word==dic[4*i]:\n                    sen3.append(dic[4*i+2])\n\n        sen4=sen1+sen2+sen3 # リストを結合\n        if bool(sen4)==False: # もしリストが空の場合\n            sen5='' # 空を返す\n        else:\n            sen5=st.mode(sen4) #一番出現回数の多い感情を返す\n        \n        global sen # 感情を保持するリスト\n        sen=0 # エラーが起きないように一応値を代入しておく\n        with open ('長岡技術科学大学＿感情分類.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\n',lines) # \\nで分割\n            for p in range(49):\n                if dic[2*p+1] in sen5:\n                    sen=dic[2*p] # マッチした感情を代入\n\n        sss.append(sen) # リストに追加\n    \n    ff=np.zeros(49) # 感情の出現回数を保持するリスト\n    for i in range(len(sss)):\n        if sss[i]=='安らぎ':\n            ff[0]=ff[0]+1\n        elif sss[i]=='楽しさ':\n            ff[1]=ff[1]+1\n        elif sss[i]=='親しみ':\n            ff[2]=ff[2]+1\n        elif sss[i]=='尊敬・尊さ':\n            ff[3]=ff[3]+1\n        elif sss[i]=='感謝':\n            ff[4]=ff[4]+1\n        elif sss[i]=='気持ちが良い':\n            ff[5]=ff[5]+1\n        elif sss[i]=='誇らしい':\n            ff[6]=ff[6]+1\n        elif sss[i]=='感動':\n            ff[7]=ff[7]+1\n        elif sss[i]=='喜び':\n            ff[8]=ff[8]+1\n        elif sss[i]=='悲しさ':\n            ff[9]=ff[9]+1\n        elif sss[i]=='寂しさ':\n            ff[10]=ff[10]+1\n        elif sss[i]=='不満':\n            ff[11]=ff[11]+1\n        elif sss[i]=='切なさ':\n            ff[12]=ff[12]+1\n        elif sss[i]=='苦しさ':\n            ff[13]=ff[13]+1\n        elif sss[i]=='不安':\n            ff[14]=ff[14]+1\n        elif sss[i]=='憂鬱':\n            ff[15]=ff[15]+1\n        elif sss[i]=='辛さ':\n            ff[16]=ff[16]+1\n        elif sss[i]=='好き':\n            ff[17]=ff[17]+1\n        elif sss[i]=='嫌悪':\n            ff[18]=ff[18]+1\n        elif sss[i]=='恥ずかしい':\n            ff[19]=ff[19]+1\n        elif sss[i]=='焦り':\n            ff[20]=ff[20]+1\n        elif sss[i]=='驚き':\n            ff[21]=ff[21]+1\n        elif sss[i]=='怒り':\n            ff[22]=ff[22]+1\n        elif sss[i]=='幸福感':\n            ff[23]=ff[23]+1\n        elif sss[i]=='恨み':\n            ff[24]=ff[24]+1\n        elif sss[i]=='恐れ（恐縮等の意味で）':\n            ff[25]=ff[25]+1\n        elif sss[i]=='恐怖':\n            ff[26]=ff[26]+1\n        elif sss[i]=='悔しさ':\n            ff[27]=ff[27]+1\n        elif sss[i]=='祝う気持ち':\n            ff[28]=ff[28]+1\n        elif sss[i]=='困惑':\n            ff[29]=ff[29]+1\n        elif sss[i]=='きまずさ':\n            ff[30]=ff[30]+1\n        elif sss[i]=='興奮':\n            ff[31]=ff[31]+1\n        elif sss[i]=='悩み':\n            ff[32]=ff[32]+1\n        elif sss[i]=='願望':\n            ff[33]=ff[33]+1\n        elif sss[i]=='失望':\n            ff[34]=ff[34]+1\n        elif sss[i]=='あわれみ':\n            ff[35]=ff[35]+1\n        elif sss[i]=='見下し':\n            ff[36]=ff[36]+1\n        elif sss[i]=='謝罪':\n            ff[37]=ff[37]+1\n        elif sss[i]=='ためらい':\n            ff[38]=ff[38]+1\n        elif sss[i]=='不快':\n            ff[39]=ff[39]+1\n        elif sss[i]=='怠さ':\n            ff[40]=ff[40]+1\n        elif sss[i]=='あきれ':\n            ff[41]=ff[41]+1\n        elif sss[i]=='心配':\n            ff[42]=ff[42]+1\n        elif sss[i]=='緊張':\n            ff[43]=ff[43]+1\n        elif sss[i]=='妬み':\n            ff[44]=ff[44]+1\n        elif sss[i]=='憎い':\n            ff[45]=ff[45]+1\n        elif sss[i]=='残念':\n            ff[46]=ff[46]+1\n        elif sss[i]=='情けない':\n            ff[47]=ff[47]+1\n        elif sss[i]=='穏やか':\n            ff[48]=ff[48]+1\n    nff=np.argsort(ff)[::-1] # 出現回数が多い順に並び替え\n    # 出現した感情、上位12位まで表示\n    msgs.insert('end','出現した感情１位は'+dic[2*nff[0]]+'です。出現回数'+str(ff[nff[0]])+'回')\n    for i in range(48):\n        if nff[1]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情２位は'+dic[2*nff[1]]+'です。出現回数'+str(ff[nff[1]])+'回')        \n    for i in range(48):\n        if nff[2]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情３位は'+dic[2*nff[2]]+'です。出現回数'+str(ff[nff[2]])+'回')\n    for i in range(48):\n        if nff[3]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情４位は'+dic[2*nff[3]]+'です。出現回数'+str(ff[nff[3]])+'回')\n    for i in range(48):\n        if nff[4]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情５位は'+dic[2*nff[4]]+'です。出現回数'+str(ff[nff[4]])+'回')\n    for i in range(48):\n        if nff[5]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情６位は'+dic[2*nff[5]]+'です。出現回数'+str(ff[nff[5]])+'回')        \n    for i in range(48):\n        if nff[6]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情７位は'+dic[2*nff[6]]+'です。出現回数'+str(ff[nff[6]])+'回')\n    for i in range(48):\n        if nff[7]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情８位は'+dic[2*nff[7]]+'です。出現回数'+str(ff[nff[7]])+'回')\n    for i in range(48):\n        if nff[8]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情９位は'+dic[2*nff[8]]+'です。出現回数'+str(ff[nff[8]])+'回')\n    for i in range(48):\n        if nff[9]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情１０位は'+dic[2*nff[9]]+'です。出現回数'+str(ff[nff[9]])+'回')        \n    for i in range(48):\n        if nff[10]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情１１位は'+dic[2*nff[10]]+'です。出現回数'+str(ff[nff[10]])+'回')\n    for i in range(48):\n        if nff[11]==ff[i]:\n            ni=i\n    msgs.insert('end','出現した感情１２位は'+dic[2*nff[11]]+'です。出現回数'+str(ff[nff[11]])+'回')\n    # 棒グラフを生成\n    left=np.array([1,2,3,4,5,6,7,8,9,10,11,12])\n    height=np.array([ff[nff[0]],ff[nff[1]],ff[nff[2]],ff[nff[3]],ff[nff[4]],ff[nff[5]],ff[nff[6]],ff[nff[7]],ff[nff[8]],ff[nff[9]],ff[nff[10]],ff[nff[11]]])\n    label=[dic[2*nff[0]],dic[2*nff[1]],dic[2*nff[2]],dic[2*nff[3]],dic[2*nff[4]],dic[2*nff[5]],dic[2*nff[6]],dic[2*nff[7]],dic[2*nff[8]],dic[2*nff[9]],dic[2*nff[10]],dic[2*nff[11]]]\n    plt.bar(left,height,tick_label=label,align='center',color='#ADFF2F')\n    plt.title('図１　出現回数上位１２位までの感情')\n    plt.xlabel('感情名')\n    plt.ylabel('出現回数')\n    plt.show()\n\n\n\n#ボタンとテキストボックスの定義\nbtn=tk.Button(root,text='送信',font=('utf-8_sig',10),bg='cyan',command=feel)\nbtn.pack(side='right')\ntextF=tk.Entry(root,font=('utf-8_sig',15),width=40)\ntextF.pack(side='right')\n#画面の保持\nroot.mainloop()\n```\n\n流れは先ほど説明したとおりです。\n\n```python:\nfor j in range(len(g3)):\n        doc=nlp(g3[j]) #GiNZAによる入力したテキストの解析\n        words=[]\n        sen1=[]\n        for sent in doc.sents: #文章群の中から文章を一つずつ抽出\n            for token in sent: #文章の中から形態素を一つずつ抽出\n                words.append(token.lemma_) # 原形を保存\n```\n\nまずGiNZAで文章の解析を行い、\n\n```python:\n # 感情辞書を用いて感情を検索\n        with open('長岡技術科学大学＿被験者１.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\t|\\n',lines) # \\nと\\tで分割\n        for word in words: \n            for i in range(int(len(dic)/4)): \n                if word==dic[4*i]: # 感情辞書にその単語があるか検索\n                    sen1.append(dic[4*i+2]) #リストに追加\n        sen2=[]\n        with open('長岡技術科学大学＿被験者２.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\n|\\t',lines)\n        for word in words:\n            for i in range(int(len(dic)/4)):\n                if word==dic[4*i]:\n                    sen2.append(dic[4*i+2])   \n        sen3=[]\n        with open('長岡技術科学大学＿被験者３.txt',encoding='utf-8') as f:\n            lines=f.read()\n            dic=re.split('\\n|\\t',lines)\n        for word in words:\n            for i in range(int(len(dic)/4)):\n                if word==dic[4*i]:\n                    sen3.append(dic[4*i+2])\n```\n\nその文章の持つ感情を辞書から取得します。あとは感情の出現回数を記録してグラフとして表示するだけです。\n意外と簡単だと思われたのではないでしょうか？\nもしよろしければ皆さんもいろいろな文章の感情分析を行ってみてください。\nではばいにゃん～\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:39:27+09:00","group":null,"id":"236ef2b239c8c0e077a9","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"自然言語処理","versions":[]},{"name":"感情分析","versions":[]},{"name":"夏目漱石","versions":[]},{"name":"GiNZA","versions":[]}],"title":"夏目漱石さんの「こころ」の心を感情分析プログラムで解析してみた","updated_at":"2022-09-18T21:41:36+09:00","url":"https://qiita.com/Mizuiro__sakura/items/236ef2b239c8c0e077a9","user":{"description":"初めまして、水色桜と言います。₍˄·͈༝·͈˄₎◞︎ ̑̑ෆ⃛\r\n自然言語処理、数値解析について書いていくつもりです❗️\r\nアイコンは本人です。こんな感じですが一応男です(男の娘？に当たるのでしょうか？)\r\nもし記事がいいと思ってもらえたら、評価ボタンを押してもらえると励みになります‧˚₊*̥(∗︎*⁰͈꒨⁰͈)‧˚₊*̥","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"Mizuiro__sakura","items_count":5,"linkedin_id":"","location":"神奈川","name":"水色 桜","organization":"","permanent_id":2847349,"profile_image_url":"https://pbs.twimg.com/profile_images/1556317871130963968/Y98m8STK_bigger.jpg","team_only":false,"twitter_screen_name":"Mizuiro__sakura","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:63\"\u003ewindows 10 で python スクリプトをダブルクリックで動かすまでためのテンプレート。\u003cbr\u003e\n全部スクリプトでセットアップするので早い。\u003c/p\u003e\n\u003chr data-sourcepos=\"4:1-5:0\"\u003e\n\u003cp data-sourcepos=\"6:1-6:19\"\u003ePowerShellの設定\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"ps1\" data-sourcepos=\"8:1-11:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e管理者powershellで叩く\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSet-ExecutionPolicy -ExecutionPolicy Bypass\n# 大丈夫か？と聞かれたら「A」や「Yes」を叩く\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003col data-sourcepos=\"13:1-28:0\"\u003e\n\u003cli data-sourcepos=\"13:1-16:0\"\u003e\n\u003cp data-sourcepos=\"13:4-15:94\"\u003e\u003ca href=\"https://www.python.org/downloads/release/python-368/\" rel=\"nofollow noopener\" target=\"_blank\"\u003epython 3.6.8\u003c/a\u003eをインストール\u003cbr\u003e\nバージョンは不問。例として3.6系。\u003cbr\u003e\n「Pathに通すか？」というチェックがあったらチェックを入れます。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"17:1-22:0\"\u003e\n\u003cp data-sourcepos=\"17:4-21:71\"\u003epython仮想環境\u003cbr\u003e\n\u003ca href=\"https://www.dropbox.com/s/tya79dlc7ksq5zt/create_venv_v05.zip?dl=1\" rel=\"nofollow noopener\" target=\"_blank\"\u003ecreate_venv.zip\u003c/a\u003eをダウンロードして展開する。\u003cbr\u003e\nフォルダの中身を仮想環境を設置したいフォルダにコピー\u003cbr\u003e\npython3仮想環境作成.ps1 をダブルクリック\u003cbr\u003e\n仮想環境ショートカット作成.vbs をダブルクリック\u003c/p\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"23:1-28:0\"\u003e\n\u003cp data-sourcepos=\"23:4-27:97\"\u003e.py ファイルの実行サンプル\u003cbr\u003e\n「venv」ショートカットで開いたウィンドウに「pip install pandas」を叩く\u003cbr\u003e\n(適当にライブラリリをインストールした。例としてpandas)\u003cbr\u003e\n「pythonスクリプトを実行.ps1」をダブルクリックすると 「test.py」が実行される\u003cbr\u003e\n(「df.tsv」ファイルが生成されたり、「log.txt」ファイルが生成される)\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp data-sourcepos=\"29:1-29:80\"\u003eこの test.py を書き換えて python に好きな作業をやらせます。\u003c/p\u003e\n\u003chr data-sourcepos=\"32:1-32:3\"\u003e\n\u003cp data-sourcepos=\"33:1-35:126\"\u003e■蛇足\u003cbr\u003e\nインターネットでゲットしたps1を簡単に実行できてしまうのはセキュリティ的にはよろしくない、\u003cbr\u003e\nと思うようなら以下でリスクが減ります。ローカルで作成したps1しか実行できなくなります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"ps1\" data-sourcepos=\"37:1-39:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e管理者powershellで叩く\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSet-ExecutionPolicy -ExecutionPolicy RemoteSigned\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"41:1-41:30\"\u003eこの記事は以上です。\u003c/p\u003e\n","body":"windows 10 で python スクリプトをダブルクリックで動かすまでためのテンプレート。\n全部スクリプトでセットアップするので早い。\n\n---\n\nPowerShellの設定\n\n```ps1:管理者powershellで叩く\nSet-ExecutionPolicy -ExecutionPolicy Bypass\n# 大丈夫か？と聞かれたら「A」や「Yes」を叩く\n```\n\n1. [python 3.6.8](https://www.python.org/downloads/release/python-368/)をインストール\n   バージョンは不問。例として3.6系。\n   「Pathに通すか？」というチェックがあったらチェックを入れます。\n\n2. python仮想環境\n   [create_venv.zip](https://www.dropbox.com/s/tya79dlc7ksq5zt/create_venv_v05.zip?dl=1)をダウンロードして展開する。\n   フォルダの中身を仮想環境を設置したいフォルダにコピー\n   python3仮想環境作成.ps1 をダブルクリック\n   仮想環境ショートカット作成.vbs をダブルクリック\n\n3. .py ファイルの実行サンプル\n   「venv」ショートカットで開いたウィンドウに「pip install pandas」を叩く   \n    (適当にライブラリリをインストールした。例としてpandas)\n   「pythonスクリプトを実行.ps1」をダブルクリックすると 「test.py」が実行される\n    (「df.tsv」ファイルが生成されたり、「log.txt」ファイルが生成される)\n\nこの test.py を書き換えて python に好きな作業をやらせます。\n\n\n---\n■蛇足\nインターネットでゲットしたps1を簡単に実行できてしまうのはセキュリティ的にはよろしくない、\nと思うようなら以下でリスクが減ります。ローカルで作成したps1しか実行できなくなります。\n\n```ps1:管理者powershellで叩く\nSet-ExecutionPolicy -ExecutionPolicy RemoteSigned\n```\n\nこの記事は以上です。\n   \n   \n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:33:39+09:00","group":null,"id":"7a08721264516b43a5f8","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"Windows10","versions":[]}],"title":"3分で python仮想環境作成 ～ ダブルクリックで実行 できるようにする","updated_at":"2022-09-18T22:02:48+09:00","url":"https://qiita.com/kawamasa/items/7a08721264516b43a5f8","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":4,"github_login_name":null,"id":"kawamasa","items_count":13,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":441999,"profile_image_url":"https://lh5.googleusercontent.com/-Vxwf9A0t10s/AAAAAAAAAAI/AAAAAAAAnFU/VBbNkv69tQQ/s50/photo.jpg","team_only":false,"twitter_screen_name":null,"website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:23\"\u003e\n\u003cspan id=\"1-今回やること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#1-%E4%BB%8A%E5%9B%9E%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e1. 今回やること\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-5:102\"\u003e・\u003ca href=\"https://qiita.com/lilac0011/items/4c897212d236df43fee6\" id=\"reference-a4b0f461cfda15374b39\"\u003eC++/WinRTでUWPその13　ピクチャフォルダをサムネイル表示しよう\u003c/a\u003eでやったようにピクチャフォルダをサムネイル表示するアプリを作成します。\u003cbr\u003e\n・基本となる部分はMSの\u003ca href=\"https://learn.microsoft.com/ja-jp/windows/apps/desktop/modernize/host-custom-control-with-xaml-islands-cpp\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC++ デスクトップ (Win32) アプリでカスタム WinRT XAML コントロールをホストする\u003c/a\u003e、ほぼそのまままです。\u003cbr\u003e\n・なるべく簡単にやろうと思っていましたが、ちょっと何か高度なことをやろうとするとやっぱり避けては通れません・・・\u003cbr\u003e\n・と、言うわけで上記二つをよく読めば出来ることを今回やっていきます。\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-7:369\"\u003e・話はちょっと変わりますが、今年に入ってからMSのHPが機械翻訳のみからおそらく人の改訂が入って凄く読みやすくなりました。\u003ca href=\"https://learn.microsoft.com/ja-jp/windows/uwp/cpp-and-winrt-apis/get-started\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC++/WInRT関連\u003c/a\u003eや各APIもかなり読みやすくなっていますので是非一度読んでみて下さい。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"10:1-10:32\"\u003e\n\u003cspan id=\"2-プロジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#2-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2. プロジェクトの作成\u003c/h1\u003e\n\u003cp data-sourcepos=\"11:1-15:61\"\u003e・最近OSをWin11、Visual Studioを2022へ変更しました。\u003cbr\u003e\n・使いづらかったり、ヘッダーが足りないと言われたり色々不便なこともありますが・・・\u003cbr\u003e\n・VC2022のMFCアプリでプロジェクトを開始します。名前は「MFCWinRTThumb」。SDIにして、高度な機能のドッキング…は使用しません。\u003cbr\u003e\n・プロパティーで言語標準をC++17にして、C++コマンドラインに「/await」を追加します。\u003cbr\u003e\n・pch.hにGetCurrentTimeとTRYの#undefを追加します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"17:1-29:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epch.h（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#ifndef PCH_H\n#define PCH_H\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// プリコンパイルするヘッダーをここに追加します\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \"framework.h\"\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#undef GetCurrentTime\n#undef TRY\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#endif //PCH_H\n\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"31:1-34:119\"\u003e・次にソリューションを右クリックして、「追加→新しいプロジェクト」から空のアプリ (C++/WinRT) プロジェクトを追加します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c810b5ce93cc98a8beca66bfaade63e57209012e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f33613162383931622d666534622d333462662d396136302d6565363462633165633862312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F3a1b891b-fe4b-34bf-9a60-ee64bc1ec8b1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=de9d2bd2f127b799ae44e14e548a1d3e\" alt=\"2-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/3a1b891b-fe4b-34bf-9a60-ee64bc1ec8b1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F3a1b891b-fe4b-34bf-9a60-ee64bc1ec8b1.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=535cbdf8df325e984a956b65ef9aa23d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n・名前は「ThumbView」、最小ターゲットバージョンは「1903」へ設定します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/632dcd73632b76c358bf72d9d0907d054bc8bec4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f39663733623839362d643333332d653761342d386139392d3965326162343530643735312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F9f73b896-d333-e7a4-8a99-9e2ab450d751.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=13a96ee9d0b2644c5f390ceb3e83bda3\" alt=\"2-4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/9f73b896-d333-e7a4-8a99-9e2ab450d751.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F9f73b896-d333-e7a4-8a99-9e2ab450d751.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=71c508ef11c0e8cb1a530dcb4548e9df 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"36:1-38:119\"\u003e・メタデータへの参照を追加します。今回最小のターゲットバージョンを1903(10.0.18362.0)としたので、このフォルダにあるメタデータへの参照を追加します。ソリューションエクスプローラーのプロジェクトの参照から右クリックして参照の追加より追加。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/9b988c00ad469987164a1421d29ab66191c79048/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f63663761356464382d323833362d633332322d323766312d3762386662346234636561612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fcf7a5dd8-2836-c322-27f1-7b8fb4b4ceaa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0ba35f19bcf3a3d1f72be227794ce43d\" alt=\"1-2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/cf7a5dd8-2836-c322-27f1-7b8fb4b4ceaa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fcf7a5dd8-2836-c322-27f1-7b8fb4b4ceaa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bac9f4da8fefdd21ac5780f888c5fbc2 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c77f709cdc4260df0045c23dab152ac2335b1e06/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f33653365393835302d376161372d623832382d633862662d6566343062326164396363322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F3e3e9850-7aa7-b828-c8bf-ef40b2ad9cc2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=58e8b1700fa93555acbad6515f345be2\" alt=\"1-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/3e3e9850-7aa7-b828-c8bf-ef40b2ad9cc2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F3e3e9850-7aa7-b828-c8bf-ef40b2ad9cc2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1c9abf6e3cc0f90d6dd3f2ecdc417092 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"42:1-47:119\"\u003e・Nugetから以下の四つのパッケージを追加します。MFCとWinRTの両方のプロジェクトへ追加してください。\u003cbr\u003e\n　①Microsoft.Windows.CppWinRT\u003cbr\u003e\n　②Microsoft.Toolkit.Win32.UI.SDK\u003cbr\u003e\n　③Microsoft.Toolkit.Win32.UI.XamlApplication\u003cbr\u003e\n　④Microsoft.VCRTForwarders.140\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/47bff6fd3d5620de8d331a90da93c8d9a3af3946/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f65373037353962622d386163372d653962352d356564342d3064306131663066323538612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fe70759bb-8ac7-e9b5-5ed4-0d0a1f0f258a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b251477dbc04dbe9cf32f0726384175f\" alt=\"2-5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/e70759bb-8ac7-e9b5-5ed4-0d0a1f0f258a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fe70759bb-8ac7-e9b5-5ed4-0d0a1f0f258a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=983cf33415f70018b559182ac941bbff 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"49:1-49:23\"\u003e\n\u003cspan id=\"3-thumbviewの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-thumbview%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3. ThumbViewの変更\u003c/h1\u003e\n\u003cp data-sourcepos=\"50:1-53:42\"\u003e・MFCのViewクラスから表示させるThumbViewを作成します。\u003cbr\u003e\n・いきなりサムネイル部分も作るのでは無く、まずはお試し表示で作成します。\u003cbr\u003e\n・MSのHPでは「MyUWPApp」という名前で作成していますが、こちらは「ThumbView」という名前で作成しています。つまり、名前の部分は書き換えが必要となります。\u003cbr\u003e\n・長いけど、一気にいきます。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"55:1-55:35\"\u003e\n\u003cspan id=\"3-1-プロパティーの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-1-%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%83%BC%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-1. プロパティーの変更\u003c/h2\u003e\n\u003cp data-sourcepos=\"56:1-57:119\"\u003e・共通プロパティーの「Verbosity」を「normal」へ変更します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/68359cc0a9eff651c8c048260b43620202b4a972/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f63623535356331342d613066612d373436392d346338662d3135623139616365376461332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fcb555c14-a0fa-7469-4c8f-15b19ace7da3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=942c5b34cf2445548e6343ffb3ed9e01\" alt=\"3-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/cb555c14-a0fa-7469-4c8f-15b19ace7da3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fcb555c14-a0fa-7469-4c8f-15b19ace7da3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dbe91cc58d08a604c26325c5dd193a41 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"59:1-60:119\"\u003e・「構成の種類」を「ダイナミック ライブラリ」へ変更します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/859f3494e9d52ec268ab08d46d40ba9904751451/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f37653263326466652d643264622d343865632d633563662d3766343536366434333162612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F7e2c2dfe-d2db-48ec-c5cf-7f4566d431ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0eb45f3cb59ad8424d77e6089aadb306\" alt=\"3-2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/7e2c2dfe-d2db-48ec-c5cf-7f4566d431ba.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F7e2c2dfe-d2db-48ec-c5cf-7f4566d431ba.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2a5e442a97ed88c129fb54e1a79a6fb8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"62:1-64:119\"\u003e・ThumbViewに「placeholder.exe」という名前のテキストファイルを新しい項目として追加し、「placeholder.exe」プロパティーウインドウより「コンテンツ」を「True」へ変更します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/37db80e7b8793e2efe80ab27c0e5ad9c15e00768/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f37356130623537662d383833622d373263372d376136642d6466616437303336363134622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F75a0b57f-883b-72c7-7a6d-dfad7036614b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b83c950b2ad20d806e44d3fef444ff55\" alt=\"3-3.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/75a0b57f-883b-72c7-7a6d-dfad7036614b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F75a0b57f-883b-72c7-7a6d-dfad7036614b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3c5b9d3e5069e6cd22f4782a86e710f4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/2740f2e026814f7fc8d3cfd1ca5b8e0cb919b44f/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f66343362643164612d353032652d373861392d663236392d3231393761653232653532642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Ff43bd1da-502e-78a9-f269-2197ae22e52d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c19864864ff15d3ef32fa7414ef6e8be\" alt=\"3-4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/f43bd1da-502e-78a9-f269-2197ae22e52d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Ff43bd1da-502e-78a9-f269-2197ae22e52d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=57ce8b5dccd848e1932db7ab34e4abac 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"66:1-67:119\"\u003e・「Package.appxmanifest」をXML（テキスト）エディターから開き、＜Application＞要素のExecutable 属性の値を placeholder.exe に変更します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ea9905a084924a432ec1944052dcdb868f4a2448/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f65376630306164352d353964302d393639392d393761352d3265633934663366653534352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fe7f00ad5-59d0-9699-97a5-2ec94f3fe545.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=37b55c7f17e0a4905b5854f288b7035e\" alt=\"3-5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/e7f00ad5-59d0-9699-97a5-2ec94f3fe545.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fe7f00ad5-59d0-9699-97a5-2ec94f3fe545.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a6a7ab6d1fd8e8dff57d09d2ec3d504a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"70:1-104:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePackage.appxmanifest（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\"1.0\" encoding=\"utf-8\"?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;Package\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/appx/manifest/foundation/windows10\"\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns:mp=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/appx/2014/phone/manifest\"\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns:uap=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/appx/manifest/uap/windows10\"\u003c/span\u003e \u003cspan class=\"na\"\u003eIgnorableNamespaces=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"uap mp\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Identity\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"04b0e12b-80de-41ab-b0f5-61ae7d68df7f\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ePublisher=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"CN=hen\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0.0.0\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;mp:PhoneIdentity\u003c/span\u003e \u003cspan class=\"na\"\u003ePhoneProductId=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"04b0e12b-80de-41ab-b0f5-61ae7d68df7f\"\u003c/span\u003e \u003cspan class=\"na\"\u003ePhonePublisherId=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"00000000-0000-0000-0000-000000000000\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Properties\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;DisplayName\u0026gt;\u003c/span\u003eThumbView\u003cspan class=\"nt\"\u003e\u0026lt;/DisplayName\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;PublisherDisplayName\u0026gt;\u003c/span\u003ehen\u003cspan class=\"nt\"\u003e\u0026lt;/PublisherDisplayName\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Logo\u0026gt;\u003c/span\u003eAssets\\StoreLogo.png\u003cspan class=\"nt\"\u003e\u0026lt;/Logo\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/Properties\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Dependencies\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;TargetDeviceFamily\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Windows.Universal\"\u003c/span\u003e \u003cspan class=\"na\"\u003eMinVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"10.0.0.0\"\u003c/span\u003e \u003cspan class=\"na\"\u003eMaxVersionTested=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"10.0.0.0\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/Dependencies\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Resources\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Resource\u003c/span\u003e \u003cspan class=\"na\"\u003eLanguage=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"x-generate\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/Resources\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Applications\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Application\u003c/span\u003e \u003cspan class=\"na\"\u003eId=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"App\"\u003c/span\u003e \u003cspan class=\"na\"\u003eExecutable=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"placeholder.exe\"\u003c/span\u003e \u003cspan class=\"na\"\u003eEntryPoint=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.App\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;uap:VisualElements\u003c/span\u003e \u003cspan class=\"na\"\u003eDisplayName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView\"\u003c/span\u003e \u003cspan class=\"na\"\u003eDescription=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Project for a single page C++/WinRT Universal Windows Platform (UWP) app with no predefined layout\"\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eSquare150x150Logo=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Assets\\Square150x150Logo.png\"\u003c/span\u003e \u003cspan class=\"na\"\u003eSquare44x44Logo=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Assets\\Square44x44Logo.png\"\u003c/span\u003e \u003cspan class=\"na\"\u003eBackgroundColor=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"transparent\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;uap:DefaultTile\u003c/span\u003e \u003cspan class=\"na\"\u003eWide310x150Logo=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Assets\\Wide310x150Logo.png\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;/uap:DefaultTile\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;uap:SplashScreen\u003c/span\u003e \u003cspan class=\"na\"\u003eImage=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Assets\\SplashScreen.png\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nt\"\u003e\u0026lt;/uap:VisualElements\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Application\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/Applications\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;Capabilities\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;Capability\u003c/span\u003e \u003cspan class=\"na\"\u003eName=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"internetClient\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/Capabilities\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Package\u0026gt;\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"106:1-106:47\"\u003e\n\u003cspan id=\"3-2-プロジェクトファイルの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-2-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-2. プロジェクトファイルの変更\u003c/h2\u003e\n\u003cp data-sourcepos=\"107:1-108:72\"\u003e・ThumbViewプロジェクトをプロジェクトからアンロードします。すると「ThumbView」のプロジェクトファイルを読み込むので、＜Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\" /＞ 要素を見つけて、次の XML に置き換えます。ここはMSのHPまんまですね。\u003cbr\u003e\n・上書き保存したら、プロジェクトを再読込します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"110:1-118:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eThumbView.vcxproj（部分のみ）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u003c/span\u003e \u003cspan class=\"na\"\u003eLabel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Globals\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;WindowsAppContainer\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/WindowsAppContainer\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AppxGeneratePriEnabled\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/AppxGeneratePriEnabled\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;ProjectPriIndexName\u0026gt;\u003c/span\u003eApp\u003cspan class=\"nt\"\u003e\u0026lt;/ProjectPriIndexName\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AppxPackage\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/AppxPackage\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;Import\u003c/span\u003e \u003cspan class=\"na\"\u003eProject=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"120:1-120:119\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/6f0c9586f73ecdc31b4a3f9e10955a0fb21c261e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f61626665393164642d613939652d313135302d343437312d3739623164343035326332652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fabfe91dd-a99e-1150-4471-79b1d4052c2e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b743f407e226f0529c83008c9c5c5d4e\" alt=\"3-6.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/abfe91dd-a99e-1150-4471-79b1d4052c2e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fabfe91dd-a99e-1150-4471-79b1d4052c2e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=833a5cd5be6b71f50cd787b64a54e67e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"123:1-123:29\"\u003e\n\u003cspan id=\"3-3-表示部分の作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-3-%E8%A1%A8%E7%A4%BA%E9%83%A8%E5%88%86%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-3. 表示部分の作成\u003c/h2\u003e\n\u003cp data-sourcepos=\"124:1-126:119\"\u003e・ThumbViewに新しい項目の追加より「Blank User Control (C++/WinRT)」を追加します。名前は「MainControl」\u003cbr\u003e\n・表示する内容は以下にでもしときます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b8c8198ff5ed558b8c54b537b613ec2b9050575a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f34623734666633662d386630662d616539352d656461612d3863386536313565353436352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F4b74ff3f-8f0f-ae95-edaa-8c8e615e5465.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c256823180ea67c337e7fea6b8c78d71\" alt=\"3-7.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/4b74ff3f-8f0f-ae95-edaa-8c8e615e5465.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F4b74ff3f-8f0f-ae95-edaa-8c8e615e5465.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e70d2f5dedb442c110fcbe617a98ffba 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"127:1-142:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMainControl.xaml（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;UserControl\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ex:Class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.MainControl\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"using:ThumbView\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:d=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/expression/blend/2008\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:mc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003emc:Ignorable=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"d\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\n    \u003cspan class=\"nt\"\u003e\u0026lt;StackPanel\u003c/span\u003e \u003cspan class=\"na\"\u003eHorizontalAlignment=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Center\"\u003c/span\u003e \u003cspan class=\"na\"\u003eSpacing=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"10\"\u003c/span\u003e \u003cspan class=\"na\"\u003ePadding=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"20\"\u003c/span\u003e \u003cspan class=\"na\"\u003eVerticalAlignment=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Center\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;TextBlock\u003c/span\u003e \u003cspan class=\"na\"\u003eHorizontalAlignment=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Center\"\u003c/span\u003e \u003cspan class=\"na\"\u003eTextWrapping=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Wrap\"\u003c/span\u003e \u003cspan class=\"na\"\u003eText=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"まだ作成中だ！💋\"\u003c/span\u003e \u003cspan class=\"na\"\u003eFontSize=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"30\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;Button\u003c/span\u003e \u003cspan class=\"na\"\u003eHorizontalAlignment=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Center\"\u003c/span\u003e \u003cspan class=\"na\"\u003ex:Name=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Button\"\u003c/span\u003e \u003cspan class=\"na\"\u003eClick=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ClickHandler\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eClick Me\u003cspan class=\"nt\"\u003e\u0026lt;/Button\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/StackPanel\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/UserControl\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"144:1-144:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/2c91862b4c3bdddc183a63e10af092a7f0f73fb1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f66323931373534302d383563632d376364622d643937312d3064653566623138326639322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Ff2917540-85cc-7cdb-d971-0de5fb182f92.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=53ad154d9223b67c563428933006428c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/f2917540-85cc-7cdb-d971-0de5fb182f92.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Ff2917540-85cc-7cdb-d971-0de5fb182f92.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2fea438498db3afc54d2dbc592296314 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"146:1-146:26\"\u003e\n\u003cspan id=\"3-5-その他の編集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3-5-%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E7%B7%A8%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e3-5. その他の編集\u003c/h2\u003e\n\u003cp data-sourcepos=\"147:1-148:119\"\u003e・ThumbViewの「MainPage.xaml」を削除します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7b0056f1e468eb125d8ea292596ebb29e15be7da/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f33393930363966342d653733642d383363372d366462332d3837653732393134316532662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F399069f4-e73d-83c7-6db3-87e729141e2f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=37f30b53974aab8d7d22833c62d9cb7b\" alt=\"3-8.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/399069f4-e73d-83c7-6db3-87e729141e2f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F399069f4-e73d-83c7-6db3-87e729141e2f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=36e9c65cec3cadfd44e86d894c728b43 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"150:1-150:44\"\u003e・「App.xaml」を以下に変更します\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"151:1-159:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.xaml（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;Toolkit:XamlApplication\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ex:Class=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.App\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:Toolkit=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"using:Microsoft.Toolkit.Win32.UI.XamlHost\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:x=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"http://schemas.microsoft.com/winfx/2006/xaml\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003exmlns:local=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"using:ThumbView\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/Toolkit:XamlApplication\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"161:1-161:43\"\u003e・「App.idl」を以下に変更します\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"162:1-171:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.idl（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003enamespace ThumbView\n{\n     [default_interface]\n     runtimeclass App : Microsoft.Toolkit.Win32.UI.XamlHost.XamlApplication\n     {\n        App();\n     }\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"173:1-173:41\"\u003e・「App.h」を以下に変更します\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"174:1-194:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.h（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n#include \"App.g.h\"\n#include \"App.base.h\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eApp\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eAppT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e~\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003efactory_implementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eApp\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eAppT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"196:1-196:43\"\u003e・「App.cpp」を以下に変更します\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"197:1-218:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eApp.cpp（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#include \"pch.h\"\n#include \"App.h\"\n#include \"App.g.cpp\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInitialize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eAddRef\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"n\"\u003em_inner\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;::\u003c/span\u003e\u003cspan class=\"n\"\u003eIUnknown\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eRelease\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"o\"\u003e::~\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eClose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"220:1-221:121\"\u003e・「app.base.h」を追加し、以下へ変更します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/4b2a8b21e6059aeffebec0c58f731111b7f15f7d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f61653563366264332d613237352d613833302d333633612d3639306639343139666434352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fae5c6bd3-a275-a830-363a-690f9419fd45.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=95798c2ba419479a23e3e289e62bcecc\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/ae5c6bd3-a275-a830-363a-690f9419fd45.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fae5c6bd3-a275-a830-363a-690f9419fd45.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ee307c550489920d335588932b249096 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"222:1-249:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.base.h（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#pragma once\n\u003c/span\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimplementation\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"nc\"\u003eD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e\u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"nc\"\u003eI\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eApp_baseWithProvider\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eApp_base\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMarkup\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eIXamlMetadataProvider\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eIXamlType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMarkup\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eIXamlType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIXamlType\u003c/span\u003e \u003cspan class=\"n\"\u003eGetXamlType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eInterop\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTypeName\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_appProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetXamlType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eIXamlType\u003c/span\u003e \u003cspan class=\"n\"\u003eGetXamlType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ehstring\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efullName\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_appProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetXamlType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efullName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecom_array\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;::\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMarkup\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXmlnsDefinition\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eGetXmlnsDefinitions\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003e_appProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eGetXmlnsDefinitions\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003eprivate:\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003e_contentLoaded\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXamlMetaDataProvider\u003c/span\u003e \u003cspan class=\"n\"\u003e_appProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"nc\"\u003eD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e\u003cspan class=\"o\"\u003e...\u003c/span\u003e \u003cspan class=\"nc\"\u003eI\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eAppT2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eApp_baseWithProvider\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eI\u003c/span\u003e\u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"251:1-251:35\"\u003e\n\u003cspan id=\"4-ソリューションの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4-%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e4. ソリューションの変更\u003c/h1\u003e\n\u003cp data-sourcepos=\"252:1-252:108\"\u003e・ビルド関連で作成するファイルの作成先の変更や、依存先の変更を行います。\u003c/p\u003e\n\u003cp data-sourcepos=\"254:1-256:119\"\u003e・まずはソリューションにXMLファイルを追加し、名前を「Solution.props」とします。\u003cbr\u003e\n・「Solution.props」を以下へ書き換えます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c7f024fd6edd881df5b2cb7cbccf6a68f22d8eb3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f37333066656631652d393962372d366532612d353830382d3934323561346630356631392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F730fef1e-99b7-6e2a-5808-9425a4f05f19.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9c260953058bd3ad3525277c52f60d31\" alt=\"4-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/730fef1e-99b7-6e2a-5808-9425a4f05f19.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F730fef1e-99b7-6e2a-5808-9425a4f05f19.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=160f0db05ffd67da1925154118b4135e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"258:1-266:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSolution.props（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u003c/span\u003e \u003cspan class=\"na\"\u003eLabel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Globals\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;WindowsAppContainer\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/WindowsAppContainer\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AppxGeneratePriEnabled\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/AppxGeneratePriEnabled\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;ProjectPriIndexName\u0026gt;\u003c/span\u003eApp\u003cspan class=\"nt\"\u003e\u0026lt;/ProjectPriIndexName\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AppxPackage\u0026gt;\u003c/span\u003etrue\u003cspan class=\"nt\"\u003e\u0026lt;/AppxPackage\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;Import\u003c/span\u003e \u003cspan class=\"na\"\u003eProject=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"268:1-270:119\"\u003e・プロパティーマネージャーの二つのプロジェクトを右クリックして、既存のプロパティーシートの追加より今作った「Solution.props」を読ませます。二つとも。ここ重要。\u003cbr\u003e\n・これで、一つのフォルダの中に二つのプロジェクトからビルドされたファイルが生成されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1e255690fffd824c191cd97db00a6569fe0f81c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f34333534623038652d333764662d613761342d393737652d3530633539303365653333332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F4354b08e-37df-a7a4-977e-50c5903ee333.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f979064c750eef6b880ad39013e36672\" alt=\"4-2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/4354b08e-37df-a7a4-977e-50c5903ee333.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F4354b08e-37df-a7a4-977e-50c5903ee333.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=951ba1ba175a6348c5a365c9658e9cb4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"272:1-273:42\"\u003e・ここで一度ビルドして失敗しなければOK。後はMFCのプロジェクトへWinRTで作成したプロジェクトを表示させる部分を作り込むだけ！\u003cbr\u003e\nここまででも十分長いょ・・・\u003c/p\u003e\n\u003ch1 data-sourcepos=\"276:1-276:72\"\u003e\n\u003cspan id=\"5-thumbviewを表示させるようにmfcwinrtthumbを改造する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-thumbview%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%95%E3%81%9B%E3%82%8B%E3%82%88%E3%81%86%E3%81%ABmfcwinrtthumb%E3%82%92%E6%94%B9%E9%80%A0%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5. ThumbViewを表示させるようにMFCWinRTThumbを改造する。\u003c/h1\u003e\n\u003cp data-sourcepos=\"277:1-277:159\"\u003e・MSのページではパッケージ化してますが、面倒なのでパッケージ化はしません。VC++ランタイムは入っているでしょ？\u003c/p\u003e\n\u003ch1 data-sourcepos=\"279:1-279:76\"\u003e\n\u003cspan id=\"5-1-マニフェストの作成とプロジェクトファイルの変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-1-%E3%83%9E%E3%83%8B%E3%83%95%E3%82%A7%E3%82%B9%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5-1. マニフェストの作成とプロジェクトファイルの変更\u003c/h1\u003e\n\u003cp data-sourcepos=\"280:1-281:119\"\u003e・まずは「app.manifest」を作成します。ただし、今までとはちょっと内容が変わります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/d8901511006f234f4e2df566628bd92b15ab474a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f64333836373331382d383031612d353438372d383964342d6531343961643637313262622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fd3867318-801a-5487-89d4-e149ad6712bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=905dcb44a5beec00363bb56c753db401\" alt=\"5-1.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/d3867318-801a-5487-89d4-e149ad6712bb.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2Fd3867318-801a-5487-89d4-e149ad6712bb.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1e0b0c86b3a64bfd067603b8da2c715c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"282:1-303:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eapp.manifest（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\"1.0\" encoding=\"utf-8\"?\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;assembly\u003c/span\u003e\n \u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:asm.v1\"\u003c/span\u003e\n \u003cspan class=\"na\"\u003exmlns:asmv3=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:asm.v3\"\u003c/span\u003e\n \u003cspan class=\"na\"\u003emanifestVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"1.0\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\t\u003cspan class=\"nt\"\u003e\u0026lt;asmv3:file\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.dll\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\t\t\u003cspan class=\"nt\"\u003e\u0026lt;activatableClass\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.App\"\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003ethreadingModel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"both\"\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:winrt.v1\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\t\t\u003cspan class=\"nt\"\u003e\u0026lt;activatableClass\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.XamlMetadataProvider\"\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003ethreadingModel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"both\"\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:winrt.v1\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\t\t\u003cspan class=\"nt\"\u003e\u0026lt;activatableClass\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ThumbView.MainControl\"\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003ethreadingModel=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"both\"\u003c/span\u003e\n\t\t\t\u003cspan class=\"na\"\u003exmlns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"urn:schemas-microsoft-com:winrt.v1\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\t\u003cspan class=\"nt\"\u003e\u0026lt;/asmv3:file\u0026gt;\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/assembly\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"305:1-305:217\"\u003e・MFCWinRTThumbのプロジェクトファイルを編集します。まずはMFCWinRTThumbをアンロードして、ファイルの末尾にある終了タグ  の直前に、次の XML を追加します\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"XML\" data-sourcepos=\"306:1-318:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMFCWinRTThumb.vcxproj（部分のみ）\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e  \u003cspan class=\"c\"\u003e\u0026lt;!-- Configure these for your UWP project --\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AppProjectName\u0026gt;\u003c/span\u003eThumbView\u003cspan class=\"nt\"\u003e\u0026lt;/AppProjectName\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;PropertyGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;AppIncludeDirectories\u0026gt;\u003c/span\u003e$(SolutionDir)\\obj\\$(Platform)\\$(Configuration)\\$(AppProjectName)\\;$(SolutionDir)\\obj\\$(Platform)\\$(Configuration)\\$(AppProjectName)\\Generated Files\\;\u003cspan class=\"nt\"\u003e\u0026lt;/AppIncludeDirectories\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/PropertyGroup\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;ItemGroup\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;ProjectReference\u003c/span\u003e \u003cspan class=\"na\"\u003eInclude=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"..\\$(AppProjectName)\\$(AppProjectName).vcxproj\"\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e\u0026lt;/ItemGroup\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"c\"\u003e\u0026lt;!-- End Section--\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"320:1-322:119\"\u003e・追加して上書き保存したら、プロジェクトの再読込\u003cbr\u003e\n・MFCWinRTThumbのプロパティーより、「DPI認識」を「モニターごとの高いDPI認識」へ変更します。今までこれを変更せずにエラーが起きたことは無いですが、エラーが発生することがあるみたいですからね。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/99b28c3469bdc65e5500709028aa78824188dd98/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f31613863356466392d323635612d613036632d343334642d6665646539636564366261302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F1a8c5df9-265a-a06c-434d-fede9ced6ba0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dc240ac634ed99ffdf538c8a6fb7b9ef\" alt=\"5-2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/1a8c5df9-265a-a06c-434d-fede9ced6ba0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F1a8c5df9-265a-a06c-434d-fede9ced6ba0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fc3a0f69dc702ea4e8af6978ed4310a9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"324:1-324:48\"\u003e\n\u003cspan id=\"5-2-mfcのviewでthumbviewを表示する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#5-2-mfc%E3%81%AEview%E3%81%A7thumbview%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e5-2. MFCのViewでThumbViewを表示する。\u003c/h2\u003e\n\u003cp data-sourcepos=\"325:1-326:88\"\u003e・それでは今回はここまで準備したので、XamlReaderを使わずに表示させます。\u003cbr\u003e\n・まずはMFCWinRTThumbの「pch.h」で必要なヘッダー等をincludeします。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"327:1-355:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003epch.h（変更後)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e#ifndef PCH_H\n#define PCH_H\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// プリコンパイルするヘッダーをここに追加します\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \"framework.h\"\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#undef GetCurrentTime\n#undef TRY\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \"resource.h\"\n#include \u0026lt;winrt/Windows.Foundation.Collections.h\u0026gt;\n#include \u0026lt;winrt/Windows.system.h\u0026gt;\n#include \u0026lt;winrt/windows.ui.xaml.hosting.h\u0026gt;\n#include \u0026lt;windows.ui.xaml.hosting.desktopwindowxamlsource.h\u0026gt;\n#include \u0026lt;winrt/windows.ui.xaml.controls.h\u0026gt;\n#include \u0026lt;winrt/Windows.ui.xaml.media.h\u0026gt;\n#include \u0026lt;winrt/Windows.UI.Core.h\u0026gt;\n#include \u0026lt;winrt/ThumbView.h\u0026gt;\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eComposition\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eHosting\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eFoundation\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eNumerics\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eControls\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#endif //PCH_H\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"357:1-357:87\"\u003e・ViewクラスにThumbViewとDesktopWindowXamlSourceのメンバを追加します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"358:1-370:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMFCWinRTThumbView.h（変更箇所周囲のみ)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCMFCWinRTThumbView\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003eCView\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"c1\"\u003e//ここにWinRT関連のメンバを追加\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e \u003cspan class=\"n\"\u003ehostApp\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eHosting\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eDesktopWindowXamlSource\u003c/span\u003e \u003cspan class=\"n\"\u003e_desktopWindowXamlSource\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMainControl\u003c/span\u003e \u003cspan class=\"n\"\u003e_mainControl\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eimpl\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecom_ref\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIDesktopWindowXamlSourceNative\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003einterop\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nl\"\u003eprotected:\u003c/span\u003e \u003cspan class=\"c1\"\u003e// シリアル化からのみ作成します。\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eCMFCWinRTThumbView\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eDECLARE_DYNCREATE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCMFCWinRTThumbView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"372:1-373:119\"\u003e・CMFCWinRTThumbViewクラスにOnCreateを追加して、WinRTの初期化～ウインドウのアタッチまで行います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/0adb68baccac7858bf04fe96d60505c98afca184/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f35396239373266662d306538342d376166332d393330322d6564306336353834303836382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F59b972ff-0e84-7af3-9302-ed0c65840868.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=98fa6d9d514901c262b3f00441c09ede\" alt=\"5-3.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/59b972ff-0e84-7af3-9302-ed0c65840868.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F59b972ff-0e84-7af3-9302-ed0c65840868.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=189b0cd00c3cc44d973d058fedb86b1b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"374:1-396:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMFCWinRTThumbView.cpp（変更箇所周囲のみ)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eCMFCWinRTThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eOnCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLPCREATESTRUCT\u003c/span\u003e \u003cspan class=\"n\"\u003elpCreateStruct\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eOnCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elpCreateStruct\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"c1\"\u003e// TODO: ここに特定な作成コードを追加してください。\u003c/span\u003e\n\n\t\u003cspan class=\"c1\"\u003e//ここでWinRTの初期化～ウインドウのアタッチまで\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003einit_apartment\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eapartment_type\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003esingle_threaded\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ehostApp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eApp\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003e_desktopWindowXamlSource\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eWindows\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eUI\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eXaml\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eHosting\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eDesktopWindowXamlSource\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\t\t\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_desktopWindowXamlSource\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003einterop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003e_desktopWindowXamlSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eIDesktopWindowXamlSourceNative\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003echeck_hresult\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einterop\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eAttachToWindow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003em_hWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\t\n\n\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"398:1-398:53\"\u003e・WinRTの表示関連はOnDrawに記述します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"CPP\" data-sourcepos=\"399:1-423:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eMFCWinRTThumbView.cpp（OnDrawのみ)\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eCMFCWinRTThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eOnDraw\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCDC\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"cm\"\u003e/*pDC*/\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eCMFCWinRTThumbDoc\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003epDoc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eGetDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eASSERT_VALID\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epDoc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003epDoc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\t\u003cspan class=\"c1\"\u003e// TODO: この場所にネイティブ データ用の描画コードを追加します。\u003c/span\u003e\n\t\n\t\u003cspan class=\"c1\"\u003e//WinRT部分の表示\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_desktopWindowXamlSource\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003eHWND\u003c/span\u003e \u003cspan class=\"n\"\u003ehWndXamlIsland\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003einterop\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eget_WindowHandle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ehWndXamlIsland\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003eRECT\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\t\t\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eGetWindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003em_hWnd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ewindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\t\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eSetWindowPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehWndXamlIsland\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eright\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebottom\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ewindowRect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etop\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSWP_SHOWWINDOW\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\t\t\u003cspan class=\"n\"\u003e_mainControl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewinrt\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eThumbView\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eMainControl\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003e_desktopWindowXamlSource\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eContent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_mainControl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\t\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"425:1-426:119\"\u003e・ふぅ、長かった。これでMFCWinRTThumbをビルド/実行してエラーが出なければ、「MFC（）笑」と言われないモダンなアプリの雛型が完成です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/68660f55399f8840fbf2b51b99bd9355e93fa917/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f32386365396138322d616164612d613032632d623938342d6263323334306631316433312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F28ce9a82-aada-a02c-b984-bc2340f11d31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a7fc632a0034356e1ad4bf8f959cf5c9\" alt=\"5-4.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/28ce9a82-aada-a02c-b984-bc2340f11d31.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F28ce9a82-aada-a02c-b984-bc2340f11d31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d3eb2eb33269b1b3162e4d37821b024f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"428:1-431:595\"\u003e・実行するとこんな感じ\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/51f43a2d85f19d85d3d88fefc04348a43ad30259/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3133313035312f39663366396139642d636263352d636262642d356364332d3163343138396462336532352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F9f3f9a9d-cbc5-cbbd-5cd3-1c4189db3e25.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=eb7d43f22ff1115b9902a6d9f071c1eb\" alt=\"5-5.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/9f3f9a9d-cbc5-cbbd-5cd3-1c4189db3e25.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F131051%2F9f3f9a9d-cbc5-cbbd-5cd3-1c4189db3e25.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=295f77f4a5383ca72ef83d2eb2ed6f17 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n・しかし、たったこれだけしか表示しないのにメモリを74MBも食うなんてなんてUWPは燃費が悪いんだ。MFCだけなら10MBも行かないのに・・・\u003cbr\u003e\n・色々苦労してMFCからUWPを利用していますが、その最大の利点は一々インストールしなくてもUWPアプリが動くこと。今回のように作成すると、dllなんかも一緒にしてくれるのでbinの中にあるMFCWinRTThumbフォルダをそのままコピーするだけで使えます。「インストーラーが動かない；；」とか「証明書が；；」とか言う苦情を聞かなくても済むんです！\u003cdel\u003eインストーラーを無効にするMS許すまじ！\u003c/del\u003e もちろんVCランタイムは入っている前提ですよ？\u003c/p\u003e\n\u003cp data-sourcepos=\"433:1-433:96\"\u003e・次回はこれを元にして、ピクチャフォルダをサムネイル表示します。\u003c/p\u003e\n\u003cp data-sourcepos=\"435:1-435:67\"\u003e\u003ca href=\"https://qiita.com/lilac0011/items/f53f7401ea7da31e3a0b\" id=\"reference-63b3e8524d3b6d0da03a\"\u003e目次へ\u003c/a\u003e\u003c/p\u003e\n","body":"# 1. 今回やること\n・[C++/WinRTでUWPその13　ピクチャフォルダをサムネイル表示しよう](https://qiita.com/lilac0011/items/4c897212d236df43fee6)でやったようにピクチャフォルダをサムネイル表示するアプリを作成します。\n・基本となる部分はMSの[C++ デスクトップ (Win32) アプリでカスタム WinRT XAML コントロールをホストする](https://learn.microsoft.com/ja-jp/windows/apps/desktop/modernize/host-custom-control-with-xaml-islands-cpp)、ほぼそのまままです。\n・なるべく簡単にやろうと思っていましたが、ちょっと何か高度なことをやろうとするとやっぱり避けては通れません・・・\n・と、言うわけで上記二つをよく読めば出来ることを今回やっていきます。\n\n・話はちょっと変わりますが、今年に入ってからMSのHPが機械翻訳のみからおそらく人の改訂が入って凄く読みやすくなりました。[C++/WInRT関連](https://learn.microsoft.com/ja-jp/windows/uwp/cpp-and-winrt-apis/get-started)や各APIもかなり読みやすくなっていますので是非一度読んでみて下さい。\n\n\n# 2. プロジェクトの作成\n・最近OSをWin11、Visual Studioを2022へ変更しました。\n・使いづらかったり、ヘッダーが足りないと言われたり色々不便なこともありますが・・・\n・VC2022のMFCアプリでプロジェクトを開始します。名前は「MFCWinRTThumb」。SDIにして、高度な機能のドッキング…は使用しません。\n・プロパティーで言語標準をC++17にして、C++コマンドラインに「/await」を追加します。\n・pch.hにGetCurrentTimeとTRYの#undefを追加します。\n\n```CPP:pch.h（変更後)\n#ifndef PCH_H\n#define PCH_H\n\n// プリコンパイルするヘッダーをここに追加します\n#include \"framework.h\"\n\n#undef GetCurrentTime\n#undef TRY\n\n#endif //PCH_H\n\n```\n\n・次にソリューションを右クリックして、「追加→新しいプロジェクト」から空のアプリ (C++/WinRT) プロジェクトを追加します。\n![2-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/3a1b891b-fe4b-34bf-9a60-ee64bc1ec8b1.png)\n・名前は「ThumbView」、最小ターゲットバージョンは「1903」へ設定します。\n![2-4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/9f73b896-d333-e7a4-8a99-9e2ab450d751.png)\n\n・メタデータへの参照を追加します。今回最小のターゲットバージョンを1903(10.0.18362.0)としたので、このフォルダにあるメタデータへの参照を追加します。ソリューションエクスプローラーのプロジェクトの参照から右クリックして参照の追加より追加。\n![1-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/cf7a5dd8-2836-c322-27f1-7b8fb4b4ceaa.png)\n![1-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/3e3e9850-7aa7-b828-c8bf-ef40b2ad9cc2.png)\n\n\n\n・Nugetから以下の四つのパッケージを追加します。MFCとWinRTの両方のプロジェクトへ追加してください。\n　①Microsoft.Windows.CppWinRT\n　②Microsoft.Toolkit.Win32.UI.SDK\n　③Microsoft.Toolkit.Win32.UI.XamlApplication\n　④Microsoft.VCRTForwarders.140\n![2-5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/e70759bb-8ac7-e9b5-5ed4-0d0a1f0f258a.png)\n\n# 3. ThumbViewの変更\n・MFCのViewクラスから表示させるThumbViewを作成します。\n・いきなりサムネイル部分も作るのでは無く、まずはお試し表示で作成します。\n・MSのHPでは「MyUWPApp」という名前で作成していますが、こちらは「ThumbView」という名前で作成しています。つまり、名前の部分は書き換えが必要となります。\n・長いけど、一気にいきます。\n\n## 3-1. プロパティーの変更\n・共通プロパティーの「Verbosity」を「normal」へ変更します。\n![3-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/cb555c14-a0fa-7469-4c8f-15b19ace7da3.png)\n\n・「構成の種類」を「ダイナミック ライブラリ」へ変更します。\n![3-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/7e2c2dfe-d2db-48ec-c5cf-7f4566d431ba.png)\n\n・ThumbViewに「placeholder.exe」という名前のテキストファイルを新しい項目として追加し、「placeholder.exe」プロパティーウインドウより「コンテンツ」を「True」へ変更します。\n![3-3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/75a0b57f-883b-72c7-7a6d-dfad7036614b.png)\n![3-4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/f43bd1da-502e-78a9-f269-2197ae22e52d.png)\n\n・「Package.appxmanifest」をXML（テキスト）エディターから開き、＜Application＞要素のExecutable 属性の値を placeholder.exe に変更します。\n![3-5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/e7f00ad5-59d0-9699-97a5-2ec94f3fe545.png)\n\n\n```XML:Package.appxmanifest（変更後)\n\u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e\n\u003cPackage xmlns=\"http://schemas.microsoft.com/appx/manifest/foundation/windows10\" xmlns:mp=\"http://schemas.microsoft.com/appx/2014/phone/manifest\" xmlns:uap=\"http://schemas.microsoft.com/appx/manifest/uap/windows10\" IgnorableNamespaces=\"uap mp\"\u003e\n  \u003cIdentity\n    Name=\"04b0e12b-80de-41ab-b0f5-61ae7d68df7f\"\n    Publisher=\"CN=hen\"\n    Version=\"1.0.0.0\" /\u003e\n  \u003cmp:PhoneIdentity PhoneProductId=\"04b0e12b-80de-41ab-b0f5-61ae7d68df7f\" PhonePublisherId=\"00000000-0000-0000-0000-000000000000\"/\u003e\n  \u003cProperties\u003e\n    \u003cDisplayName\u003eThumbView\u003c/DisplayName\u003e\n    \u003cPublisherDisplayName\u003ehen\u003c/PublisherDisplayName\u003e\n    \u003cLogo\u003eAssets\\StoreLogo.png\u003c/Logo\u003e\n  \u003c/Properties\u003e\n  \u003cDependencies\u003e\n    \u003cTargetDeviceFamily Name=\"Windows.Universal\" MinVersion=\"10.0.0.0\" MaxVersionTested=\"10.0.0.0\" /\u003e\n  \u003c/Dependencies\u003e\n  \u003cResources\u003e\n    \u003cResource Language=\"x-generate\" /\u003e\n  \u003c/Resources\u003e\n  \u003cApplications\u003e\n    \u003cApplication Id=\"App\" Executable=\"placeholder.exe\" EntryPoint=\"ThumbView.App\"\u003e\n      \u003cuap:VisualElements DisplayName=\"ThumbView\" Description=\"Project for a single page C++/WinRT Universal Windows Platform (UWP) app with no predefined layout\"\n        Square150x150Logo=\"Assets\\Square150x150Logo.png\" Square44x44Logo=\"Assets\\Square44x44Logo.png\" BackgroundColor=\"transparent\"\u003e\n        \u003cuap:DefaultTile Wide310x150Logo=\"Assets\\Wide310x150Logo.png\"\u003e\n        \u003c/uap:DefaultTile\u003e\n        \u003cuap:SplashScreen Image=\"Assets\\SplashScreen.png\" /\u003e\n      \u003c/uap:VisualElements\u003e\n    \u003c/Application\u003e\n  \u003c/Applications\u003e\n  \u003cCapabilities\u003e\n    \u003cCapability Name=\"internetClient\" /\u003e\n  \u003c/Capabilities\u003e\n\u003c/Package\u003e\n\n```\n\n## 3-2. プロジェクトファイルの変更\n・ThumbViewプロジェクトをプロジェクトからアンロードします。すると「ThumbView」のプロジェクトファイルを読み込むので、＜Import Project=\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\" /＞ 要素を見つけて、次の XML に置き換えます。ここはMSのHPまんまですね。\n・上書き保存したら、プロジェクトを再読込します。\n\n```XML:ThumbView.vcxproj（部分のみ）\n\u003cPropertyGroup Label=\"Globals\"\u003e\n    \u003cWindowsAppContainer\u003etrue\u003c/WindowsAppContainer\u003e\n    \u003cAppxGeneratePriEnabled\u003etrue\u003c/AppxGeneratePriEnabled\u003e\n    \u003cProjectPriIndexName\u003eApp\u003c/ProjectPriIndexName\u003e\n    \u003cAppxPackage\u003etrue\u003c/AppxPackage\u003e\n\u003c/PropertyGroup\u003e\n\u003cImport Project=\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\" /\u003e\n```\n\n![3-6.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/abfe91dd-a99e-1150-4471-79b1d4052c2e.png)\n\n\n## 3-3. 表示部分の作成\n・ThumbViewに新しい項目の追加より「Blank User Control (C++/WinRT)」を追加します。名前は「MainControl」\n・表示する内容は以下にでもしときます。\n![3-7.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/4b74ff3f-8f0f-ae95-edaa-8c8e615e5465.png)\n```XML:MainControl.xaml（変更後)\n\u003cUserControl\n    x:Class=\"ThumbView.MainControl\"\n    xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n    xmlns:local=\"using:ThumbView\"\n    xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n    xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n    mc:Ignorable=\"d\"\u003e\n\n    \u003cStackPanel HorizontalAlignment=\"Center\" Spacing=\"10\" Padding=\"20\" VerticalAlignment=\"Center\"\u003e\n        \u003cTextBlock HorizontalAlignment=\"Center\" TextWrapping=\"Wrap\" Text=\"まだ作成中だ！💋\" FontSize=\"30\" /\u003e\n        \u003cButton HorizontalAlignment=\"Center\" x:Name=\"Button\" Click=\"ClickHandler\"\u003eClick Me\u003c/Button\u003e\n    \u003c/StackPanel\u003e\n\u003c/UserControl\u003e\n```\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/f2917540-85cc-7cdb-d971-0de5fb182f92.png)\n\n## 3-5. その他の編集\n・ThumbViewの「MainPage.xaml」を削除します。\n![3-8.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/399069f4-e73d-83c7-6db3-87e729141e2f.png)\n\n・「App.xaml」を以下に変更します\n```XML:App.xaml（変更後)\n\u003cToolkit:XamlApplication\n    x:Class=\"ThumbView.App\"\n    xmlns:Toolkit=\"using:Microsoft.Toolkit.Win32.UI.XamlHost\"\n    xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n    xmlns:local=\"using:ThumbView\"\u003e\n\u003c/Toolkit:XamlApplication\u003e\n```\n\n・「App.idl」を以下に変更します\n```XML:App.idl（変更後)\nnamespace ThumbView\n{\n     [default_interface]\n     runtimeclass App : Microsoft.Toolkit.Win32.UI.XamlHost.XamlApplication\n     {\n        App();\n     }\n}\n```\n\n・「App.h」を以下に変更します\n```CPP:App.h（変更後)\n#pragma once\n#include \"App.g.h\"\n#include \"App.base.h\"\n\nnamespace winrt::ThumbView::implementation\n{\n    class App : public AppT2\u003cApp\u003e\n    {\n    public:\n        App();\n        ~App();\n    };\n}\nnamespace winrt::ThumbView::factory_implementation\n{\n    class App : public AppT\u003cApp, implementation::App\u003e\n    {\n    };\n}\n```\n\n・「App.cpp」を以下に変更します\n```CPP:App.cpp（変更後)\n#include \"pch.h\"\n#include \"App.h\"\n#include \"App.g.cpp\"\n\nusing namespace winrt;\nusing namespace Windows::UI::Xaml;\n\nnamespace winrt::ThumbView::implementation\n{\n    App::App()\n    {\n        Initialize();\n        AddRef();\n        m_inner.as\u003c::IUnknown\u003e()-\u003eRelease();\n    }\n    App::~App()\n    {\n        Close();\n    }\n}\n```\n\n・「app.base.h」を追加し、以下へ変更します。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/ae5c6bd3-a275-a830-363a-690f9419fd45.png)\n```CPP:app.base.h（変更後)\n#pragma once\nnamespace winrt::ThumbView::implementation\n{\n    template \u003ctypename D, typename... I\u003e\n    struct App_baseWithProvider : public App_base\u003cD, ::winrt::Windows::UI::Xaml::Markup::IXamlMetadataProvider\u003e\n    {\n        using IXamlType = ::winrt::Windows::UI::Xaml::Markup::IXamlType;\n        IXamlType GetXamlType(::winrt::Windows::UI::Xaml::Interop::TypeName const\u0026 type)\n        {\n            return _appProvider.GetXamlType(type);\n        }\n        IXamlType GetXamlType(::winrt::hstring const\u0026 fullName)\n        {\n            return _appProvider.GetXamlType(fullName);\n        }\n        ::winrt::com_array\u003c::winrt::Windows::UI::Xaml::Markup::XmlnsDefinition\u003e GetXmlnsDefinitions()\n        {\n            return _appProvider.GetXmlnsDefinitions();\n        }\n    private:\n        bool _contentLoaded{ false };\n        winrt::ThumbView::XamlMetaDataProvider _appProvider;\n    };\n    template \u003ctypename D, typename... I\u003e\n    using AppT2 = App_baseWithProvider\u003cD, I...\u003e;\n}\n```\n\n# 4. ソリューションの変更\n・ビルド関連で作成するファイルの作成先の変更や、依存先の変更を行います。\n\n・まずはソリューションにXMLファイルを追加し、名前を「Solution.props」とします。\n・「Solution.props」を以下へ書き換えます。\n![4-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/730fef1e-99b7-6e2a-5808-9425a4f05f19.png)\n\n```XML:Solution.props（変更後)\n\u003cPropertyGroup Label=\"Globals\"\u003e\n    \u003cWindowsAppContainer\u003etrue\u003c/WindowsAppContainer\u003e\n    \u003cAppxGeneratePriEnabled\u003etrue\u003c/AppxGeneratePriEnabled\u003e\n    \u003cProjectPriIndexName\u003eApp\u003c/ProjectPriIndexName\u003e\n    \u003cAppxPackage\u003etrue\u003c/AppxPackage\u003e\n\u003c/PropertyGroup\u003e\n\u003cImport Project=\"$(VCTargetsPath)\\Microsoft.Cpp.Default.props\" /\u003e\n```\n\n・プロパティーマネージャーの二つのプロジェクトを右クリックして、既存のプロパティーシートの追加より今作った「Solution.props」を読ませます。二つとも。ここ重要。\n・これで、一つのフォルダの中に二つのプロジェクトからビルドされたファイルが生成されます。\n![4-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/4354b08e-37df-a7a4-977e-50c5903ee333.png)\n\n・ここで一度ビルドして失敗しなければOK。後はMFCのプロジェクトへWinRTで作成したプロジェクトを表示させる部分を作り込むだけ！\nここまででも十分長いょ・・・\n\n\n# 5. ThumbViewを表示させるようにMFCWinRTThumbを改造する。\n・MSのページではパッケージ化してますが、面倒なのでパッケージ化はしません。VC++ランタイムは入っているでしょ？\n\n# 5-1. マニフェストの作成とプロジェクトファイルの変更\n・まずは「app.manifest」を作成します。ただし、今までとはちょっと内容が変わります。\n![5-1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/d3867318-801a-5487-89d4-e149ad6712bb.png)\n```XML:app.manifest（変更後)\n\u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e\n\u003cassembly\n xmlns=\"urn:schemas-microsoft-com:asm.v1\"\n xmlns:asmv3=\"urn:schemas-microsoft-com:asm.v3\"\n manifestVersion=\"1.0\"\u003e\n\t\u003casmv3:file name=\"ThumbView.dll\"\u003e\n\t\t\u003cactivatableClass\n\t\t\tname=\"ThumbView.App\"\n\t\t\tthreadingModel=\"both\"\n\t\t\txmlns=\"urn:schemas-microsoft-com:winrt.v1\" /\u003e\n\t\t\u003cactivatableClass\n\t\t\tname=\"ThumbView.XamlMetadataProvider\"\n\t\t\tthreadingModel=\"both\"\n\t\t\txmlns=\"urn:schemas-microsoft-com:winrt.v1\" /\u003e\n\t\t\u003cactivatableClass\n\t\t\tname=\"ThumbView.MainControl\"\n\t\t\tthreadingModel=\"both\"\n\t\t\txmlns=\"urn:schemas-microsoft-com:winrt.v1\" /\u003e\n\t\u003c/asmv3:file\u003e\n\u003c/assembly\u003e\n```\n\n・MFCWinRTThumbのプロジェクトファイルを編集します。まずはMFCWinRTThumbをアンロードして、ファイルの末尾にある終了タグ \u003c/Project\u003e の直前に、次の XML を追加します\n```XML:MFCWinRTThumb.vcxproj（部分のみ）\n  \u003c!-- Configure these for your UWP project --\u003e\n  \u003cPropertyGroup\u003e\n    \u003cAppProjectName\u003eThumbView\u003c/AppProjectName\u003e\n  \u003c/PropertyGroup\u003e\n  \u003cPropertyGroup\u003e\n    \u003cAppIncludeDirectories\u003e$(SolutionDir)\\obj\\$(Platform)\\$(Configuration)\\$(AppProjectName)\\;$(SolutionDir)\\obj\\$(Platform)\\$(Configuration)\\$(AppProjectName)\\Generated Files\\;\u003c/AppIncludeDirectories\u003e\n  \u003c/PropertyGroup\u003e\n  \u003cItemGroup\u003e\n    \u003cProjectReference Include=\"..\\$(AppProjectName)\\$(AppProjectName).vcxproj\" /\u003e\n  \u003c/ItemGroup\u003e\n  \u003c!-- End Section--\u003e\n```\n\n・追加して上書き保存したら、プロジェクトの再読込\n・MFCWinRTThumbのプロパティーより、「DPI認識」を「モニターごとの高いDPI認識」へ変更します。今までこれを変更せずにエラーが起きたことは無いですが、エラーが発生することがあるみたいですからね。\n![5-2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/1a8c5df9-265a-a06c-434d-fede9ced6ba0.png)\n\n## 5-2. MFCのViewでThumbViewを表示する。\n・それでは今回はここまで準備したので、XamlReaderを使わずに表示させます。\n・まずはMFCWinRTThumbの「pch.h」で必要なヘッダー等をincludeします。\n```CPP:pch.h（変更後)\n#ifndef PCH_H\n#define PCH_H\n\n// プリコンパイルするヘッダーをここに追加します\n#include \"framework.h\"\n\n#undef GetCurrentTime\n#undef TRY\n\n#include \"resource.h\"\n#include \u003cwinrt/Windows.Foundation.Collections.h\u003e\n#include \u003cwinrt/Windows.system.h\u003e\n#include \u003cwinrt/windows.ui.xaml.hosting.h\u003e\n#include \u003cwindows.ui.xaml.hosting.desktopwindowxamlsource.h\u003e\n#include \u003cwinrt/windows.ui.xaml.controls.h\u003e\n#include \u003cwinrt/Windows.ui.xaml.media.h\u003e\n#include \u003cwinrt/Windows.UI.Core.h\u003e\n#include \u003cwinrt/ThumbView.h\u003e\n\nusing namespace winrt;\nusing namespace Windows::UI;\nusing namespace Windows::UI::Composition;\nusing namespace Windows::UI::Xaml::Hosting;\nusing namespace Windows::Foundation::Numerics;\nusing namespace Windows::UI::Xaml::Controls;\n\n#endif //PCH_H\n```\n\n・ViewクラスにThumbViewとDesktopWindowXamlSourceのメンバを追加します。\n```CPP:MFCWinRTThumbView.h（変更箇所周囲のみ)\nclass CMFCWinRTThumbView : public CView\n{\n\t//ここにWinRT関連のメンバを追加\n\twinrt::ThumbView::App hostApp{ nullptr };\n\twinrt::Windows::UI::Xaml::Hosting::DesktopWindowXamlSource _desktopWindowXamlSource{ nullptr };\n\twinrt::ThumbView::MainControl _mainControl{ nullptr };\n\twinrt::impl::com_ref\u003cIDesktopWindowXamlSourceNative\u003e interop;\n\nprotected: // シリアル化からのみ作成します。\n\tCMFCWinRTThumbView() noexcept;\n\tDECLARE_DYNCREATE(CMFCWinRTThumbView)\n```\n\n・CMFCWinRTThumbViewクラスにOnCreateを追加して、WinRTの初期化～ウインドウのアタッチまで行います。\n![5-3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/59b972ff-0e84-7af3-9302-ed0c65840868.png)\n```CPP:MFCWinRTThumbView.cpp（変更箇所周囲のみ)\nint CMFCWinRTThumbView::OnCreate(LPCREATESTRUCT lpCreateStruct)\n{\n\tif (CView::OnCreate(lpCreateStruct) == -1)\n\t\treturn -1;\n\n\t// TODO: ここに特定な作成コードを追加してください。\n\n\t//ここでWinRTの初期化～ウインドウのアタッチまで\n\twinrt::init_apartment(winrt::apartment_type::single_threaded);\n\thostApp = winrt::ThumbView::App{};\n\t_desktopWindowXamlSource = winrt::Windows::UI::Xaml::Hosting::DesktopWindowXamlSource{};\n\t\t\n\tif (_desktopWindowXamlSource != nullptr)\n\t{\n\t\tinterop = _desktopWindowXamlSource.as\u003cIDesktopWindowXamlSourceNative\u003e();\n\t\tcheck_hresult(interop-\u003eAttachToWindow(this-\u003em_hWnd));\n\t}\t\n\n\treturn 0;\n}\n\n```\n\n・WinRTの表示関連はOnDrawに記述します。\n```CPP:MFCWinRTThumbView.cpp（OnDrawのみ)\nvoid CMFCWinRTThumbView::OnDraw(CDC* /*pDC*/)\n{\n\tCMFCWinRTThumbDoc* pDoc = GetDocument();\n\tASSERT_VALID(pDoc);\n\tif (!pDoc)\n\t\treturn;\n\n\t// TODO: この場所にネイティブ データ用の描画コードを追加します。\n\t\n\t//WinRT部分の表示\n\tif (_desktopWindowXamlSource != nullptr)\n\t{\n\t\tHWND hWndXamlIsland = nullptr;\n\t\tinterop-\u003eget_WindowHandle(\u0026hWndXamlIsland);\n\t\tRECT windowRect;\n\t\t::GetWindowRect(this-\u003em_hWnd, \u0026windowRect);\n\t\t::SetWindowPos(hWndXamlIsland, NULL, 0, 0, windowRect.right - windowRect.left, windowRect.bottom - windowRect.top, SWP_SHOWWINDOW);\n\n\t\t_mainControl = winrt::ThumbView::MainControl();\n\t\t_desktopWindowXamlSource.Content(_mainControl);\n\t}\t\n}\n\n```\n\n・ふぅ、長かった。これでMFCWinRTThumbをビルド/実行してエラーが出なければ、「MFC（）笑」と言われないモダンなアプリの雛型が完成です。\n![5-4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/28ce9a82-aada-a02c-b984-bc2340f11d31.png)\n\n・実行するとこんな感じ\n![5-5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/131051/9f3f9a9d-cbc5-cbbd-5cd3-1c4189db3e25.png)\n・しかし、たったこれだけしか表示しないのにメモリを74MBも食うなんてなんてUWPは燃費が悪いんだ。MFCだけなら10MBも行かないのに・・・\n・色々苦労してMFCからUWPを利用していますが、その最大の利点は一々インストールしなくてもUWPアプリが動くこと。今回のように作成すると、dllなんかも一緒にしてくれるのでbinの中にあるMFCWinRTThumbフォルダをそのままコピーするだけで使えます。「インストーラーが動かない；；」とか「証明書が；；」とか言う苦情を聞かなくても済むんです！~~インストーラーを無効にするMS許すまじ！~~ もちろんVCランタイムは入っている前提ですよ？\n\n・次回はこれを元にして、ピクチャフォルダをサムネイル表示します。\n\n[目次へ](https://qiita.com/lilac0011/items/f53f7401ea7da31e3a0b)\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:33:01+09:00","group":null,"id":"ca08fbb33dbf42121c4a","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"VC++","versions":[]},{"name":"MFC","versions":[]},{"name":"WinRT","versions":[]},{"name":"UWP","versions":[]}],"title":"MFCでもWinRTその7.　MFCアプリでもピクチャフォルダをサムネイル表示しよう（仮部分の表示まで）","updated_at":"2022-09-18T22:10:04+09:00","url":"https://qiita.com/lilac0011/items/ca08fbb33dbf42121c4a","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":6,"github_login_name":null,"id":"lilac0011","items_count":25,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":131051,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/131051/profile-images/1473718125","team_only":false,"twitter_screen_name":null,"website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:14\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-2:124\"\u003e過去に投稿した下記の記事の続編です。今度は1時間ごとのデータをスクレイピングします。\u003c/p\u003e\n\u003cul data-sourcepos=\"3:2-4:0\"\u003e\n\u003cli data-sourcepos=\"3:2-4:0\"\u003e\u003ca href=\"https://qiita.com/hase-k0x01/items/491d2d80596e014eb7d3\" id=\"reference-a7015cf37cf2105f8f89\"\u003e気象庁の1日毎の過去の気象データをPythonでスクレイピングしてPostgreSQLにINSERTしてみた\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 data-sourcepos=\"5:1-5:15\"\u003e\n\u003cspan id=\"やること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eやること\u003c/h2\u003e\n\u003cul data-sourcepos=\"6:2-9:1\"\u003e\n\u003cli data-sourcepos=\"6:2-6:76\"\u003e気象庁の1時間ごとの気象データをスクレイピングする\u003c/li\u003e\n\u003cli data-sourcepos=\"7:2-9:1\"\u003e取得したデータをPostgreSQLのDBにINSERTする\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 data-sourcepos=\"10:1-10:12\"\u003e\n\u003cspan id=\"環境等\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E7%AD%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境等\u003c/h2\u003e\n\u003cul data-sourcepos=\"11:2-15:0\"\u003e\n\u003cli data-sourcepos=\"11:2-11:42\"\u003eプログラミング言語: Python3.10\u003c/li\u003e\n\u003cli data-sourcepos=\"12:2-12:30\"\u003eDBサーバ: Amazon AWS RDB\u003c/li\u003e\n\u003cli data-sourcepos=\"13:2-13:31\"\u003e実行環境: Amazon AWS EC2\u003c/li\u003e\n\u003cli data-sourcepos=\"14:2-15:0\"\u003eスクレイピングに使うライブラリ: BeautifulSoup\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 data-sourcepos=\"16:1-16:24\"\u003e\n\u003cspan id=\"参考にした情報\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E6%83%85%E5%A0%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にした情報\u003c/h2\u003e\n\u003cp data-sourcepos=\"17:1-17:102\"\u003e制作にあたり、以下の記事と記載のコードを参考にさせていただきました。\u003c/p\u003e\n\u003cul data-sourcepos=\"18:2-20:0\"\u003e\n\u003cli data-sourcepos=\"18:2-18:160\"\u003e\u003ca href=\"https://qiita.com/Cyber_Hacnosuke/items/122cec35d299c4d01f10\" id=\"reference-386b1b04055201acf1fd\"\u003eGoogleColaboratoryで気象庁の過去気象データをスクレイピングしてみた。\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"19:2-20:0\"\u003e\u003ca href=\"http://k-ichikawa.blog.enjoy.jp/etc/HP/htm/jmaP0.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e気象データの観測地点一覧　（2017年3月時点）\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"21:1-21:53\"\u003e\n\u003cspan id=\"スクレイピングするデータを観察する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E8%A6%B3%E5%AF%9F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクレイピングするデータを観察する\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"22:1-22:42\"\u003e\n\u003cspan id=\"気象庁のwebサイトを見てみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B0%97%E8%B1%A1%E5%BA%81%E3%81%AEweb%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e気象庁のWEBサイトを見てみる\u003c/h2\u003e\n\u003cp data-sourcepos=\"23:1-23:287\"\u003e気象庁のWEBサイトをGoogleで検索して開きます。「ホーム\u0026gt;各種データ・資料\u0026gt;過去の気象データ検索」と辿っていくと、下記のURLに行き当たります。なんかいかにもパラメータを入れてくださいと言わんばかりです。\u003c/p\u003e\n\u003cul data-sourcepos=\"24:1-26:0\"\u003e\n\u003cli data-sourcepos=\"24:1-26:0\"\u003e\u003ca href=\"https://www.data.jma.go.jp/obd/stats/etrn/index.php?prec_no=\u0026amp;block_no=\u0026amp;year=\u0026amp;month=\u0026amp;day=\u0026amp;view=\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.data.jma.go.jp/obd/stats/etrn/index.php?prec_no=\u0026amp;block_no=\u0026amp;year=\u0026amp;month=\u0026amp;day=\u0026amp;view=\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"27:1-28:121\"\u003e場所とか日付を選んでいくと、パラメータが埋まっていきます。最後に、「～1時間毎の値を表示」をクリックすると次の画面に進みます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/87010c584e2adf2c18c40b6ebd662856cbc5cb9c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132363430302f30343839323233302d313034392d663866372d626265342d3037386231343138656366362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2F04892230-1049-f8f7-bbe4-078b1418ecf6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1695571138a775aea9ad2f2e254c9fd6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/04892230-1049-f8f7-bbe4-078b1418ecf6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2F04892230-1049-f8f7-bbe4-078b1418ecf6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ba48284704e67850907ba4cd7ddc01a9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"30:1-30:54\"\u003e\n\u003cspan id=\"データがどうなっているのか見てみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータがどうなっているのか見てみる\u003c/h2\u003e\n\u003cp data-sourcepos=\"31:1-32:121\"\u003eデータの表示こんなふうになります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c42f09c8eb948a10150dc77d5f71569fe905b058/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132363430302f31623163346138632d663737652d656430332d623733642d6364343337313933373538392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2F1b1c4a8c-f77e-ed03-b73d-cd4371937589.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=981bb84e4c8a9a28046b00b6fbfc5e01\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/1b1c4a8c-f77e-ed03-b73d-cd4371937589.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2F1b1c4a8c-f77e-ed03-b73d-cd4371937589.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=be19556b8305383200d73b8f46fe5c49 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"34:1-34:93\"\u003eこのときにアドレスバーに表示されているURLは次のようになります。\u003c/p\u003e\n\u003cul data-sourcepos=\"35:2-36:0\"\u003e\n\u003cli data-sourcepos=\"35:2-36:0\"\u003e(\u003ca href=\"https://www.data.jma.go.jp/obd/stats/etrn/view/hourly_s1.php?prec_no=14\u0026amp;block_no=47412\u0026amp;year=2021\u0026amp;month=12\u0026amp;day=31\u0026amp;view=\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.data.jma.go.jp/obd/stats/etrn/view/hourly_s1.php?prec_no=14\u0026amp;block_no=47412\u0026amp;year=2021\u0026amp;month=12\u0026amp;day=31\u0026amp;view=\u003c/a\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"37:1-37:262\"\u003eスクレイピングしやすそうなデータです。しかし、\"--\"が当てはめられているセルや空白のセルがあります。「天気」の欄は天気記号という記号になっていて、画像データが当てはまっています。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"39:1-39:39\"\u003e\n\u003cspan id=\"ページのソースを見てみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eページのソースを見てみる\u003c/h2\u003e\n\u003cp data-sourcepos=\"40:1-41:82\"\u003eスクレイピングしやすそうなデータです。BeautifulSoupに放り込めば、うまい感じに切り分けてくれそうです。\u003cbr\u003e\n気象データがあるところのclassは\"mtx\"になっているようです。\u003c/p\u003e\n\u003cp data-sourcepos=\"43:1-43:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/c169631cf855ec92558848ee14776246f25fca04/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132363430302f37343566393562372d626162662d393532312d383261652d3230623566613739613161382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2F745f95b7-babf-9521-82ae-20b5fa79a1a8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d338da3a19e6e28522e28bdb0e61fef2\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/745f95b7-babf-9521-82ae-20b5fa79a1a8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2F745f95b7-babf-9521-82ae-20b5fa79a1a8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f2899b619aa757ae4c3cca9f5347f53c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"45:1-45:360\"\u003e「天気」の欄は、次のようなコードになっていました。天気欄は結構重要なデータなんですが、画像データが当てはめられていて、そのままだとデータを取り込めませんが、alt属性には天気概況がそのまま書いてありました。天気欄は、alt属性を使えば良さそうです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"46:1-48:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;img src=\"../../data/image/tenki/large/F8A0.gif\" alt=\"晴れ\"\u0026gt;\u0026lt;/td\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch1 data-sourcepos=\"51:1-51:25\"\u003e\n\u003cspan id=\"コードとdbの概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A8db%E3%81%AE%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコードとDBの概要\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"53:1-53:51\"\u003e\n\u003cspan id=\"今回つくったプログラムでやること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%A4%E3%81%8F%E3%81%A3%E3%81%9F%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%A7%E3%82%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回つくったプログラムでやること\u003c/h2\u003e\n\u003cp data-sourcepos=\"55:1-55:33\"\u003eこのことをやっています\u003c/p\u003e\n\u003cul data-sourcepos=\"56:2-62:0\"\u003e\n\u003cli data-sourcepos=\"56:2-56:49\"\u003e1時間ごとの気象データを取得する\u003c/li\u003e\n\u003cli data-sourcepos=\"57:2-57:44\"\u003e取得したデータをDBに登録する\u003c/li\u003e\n\u003cli data-sourcepos=\"58:2-59:78\"\u003e取得する対象の日を求める\n\u003cul data-sourcepos=\"59:4-59:78\"\u003e\n\u003cli data-sourcepos=\"59:4-59:78\"\u003e取得する最初の日を求め、そこから1日ずつ遡っていく\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"60:2-62:0\"\u003e取得する対象の地点を求める\n\u003cul data-sourcepos=\"61:4-62:0\"\u003e\n\u003cli data-sourcepos=\"61:4-62:0\"\u003e地点情報はCSVに書いておいて読み出していく\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 data-sourcepos=\"63:1-63:11\"\u003e\n\u003cspan id=\"db構造\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#db%E6%A7%8B%E9%80%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDB構造\u003c/h2\u003e\n\u003cp data-sourcepos=\"64:1-64:129\"\u003eDBは前回同様PostgreSQLでやってます。1日毎のデータのそれぞれの項目をDBのフィールドとします。\u003c/p\u003e\n\u003cp data-sourcepos=\"66:1-66:54\"\u003eテーブル構造はこんな感じにしました。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"67:1-91:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eCREATE TABLE weather_hourly_table(\n    id SERIAL PRIMARY       KEY ,\n    date_time               TIMESTAMP WITH TIME ZONE,\n    prec_no\t\t\t        INTEGER,\n    block_no\t\t        INTEGER,\n    pressure_ground         REAL,\n    pressure_sea            REAL,\n    rainfall                REAL,\n    temperature             REAL,\n    dew_point_humidity      REAL,\n    vapor_pressure          REAL,\n    humidity                REAL,\n    windspeed_value         REAL,\n    windspeed_direction     INTEGER,\n    sunshine_hours          REAL,\n    global_solar_radiation  REAL,\n    snowfall                REAL,\n    snowdepth               REAL,\n    weather                 VARCHAR(100),\n    cloud_amount            VARCHAR(100) ,\n    visibility              REAL\n);\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch1 data-sourcepos=\"94:1-94:20\"\u003e\n\u003cspan id=\"実際のコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実際のコード\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"97:1-97:51\"\u003e\n\u003cspan id=\"スクレイピングをする部分のコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0%E3%82%92%E3%81%99%E3%82%8B%E9%83%A8%E5%88%86%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクレイピングをする部分のコード\u003c/h2\u003e\n\u003cp data-sourcepos=\"98:1-98:296\"\u003eスクレイピングをおこなう部分を関数にまとめました。取得した日付と2種類の地点情報を引数に渡すと、その日の気象データを辞書の配列で返します。配列の各要素は1時間ごとの気象データを辞書形式にしたものです。\u003c/p\u003e\n\u003cp data-sourcepos=\"100:1-102:219\"\u003e各セルのデータはBeautifulSoupが分解してくれます。\u003cbr\u003e\n文字列で表現できるところは、そのまま文字列で取り込みます。\u003cbr\u003e\n数値の部分は、変換してfloatとかにしないといけません。しかし、セルの値が\"--\"とか空欄になっている部分があり、これについての処理を考える必要があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"104:1-104:39\"\u003e次のように方針を考えます。\u003c/p\u003e\n\u003cul data-sourcepos=\"105:2-108:0\"\u003e\n\u003cli data-sourcepos=\"105:2-105:352\"\u003e「降水量」の欄に\"--\"となっているデータがあります。測定限界以下、もしくは雨がふらなかった、と解釈して問題なさそうです。というわけで、数値以外のデータが現れたら0.0として処理するようにします。「降雪量」に関しても同様に考えていいでしょう。\u003c/li\u003e\n\u003cli data-sourcepos=\"106:2-108:0\"\u003e「視程」「日照時間」のデータは、空欄になっている部分があります。このようなデータは 0 とか、デフォルト値を当てはめてしまうと意味が変わってしまうので、空欄のまま登録します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"109:1-109:204\"\u003e天気の部分は、画像データが当てはめられています。先述のとおり、alt属性が埋め込まれていましたので、alt属性をそのまま利用することにしました。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"111:1-224:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# 気象庁のWEBサイトから指定日・指定場所の１時間毎の天気データを取得する\n# 取得したデータは辞書形式の配列で返す\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efetch_daily_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#date_f = dt.strptime(date, '%Y-%m-%d')\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 日付データを取り込む\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eyear\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emonth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emonth\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eday\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eday\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#指定URLからHTMLデータを取得する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_url\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapparent_encoding\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#取得したデータをBeautifulSoupで解析する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esoup\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBeautifulSoup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'html.parser'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esoup\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efindAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'tr'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclass_\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'mtx'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#空の配列を返す\n\u003c/span\u003e    \n    \u003cspan class=\"c1\"\u003e#最初の２行は見出しなので削除する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003erows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#時間毎の気象データは配列に格納。\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#格納する配列を初期化する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ed_weather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#時間ごとに分割\n\u003c/span\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#項目毎に分割\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eitems\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efindAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'td'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#左側から数えて何番目のitemか、ということで場合分けして処理する\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#時（いま何時！？？）\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ehour\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehour\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e'24'\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"c1\"\u003e#24時は、次の日の0時にする\n\u003c/span\u003e            \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%s-%s-%s'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#次の日の日付\n\u003c/span\u003e            \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%s-%s-%s %s:0:0'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'0'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%s-%s-%s %s:0:0'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#気圧(地表)(hPa)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#気圧(海面)(hPa)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#降水量(mm)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#気温(℃)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#露点湿度(℃)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#蒸気圧(hPa)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#湿度(%)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#風速(m/s)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#風向\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekanji_direction_to_degree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#日照時間(h)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#全天日射量(MJ/m2)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#降雪(cm)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#積雪(cm)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#天気\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eweather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e''\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#空欄だったら''をあてはめる\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"c1\"\u003e#imgタグを取得\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e#データが入っていればalt属性を取得する\n\u003c/span\u003e            \u003cspan class=\"n\"\u003eweather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'alt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#雲量\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e#空欄だったらNoneをあてはめる\n\u003c/span\u003e            \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n        \n        \u003cspan class=\"c1\"\u003e#視程(km)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e# itemを処理し終わったので、辞書にまとめる\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eh_weather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"s\"\u003e'date_time'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e   \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e  \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'pressure_ground'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                        \u003cspan class=\"s\"\u003e'pressure_sea'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                        \u003cspan class=\"s\"\u003e'rainfall'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'temperature'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'dew_point_humidity'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'vapor_pressure'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'humidity'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'windspeed_value'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'windspeed_direction'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'sunshine_hours'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'global_solar_radiation'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'snowfall'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'snowdepth'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'weather'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eweather\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'cloud_amount'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'visibility'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e\n                         \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#辞書データを配列に追加する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ed_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ed_weather\u003c/span\u003e\n    \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"226:1-226:29\"\u003e\n\u003cspan id=\"dbにinsertするコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#db%E3%81%ABinsert%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDBにINSERTするコード\u003c/h2\u003e\n\u003cp data-sourcepos=\"227:1-230:113\"\u003eこれも関数にまとめました。\u003cbr\u003e\n1レコード分のデータは1時間毎のデータとして、これを引数にするとDBにINSERTします。\u003cbr\u003e\n辞書からデータを取り出して、フィールドにあてはめてINSERTするだけです。\u003cbr\u003e\n日付・時刻のデータには日本標準時だとわかるように\"JST\"を付加して登録しました。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"232:1-282:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e#1時間毎のデータをDBに登録する\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einsert_hourly_weather_into_db\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#cursorの取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# timestampをDBに登録するときは、日本標準時で登録することを指示する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e          \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'date_time'\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" JST\"\u003c/span\u003e \u003cspan class=\"c1\"\u003e#測定日時\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e            \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#地域コード\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#地点コード\n\u003c/span\u003e    \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'pressure_ground'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#気圧(地表)(hPa)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e       \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'pressure_sea'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#気圧(海面)(hPa)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'rainfall'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#降水量(mm)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'temperature'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e          \u003cspan class=\"c1\"\u003e#気温(℃)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'dew_point_humidity'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e   \u003cspan class=\"c1\"\u003e#露点湿度(℃)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'vapor_pressure'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e       \u003cspan class=\"c1\"\u003e#蒸気圧(hPa)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'humidity'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e             \u003cspan class=\"c1\"\u003e#湿度(%)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'windspeed_value'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e      \u003cspan class=\"c1\"\u003e#風速(m/s)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'windspeed_direction'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#風向\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'sunshine_hours'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#日照時間(h)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'global_solar_radiation'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#全天日射量(MJ/m2)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e          \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'snowfall'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#降雪(cm)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e         \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'snowdepth'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e       \u003cspan class=\"c1\"\u003e#積雪(cm)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eweather\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'weather'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e         \u003cspan class=\"c1\"\u003e#天気\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'cloud_amount'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#雲量\n\u003c/span\u003e    \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'visibility'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e      \u003cspan class=\"c1\"\u003e#視程(km)\n\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n        \u003cspan class=\"c1\"\u003e#クエリを実行する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'INSERT INTO weather_hourly_table (date_time, prec_no, block_no, pressure_ground, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    pressure_sea, rainfall, temperature, dew_point_humidity, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    vapor_pressure, humidity, windspeed_value, windspeed_direction, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    sunshine_hours, global_solar_radiation, snowfall, snowdepth, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    weather, cloud_amount, visibility) \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    VALUES( %s, %s,  %s, %s, %s,   %s,   %s,   %s,   %s, %s, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                            %s,     %s,      %s,   %s, %s, %s, %s, %s, %s)'\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003eweather\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e)\u003c/span\u003e \n                        \n        \u003cspan class=\"c1\"\u003e#反映する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecommit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#登録失敗\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#登録成功\n\u003c/span\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"284:1-284:45\"\u003e\n\u003cspan id=\"すでに登録済みかチェックする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%99%E3%81%A7%E3%81%AB%E7%99%BB%E9%8C%B2%E6%B8%88%E3%81%BF%E3%81%8B%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eすでに登録済みかチェックする\u003c/h2\u003e\n\u003cp data-sourcepos=\"285:1-286:168\"\u003eDBにINSERTする前に、その日・その地点のデータがすでにDBに登録されているかどうかをチェックすることにしました。\u003cbr\u003e\nプログラムが途中でクラッシュして、どこまで登録したかわからなくなって再実行するときも、二重登録しなくてすみます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"288:1-309:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# 指定日・指定場所のデータがすでにDBに登録されているかチェックする\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003echeck_already_inserted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#指定日の1時から、次の日の0時までの範囲で検索するためにタイムスタンプデータを作る\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edt_start\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 1:0:0 JST\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edt_end\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 0:0:0 JST\"\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#カーソルを取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#クエリを発行する。指定日（の1時～次の日の0時の範囲）・指定場所のレコード数をクエリする\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'SELECT count(*) FROM weather_hourly_table WHERE \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e        date_time \u0026gt; %s and date_time \u0026lt; %s and prec_no = %s and block_no = %s'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edt_start\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edt_end\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#取得出来たデータ（指定場所のレコード数）を取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003erecord_count\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efetchone\u003c/span\u003e\u003cspan class=\"p\"\u003e()[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#レコード数が0を越えていれば登録ありとしてTrue、0ならFalseを返す\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecord_count\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#登録あり\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e \u003cspan class=\"c1\"\u003e#登録なし\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"311:1-311:27\"\u003e\n\u003cspan id=\"データの変換など\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%A4%89%E6%8F%9B%E3%81%AA%E3%81%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータの変換など\u003c/h2\u003e\n\u003cp data-sourcepos=\"312:1-312:66\"\u003eデータの変換をおこなう関数をつくっています。\u003c/p\u003e\n\u003cul data-sourcepos=\"313:2-316:0\"\u003e\n\u003cli data-sourcepos=\"313:2-313:107\"\u003estr2float_z(): 文字列 -\u0026gt; float 変換で、float変換できない場合は 0.0 として変換する\u003c/li\u003e\n\u003cli data-sourcepos=\"314:2-314:140\"\u003estr2float_n(): 文字列 -\u0026gt; float 変換で、float変換できない場合は None として変換する(DBにはNull値として登録)\u003c/li\u003e\n\u003cli data-sourcepos=\"315:2-316:0\"\u003ekanji_direction_to_degree(): 方角は「東北東」というような表現なので、北を0度として整数値で表す\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"317:1-381:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e#取得したデータの変換: 方角を整数値に変換、北を0°として360°で表記\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ekanji_direction_to_degree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekanji_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ematch\u003c/span\u003e   \u003cspan class=\"n\"\u003ekanji_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北北東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e23\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'東北東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e68\u003c/span\u003e           \n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'東南東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e113\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南南東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e158\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南南西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e203\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'西南西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e248\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'西北西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e293\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北北西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e335\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e45\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e135\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e225\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e315\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e90\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e180\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e270\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#判別不能なデータがきたとき\n\u003c/span\u003e            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edirection\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#取得したデータの変換:  float型に変換する。変換できない文字は0.0で代用。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  測定結果が0とか測定限界以下だったんだな、って思って差し支えないデータはこっちを使う\n#  例: 降雨量、降雪量\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#取得したデータの変換: float型に変換する。変換できない場合はNoneを返す。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  0として考えると差し支えがあるデータの場合(つまり0と言うデータにも意味がある場合)は\n# こっちを使う。\n# #  例: 気温、気圧、湿度等\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"384:1-384:54\"\u003e\n\u003cspan id=\"場所データをcsvファイルから読み出す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A0%B4%E6%89%80%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92csv%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8B%E3%82%89%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e場所データをCSVファイルから読み出す\u003c/h2\u003e\n\u003cp data-sourcepos=\"385:1-387:237\"\u003e場所データは .csv ファイルに記録しています。\u003cbr\u003e\n場所データの読み出しは関数化しました。\u003cbr\u003e\nこの関数は、場所データを .csv ファイルから読み出して、場所データを辞書形式の配列で返します。ひとつの場所データの要素は、prec_no, block_no, place_name をキーとしています。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"389:1-411:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# CSVから場所リストを取得して辞書の配列に入れて返す\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_place_to_fetch\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#場所データをcsvから読み込み\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecsv_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplace_csv_file_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'r'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eerrors\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewline\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecsv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecsv_file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edelimiter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\",\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edoublequote\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elineterminator\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equotechar\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'\"'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eskipinitialspace\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \n    \u003cspan class=\"n\"\u003eheader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 場所リストを初期化\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 場所データを辞書に設定\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#地域コード\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#地点コード\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#地点名\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eplace\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'place_name'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'error_count'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#場所を登録した辞書データを配列に追加\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecsv_file\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 場所リストを返却\n\u003c/span\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"413:1-413:12\"\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h2\u003e\n\u003cp data-sourcepos=\"414:1-414:173\"\u003eAWS上でプログラムを実行するとき、日本標準時(JST)がうまく扱えないみたいなので、JSTを定義しないとうまくいきませんでした。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"416:1-419:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e#AWSでJSTを扱うためのtimezoneを定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003eJST\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehours\u003c/span\u003e\u003cspan class=\"o\"\u003e=+\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#timezoneの生成\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"422:1-422:11\"\u003e\n\u003cspan id=\"実行例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実行例\u003c/h1\u003e\n\u003cp data-sourcepos=\"424:1-424:42\"\u003eプログラムの出力はこんな感じ\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"425:1-428:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ python3 weather_scraper_hourly_fetch.py\n2022-09-18 21:29:38 UTC+09:00: Data Inserted for:date: 2022-09-08 00:00:00, prec_no: 31, block_no: 47581, place_name: 八戸, records: 1056, places: 299.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"430:1-431:121\"\u003eINSERTされたデータをSELECTしてみました。ちゃんと登録されているようです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a60ecbe041285d583dd54ea7299c8dc4deb3e193/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3132363430302f65363831666538652d333936642d373732392d626462312d3432303430313032663564332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2Fe681fe8e-396d-7729-bdb1-42040102f5d3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8ce4c2e72b134ae96efe72cff90f1da6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/e681fe8e-396d-7729-bdb1-42040102f5d3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F126400%2Fe681fe8e-396d-7729-bdb1-42040102f5d3.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3dee001e90d5cdb78800c35b9054ee73 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"435:1-435:20\"\u003e\n\u003cspan id=\"コードの全文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%85%A8%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコードの全文\u003c/h1\u003e\n\u003cp data-sourcepos=\"436:1-437:39\"\u003e主要な部分の説明は異常です。\u003cbr\u003e\nコードの全文を掲載します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"439:1-882:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eweather_scraper_hourly_fetch.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ebs4\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eBeautifulSoup\u003c/span\u003e  \n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecsv\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ejson\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erequests\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epsycopg2\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003edatetime\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e  \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etimezone\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecodecs\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etime\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eurllib.error\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eHTTPError\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eurllib.error\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eURLError\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003esys\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#地点データのcsvファイル名\n\u003c/span\u003e\u003cspan class=\"n\"\u003eplace_csv_file_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'./place.csv'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#地点データを読み込んだ辞書データには、その地点のエラー情報が含まれているが、それらを保存しておくファイル名\n\u003c/span\u003e\u003cspan class=\"n\"\u003eplace_list_with_err_file_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'xxxxxx.csv'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#気象庁の時間毎のデータを取得するためのURL\n\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_url\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"https://www.data.jma.go.jp/obd/stats/etrn/view/hourly_s1.php?prec_no=%s\u0026amp;block_no=%s\u0026amp;year=%s\u0026amp;month=%s\u0026amp;day=%s\u0026amp;view=p1\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#AWSでJSTを扱うためのtimezoneを定義\n\u003c/span\u003e\u003cspan class=\"n\"\u003eJST\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehours\u003c/span\u003e\u003cspan class=\"o\"\u003e=+\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#timezoneの生成\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#SQLサーバの情報\n\u003c/span\u003e\u003cspan class=\"n\"\u003edbms_hostname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'xxxxxx.example.com'\u003c/span\u003e\n\u003cspan class=\"n\"\u003edbms_port\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e999999\u003c/span\u003e\n\u003cspan class=\"n\"\u003edbms_database_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'xxxxxx'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#SQLサーバに接続するためのユーザ名とパスワード情報を保存したファイル名\n\u003c/span\u003e\u003cspan class=\"n\"\u003edb_auth_filename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'xxxxxx.json'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#logfile名\n\u003c/span\u003e\u003cspan class=\"n\"\u003elogfile_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"./xxxxxxxx.log\"\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e# CSVから場所リストを取得して辞書の配列に入れて返す\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_place_to_fetch\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#場所データをcsvから読み込み\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecsv_file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplace_csv_file_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'r'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eerrors\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewline\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecsv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecsv_file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edelimiter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\",\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edoublequote\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elineterminator\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equotechar\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'\"'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eskipinitialspace\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \n    \u003cspan class=\"n\"\u003eheader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 場所リストを初期化\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 場所データを辞書に設定\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#地域コード\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e#地点コード\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#地点名\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eplace\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'place_name'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'error_count'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#場所を登録した辞書データを配列に追加\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecsv_file\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 場所リストを返却\n\u003c/span\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#ログファイルに追記する\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprintlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_str\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody_str\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJST\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e','\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_str\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e','\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebody_str\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"nb\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003ecodecs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elogfile_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'a'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#端末に印字する（文字が流れていかないように1行で上書きする）\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eprintmsg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\u003c/span\u003e\u003cspan class=\"s\"\u003e_________________________________________________________________________________________________________________________________'\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\u003c/span\u003e\u003cspan class=\"s\"\u003e%s: %s'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eJST\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S %Z'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 進捗を表示する(端末に印字し、ログファイルに記録する)\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintmsg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s\"\u003e'date: %s, prec_no: %s, block_no: %s, place_name: %s, records: %s, places: %s.'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e'date: %s, prec_no: %s, block_no: %s, place_name: %s, records: %s, places: %s.'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e#取得したデータの変換: 方角を整数値に変換、北を0°として360°で表記\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ekanji_direction_to_degree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekanji_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ematch\u003c/span\u003e   \u003cspan class=\"n\"\u003ekanji_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北北東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e23\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'東北東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e68\u003c/span\u003e           \n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'東南東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e113\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南南東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e158\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南南西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e203\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'西南西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e248\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'西北西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e293\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北北西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e335\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e45\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e135\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e225\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e315\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'北'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'東'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e90\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'南'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e180\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e'西'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e270\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#判別不能なデータがきたとき\n\u003c/span\u003e            \u003cspan class=\"n\"\u003edirection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edirection\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#取得したデータの変換:  float型に変換する。変換できない文字は0.0で代用。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  測定結果が0とか測定限界以下だったんだな、って思って差し支えないデータはこっちを使う\n#  例: 降雨量、降雪量\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#取得したデータの変換: float型に変換する。変換できない場合はNoneを返す。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  0として考えると差し支えがあるデータの場合(つまり0と言うデータにも意味がある場合)は\n# こっちを使う。\n# #  例: 気温、気圧、湿度等\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e# 気象庁のWEBサイトから指定日・指定場所の１時間毎の天気データを取得する\n# 取得したデータは辞書形式の配列で返す\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efetch_daily_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#date_f = dt.strptime(date, '%Y-%m-%d')\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 日付データを取り込む\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eyear\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emonth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emonth\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eday\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eday\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#指定URLからHTMLデータを取得する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebase_url\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencoding\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapparent_encoding\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#取得したデータをBeautifulSoupで解析する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esoup\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eBeautifulSoup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'html.parser'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esoup\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efindAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'tr'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eclass_\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'mtx'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#空の配列を返す\n\u003c/span\u003e    \n    \u003cspan class=\"c1\"\u003e#最初の２行は見出しなので削除する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003erows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#時間毎の気象データは配列に格納。\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#格納する配列を初期化する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ed_weather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#時間ごとに分割\n\u003c/span\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#項目毎に分割\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eitems\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efindAll\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'td'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#左側から数えて何番目のitemか、ということで場合分けして処理する\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#時（いま何時！？？）\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ehour\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehour\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e'24'\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"c1\"\u003e#24時は、次の日の0時にする\n\u003c/span\u003e            \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%s-%s-%s'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#次の日の日付\n\u003c/span\u003e            \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%s-%s-%s %s:0:0'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'0'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%s-%s-%s %s:0:0'\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eyear\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emonth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eday\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#気圧(地表)(hPa)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#気圧(海面)(hPa)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#降水量(mm)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#気温(℃)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#露点湿度(℃)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#蒸気圧(hPa)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#湿度(%)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#風速(m/s)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#風向\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekanji_direction_to_degree\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#日照時間(h)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#全天日射量(MJ/m2)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#降雪(cm)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#積雪(cm)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_z\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#天気\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eweather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e''\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#空欄だったら''をあてはめる\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"c1\"\u003e#imgタグを取得\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e#データが入っていればalt属性を取得する\n\u003c/span\u003e            \u003cspan class=\"n\"\u003eweather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'alt'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#雲量\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e#空欄だったらNoneをあてはめる\n\u003c/span\u003e            \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n        \n        \u003cspan class=\"c1\"\u003e#視程(km)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estr2float_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e# itemを処理し終わったので、辞書にまとめる\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eh_weather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e   \u003cspan class=\"s\"\u003e'date_time'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e   \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e  \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'pressure_ground'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                        \u003cspan class=\"s\"\u003e'pressure_sea'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                        \u003cspan class=\"s\"\u003e'rainfall'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'temperature'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'dew_point_humidity'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'vapor_pressure'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'humidity'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'windspeed_value'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'windspeed_direction'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'sunshine_hours'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'global_solar_radiation'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'snowfall'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'snowdepth'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'weather'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eweather\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'cloud_amount'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003e'visibility'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e\n                         \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#辞書データを配列に追加する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ed_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ed_weather\u003c/span\u003e\n    \n\u003cspan class=\"c1\"\u003e#DBの認証情報をファイルから読み取る\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eread_auth\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"r\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eauth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eauth\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#DBMSに接続する\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003econnect_dbms\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eauth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eread_auth\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"auth.json\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edbms_username\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eauth\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'username'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edbms_password\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eauth\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'password'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econ\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epsycopg2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edbms_hostname\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eport\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edbms_port\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003edatabase\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003edbms_database_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edbms_username\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n            \u003cspan class=\"n\"\u003epassword\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003edbms_password\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003econ\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 指定日・指定場所のデータがすでにDBに登録されているかチェックする\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003echeck_already_inserted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#指定日の1時から、次の日の0時までの範囲で検索するためにタイムスタンプデータを作る\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edt_start\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 1:0:0 JST\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edt_end\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" 0:0:0 JST\"\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#カーソルを取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#クエリを発行する。指定日（の1時～次の日の0時の範囲）・指定場所のレコード数をクエリする\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'SELECT count(*) FROM weather_hourly_table WHERE \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e        date_time \u0026gt; %s and date_time \u0026lt; %s and prec_no = %s and block_no = %s'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n        \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edt_start\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edt_end\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#取得出来たデータ（指定場所のレコード数）を取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003erecord_count\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efetchone\u003c/span\u003e\u003cspan class=\"p\"\u003e()[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#レコード数が0を越えていれば登録ありとしてTrue、0ならFalseを返す\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erecord_count\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#登録あり\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e \u003cspan class=\"c1\"\u003e#登録なし\n\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#1時間毎のデータをDBに登録する\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einsert_hourly_weather_into_db\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#cursorの取得\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# timestampをDBに登録するときは、日本標準時で登録することを指示する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e          \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'date_time'\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'%Y-%m-%d %H:%M:%S'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\" JST\"\u003c/span\u003e \u003cspan class=\"c1\"\u003e#測定日時\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e            \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#地域コード\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#地点コード\n\u003c/span\u003e    \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'pressure_ground'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#気圧(地表)(hPa)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e       \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'pressure_sea'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#気圧(海面)(hPa)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'rainfall'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#降水量(mm)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'temperature'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e          \u003cspan class=\"c1\"\u003e#気温(℃)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'dew_point_humidity'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e   \u003cspan class=\"c1\"\u003e#露点湿度(℃)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'vapor_pressure'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e       \u003cspan class=\"c1\"\u003e#蒸気圧(hPa)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'humidity'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e             \u003cspan class=\"c1\"\u003e#湿度(%)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'windspeed_value'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e      \u003cspan class=\"c1\"\u003e#風速(m/s)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'windspeed_direction'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#風向\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'sunshine_hours'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#日照時間(h)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'global_solar_radiation'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#全天日射量(MJ/m2)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e          \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'snowfall'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#降雪(cm)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e         \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'snowdepth'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e       \u003cspan class=\"c1\"\u003e#積雪(cm)\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eweather\u003c/span\u003e           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'weather'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e         \u003cspan class=\"c1\"\u003e#天気\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'cloud_amount'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#雲量\n\u003c/span\u003e    \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'visibility'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e      \u003cspan class=\"c1\"\u003e#視程(km)\n\u003c/span\u003e\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n        \u003cspan class=\"c1\"\u003e#クエリを実行する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ecursor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexecute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'INSERT INTO weather_hourly_table (date_time, prec_no, block_no, pressure_ground, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    pressure_sea, rainfall, temperature, dew_point_humidity, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    vapor_pressure, humidity, windspeed_value, windspeed_direction, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    sunshine_hours, global_solar_radiation, snowfall, snowdepth, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    weather, cloud_amount, visibility) \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                    VALUES( %s, %s,  %s, %s, %s,   %s,   %s,   %s,   %s, %s, \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e                            %s,     %s,      %s,   %s, %s, %s, %s, %s, %s)'\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003edate_time\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epressure_ground\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003epressure_sea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erainfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etemperature\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edew_point_humidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003evapor_pressure\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_value\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewindspeed_direction\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003esunshine_hours\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_solar_radiation\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowfall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esnowdepth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n                    \u003cspan class=\"n\"\u003eweather\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecloud_amount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evisibility\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e)\u003c/span\u003e \n                        \n        \u003cspan class=\"c1\"\u003e#反映する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003econnector\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecommit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#登録失敗\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#登録成功\n\u003c/span\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#main関数\n\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__main__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eprintmsg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Weather Hourly Scraper Started.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Weather Hourly Scraper Started.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#DBに接続する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003econn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnect_dbms\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econn\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprintmsg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'Could not connect DB.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprintlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'ERROR'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Could not connect DB.'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#データを取得する場所のリストを読み込む\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eget_place_to_fetch\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003edate_start\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'2022-9-9'\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#データを取得する最初の日付\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edate_back\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e           \u003cspan class=\"c1\"\u003e#何日遡ってデータを取得するか\n\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#登録したレコードの数\n\u003c/span\u003e    \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#処理した地点・地域の数\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#場所毎にループする\n\u003c/span\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eplace\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#場所の情報を辞書から取り出す\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'place_name'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#日付データをdtに変換する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate_start\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'%Y-%m-%d'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#何日目のデータか、を初期化する\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eday_count\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#ループの冒頭で１日遡るので、１日進めておく\n\u003c/span\u003e        \u003cspan class=\"c1\"\u003e#(Cスタイルのfor文が使えればこんなことしない)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e#無限ループだが、ちゃんと脱出条件あり\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e#指定日数分だけ遡って取得する\n\u003c/span\u003e            \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etimedelta\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#1日ずつ遡る\n\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eday_count\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eday_count\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e#指定した日数遡ったら、次の場所に行く\n\u003c/span\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eday_count\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003edate_back\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e \u003cspan class=\"c1\"\u003e#次の場所へ\n\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e#この日のデータがすでに登録されているか\n\u003c/span\u003e            \u003cspan class=\"n\"\u003ealready_exists\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003echeck_already_inserted\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e#すでに登録されていたら、その日はスキップする\n\u003c/span\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealready_exists\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \n                \u003cspan class=\"n\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Data alredy exists on DB'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#この日はスキップ\n\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Fetching data for '\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \n            \u003cspan class=\"c1\"\u003e#指定した日付、場所の1時間毎のデータを読み込む\n\u003c/span\u003e            \u003cspan class=\"n\"\u003edaily_weather\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efetch_daily_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e#ちゃんとデータが取得出来たかチェックする\n\u003c/span\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edaily_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e23\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e#データが取得できていた場合は、登録する\n\u003c/span\u003e                \u003cspan class=\"n\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Inserting data for :'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edaily_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003einsert_hourly_weather_into_db\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehourly_weather\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Data Inserted for:'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#10秒やすみ。サーバへの気遣い\n\u003c/span\u003e            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e#取得出来ていない場合は、登録しない\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e#データが取得出来ないのは、その場所の測定データが無いものと考える\n\u003c/span\u003e                \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#10秒やすみ。サーバへの気遣い\n\u003c/span\u003e                \u003cspan class=\"n\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'No data exists  for: '\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e#その場所のエラー回数をインクリメントする\n\u003c/span\u003e                \u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'error_count'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplace\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'error_count'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e \u003cspan class=\"c1\"\u003e#この場所はあきらめる、次の場所へ\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e#場所データのエラー回数を含めたデータを書き出しておく\n\u003c/span\u003e        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplace_list_with_err_file_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'w'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ecsvfile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecsv\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDictWriter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecsvfile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efieldnames\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'prec_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'block_no'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'place_name'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'error_count'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ewriter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewriterows\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplace_list\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e#全データ取得終了\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eshow_progress\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'MESSAGE'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'Fetching done.'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eprec_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eblock_no\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eplace_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_records\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etotal_inserted_places\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"884:1-884:6\"\u003e以上\u003c/p\u003e\n","body":"# はじめに\n過去に投稿した下記の記事の続編です。今度は1時間ごとのデータをスクレイピングします。\n - [気象庁の1日毎の過去の気象データをPythonでスクレイピングしてPostgreSQLにINSERTしてみた]( https://qiita.com/hase-k0x01/items/491d2d80596e014eb7d3)\n\n## やること\n - 気象庁の1時間ごとの気象データをスクレイピングする\n - 取得したデータをPostgreSQLのDBにINSERTする\n \n \n## 環境等\n - プログラミング言語: Python3.10\n - DBサーバ: Amazon AWS RDB\n - 実行環境: Amazon AWS EC2\n - スクレイピングに使うライブラリ: BeautifulSoup\n\n## 参考にした情報\n制作にあたり、以下の記事と記載のコードを参考にさせていただきました。\n - [GoogleColaboratoryで気象庁の過去気象データをスクレイピングしてみた。](https://qiita.com/Cyber_Hacnosuke/items/122cec35d299c4d01f10)\n - [気象データの観測地点一覧　（2017年3月時点）](http://k-ichikawa.blog.enjoy.jp/etc/HP/htm/jmaP0.html)\n\n# スクレイピングするデータを観察する\n## 気象庁のWEBサイトを見てみる\n気象庁のWEBサイトをGoogleで検索して開きます。「ホーム\u003e各種データ・資料\u003e過去の気象データ検索」と辿っていくと、下記のURLに行き当たります。なんかいかにもパラメータを入れてくださいと言わんばかりです。\n- https://www.data.jma.go.jp/obd/stats/etrn/index.php?prec_no=\u0026block_no=\u0026year=\u0026month=\u0026day=\u0026view=\n\n\n場所とか日付を選んでいくと、パラメータが埋まっていきます。最後に、「～1時間毎の値を表示」をクリックすると次の画面に進みます。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/04892230-1049-f8f7-bbe4-078b1418ecf6.png)\n\n## データがどうなっているのか見てみる\nデータの表示こんなふうになります。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/1b1c4a8c-f77e-ed03-b73d-cd4371937589.png)\n\nこのときにアドレスバーに表示されているURLは次のようになります。\n - (https://www.data.jma.go.jp/obd/stats/etrn/view/hourly_s1.php?prec_no=14\u0026block_no=47412\u0026year=2021\u0026month=12\u0026day=31\u0026view=)\n\nスクレイピングしやすそうなデータです。しかし、\"--\"が当てはめられているセルや空白のセルがあります。「天気」の欄は天気記号という記号になっていて、画像データが当てはまっています。\n\n## ページのソースを見てみる\nスクレイピングしやすそうなデータです。BeautifulSoupに放り込めば、うまい感じに切り分けてくれそうです。\n気象データがあるところのclassは\"mtx\"になっているようです。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/745f95b7-babf-9521-82ae-20b5fa79a1a8.png)\n\n「天気」の欄は、次のようなコードになっていました。天気欄は結構重要なデータなんですが、画像データが当てはめられていて、そのままだとデータを取り込めませんが、alt属性には天気概況がそのまま書いてありました。天気欄は、alt属性を使えば良さそうです。\n```\n\u003cimg src=\"../../data/image/tenki/large/F8A0.gif\" alt=\"晴れ\"\u003e\u003c/td\u003e\n```\n\n\n# コードとDBの概要\n\n## 今回つくったプログラムでやること\n\nこのことをやっています\n - 1時間ごとの気象データを取得する\n - 取得したデータをDBに登録する\n - 取得する対象の日を求める\n   - 取得する最初の日を求め、そこから1日ずつ遡っていく\n - 取得する対象の地点を求める\n   - 地点情報はCSVに書いておいて読み出していく\n\n## DB構造\nDBは前回同様PostgreSQLでやってます。1日毎のデータのそれぞれの項目をDBのフィールドとします。\n\nテーブル構造はこんな感じにしました。\n```\nCREATE TABLE weather_hourly_table(\n    id SERIAL PRIMARY       KEY ,\n    date_time               TIMESTAMP WITH TIME ZONE,\n    prec_no\t\t\t        INTEGER,\n    block_no\t\t        INTEGER,\n    pressure_ground         REAL,\n    pressure_sea            REAL,\n    rainfall                REAL,\n    temperature             REAL,\n    dew_point_humidity      REAL,\n    vapor_pressure          REAL,\n    humidity                REAL,\n    windspeed_value         REAL,\n    windspeed_direction     INTEGER,\n    sunshine_hours          REAL,\n    global_solar_radiation  REAL,\n    snowfall                REAL,\n    snowdepth               REAL,\n    weather                 VARCHAR(100),\n    cloud_amount            VARCHAR(100) ,\n    visibility              REAL\n);\n\n```\n\n\n# 実際のコード\n\n\n## スクレイピングをする部分のコード\nスクレイピングをおこなう部分を関数にまとめました。取得した日付と2種類の地点情報を引数に渡すと、その日の気象データを辞書の配列で返します。配列の各要素は1時間ごとの気象データを辞書形式にしたものです。\n\n各セルのデータはBeautifulSoupが分解してくれます。\n文字列で表現できるところは、そのまま文字列で取り込みます。\n数値の部分は、変換してfloatとかにしないといけません。しかし、セルの値が\"--\"とか空欄になっている部分があり、これについての処理を考える必要があります。\n\n次のように方針を考えます。\n - 「降水量」の欄に\"--\"となっているデータがあります。測定限界以下、もしくは雨がふらなかった、と解釈して問題なさそうです。というわけで、数値以外のデータが現れたら0.0として処理するようにします。「降雪量」に関しても同様に考えていいでしょう。\n - 「視程」「日照時間」のデータは、空欄になっている部分があります。このようなデータは 0 とか、デフォルト値を当てはめてしまうと意味が変わってしまうので、空欄のまま登録します。\n\n\n天気の部分は、画像データが当てはめられています。先述のとおり、alt属性が埋め込まれていましたので、alt属性をそのまま利用することにしました。\n\n``` .py\n# 気象庁のWEBサイトから指定日・指定場所の１時間毎の天気データを取得する\n# 取得したデータは辞書形式の配列で返す\ndef fetch_daily_weather(date, prec_no, block_no):\n    #date_f = dt.strptime(date, '%Y-%m-%d')\n\n    # 日付データを取り込む\n    year = date.year\n    month = date.month\n    day = date.day\n\n    try:\n        #指定URLからHTMLデータを取得する\n        r = requests.get(base_url % (prec_no, block_no, year, month, day))\n        r.encoding = r.apparent_encoding\n        #取得したデータをBeautifulSoupで解析する\n        soup = BeautifulSoup(r.text, 'html.parser')\n        rows = soup.findAll('tr', class_='mtx')\n    except:\n        return [] #空の配列を返す\n    \n    #最初の２行は見出しなので削除する\n    rows = rows[2:]\n\n    #時間毎の気象データは配列に格納。\n    #格納する配列を初期化する\n    d_weather = []\n\n    #時間ごとに分割\n    for row in rows:\n        #項目毎に分割\n        items = row.findAll('td')\n\n        #左側から数えて何番目のitemか、ということで場合分けして処理する\n\n        #時（いま何時！？？）\n        hour = items[0].text\n        if(hour == '24'): #24時は、次の日の0時にする\n            d = dt.strptime('%s-%s-%s' % (year, month, day), '%Y-%m-%d')\n            d = d + timedelta(1) #次の日の日付\n            date_time = dt.strptime('%s-%s-%s %s:0:0' % (d.year, d.month, d.day, '0'), '%Y-%m-%d %H:%M:%S')\n        else:\n            date_time = dt.strptime('%s-%s-%s %s:0:0' % (year, month, day, items[0].text), '%Y-%m-%d %H:%M:%S')\n\n        #気圧(地表)(hPa)\n        pressure_ground = str2float_n(items[1].text)\n        #気圧(海面)(hPa)\n        pressure_sea    = str2float_n(items[2].text)\n        #降水量(mm)\n        rainfall = str2float_z(items[3].text)\n        #気温(℃)\n        temperature = str2float_n(items[4].text)\n        #露点湿度(℃)\n        dew_point_humidity = str2float_z(items[5].text)\n        #蒸気圧(hPa)\n        vapor_pressure = str2float_n(items[6].text)\n        #湿度(%)\n        humidity = str2float_n(items[7].text)\n        #風速(m/s)\n        windspeed_value = str2float_n(items[8].text)\n        #風向\n        windspeed_direction = kanji_direction_to_degree(items[9].text)\n        #日照時間(h)\n        sunshine_hours = str2float_z(items[10].text)\n        #全天日射量(MJ/m2)\n        global_solar_radiation = str2float_z(items[11].text)\n        #降雪(cm)\n        snowfall = str2float_z(items[12].text)\n        #積雪(cm)\n        snowdepth = str2float_z(items[13].text)\n\n        #天気\n        weather = ''  #空欄だったら''をあてはめる\n        img = items[14].img #imgタグを取得\n        if(img):\n            #データが入っていればalt属性を取得する\n            weather =  img.attrs.get('alt', '')\n\n        #雲量\n        if(len(items[15].text) \u003e 0):\n            cloud_amount = items[15].text\n        else:\n            #空欄だったらNoneをあてはめる\n            cloud_amount = None\n        \n        #視程(km)\n        visibility = str2float_n(items[16].text)\n\n        # itemを処理し終わったので、辞書にまとめる\n        h_weather = {   'date_time' : date_time,\n                        'prec_no'   : prec_no,\n                        'block_no'  : block_no,\n                        'pressure_ground': pressure_ground, \n                        'pressure_sea': pressure_sea, \n                        'rainfall' : rainfall,\n                        'temperature' : temperature,\n                        'dew_point_humidity' : dew_point_humidity,\n                        'vapor_pressure' : vapor_pressure,\n                        'humidity' : humidity,\n                        'windspeed_value' : windspeed_value,\n                        'windspeed_direction' : windspeed_direction,\n                        'sunshine_hours' : sunshine_hours,\n                        'global_solar_radiation' : global_solar_radiation,\n                        'snowfall' : snowfall,\n                        'snowdepth' : snowdepth,\n                        'weather' : weather,\n                        'cloud_amount' : cloud_amount,\n                        'visibility' : visibility\n                         }\n        #辞書データを配列に追加する\n        d_weather.append(h_weather)\n    return d_weather\n    \n```\n\n## DBにINSERTするコード\nこれも関数にまとめました。\n1レコード分のデータは1時間毎のデータとして、これを引数にするとDBにINSERTします。\n辞書からデータを取り出して、フィールドにあてはめてINSERTするだけです。\n日付・時刻のデータには日本標準時だとわかるように\"JST\"を付加して登録しました。\n\n``` .py\n#1時間毎のデータをDBに登録する\ndef insert_hourly_weather_into_db(connector, hourly_weather):\n    #cursorの取得\n    cursor = connector.cursor()\n    # timestampをDBに登録するときは、日本標準時で登録することを指示する\n    date_time          = hourly_weather['date_time'].strftime('%Y-%m-%d %H:%M:%S') + \" JST\" #測定日時\n    prec_no            = hourly_weather['prec_no']  #地域コード\n    block_no           = hourly_weather['block_no'] #地点コード\n    pressure_ground    = hourly_weather['pressure_ground'] #気圧(地表)(hPa)\n    pressure_sea       = hourly_weather['pressure_sea']    #気圧(海面)(hPa)\n    rainfall           = hourly_weather['rainfall']        #降水量(mm)\n    temperature        = hourly_weather['temperature']          #気温(℃)\n    dew_point_humidity = hourly_weather['dew_point_humidity']   #露点湿度(℃)\n    vapor_pressure     = hourly_weather['vapor_pressure']       #蒸気圧(hPa)\n    humidity           = hourly_weather['humidity']             #湿度(%)\n    windspeed_value    = hourly_weather['windspeed_value']      #風速(m/s)\n    windspeed_direction = hourly_weather['windspeed_direction']  #風向\n    sunshine_hours     = hourly_weather['sunshine_hours']        #日照時間(h)\n    global_solar_radiation = hourly_weather['global_solar_radiation']  #全天日射量(MJ/m2)\n    snowfall          = hourly_weather['snowfall']        #降雪(cm)\n    snowdepth         = hourly_weather['snowdepth']       #積雪(cm)\n    weather           = hourly_weather['weather']         #天気\n    cloud_amount      = hourly_weather['cloud_amount']    #雲量\n    visibility        = hourly_weather['visibility']      #視程(km)\n\n    try: \n        #クエリを実行する\n        cursor.execute('INSERT INTO weather_hourly_table (date_time, prec_no, block_no, pressure_ground, \\\n                    pressure_sea, rainfall, temperature, dew_point_humidity, \\\n                    vapor_pressure, humidity, windspeed_value, windspeed_direction, \\\n                    sunshine_hours, global_solar_radiation, snowfall, snowdepth, \\\n                    weather, cloud_amount, visibility) \\\n                    VALUES( %s, %s,  %s, %s, %s,   %s,   %s,   %s,   %s, %s, \\\n                            %s,     %s,      %s,   %s, %s, %s, %s, %s, %s)'\n                    , (\n                    date_time, prec_no, block_no, pressure_ground, \n                    pressure_sea, rainfall, temperature, dew_point_humidity, \n                    vapor_pressure, humidity, windspeed_value, windspeed_direction, \n                    sunshine_hours, global_solar_radiation, snowfall, snowdepth, \n                    weather, cloud_amount, visibility)\n                    ) \n                        \n        #反映する\n        connector.commit()\n    except:\n        #登録失敗\n        return False\n    #登録成功\n    return True\n```\n\n## すでに登録済みかチェックする\nDBにINSERTする前に、その日・その地点のデータがすでにDBに登録されているかどうかをチェックすることにしました。\nプログラムが途中でクラッシュして、どこまで登録したかわからなくなって再実行するときも、二重登録しなくてすみます。\n\n``` .py\n# 指定日・指定場所のデータがすでにDBに登録されているかチェックする\ndef check_already_inserted(connector, date, prec_no, block_no):\n    #指定日の1時から、次の日の0時までの範囲で検索するためにタイムスタンプデータを作る\n    dt_start = date.strftime('%Y-%m-%d') + \" 1:0:0 JST\"\n    dt_end   = (date + timedelta(1) ).strftime('%Y-%m-%d') + \" 0:0:0 JST\"\n\n    #カーソルを取得\n    cursor = connector.cursor()\n    #クエリを発行する。指定日（の1時～次の日の0時の範囲）・指定場所のレコード数をクエリする\n    cursor.execute('SELECT count(*) FROM weather_hourly_table WHERE \\\n        date_time \u003e %s and date_time \u003c %s and prec_no = %s and block_no = %s', \n        (dt_start, dt_end,prec_no, block_no))\n    #取得出来たデータ（指定場所のレコード数）を取得\n    record_count = cursor.fetchone()[0]\n\n    #レコード数が0を越えていれば登録ありとしてTrue、0ならFalseを返す\n    if(record_count \u003e 0):\n        return True  #登録あり\n    else:\n        return False #登録なし\n```\n\n## データの変換など\nデータの変換をおこなう関数をつくっています。\n - str2float_z(): 文字列 -\u003e float 変換で、float変換できない場合は 0.0 として変換する\n - str2float_n(): 文字列 -\u003e float 変換で、float変換できない場合は None として変換する(DBにはNull値として登録)\n - kanji_direction_to_degree(): 方角は「東北東」というような表現なので、北を0度として整数値で表す\n\n``` .py\n\n#取得したデータの変換: 方角を整数値に変換、北を0°として360°で表記\ndef kanji_direction_to_degree(kanji_direction):\n    direction = None\n\n    match   kanji_direction:\n        case '北北東':\n            direction = 23\n        case '東北東':\n            direction = 68           \n        case '東南東':\n            direction = 113\n        case '南南東':\n            direction = 158\n        case '南南西':\n            direction = 203\n        case '西南西':\n            direction = 248\n        case '西北西':\n            direction = 293\n        case '北北西':\n            direction = 335\n        case '北東':\n            direction = 45\n        case '南東':\n            direction = 135\n        case '南西':\n            direction = 225\n        case '北西':\n            direction = 315\n        case '北':\n            direction = 0\n        case '東':\n            direction = 90\n        case '南':\n            direction = 180\n        case '西':\n            direction = 270\n        case _:  #判別不能なデータがきたとき\n            direction = None\n    return direction\n\n#取得したデータの変換:  float型に変換する。変換できない文字は0.0で代用。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  測定結果が0とか測定限界以下だったんだな、って思って差し支えないデータはこっちを使う\n#  例: 降雨量、降雪量\n\ndef str2float_z(str):\n    try:\n        return float(str)\n    except:\n        return 0.0\n\n#取得したデータの変換: float型に変換する。変換できない場合はNoneを返す。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  0として考えると差し支えがあるデータの場合(つまり0と言うデータにも意味がある場合)は\n# こっちを使う。\n# #  例: 気温、気圧、湿度等\ndef str2float_n(str):\n    try:\n        return float(str)\n    except:\n        return None\n```\n\n\n## 場所データをCSVファイルから読み出す\n場所データは .csv ファイルに記録しています。\n場所データの読み出しは関数化しました。\nこの関数は、場所データを .csv ファイルから読み出して、場所データを辞書形式の配列で返します。ひとつの場所データの要素は、prec_no, block_no, place_name をキーとしています。\n\n``` .py\n# CSVから場所リストを取得して辞書の配列に入れて返す\ndef get_place_to_fetch():\n    #場所データをcsvから読み込み\n    csv_file = open(place_csv_file_name, 'r', encoding='utf-8', errors='', newline='' )\n    f = csv.reader(csv_file, delimiter=\",\", doublequote=True, lineterminator=\"\\r\\n\", quotechar='\"', skipinitialspace=True)\n    \n    header = next(f)\n    # 場所リストを初期化\n    place_list = []\n    for row in f:\n        # 場所データを辞書に設定\n        prec_no = int(row[3].strip(' '))  #地域コード\n        block_no = int(row[4].strip(' ')) #地点コード\n        place_name = row[2].strip(' ')    #地点名\n        place = { 'prec_no': prec_no, 'block_no' : block_no, 'place_name': place_name, 'error_count' : 0}\n        #場所を登録した辞書データを配列に追加\n        place_list.append(place)\n    csv_file.close()\n\n    # 場所リストを返却\n    return place_list\n```\n\n## その他\nAWS上でプログラムを実行するとき、日本標準時(JST)がうまく扱えないみたいなので、JSTを定義しないとうまくいきませんでした。\n\n``` .py\n#AWSでJSTを扱うためのtimezoneを定義\nJST = timezone(timedelta(hours=+9)) #timezoneの生成\n```\n\n\n# 実行例\n\nプログラムの出力はこんな感じ\n```\n$ python3 weather_scraper_hourly_fetch.py\n2022-09-18 21:29:38 UTC+09:00: Data Inserted for:date: 2022-09-08 00:00:00, prec_no: 31, block_no: 47581, place_name: 八戸, records: 1056, places: 299.\n```\n\nINSERTされたデータをSELECTしてみました。ちゃんと登録されているようです。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/e681fe8e-396d-7729-bdb1-42040102f5d3.png)\n\n\n\n# コードの全文\n主要な部分の説明は異常です。\nコードの全文を掲載します。\n\n``` weather_scraper_hourly_fetch.py\nfrom bs4 import BeautifulSoup  \n\nimport csv\nimport json\nimport requests\nimport psycopg2\nfrom datetime import datetime  as dt, timedelta, datetime, timezone\nimport codecs\nimport time\nfrom urllib.error import HTTPError\nfrom urllib.error import URLError\nimport sys\n\n#地点データのcsvファイル名\nplace_csv_file_name = './place.csv'\n\n#地点データを読み込んだ辞書データには、その地点のエラー情報が含まれているが、それらを保存しておくファイル名\nplace_list_with_err_file_name = 'xxxxxx.csv'\n\n#気象庁の時間毎のデータを取得するためのURL\nbase_url=\"https://www.data.jma.go.jp/obd/stats/etrn/view/hourly_s1.php?prec_no=%s\u0026block_no=%s\u0026year=%s\u0026month=%s\u0026day=%s\u0026view=p1\"\n\n#AWSでJSTを扱うためのtimezoneを定義\nJST = timezone(timedelta(hours=+9)) #timezoneの生成\n\n#SQLサーバの情報\ndbms_hostname = 'xxxxxx.example.com'\ndbms_port = 999999\ndbms_database_name ='xxxxxx'\n\n#SQLサーバに接続するためのユーザ名とパスワード情報を保存したファイル名\ndb_auth_filename = 'xxxxxx.json'\n\n#logfile名\nlogfile_name = \"./xxxxxxxx.log\"\n\n\n# CSVから場所リストを取得して辞書の配列に入れて返す\ndef get_place_to_fetch():\n    #場所データをcsvから読み込み\n    csv_file = open(place_csv_file_name, 'r', encoding='utf-8', errors='', newline='' )\n    f = csv.reader(csv_file, delimiter=\",\", doublequote=True, lineterminator=\"\\r\\n\", quotechar='\"', skipinitialspace=True)\n    \n    header = next(f)\n    # 場所リストを初期化\n    place_list = []\n    for row in f:\n        # 場所データを辞書に設定\n        prec_no = int(row[3].strip(' '))  #地域コード\n        block_no = int(row[4].strip(' ')) #地点コード\n        place_name = row[2].strip(' ')    #地点名\n        place = { 'prec_no': prec_no, 'block_no' : block_no, 'place_name': place_name, 'error_count' : 0}\n        #場所を登録した辞書データを配列に追加\n        place_list.append(place)\n    csv_file.close()\n\n    # 場所リストを返却\n    return place_list\n\n#ログファイルに追記する\ndef printlog(label_str, body_str):\n    print(datetime.now(JST), ',' ,label_str, ',', body_str,\n                            file =  codecs.open(logfile_name, 'a', 'utf-8'))\n\n#端末に印字する（文字が流れていかないように1行で上書きする）\ndef printmsg(msg):\n    print('\\r_________________________________________________________________________________________________________________________________' , end='')\n    print('\\r%s: %s' % (datetime.now(JST).strftime('%Y-%m-%d %H:%M:%S %Z'), msg), end='')\n\n# 進捗を表示する(端末に印字し、ログファイルに記録する)\ndef show_progress(label, message, date, prec_no, block_no, place_name, inserted_records, inserted_places):\n    printmsg(message +'date: %s, prec_no: %s, block_no: %s, place_name: %s, records: %s, places: %s.' % (date, prec_no, block_no, place_name, inserted_records, inserted_places))\n    printlog(label, message + 'date: %s, prec_no: %s, block_no: %s, place_name: %s, records: %s, places: %s.' % (date, prec_no, block_no, place_name, inserted_records, inserted_places))\n\n\n#取得したデータの変換: 方角を整数値に変換、北を0°として360°で表記\ndef kanji_direction_to_degree(kanji_direction):\n    direction = None\n\n    match   kanji_direction:\n        case '北北東':\n            direction = 23\n        case '東北東':\n            direction = 68           \n        case '東南東':\n            direction = 113\n        case '南南東':\n            direction = 158\n        case '南南西':\n            direction = 203\n        case '西南西':\n            direction = 248\n        case '西北西':\n            direction = 293\n        case '北北西':\n            direction = 335\n        case '北東':\n            direction = 45\n        case '南東':\n            direction = 135\n        case '南西':\n            direction = 225\n        case '北西':\n            direction = 315\n        case '北':\n            direction = 0\n        case '東':\n            direction = 90\n        case '南':\n            direction = 180\n        case '西':\n            direction = 270\n        case _:  #判別不能なデータがきたとき\n            direction = None\n    return direction\n\n#取得したデータの変換:  float型に変換する。変換できない文字は0.0で代用。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  測定結果が0とか測定限界以下だったんだな、って思って差し支えないデータはこっちを使う\n#  例: 降雨量、降雪量\n\ndef str2float_z(str):\n    try:\n        return float(str)\n    except:\n        return 0.0\n\n#取得したデータの変換: float型に変換する。変換できない場合はNoneを返す。\n#※観測データのうち、データが無い（または変換不能なデータが当てはめられている）のは\n#  0として考えると差し支えがあるデータの場合(つまり0と言うデータにも意味がある場合)は\n# こっちを使う。\n# #  例: 気温、気圧、湿度等\ndef str2float_n(str):\n    try:\n        return float(str)\n    except:\n        return None\n\n\n# 気象庁のWEBサイトから指定日・指定場所の１時間毎の天気データを取得する\n# 取得したデータは辞書形式の配列で返す\ndef fetch_daily_weather(date, prec_no, block_no):\n    #date_f = dt.strptime(date, '%Y-%m-%d')\n\n    # 日付データを取り込む\n    year = date.year\n    month = date.month\n    day = date.day\n\n    try:\n        #指定URLからHTMLデータを取得する\n        r = requests.get(base_url % (prec_no, block_no, year, month, day))\n        r.encoding = r.apparent_encoding\n        #取得したデータをBeautifulSoupで解析する\n        soup = BeautifulSoup(r.text, 'html.parser')\n        rows = soup.findAll('tr', class_='mtx')\n    except:\n        return [] #空の配列を返す\n    \n    #最初の２行は見出しなので削除する\n    rows = rows[2:]\n\n    #時間毎の気象データは配列に格納。\n    #格納する配列を初期化する\n    d_weather = []\n\n    #時間ごとに分割\n    for row in rows:\n        #項目毎に分割\n        items = row.findAll('td')\n\n        #左側から数えて何番目のitemか、ということで場合分けして処理する\n\n        #時（いま何時！？？）\n        hour = items[0].text\n        if(hour == '24'): #24時は、次の日の0時にする\n            d = dt.strptime('%s-%s-%s' % (year, month, day), '%Y-%m-%d')\n            d = d + timedelta(1) #次の日の日付\n            date_time = dt.strptime('%s-%s-%s %s:0:0' % (d.year, d.month, d.day, '0'), '%Y-%m-%d %H:%M:%S')\n        else:\n            date_time = dt.strptime('%s-%s-%s %s:0:0' % (year, month, day, items[0].text), '%Y-%m-%d %H:%M:%S')\n\n        #気圧(地表)(hPa)\n        pressure_ground = str2float_n(items[1].text)\n        #気圧(海面)(hPa)\n        pressure_sea    = str2float_n(items[2].text)\n        #降水量(mm)\n        rainfall = str2float_z(items[3].text)\n        #気温(℃)\n        temperature = str2float_n(items[4].text)\n        #露点湿度(℃)\n        dew_point_humidity = str2float_z(items[5].text)\n        #蒸気圧(hPa)\n        vapor_pressure = str2float_n(items[6].text)\n        #湿度(%)\n        humidity = str2float_n(items[7].text)\n        #風速(m/s)\n        windspeed_value = str2float_n(items[8].text)\n        #風向\n        windspeed_direction = kanji_direction_to_degree(items[9].text)\n        #日照時間(h)\n        sunshine_hours = str2float_z(items[10].text)\n        #全天日射量(MJ/m2)\n        global_solar_radiation = str2float_z(items[11].text)\n        #降雪(cm)\n        snowfall = str2float_z(items[12].text)\n        #積雪(cm)\n        snowdepth = str2float_z(items[13].text)\n\n        #天気\n        weather = ''  #空欄だったら''をあてはめる\n        img = items[14].img #imgタグを取得\n        if(img):\n            #データが入っていればalt属性を取得する\n            weather =  img.attrs.get('alt', '')\n\n        #雲量\n        if(len(items[15].text) \u003e 0):\n            cloud_amount = items[15].text\n        else:\n            #空欄だったらNoneをあてはめる\n            cloud_amount = None\n        \n        #視程(km)\n        visibility = str2float_n(items[16].text)\n\n        # itemを処理し終わったので、辞書にまとめる\n        h_weather = {   'date_time' : date_time,\n                        'prec_no'   : prec_no,\n                        'block_no'  : block_no,\n                        'pressure_ground': pressure_ground, \n                        'pressure_sea': pressure_sea, \n                        'rainfall' : rainfall,\n                        'temperature' : temperature,\n                        'dew_point_humidity' : dew_point_humidity,\n                        'vapor_pressure' : vapor_pressure,\n                        'humidity' : humidity,\n                        'windspeed_value' : windspeed_value,\n                        'windspeed_direction' : windspeed_direction,\n                        'sunshine_hours' : sunshine_hours,\n                        'global_solar_radiation' : global_solar_radiation,\n                        'snowfall' : snowfall,\n                        'snowdepth' : snowdepth,\n                        'weather' : weather,\n                        'cloud_amount' : cloud_amount,\n                        'visibility' : visibility\n                         }\n        #辞書データを配列に追加する\n        d_weather.append(h_weather)\n    return d_weather\n    \n#DBの認証情報をファイルから読み取る\ndef read_auth(filename):\n    file = open(filename, \"r\")\n    auth = json.load(file)\n    file.close()\n\n    return auth\n\n#DBMSに接続する\ndef connect_dbms():\n    auth = read_auth(\"auth.json\")\n    dbms_username = auth['username']\n    dbms_password = auth['password']\n\n    try:\n        con = psycopg2.connect(\n            host = dbms_hostname,\n            port = dbms_port,\n            database=dbms_database_name,\n            user= dbms_username, \n            password=dbms_password)\n    except:\n        return None\n\n    return con\n\n# 指定日・指定場所のデータがすでにDBに登録されているかチェックする\ndef check_already_inserted(connector, date, prec_no, block_no):\n    #指定日の1時から、次の日の0時までの範囲で検索するためにタイムスタンプデータを作る\n    dt_start = date.strftime('%Y-%m-%d') + \" 1:0:0 JST\"\n    dt_end   = (date + timedelta(1) ).strftime('%Y-%m-%d') + \" 0:0:0 JST\"\n\n    #カーソルを取得\n    cursor = connector.cursor()\n    #クエリを発行する。指定日（の1時～次の日の0時の範囲）・指定場所のレコード数をクエリする\n    cursor.execute('SELECT count(*) FROM weather_hourly_table WHERE \\\n        date_time \u003e %s and date_time \u003c %s and prec_no = %s and block_no = %s', \n        (dt_start, dt_end,prec_no, block_no))\n    #取得出来たデータ（指定場所のレコード数）を取得\n    record_count = cursor.fetchone()[0]\n\n    #レコード数が0を越えていれば登録ありとしてTrue、0ならFalseを返す\n    if(record_count \u003e 0):\n        return True  #登録あり\n    else:\n        return False #登録なし\n\n\n#1時間毎のデータをDBに登録する\ndef insert_hourly_weather_into_db(connector, hourly_weather):\n    #cursorの取得\n    cursor = connector.cursor()\n    # timestampをDBに登録するときは、日本標準時で登録することを指示する\n    date_time          = hourly_weather['date_time'].strftime('%Y-%m-%d %H:%M:%S') + \" JST\" #測定日時\n    prec_no            = hourly_weather['prec_no']  #地域コード\n    block_no           = hourly_weather['block_no'] #地点コード\n    pressure_ground    = hourly_weather['pressure_ground'] #気圧(地表)(hPa)\n    pressure_sea       = hourly_weather['pressure_sea']    #気圧(海面)(hPa)\n    rainfall           = hourly_weather['rainfall']        #降水量(mm)\n    temperature        = hourly_weather['temperature']          #気温(℃)\n    dew_point_humidity = hourly_weather['dew_point_humidity']   #露点湿度(℃)\n    vapor_pressure     = hourly_weather['vapor_pressure']       #蒸気圧(hPa)\n    humidity           = hourly_weather['humidity']             #湿度(%)\n    windspeed_value    = hourly_weather['windspeed_value']      #風速(m/s)\n    windspeed_direction = hourly_weather['windspeed_direction']  #風向\n    sunshine_hours     = hourly_weather['sunshine_hours']        #日照時間(h)\n    global_solar_radiation = hourly_weather['global_solar_radiation']  #全天日射量(MJ/m2)\n    snowfall          = hourly_weather['snowfall']        #降雪(cm)\n    snowdepth         = hourly_weather['snowdepth']       #積雪(cm)\n    weather           = hourly_weather['weather']         #天気\n    cloud_amount      = hourly_weather['cloud_amount']    #雲量\n    visibility        = hourly_weather['visibility']      #視程(km)\n\n    try: \n        #クエリを実行する\n        cursor.execute('INSERT INTO weather_hourly_table (date_time, prec_no, block_no, pressure_ground, \\\n                    pressure_sea, rainfall, temperature, dew_point_humidity, \\\n                    vapor_pressure, humidity, windspeed_value, windspeed_direction, \\\n                    sunshine_hours, global_solar_radiation, snowfall, snowdepth, \\\n                    weather, cloud_amount, visibility) \\\n                    VALUES( %s, %s,  %s, %s, %s,   %s,   %s,   %s,   %s, %s, \\\n                            %s,     %s,      %s,   %s, %s, %s, %s, %s, %s)'\n                    , (\n                    date_time, prec_no, block_no, pressure_ground, \n                    pressure_sea, rainfall, temperature, dew_point_humidity, \n                    vapor_pressure, humidity, windspeed_value, windspeed_direction, \n                    sunshine_hours, global_solar_radiation, snowfall, snowdepth, \n                    weather, cloud_amount, visibility)\n                    ) \n                        \n        #反映する\n        connector.commit()\n    except:\n        #登録失敗\n        return False\n    #登録成功\n    return True\n\n#main関数\nif __name__ == \"__main__\":\n\n    printmsg('Weather Hourly Scraper Started.')\n    printlog('MESSAGE', 'Weather Hourly Scraper Started.')\n\n    #DBに接続する\n    conn = connect_dbms()\n    if(conn == None):\n        printmsg('Could not connect DB.')\n        printlog('ERROR', 'Could not connect DB.')\n        exit(0)\n\n    #データを取得する場所のリストを読み込む\n    place_list = get_place_to_fetch()\n\n    date_start = '2022-9-9'  #データを取得する最初の日付\n    date_back  = 7           #何日遡ってデータを取得するか\n\n    total_inserted_records = 0  #登録したレコードの数\n    total_inserted_places  = 0  #処理した地点・地域の数\n\n    #場所毎にループする\n    for place in place_list:\n        total_inserted_places = total_inserted_places + 1\n\n        #場所の情報を辞書から取り出す\n        prec_no =  place['prec_no']\n        block_no = place['block_no']\n        place_name = place['place_name']\n\n        #日付データをdtに変換する\n        date = dt.strptime(date_start, '%Y-%m-%d')\n\n        #何日目のデータか、を初期化する\n        day_count = 0\n\n        #ループの冒頭で１日遡るので、１日進めておく\n        #(Cスタイルのfor文が使えればこんなことしない)\n        date = date + timedelta(1)\n\n        #無限ループだが、ちゃんと脱出条件あり\n        while(True):\n            #指定日数分だけ遡って取得する\n            date = date - timedelta(1) #1日ずつ遡る\n\n            day_count = day_count + 1\n\n            #指定した日数遡ったら、次の場所に行く\n            if(day_count \u003e date_back):\n                break #次の場所へ\n\n            #この日のデータがすでに登録されているか\n            already_exists = check_already_inserted(conn, date, prec_no, block_no )\n\n            #すでに登録されていたら、その日はスキップする\n            if(already_exists == True):  \n                show_progress('MESSAGE', 'Data alredy exists on DB', date, prec_no, block_no, place_name, total_inserted_records, total_inserted_places)\n                continue  #この日はスキップ\n\n            show_progress('MESSAGE', 'Fetching data for ', date, prec_no, block_no, place_name, total_inserted_records, total_inserted_places)\n        \n            #指定した日付、場所の1時間毎のデータを読み込む\n            daily_weather = fetch_daily_weather(date, prec_no, block_no)\n\n            #ちゃんとデータが取得出来たかチェックする\n            if(len(daily_weather) \u003e 23):\n                #データが取得できていた場合は、登録する\n                show_progress('MESSAGE', 'Inserting data for :', date, prec_no, block_no, place_name, total_inserted_records, total_inserted_places)\n                for hourly_weather in daily_weather:\n                    insert_hourly_weather_into_db(conn, hourly_weather)\n                    total_inserted_records = total_inserted_records + 1\n\n                show_progress('MESSAGE', 'Data Inserted for:', date, prec_no, block_no, place_name, total_inserted_records, total_inserted_places)\n                time.sleep(10)  #10秒やすみ。サーバへの気遣い\n            else:\n                #取得出来ていない場合は、登録しない\n                #データが取得出来ないのは、その場所の測定データが無いものと考える\n                time.sleep(10)  #10秒やすみ。サーバへの気遣い\n                show_progress('MESSAGE', 'No data exists  for: ', date, prec_no, block_no, place_name, total_inserted_records, total_inserted_places)\n\n                #その場所のエラー回数をインクリメントする\n                place['error_count'] = place['error_count'] + 1\n\n                break #この場所はあきらめる、次の場所へ\n\n        #場所データのエラー回数を含めたデータを書き出しておく\n        with open(place_list_with_err_file_name, 'w', encoding='utf-8') as csvfile:\n            writer = writer = csv.DictWriter(csvfile, fieldnames = ['prec_no', 'block_no', 'place_name', 'error_count'])\n            writer.writerows(place_list)\n\n    #全データ取得終了\n    show_progress('MESSAGE', 'Fetching done.', date, prec_no, block_no, place_name, total_inserted_records, total_inserted_places)\n```\n\n以上\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:32:54+09:00","group":null,"id":"ac9cf4af370369cae63d","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"SQL","versions":[]},{"name":"PostgreSQL","versions":[]},{"name":"スクレイピング","versions":[]},{"name":"天気","versions":[]}],"title":"気象庁の過去の1時間毎の気象データをPythonでスクレイピングしてPostgreSQLにINSERTしてみた","updated_at":"2022-09-18T21:32:54+09:00","url":"https://qiita.com/hase-k0x01/items/ac9cf4af370369cae63d","user":{"description":".","facebook_id":"","followees_count":4,"followers_count":5,"github_login_name":"hase-k0x01","id":"hase-k0x01","items_count":8,"linkedin_id":"","location":"Osaka, Japan.","name":"Koichi Hasegawa","organization":"","permanent_id":126400,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/126400/profile-images/1608266831","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:11\"\u003e\n\u003cspan id=\"前置き\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E7%BD%AE%E3%81%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前置き\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-4:54\"\u003eこの記事ではWaifu Diffusionを扱います。\u003cbr\u003e\n意外と知らずに使っている方もいるようなのでここで念押ししておきますが、Waifu Diffusionは\u003ca href=\"https://danbooru.donmai.us/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDanbooru\u003c/a\u003eという真っ黒もいいとこな無断転載天国サイトを学習データとして使っていると\u003ca href=\"https://github.com/harubaru/waifu-diffusion\" rel=\"nofollow noopener\" target=\"_blank\"\u003e明言\u003c/a\u003eしており、使用者の立場によっては不適切とみなされ炎上したりこういうサイトを容認してるという意思表示とみなされるリスクがあります。微妙な立場の人は\u003ca href=\"https://huggingface.co/naclbit/trinart_stable_diffusion_v2/blob/main/trinart2_step60000.ckpt\" rel=\"nofollow noopener\" target=\"_blank\"\u003eとりんさまモデル\u003c/a\u003eでも使ってた方が身のためですよ。\u003cbr\u003e\n知ったこっちゃないという人はどうぞ。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"6:1-6:8\"\u003e\n\u003cspan id=\"目的\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E7%9A%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目的\u003c/h1\u003e\n\u003cp data-sourcepos=\"7:1-10:116\"\u003eStable Diffusionやその派生で欲しい絵を描くワークフローは既に色々出回ってますが、これらは元々絵を描ける人が補助ツールとして使う方法という側面が強いです。\u003cbr\u003e\n棒人間すらまともにかけないヨドコロちゃんのようなカス画力の持ち主はPromptをいじり倒して呪文ガチャに祈るしかないのが黎明期のAI画でした。\u003cbr\u003e\nしかし今やimg2imgが各種GUIアプリでも標準搭載されるに至り、我々の手の届くところにあります。\u003cbr\u003e\ntxt2imgとimg2imgを組み合わせれば、特定のキャラデザに似せて描くことだってできます。\u003c/p\u003e\n\u003cp data-sourcepos=\"12:1-12:114\"\u003eこの記事では画力一切不要でそれっぽい絵を作るためのノウハウを書いていきます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"14:1-14:20\"\u003e\n\u003cspan id=\"用意するもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e用意するもの\u003c/h1\u003e\n\u003cul data-sourcepos=\"15:1-18:0\"\u003e\n\u003cli data-sourcepos=\"15:1-15:23\"\u003eVRAMいっぱいのPC\u003c/li\u003e\n\u003cli data-sourcepos=\"16:1-16:56\"\u003eNMKD Stable Diffusion GUI \u003ca href=\"https://nmkd.itch.io/t2i-gui\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://nmkd.itch.io/t2i-gui\u003c/a\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"17:1-18:0\"\u003eWaifu Diffusionモデル \u003ca href=\"https://huggingface.co/hakurei/waifu-diffusion\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://huggingface.co/hakurei/waifu-diffusion\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"19:1-21:151\"\u003eインストールについてはそのへんに解説があると思うので省略します。ていうか一目瞭然だから別に調べなくても普通に分かる。\u003cbr\u003e\nよくあるエラーとして、NMKDがFileNotFoundExceptionで止まったらモデルのDL失敗だから手動で適当に代わりを用意して置いてから再実行すればいいです。\u003cbr\u003e\nあと生成画像が緑一色になるやつはVRAMが足りないからLow memory modeにするべし。それでもだめならグラボを買え。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"23:1-23:8\"\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手順\u003c/h1\u003e\n\u003cp data-sourcepos=\"24:1-24:42\"\u003e以下の流れで作っていきます。\u003c/p\u003e\n\u003col data-sourcepos=\"25:1-33:0\"\u003e\n\u003cli data-sourcepos=\"25:1-25:45\"\u003e描きたい相手とシチュを決める\u003c/li\u003e\n\u003cli data-sourcepos=\"26:1-26:44\"\u003e適合するタグをDanbooruで集める\u003c/li\u003e\n\u003cli data-sourcepos=\"27:1-27:36\"\u003e集めたタグでpromptを作る\u003c/li\u003e\n\u003cli data-sourcepos=\"28:1-28:60\"\u003e「惜しい絵」が出るまで呪文ガチャを回す\u003c/li\u003e\n\u003cli data-sourcepos=\"29:1-29:63\"\u003e「惜しい絵」に加筆して各要素を正しくする\u003c/li\u003e\n\u003cli data-sourcepos=\"30:1-30:67\"\u003e加筆した絵を元にimg2imgで再度呪文ガチャを回す\u003c/li\u003e\n\u003cli data-sourcepos=\"31:1-31:38\"\u003e(必要なら)要素をコラする\u003c/li\u003e\n\u003cli data-sourcepos=\"32:1-33:0\"\u003e完成\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 data-sourcepos=\"34:1-34:45\"\u003e\n\u003cspan id=\"描きたい相手とシチュを決める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8F%8F%E3%81%8D%E3%81%9F%E3%81%84%E7%9B%B8%E6%89%8B%E3%81%A8%E3%82%B7%E3%83%81%E3%83%A5%E3%82%92%E6%B1%BA%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e描きたい相手とシチュを決める\u003c/h2\u003e\n\u003cp data-sourcepos=\"35:1-37:139\"\u003e相手というのは説明不要ですね。\u003cbr\u003e\nシチュというのは表情、場所、時間帯みたいなフワッとしたレベルの話です。\u003cbr\u003e\n細かいポージングとかは鬼門なので最初は諦めるべし。慣れてきたらPromptに入れてみ\u003cdel\u003eて絶望し\u003c/del\u003eよう。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"39:1-39:44\"\u003e\n\u003cspan id=\"適合するタグをdanbooruで集める\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%81%A9%E5%90%88%E3%81%99%E3%82%8B%E3%82%BF%E3%82%B0%E3%82%92danbooru%E3%81%A7%E9%9B%86%E3%82%81%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e適合するタグをDanbooruで集める\u003c/h2\u003e\n\u003cp data-sourcepos=\"40:1-47:174\"\u003eシチュが決まったら\u003ca href=\"https://danbooru.donmai.us/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDanbooru\u003c/a\u003eを開いて、それらの要素がDanbooruでどうタグ付けされているか調べてリストアップします。\u003cbr\u003e\nタグはアンダースコア区切りの英単語です。オタクの言葉なので日本語のローマ字表記がそのまま使われている場合もあります。tsurimeとか。\u003cbr\u003e\n親切なことにタグの定義までサイト内で見れるので悩むより入れてみた方が早いです。\u003cbr\u003e\nたとえば「hair」と入れるとこんな感じで候補が出まくります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e5fbda04e9839afb9f1388b37e61211a64df4454/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f65383262616264312d633431652d663835362d353963362d6466376635373065373661612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Fe82babd1-c41e-f856-59c6-df7f570e76aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=04175fb456e87023c6fafdc011f674ff\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/e82babd1-c41e-f856-59c6-df7f570e76aa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Fe82babd1-c41e-f856-59c6-df7f570e76aa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dc9dca7c46991259565a86c7670a6892 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n髪色、長さ、アクセサリーなど。一目瞭然ですね。右の数字はヒット件数で、この数字が大きいほど影響力があります。1000件未満のタグは入れてもほとんど効果が無いことが多いです。\u003cbr\u003e\nどーしてもわからない場合はその要素を持ってる版権キャラで調べて、その絵についてるタグを見るとよいです。\u003cbr\u003e\nこうして髪色、髪型、年齢、瞳の色、衣装、表情、感情、天候、場所、光の向きなど思い付く限りの情報をタグにして集めます。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"49:1-49:36\"\u003e\n\u003cspan id=\"集めたタグでpromptを作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9B%86%E3%82%81%E3%81%9F%E3%82%BF%E3%82%B0%E3%81%A7prompt%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e集めたタグでpromptを作る\u003c/h2\u003e\n\u003cp data-sourcepos=\"50:1-51:45\"\u003eさて、材料は揃ったので呪文を作るわけですが、Waifuに関しては他のモデルとは全く異なる独自の指針があります。\u003cbr\u003e\n以下のwikiに詳解があります(英語)\u003c/p\u003e\n\u003cp data-sourcepos=\"53:1-53:68\"\u003e\u003cqiita-embed-ogp src=\"https://wiki.installgentoo.com/wiki/Stable_Diffusion#Waifu_Diffusion\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"55:1-55:93\"\u003e大事なとこだけ訳すと、このような順にソートせよということです。\u003c/p\u003e\n\u003cblockquote data-sourcepos=\"57:1-57:121\"\u003e\n\u003cp data-sourcepos=\"57:3-57:121\"\u003e[originalまたは作品タイトル][キャラ名(既存キャラを出す場合)][Danbooruのタグ][作者・作風]\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp data-sourcepos=\"59:1-59:214\"\u003eかつ、\u003cstrong\u003e各カテゴリ内ではアルファベット順にソートせよ\u003c/strong\u003eとあります。他のモデルでは「重要な情報ほど先頭に置け」が鉄則なので、性質が全く異なります。\u003c/p\u003e\n\u003cp data-sourcepos=\"61:1-61:93\"\u003eこの法則に基づいて、タグを並べ替えます。例えばこんな感じです。\u003c/p\u003e\n\u003cblockquote data-sourcepos=\"63:1-63:323\"\u003e\n\u003cp data-sourcepos=\"63:3-63:323\"\u003eoriginal 1girl bangs bare_shoulders blush bowtie doyagao flat_chest fox_ears fox_tail full_body half-closed_eyes headdress loli looking_at_viewer long_hair neck_ribbon pink_bowtie pink_eyes pink_hair pink_sailor_collar sailor_collar sailor_shirt serafuku sleeveless smug squinting standing tsurime twintails white_jacket\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp data-sourcepos=\"65:1-67:306\"\u003eoriginalは先頭に置きます。版権キャラでは作品名のタグが入ります。あとはアルファベット順にソートされたタグの羅列です。\u003cbr\u003e\n絵柄や作風についても指示したい場合はこれらのタグの後ろに追記します。ミュシャとかのやつ。そっちはソートしなくてOKです。\u003cbr\u003e\n実は並べ替えなくてもそれなりに期待通りの画は出ますが、顔面や手足の整合性は体感で分かるくらい悪くなります。打率は重要なのでサボらず並べ替えましょう。スプレッドシートに羅列しておいて自動でソートさせると楽。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"69:1-69:60\"\u003e\n\u003cspan id=\"惜しい絵が出るまで呪文ガチャを回す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%9C%E3%81%97%E3%81%84%E7%B5%B5%E3%81%8C%E5%87%BA%E3%82%8B%E3%81%BE%E3%81%A7%E5%91%AA%E6%96%87%E3%82%AC%E3%83%81%E3%83%A3%E3%82%92%E5%9B%9E%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「惜しい絵」が出るまで呪文ガチャを回す\u003c/h2\u003e\n\u003cp data-sourcepos=\"70:1-74:159\"\u003e呪文ができたので、適当に100枚くらい回してみます。\u003cbr\u003e\n20枚くらいで様子を見て、傾向に修正が必要そうなら直してまた回します。ここは基本と変わらないです。\u003cbr\u003e\nただし、このヨドコロちゃん式ワークフローの重要ポイントとして、\u003cstrong\u003eこの段階では整合性や色、細かい指定については反映されていなくてもいいものとします\u003c/strong\u003e。\u003cbr\u003e\n何故なら、このあと加筆して再度img2imgでAIに修正させるからです。\u003cbr\u003e\n手の形が崩れてるとか、目が怖いとか、そういうのはスルーして、構図と大まかな「要望一致度」だけに注目します。\u003c/p\u003e\n\u003cp data-sourcepos=\"76:1-77:69\"\u003eなので、「加筆で直せる修正」はスルーして、それ以外の項目だけに着目します。\u003cbr\u003e\n「加筆で直せる修正」とは例えば以下の要素です。\u003c/p\u003e\n\u003cul data-sourcepos=\"78:1-82:0\"\u003e\n\u003cli data-sourcepos=\"78:1-78:35\"\u003e髪や瞳の色がなんか違う\u003c/li\u003e\n\u003cli data-sourcepos=\"79:1-79:47\"\u003e髪が長い、短い、ツインテが無い\u003c/li\u003e\n\u003cli data-sourcepos=\"80:1-80:32\"\u003e服のパーツがおかしい\u003c/li\u003e\n\u003cli data-sourcepos=\"81:1-82:0\"\u003e3本目の腕が生えてる、片腕しかない\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"83:1-85:171\"\u003eこういうのはあとからどうにでもなるのでどーでもいいです。雰囲気を大事にしましょう。\u003cbr\u003e\n最初はわからないと思いますが、このあとのimg2imgのプロセスを1度やってみれば次からは勘が働くようになるはずです。\u003cbr\u003e\n何でも一発でうまくできることなんてないのでそこは練習です。数回やれば身に付くんだから絵の練習よりよっぽど楽ですよ。\u003c/p\u003e\n\u003cp data-sourcepos=\"87:1-87:87\"\u003eちなみにパラメタは適当ですが、うちはこんな感じにしてます。\u003c/p\u003e\n\u003cp data-sourcepos=\"89:1-89:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/88918993fb04db567102219f96747ee7b10fbac3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f35623762396566322d336339332d653032332d666565332d6236613437653963666339642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F5b7b9ef2-3c93-e023-fee3-b6a47e9cfc9d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dd5342452929b51b62b53c68f0358937\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/5b7b9ef2-3c93-e023-fee3-b6a47e9cfc9d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F5b7b9ef2-3c93-e023-fee3-b6a47e9cfc9d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=456b2cd90c12b25df7a2d97b578e860a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"92:1-92:63\"\u003e\n\u003cspan id=\"惜しい絵に加筆して各要素を正しくする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%9C%E3%81%97%E3%81%84%E7%B5%B5%E3%81%AB%E5%8A%A0%E7%AD%86%E3%81%97%E3%81%A6%E5%90%84%E8%A6%81%E7%B4%A0%E3%82%92%E6%AD%A3%E3%81%97%E3%81%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「惜しい絵」に加筆して各要素を正しくする\u003c/h2\u003e\n\u003cp data-sourcepos=\"93:1-95:174\"\u003eで、「これだ！」という絵を見つけたら、加筆します。\u003cbr\u003e\n例としてこんな絵が出たとします。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/73d321cbdf64e1f35dbfa39970b762c4673dcbb4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f34306361383835332d383535362d366666352d376561342d3837326431346562303835352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F40ca8853-8556-6ff5-7ea4-872d14eb0855.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3bb67a6438e3bf03db242d1defccd792\" alt=\"2022-09-18-12-58-21-007-1618706736-scale7.50-k_euler_a-007.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/40ca8853-8556-6ff5-7ea4-872d14eb0855.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F40ca8853-8556-6ff5-7ea4-872d14eb0855.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0bb9f8c6505c6afd1c481eff7666b8b7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"97:1-97:156\"\u003eいい感じのメスガキですね。しかしこれが欲しかった絵かというと色々違います。描きたかった相手はこの人です。\u003c/p\u003e\n\u003cp data-sourcepos=\"99:1-99:59\"\u003e\u003cqiita-embed-tweet src=\"https://twitter.com/MekaNyankoVR/status/1532154039558778881\"\u003e\u003c/qiita-embed-tweet\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"101:1-101:84\"\u003eっは～～～～～～～～～～～～～！！！！！！！！！　かわよ\u003c/p\u003e\n\u003cp data-sourcepos=\"103:1-103:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/69973bcc361d8f9e2e93ac1b6c6d615b68dd0c10/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f64626464366166362d623932362d663564622d666437312d3261626639313533623365652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Fdbdd6af6-b926-f5db-fd71-2abf9153b3ee.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=020735793a5086ea5c9489fcd4b7f3c8\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/dbdd6af6-b926-f5db-fd71-2abf9153b3ee.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Fdbdd6af6-b926-f5db-fd71-2abf9153b3ee.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=689306e22e0926f6fc83d2bbd1f4e021 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"105:1-107:124\"\u003e全身はこんな感じです。\u003cbr\u003e\n比べてみると全然違います。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/52a876cf12ae8377775a85e7198b67e7fc442f3d/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f30366565323730642d643864322d316266622d666239392d3231353561616339303739662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F06ee270d-d8d2-1bfb-fb99-2155aac9079f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4c1a839b706086aa6628352bae5cd3ca\" alt=\"qiita_01.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/06ee270d-d8d2-1bfb-fb99-2155aac9079f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F06ee270d-d8d2-1bfb-fb99-2155aac9079f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b4cb231d829eb18d0f2091b3bdca5dac 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"109:1-110:94\"\u003eこういう気に入らない箇所が全部正しくなるまでガチャを回していると一生かかっても出ません。\u003cbr\u003e\nしかし一生ガチャを回さなくてもいいように、img2imgが登場しました。\u003c/p\u003e\n\u003cp data-sourcepos=\"112:1-114:207\"\u003eimg2imgは、promptに加えて下絵となる画像もAIに読ませることでそれらしい絵を出させる機能です。\u003cbr\u003e\n「下絵をどれくらい尊重するか」みたいなパラメタがあり、これを下げてAIの想像に任せ気味にすると適当な単色塗分けからいい感じの風景画を出すみたいなことができたりします。\u003cbr\u003e\n逆に下絵をよく尊重するような設定で描かせると立ち絵の差分みたいな微妙な違いの類似画像を描かせまくることができます。今回はこれを利用します。\u003c/p\u003e\n\u003cp data-sourcepos=\"116:1-117:81\"\u003e画力不要とか言っといて結局描くのかよ！　と言いたい気持ちはわかりますが、要求されるレベルは棒人間を描く以下なので安心してください。\u003cbr\u003e\nとりあえず加筆したものをお見せします。こうするのじゃ。\u003c/p\u003e\n\u003cp data-sourcepos=\"119:1-119:164\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/54b36417ad49409121dad7777ca769095c9dc9c4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f39343261323363642d353830332d316536312d633737332d6130376332303435376133312e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F942a23cd-5803-1e61-c773-a07c20457a31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=db1ef132981a60c3fa9b0e1e1e6a9aa5\" alt=\"2022-09-18-12-58-21-007-1618706736-scale7_Bring2.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/942a23cd-5803-1e61-c773-a07c20457a31.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F942a23cd-5803-1e61-c773-a07c20457a31.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=822251133a88595056dd830475e5edd3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"121:1-122:206\"\u003eえー、挫折した方の絵下手マンでなく、そもそもフォトショもクリスタも触ったこと無い方の素人絵下手マンの場合、この画像を見て「めちゃくちゃ描いとるやん！　絵うまやん！！」と思うかもしれませんが、気のせいです。誰でもできます。\u003cbr\u003e\nここでペイントツールの使い方をだらだら書いてるとテンポが悪いので最後に回しますが、とにかく無料ツールでもこれくらいは15分足らずでできます。\u003c/p\u003e\n\u003cp data-sourcepos=\"124:1-129:85\"\u003eこれで、めちゃくちゃ縮小してみた時になんとなくいい感じになっていればOKです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c40853c5bb95b7bcacdb82cf71262507ac641576/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f34663636626138632d646437352d333464312d396364362d3832386363336435306639642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F4f66ba8c-dd75-34d1-9cd6-828cc3d50f9d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cb17bcf55ad9c5c336c211326288cd78\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/4f66ba8c-dd75-34d1-9cd6-828cc3d50f9d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F4f66ba8c-dd75-34d1-9cd6-828cc3d50f9d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3853ac62914932d89f93e46f4cd46fa4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n拡大するとダメなのですが、遠目にはなんかちゃんと描けてるように見えます。これでOKです。\u003cbr\u003e\n加筆した箇所の要点はこんな感じです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/8a349395b2690d57216544bcd4d460de177a2fa1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f61663430333130632d393566632d383937382d653333382d6263666231346562663736362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Faf40310c-95fc-8978-e338-bcfb14ebf766.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=836a3b253a03475edfe458ed6815ddcf\" alt=\"qiita_02.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/af40310c-95fc-8978-e338-bcfb14ebf766.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Faf40310c-95fc-8978-e338-bcfb14ebf766.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d13d54867571233975c4dafcb8ffd631 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n見たまんまですね。1つだけ、画像サイズについて補足します。\u003c/p\u003e\n\u003cp data-sourcepos=\"131:1-134:132\"\u003eAIに自由に描かせると、95%の確率で頭が見切れます。\u003cbr\u003e\nこれはもうAIの特性上どうしようもないです。呪文ではどうにもなりません。\u003cbr\u003e\nなのでもう加筆する前提で最初から縦に少し小さい画像を作らせ、加筆する段階で足りない部分を描き足すとよいです。\u003cbr\u003e\nうちのGPUでは512×768が限界なので、まず512×640で生成し、加筆する段階で512×768に拡張しています。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"136:1-136:67\"\u003e\n\u003cspan id=\"加筆した絵を元にimg2imgで再度呪文ガチャを回す\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8A%A0%E7%AD%86%E3%81%97%E3%81%9F%E7%B5%B5%E3%82%92%E5%85%83%E3%81%ABimg2img%E3%81%A7%E5%86%8D%E5%BA%A6%E5%91%AA%E6%96%87%E3%82%AC%E3%83%81%E3%83%A3%E3%82%92%E5%9B%9E%E3%81%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e加筆した絵を元にimg2imgで再度呪文ガチャを回す\u003c/h2\u003e\n\u003cp data-sourcepos=\"137:1-142:146\"\u003eLoad Imageボタンを押すと画像を選択できるので、加筆した絵を指定します。\u003cbr\u003e\nするとimg2imgモードに切り替わります。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/722326c514057eeebba7547e73d41dbc64248d97/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f38303536333062612d636134352d336233372d396635332d3331383161303664663765612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F805630ba-ca45-3b37-9f53-3181a06df7ea.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5eb5638c59c2974c4fd87e182c529da2\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/805630ba-ca45-3b37-9f53-3181a06df7ea.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F805630ba-ca45-3b37-9f53-3181a06df7ea.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b543968dc01912a1b3dd5885b5e638fe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nInfluenceという項目が増えました。これが「元画像をどれだけ尊重するか度」です。0にすると完全に無視し、1にすると元画像がそのまま出るみたいな感じになります。\u003cbr\u003e\n加筆修正の場合は0.600から始めて、結果を見ながら微調整するのがよいと思います。\u003cbr\u003e\n加筆で塗りつぶして単色になった部分が多いほど、Influenceを下げてAIの方で補完してもらう必要があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"144:1-146:135\"\u003epromptはtxt2imgの時と同じままでよいです。また50枚ほど生成してもらって結果を見ましょう。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/aeea2b1eec4b0ded1b89025616a5377abad75615/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f65663138333834342d626637302d653037362d656536642d6561323264336564336166662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Fef183844-bf70-e076-ee6d-ea22d3ed3aff.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=e9b7820d39fbfaa55c394665611ed201\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/ef183844-bf70-e076-ee6d-ea22d3ed3aff.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Fef183844-bf70-e076-ee6d-ea22d3ed3aff.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1da92f7c632a671a4984482bba945012 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n遠目にはあまり違いがわからない類似画像が大量に出てきました。しかし拡大すると全然違います。\u003c/p\u003e\n\u003cp data-sourcepos=\"148:1-148:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/30ab9de02e733261b55d74a36e97f066bbbdb6b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f36666336323931322d663739662d363962302d333132642d3939613065346161313935612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F6fc62912-f79f-69b0-312d-99a0e4aa195a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=02bdd3e8ba191efc1fdd7e62e7199bfc\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/6fc62912-f79f-69b0-312d-99a0e4aa195a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F6fc62912-f79f-69b0-312d-99a0e4aa195a.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d51f46c7c43461f5564f44bc92853aed 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"150:1-151:149\"\u003eたとえば左の子は襟の部分がリボンみたいになっちゃってますね。首周りの背景もおかしいしこれはNGですね。\u003cbr\u003e\n右の子は表情がちょっと病みすぎです。空もなんかグラデが変になってるし。猫口も潰れちゃっててNGですね。\u003c/p\u003e\n\u003cp data-sourcepos=\"153:1-154:138\"\u003eこんな感じでかなり惜しい画像が出まくります。しかしみんな似てるので50～100枚も出せば1枚くらいは当たりがあります。\u003cbr\u003e\n同じ箇所が何度も「惜しい」になる場合は、加筆画像に戻って該当箇所をちょっと直すと改善します。\u003c/p\u003e\n\u003cp data-sourcepos=\"156:1-156:172\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/03ebb358d670ce83d88ef6c35cfedb354d754900/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f33303436333762642d633237632d376236372d646335382d6264346661656361376364382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F304637bd-c27c-7b67-dc58-bd4faeca7cd8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=51e50d51799c6f5b42ddc68dcc2032d0\" alt=\"2022-09-18-14-54-32-004-34133620-scale7.50-k_euler_a-004.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/304637bd-c27c-7b67-dc58-bd4faeca7cd8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F304637bd-c27c-7b67-dc58-bd4faeca7cd8.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e76354310f6635e13d7b9f0da8ee0e67 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"158:1-158:60\"\u003eうーん……これでヨシということにしよう！\u003c/p\u003e\n\u003ch2 data-sourcepos=\"160:1-160:38\"\u003e\n\u003cspan id=\"必要なら要素をコラする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%89%E8%A6%81%E7%B4%A0%E3%82%92%E3%82%B3%E3%83%A9%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e(必要なら)要素をコラする\u003c/h2\u003e\n\u003cp data-sourcepos=\"162:1-163:103\"\u003e二次創作の場合、キャラ固有のアクセやマーク入り衣装があるとそれこそガチャでは一生出ないですよね。\u003cbr\u003e\nimg2imgでもそれは同じなのでそこだけは手動でコラしてやる必要があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"165:1-165:161\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/5de4eda48fb7452e25a184090be6b7aefbaa9cb1/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f35643032373832362d323231362d333130382d623861622d3663323235633535323436632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F5d027826-2216-3108-b8ab-6c225c55246c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3396458bc374ed9d76384ea80813b81b\" alt=\"2022-09-18-14-54-32-004-34133620-scale7_Fixed.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/5d027826-2216-3108-b8ab-6c225c55246c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2F5d027826-2216-3108-b8ab-6c225c55246c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7c394d1f4dc04fbcd5ba49226468f069 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"167:1-167:108\"\u003e髪にロゴを入れてあげました。う～ん、これはもうめかにゃんこ様に違いない。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"169:1-169:9\"\u003e\n\u003cspan id=\"完成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%8C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e完成\u003c/h2\u003e\n\u003cp data-sourcepos=\"171:1-173:219\"\u003e以上です。\u003cbr\u003e\n既にお気づきかと思いますが、この方法では「完璧」にはならないです。\u003cbr\u003e\nこの画像だって襟の線が微妙だし、鎖骨のところの布が無いし、スカートも本当はエプロンドレスなのにプリーツになってるし、そもそも髪型もなんか違う……。\u003c/p\u003e\n\u003cp data-sourcepos=\"175:1-177:237\"\u003e\u003cstrong\u003eうるせ～～～～！！！！　しょーがねーだろ画力ゼロなんだから！！！！\u003c/strong\u003e\u003cbr\u003e\n余談ですがAIが絵描きの仕事を奪うとかいう話がいかにたわごとかよくわかりますね。真にAIを使いこなすには画力が必要なのは明白です。ただ全体のレベルが底上げされたに過ぎないってわけ。\u003cbr\u003e\nそういうわけで我々素人は衣装再現とかはほどほどにしておいて、水着とかメイド服とか好き放題着せたりして道具の持ち味を生かすことを考えたほうが建設的だと思います。\u003c/p\u003e\n\u003cp data-sourcepos=\"179:1-182:30\"\u003eさて、せっかくのファンアートなので描いてもらった絵を見てもらいましょう、相手によっては喜んでくれます。\u003cbr\u003e\n好反応だった時、ありがとうなんて言われたときにはもうね……絵下手マンが一生届かないと思っていた種類の喜びが沸き上がってきて泣きそうになります。\u003cbr\u003e\n喜んでくれなそうな相手には見せないでください。前置きの通り微妙なところがあるので。\u003cbr\u003e\n一線は守るんじゃよ。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"184:1-184:32\"\u003e\n\u003cspan id=\"その他細かいノウハウ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96%E7%B4%B0%E3%81%8B%E3%81%84%E3%83%8E%E3%82%A6%E3%83%8F%E3%82%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他細かいノウハウ\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"186:1-186:30\"\u003e\n\u003cspan id=\"背景は合成でもいい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%83%8C%E6%99%AF%E3%81%AF%E5%90%88%E6%88%90%E3%81%A7%E3%82%82%E3%81%84%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e背景は合成でもいい\u003c/h2\u003e\n\u003cp data-sourcepos=\"187:1-190:226\"\u003e背景や場面について指定しないと、のぺっとした立ち絵だけが出力されがち。\u003cbr\u003e\nなので基本的に背景は何かしら指定したほうがいいのですが、衣装や髪型などでニッチな要素をpromptに入れるとなかなか反映されなくて、他のタグを削っていくとようやく少しずつ特徴が現れだす、みたいなことはままあります。\u003cbr\u003e\nそういう場合、キャラ以外のタグをガッツリ削って立ち絵だけでまず作ってしまうというのも1つの方法です。\u003cbr\u003e\n単色背景を透過してコラするのは簡単なので、綺麗な風景を描くのが得意な素のStable Diffusionに好きな背景を適当に生成してもらい、最後に立ち絵と重ねればよいです。\u003c/p\u003e\n\u003cp data-sourcepos=\"192:1-195:39\"\u003eライティングの整合性とかまで考えるともちろん良くはないのですが、終わらないガチャを回すよりはよっぽどマシです。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b81e3c318f674260c2ebcfbbcbe2de7ec081052c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3632373732322f66613866323831332d343762302d646235382d386634622d3038616463633563353139622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Ffa8f2813-47b0-db58-8f4b-08adcc5c519b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6de7cfddc339cd42157318770ea36d5d\" alt=\"2022-09-09-17-06-57-052-443451504-scale7_Fixed.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/fa8f2813-47b0-db58-8f4b-08adcc5c519b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F627722%2Ffa8f2813-47b0-db58-8f4b-08adcc5c519b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3eb2fc7f75ac8d8def99ef21a4e47a9d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nヨドコロちゃん自身の肖像画。この背景はキャラとは別のprompt、別のモデルで生成したコラです。\u003cbr\u003e\nそんなに気にならないよね？\u003c/p\u003e\n\u003ch2 data-sourcepos=\"197:1-197:44\"\u003e\n\u003cspan id=\"呪文に悩んだらstepsを減らそう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%91%AA%E6%96%87%E3%81%AB%E6%82%A9%E3%82%93%E3%81%A0%E3%82%89steps%E3%82%92%E6%B8%9B%E3%82%89%E3%81%9D%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e呪文に悩んだらStepsを減らそう\u003c/h2\u003e\n\u003cp data-sourcepos=\"198:1-202:80\"\u003eStepsは生成にかける処理の回数みたいなパラメタで、数値が小さいとノイズに近付き、大きいと細部まで精細になっていきます。\u003cbr\u003e\nそして大きいほど生成にかける時間はどんどん長くなります。\u003cbr\u003e\n思い通りの要素が出ずにpromptを試行錯誤している段階では、Stepsが大きいまま試行するのは時間の無駄です。\u003cbr\u003e\n50くらいまで減らしてもpromptが持つ特徴は見えてくるので、まずはそれでpromptを決定するところまで進めましょう。\u003cbr\u003e\nそれからStepsを100とかにしていい絵が出るのを待つのです。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"204:1-204:62\"\u003e\n\u003cspan id=\"素人が無料ツールでうまいこと加筆する方法\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B4%A0%E4%BA%BA%E3%81%8C%E7%84%A1%E6%96%99%E3%83%84%E3%83%BC%E3%83%AB%E3%81%A7%E3%81%86%E3%81%BE%E3%81%84%E3%81%93%E3%81%A8%E5%8A%A0%E7%AD%86%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e素人が無料ツールでうまいこと加筆する方法\u003c/h1\u003e\n\u003cp data-sourcepos=\"205:1-208:72\"\u003eえー、ここまで書いて力尽きたので記事を分けます。\u003cbr\u003e\nとはいえVRChatterならテクスチャ改変でやってることだろうしみんなわかるよね？\u003cbr\u003e\nおすすめはPhotopeaです。gimpは好きじゃない。\u003cbr\u003e\nもちろんPhotoshopを使えるならそれが一番なのですが。\u003c/p\u003e\n\u003cp data-sourcepos=\"210:1-211:18\"\u003eやる気が残ってることを祈っててください。\u003cbr\u003e\nお楽しみに。\u003c/p\u003e\n","body":"# 前置き\nこの記事ではWaifu Diffusionを扱います。\n意外と知らずに使っている方もいるようなのでここで念押ししておきますが、Waifu Diffusionは[Danbooru](https://danbooru.donmai.us/)という真っ黒もいいとこな無断転載天国サイトを学習データとして使っていると[明言](https://github.com/harubaru/waifu-diffusion)しており、使用者の立場によっては不適切とみなされ炎上したりこういうサイトを容認してるという意思表示とみなされるリスクがあります。微妙な立場の人は[とりんさまモデル](https://huggingface.co/naclbit/trinart_stable_diffusion_v2/blob/main/trinart2_step60000.ckpt)でも使ってた方が身のためですよ。\n知ったこっちゃないという人はどうぞ。\n\n# 目的\nStable Diffusionやその派生で欲しい絵を描くワークフローは既に色々出回ってますが、これらは元々絵を描ける人が補助ツールとして使う方法という側面が強いです。\n棒人間すらまともにかけないヨドコロちゃんのようなカス画力の持ち主はPromptをいじり倒して呪文ガチャに祈るしかないのが黎明期のAI画でした。\nしかし今やimg2imgが各種GUIアプリでも標準搭載されるに至り、我々の手の届くところにあります。\ntxt2imgとimg2imgを組み合わせれば、特定のキャラデザに似せて描くことだってできます。\n\nこの記事では画力一切不要でそれっぽい絵を作るためのノウハウを書いていきます。\n\n# 用意するもの\n+ VRAMいっぱいのPC\n+ NMKD Stable Diffusion GUI https://nmkd.itch.io/t2i-gui\n+ Waifu Diffusionモデル https://huggingface.co/hakurei/waifu-diffusion\n\nインストールについてはそのへんに解説があると思うので省略します。ていうか一目瞭然だから別に調べなくても普通に分かる。\nよくあるエラーとして、NMKDがFileNotFoundExceptionで止まったらモデルのDL失敗だから手動で適当に代わりを用意して置いてから再実行すればいいです。\nあと生成画像が緑一色になるやつはVRAMが足りないからLow memory modeにするべし。それでもだめならグラボを買え。\n\n# 手順\n以下の流れで作っていきます。\n1. 描きたい相手とシチュを決める\n1. 適合するタグをDanbooruで集める\n1. 集めたタグでpromptを作る\n1. 「惜しい絵」が出るまで呪文ガチャを回す\n1. 「惜しい絵」に加筆して各要素を正しくする\n1. 加筆した絵を元にimg2imgで再度呪文ガチャを回す\n1. (必要なら)要素をコラする\n1. 完成\n\n## 描きたい相手とシチュを決める\n相手というのは説明不要ですね。\nシチュというのは表情、場所、時間帯みたいなフワッとしたレベルの話です。\n細かいポージングとかは鬼門なので最初は諦めるべし。慣れてきたらPromptに入れてみ~~て絶望し~~よう。\n\n## 適合するタグをDanbooruで集める\nシチュが決まったら[Danbooru](https://danbooru.donmai.us/)を開いて、それらの要素がDanbooruでどうタグ付けされているか調べてリストアップします。\nタグはアンダースコア区切りの英単語です。オタクの言葉なので日本語のローマ字表記がそのまま使われている場合もあります。tsurimeとか。\n親切なことにタグの定義までサイト内で見れるので悩むより入れてみた方が早いです。\nたとえば「hair」と入れるとこんな感じで候補が出まくります。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/e82babd1-c41e-f856-59c6-df7f570e76aa.png)\n髪色、長さ、アクセサリーなど。一目瞭然ですね。右の数字はヒット件数で、この数字が大きいほど影響力があります。1000件未満のタグは入れてもほとんど効果が無いことが多いです。\nどーしてもわからない場合はその要素を持ってる版権キャラで調べて、その絵についてるタグを見るとよいです。\nこうして髪色、髪型、年齢、瞳の色、衣装、表情、感情、天候、場所、光の向きなど思い付く限りの情報をタグにして集めます。\n\n## 集めたタグでpromptを作る\nさて、材料は揃ったので呪文を作るわけですが、Waifuに関しては他のモデルとは全く異なる独自の指針があります。\n以下のwikiに詳解があります(英語)\n\nhttps://wiki.installgentoo.com/wiki/Stable_Diffusion#Waifu_Diffusion\n\n大事なとこだけ訳すと、このような順にソートせよということです。\n\n\u003e [originalまたは作品タイトル][キャラ名(既存キャラを出す場合)][Danbooruのタグ][作者・作風]\n\nかつ、**各カテゴリ内ではアルファベット順にソートせよ**とあります。他のモデルでは「重要な情報ほど先頭に置け」が鉄則なので、性質が全く異なります。\n\nこの法則に基づいて、タグを並べ替えます。例えばこんな感じです。\n\n\u003e original 1girl bangs bare_shoulders blush bowtie doyagao flat_chest fox_ears fox_tail full_body half-closed_eyes headdress loli looking_at_viewer long_hair neck_ribbon pink_bowtie pink_eyes pink_hair pink_sailor_collar sailor_collar sailor_shirt serafuku sleeveless smug squinting standing tsurime twintails white_jacket \n\noriginalは先頭に置きます。版権キャラでは作品名のタグが入ります。あとはアルファベット順にソートされたタグの羅列です。\n絵柄や作風についても指示したい場合はこれらのタグの後ろに追記します。ミュシャとかのやつ。そっちはソートしなくてOKです。\n実は並べ替えなくてもそれなりに期待通りの画は出ますが、顔面や手足の整合性は体感で分かるくらい悪くなります。打率は重要なのでサボらず並べ替えましょう。スプレッドシートに羅列しておいて自動でソートさせると楽。\n\n## 「惜しい絵」が出るまで呪文ガチャを回す\n呪文ができたので、適当に100枚くらい回してみます。\n20枚くらいで様子を見て、傾向に修正が必要そうなら直してまた回します。ここは基本と変わらないです。\nただし、このヨドコロちゃん式ワークフローの重要ポイントとして、**この段階では整合性や色、細かい指定については反映されていなくてもいいものとします**。\n何故なら、このあと加筆して再度img2imgでAIに修正させるからです。\n手の形が崩れてるとか、目が怖いとか、そういうのはスルーして、構図と大まかな「要望一致度」だけに注目します。\n\nなので、「加筆で直せる修正」はスルーして、それ以外の項目だけに着目します。\n「加筆で直せる修正」とは例えば以下の要素です。\n+ 髪や瞳の色がなんか違う\n+ 髪が長い、短い、ツインテが無い\n+ 服のパーツがおかしい\n+ 3本目の腕が生えてる、片腕しかない\n\nこういうのはあとからどうにでもなるのでどーでもいいです。雰囲気を大事にしましょう。\n最初はわからないと思いますが、このあとのimg2imgのプロセスを1度やってみれば次からは勘が働くようになるはずです。\n何でも一発でうまくできることなんてないのでそこは練習です。数回やれば身に付くんだから絵の練習よりよっぽど楽ですよ。\n\nちなみにパラメタは適当ですが、うちはこんな感じにしてます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/5b7b9ef2-3c93-e023-fee3-b6a47e9cfc9d.png)\n\n\n## 「惜しい絵」に加筆して各要素を正しくする\nで、「これだ！」という絵を見つけたら、加筆します。\n例としてこんな絵が出たとします。\n![2022-09-18-12-58-21-007-1618706736-scale7.50-k_euler_a-007.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/40ca8853-8556-6ff5-7ea4-872d14eb0855.png)\n\nいい感じのメスガキですね。しかしこれが欲しかった絵かというと色々違います。描きたかった相手はこの人です。\n\nhttps://twitter.com/MekaNyankoVR/status/1532154039558778881\n\nっは～～～～～～～～～～～～～！！！！！！！！！　かわよ\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/dbdd6af6-b926-f5db-fd71-2abf9153b3ee.png)\n\n全身はこんな感じです。\n比べてみると全然違います。\n![qiita_01.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/06ee270d-d8d2-1bfb-fb99-2155aac9079f.png)\n\nこういう気に入らない箇所が全部正しくなるまでガチャを回していると一生かかっても出ません。\nしかし一生ガチャを回さなくてもいいように、img2imgが登場しました。\n\nimg2imgは、promptに加えて下絵となる画像もAIに読ませることでそれらしい絵を出させる機能です。\n「下絵をどれくらい尊重するか」みたいなパラメタがあり、これを下げてAIの想像に任せ気味にすると適当な単色塗分けからいい感じの風景画を出すみたいなことができたりします。\n逆に下絵をよく尊重するような設定で描かせると立ち絵の差分みたいな微妙な違いの類似画像を描かせまくることができます。今回はこれを利用します。\n\n画力不要とか言っといて結局描くのかよ！　と言いたい気持ちはわかりますが、要求されるレベルは棒人間を描く以下なので安心してください。\nとりあえず加筆したものをお見せします。こうするのじゃ。\n\n![2022-09-18-12-58-21-007-1618706736-scale7_Bring2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/942a23cd-5803-1e61-c773-a07c20457a31.png)\n\nえー、挫折した方の絵下手マンでなく、そもそもフォトショもクリスタも触ったこと無い方の素人絵下手マンの場合、この画像を見て「めちゃくちゃ描いとるやん！　絵うまやん！！」と思うかもしれませんが、気のせいです。誰でもできます。\nここでペイントツールの使い方をだらだら書いてるとテンポが悪いので最後に回しますが、とにかく無料ツールでもこれくらいは15分足らずでできます。\n\nこれで、めちゃくちゃ縮小してみた時になんとなくいい感じになっていればOKです。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/4f66ba8c-dd75-34d1-9cd6-828cc3d50f9d.png)\n拡大するとダメなのですが、遠目にはなんかちゃんと描けてるように見えます。これでOKです。\n加筆した箇所の要点はこんな感じです。\n![qiita_02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/af40310c-95fc-8978-e338-bcfb14ebf766.png)\n見たまんまですね。1つだけ、画像サイズについて補足します。\n\nAIに自由に描かせると、95%の確率で頭が見切れます。\nこれはもうAIの特性上どうしようもないです。呪文ではどうにもなりません。\nなのでもう加筆する前提で最初から縦に少し小さい画像を作らせ、加筆する段階で足りない部分を描き足すとよいです。\nうちのGPUでは512×768が限界なので、まず512×640で生成し、加筆する段階で512×768に拡張しています。\n\n## 加筆した絵を元にimg2imgで再度呪文ガチャを回す\nLoad Imageボタンを押すと画像を選択できるので、加筆した絵を指定します。\nするとimg2imgモードに切り替わります。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/805630ba-ca45-3b37-9f53-3181a06df7ea.png)\nInfluenceという項目が増えました。これが「元画像をどれだけ尊重するか度」です。0にすると完全に無視し、1にすると元画像がそのまま出るみたいな感じになります。\n加筆修正の場合は0.600から始めて、結果を見ながら微調整するのがよいと思います。\n加筆で塗りつぶして単色になった部分が多いほど、Influenceを下げてAIの方で補完してもらう必要があります。\n\npromptはtxt2imgの時と同じままでよいです。また50枚ほど生成してもらって結果を見ましょう。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/ef183844-bf70-e076-ee6d-ea22d3ed3aff.png)\n遠目にはあまり違いがわからない類似画像が大量に出てきました。しかし拡大すると全然違います。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/6fc62912-f79f-69b0-312d-99a0e4aa195a.png)\n\nたとえば左の子は襟の部分がリボンみたいになっちゃってますね。首周りの背景もおかしいしこれはNGですね。\n右の子は表情がちょっと病みすぎです。空もなんかグラデが変になってるし。猫口も潰れちゃっててNGですね。\n\nこんな感じでかなり惜しい画像が出まくります。しかしみんな似てるので50～100枚も出せば1枚くらいは当たりがあります。\n同じ箇所が何度も「惜しい」になる場合は、加筆画像に戻って該当箇所をちょっと直すと改善します。\n\n![2022-09-18-14-54-32-004-34133620-scale7.50-k_euler_a-004.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/304637bd-c27c-7b67-dc58-bd4faeca7cd8.png)\n\nうーん……これでヨシということにしよう！\n\n## (必要なら)要素をコラする\n\n二次創作の場合、キャラ固有のアクセやマーク入り衣装があるとそれこそガチャでは一生出ないですよね。\nimg2imgでもそれは同じなのでそこだけは手動でコラしてやる必要があります。\n\n![2022-09-18-14-54-32-004-34133620-scale7_Fixed.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/5d027826-2216-3108-b8ab-6c225c55246c.png)\n\n髪にロゴを入れてあげました。う～ん、これはもうめかにゃんこ様に違いない。\n\n## 完成\n\n以上です。\n既にお気づきかと思いますが、この方法では「完璧」にはならないです。\nこの画像だって襟の線が微妙だし、鎖骨のところの布が無いし、スカートも本当はエプロンドレスなのにプリーツになってるし、そもそも髪型もなんか違う……。\n\n**うるせ～～～～！！！！　しょーがねーだろ画力ゼロなんだから！！！！**\n余談ですがAIが絵描きの仕事を奪うとかいう話がいかにたわごとかよくわかりますね。真にAIを使いこなすには画力が必要なのは明白です。ただ全体のレベルが底上げされたに過ぎないってわけ。\nそういうわけで我々素人は衣装再現とかはほどほどにしておいて、水着とかメイド服とか好き放題着せたりして道具の持ち味を生かすことを考えたほうが建設的だと思います。\n\nさて、せっかくのファンアートなので描いてもらった絵を見てもらいましょう、相手によっては喜んでくれます。\n好反応だった時、ありがとうなんて言われたときにはもうね……絵下手マンが一生届かないと思っていた種類の喜びが沸き上がってきて泣きそうになります。\n喜んでくれなそうな相手には見せないでください。前置きの通り微妙なところがあるので。\n一線は守るんじゃよ。\n\n# その他細かいノウハウ\n\n## 背景は合成でもいい\n背景や場面について指定しないと、のぺっとした立ち絵だけが出力されがち。\nなので基本的に背景は何かしら指定したほうがいいのですが、衣装や髪型などでニッチな要素をpromptに入れるとなかなか反映されなくて、他のタグを削っていくとようやく少しずつ特徴が現れだす、みたいなことはままあります。\nそういう場合、キャラ以外のタグをガッツリ削って立ち絵だけでまず作ってしまうというのも1つの方法です。\n単色背景を透過してコラするのは簡単なので、綺麗な風景を描くのが得意な素のStable Diffusionに好きな背景を適当に生成してもらい、最後に立ち絵と重ねればよいです。\n\nライティングの整合性とかまで考えるともちろん良くはないのですが、終わらないガチャを回すよりはよっぽどマシです。\n![2022-09-09-17-06-57-052-443451504-scale7_Fixed.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/fa8f2813-47b0-db58-8f4b-08adcc5c519b.png)\nヨドコロちゃん自身の肖像画。この背景はキャラとは別のprompt、別のモデルで生成したコラです。\nそんなに気にならないよね？\n\n## 呪文に悩んだらStepsを減らそう\nStepsは生成にかける処理の回数みたいなパラメタで、数値が小さいとノイズに近付き、大きいと細部まで精細になっていきます。\nそして大きいほど生成にかける時間はどんどん長くなります。\n思い通りの要素が出ずにpromptを試行錯誤している段階では、Stepsが大きいまま試行するのは時間の無駄です。\n50くらいまで減らしてもpromptが持つ特徴は見えてくるので、まずはそれでpromptを決定するところまで進めましょう。\nそれからStepsを100とかにしていい絵が出るのを待つのです。\n\n# 素人が無料ツールでうまいこと加筆する方法\nえー、ここまで書いて力尽きたので記事を分けます。\nとはいえVRChatterならテクスチャ改変でやってることだろうしみんなわかるよね？\nおすすめはPhotopeaです。gimpは好きじゃない。\nもちろんPhotoshopを使えるならそれが一番なのですが。\n\nやる気が残ってることを祈っててください。\nお楽しみに。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:29:28+09:00","group":null,"id":"7a9c650f0e1adbb3e70c","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"StableDiffusion","versions":[]},{"name":"txt2img","versions":[]},{"name":"img2img","versions":[]}],"title":"絵下手マンがWaifu Diffusionでファンアートを描く方法","updated_at":"2022-09-18T21:29:28+09:00","url":"https://qiita.com/Yodokoro/items/7a9c650f0e1adbb3e70c","user":{"description":"ヨドコロちゃんだよ。VRChatでWorldを作ったりしているよ。","facebook_id":"","followees_count":0,"followers_count":7,"github_login_name":null,"id":"Yodokoro","items_count":5,"linkedin_id":"","location":"","name":"ヨドコロちゃん","organization":"","permanent_id":627722,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/627722/profile-images/1637644026","team_only":false,"twitter_screen_name":"Yodokor0","website_url":"https://twitter.com/Yodokor0"},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:9\"\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-5:75\"\u003eこんな画像から\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/5cccabbbce76f1f0c080562ed6efd816c93e180a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137353231342f61383639643434312d316265662d313161652d366163642d6662613561613139343132392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2Fa869d441-1bef-11ae-6acd-fba5aa194129.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=dc42e52eb86c859677b886141c9d7c02\" alt=\"side.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/a869d441-1bef-11ae-6acd-fba5aa194129.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2Fa869d441-1bef-11ae-6acd-fba5aa194129.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=badf1b64a964dd0a7e6f2e4460766c67 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n出典：\u003ca href=\"https://foxkeh.jp/downloads/materials/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eフォクすけの画像\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-9:51\"\u003eこんな画像を作成します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3a100b07eeb38c823f03c62d91ab31b260a2d56a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137353231342f64383939306131352d613265322d333535392d393866342d6264326532343465613635632e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2Fd8990a15-a2e2-3559-98f4-bd2e244ea65c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b27b2e65bf853db131ba50f9e367be7e\" alt=\"ret.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/d8990a15-a2e2-3559-98f4-bd2e244ea65c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2Fd8990a15-a2e2-3559-98f4-bd2e244ea65c.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3aab905b5772cfd48e3d09ae5a7f1bbc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n画像は透過PNGであることが前提です。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"11:1-11:12\"\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"Python\" data-sourcepos=\"12:1-73:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecv2\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eImageFilter\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 上下左右に縁取りを追加\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd_border\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eborder_h\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeros\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e \u003cspan class=\"n\"\u003edtype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euint8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eborder_v\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeros\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e \u003cspan class=\"n\"\u003edtype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euint8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evstack\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eborder_h\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eborder_h\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehstack\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eborder_v\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eborder_v\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\n\n\n\u003cspan class=\"c1\"\u003e# 輪郭をなめらかに膨張\n# img  : 中身が白、背景が黒のグレースケール画像\n# size : 膨張サイズ[pix]\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einflate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 円形（なめらか）に膨張\n\u003c/span\u003e    \u003cspan class=\"n\"\u003ekernel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetStructuringElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMORPH_ELLIPSE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emorphologyEx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMORPH_DILATE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekernel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e#cv2.imwrite('morph.png', img2)\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# モード（最頻）フィルターを適用\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efromarray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# cv -\u0026gt; PIL\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eImageFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eModeFilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edtype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euint8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# PIL -\u0026gt; cv\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e#cv2.imwrite('mode.png', img2)\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 外接する輪郭を取得して内部を塗りつぶす\n\u003c/span\u003e    \u003cspan class=\"n\"\u003econtours\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehierarchy\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efindContours\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRETR_EXTERNAL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCHAIN_APPROX_SIMPLE\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edrawContours\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econtours\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ethickness\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eFILLED\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eimg2\u003c/span\u003e\n\n\n\u003cspan class=\"n\"\u003esize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e50\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 膨張サイズ\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'side.png'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eIMREAD_UNCHANGED\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 透過情報もそのまま読み込む\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 上下左右に縁取りを追加\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_border\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 透過画像から中身が白、背景が黒のグレースケール画像を作成\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecopy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003eth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"mi\"\u003e127\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eth\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elogical_not\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eth\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecvtColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLOR_BGR2GRAY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e#cv2.imwrite('gray.png', img_gray)\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 輪郭画像を作成\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_inf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einflate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_gray\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimg_inf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecvtColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_inf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLOR_GRAY2BGR\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 元画像を透過情報を維持しつつ合成\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_ret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg_inf\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,:\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[:,:,\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e255\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'ret.png'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg_ret\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"75:1-75:18\"\u003e\n\u003cspan id=\"コード解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード解説\u003c/h2\u003e\n\u003cp data-sourcepos=\"77:1-78:120\"\u003eまずは元の画像から、中身が白で背景が黒の２値画像を作成します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/7dc5e6370c271c916cd9db15d5cd6ac3b84154bd/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137353231342f37306132613930372d306461322d386638662d363266352d3765396139373331626630622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2F70a2a907-0da2-8f8f-62f5-7e9a9731bf0b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a5e157ad2aeeb797326fc8b0821651b1\" alt=\"gray.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/70a2a907-0da2-8f8f-62f5-7e9a9731bf0b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2F70a2a907-0da2-8f8f-62f5-7e9a9731bf0b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6fea6545233ed9762e5d05e086d8af76 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"80:1-87:114\"\u003e次に\u003ccode\u003ecv2.morphologyEx\u003c/code\u003eで周囲が円形になるように画像を膨張させます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/cbbb82657c8f030b46c32d853183c784df54fe18/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137353231342f38613962356532362d316131342d323265392d333431352d3336663635356131343838392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2F8a9b5e26-1a14-22e9-3415-36f655a14889.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=08ce70759ea4e6ed7887b56f28adcbc6\" alt=\"morph.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/8a9b5e26-1a14-22e9-3415-36f655a14889.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2F8a9b5e26-1a14-22e9-3415-36f655a14889.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=66885ec0797b6562adfd67c023a66c4d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nただ、そのまま膨張させると凹部分が鋭角のままになってしまいます。\u003cbr\u003e\nそこでPILの\u003ccode\u003eModeFilter\u003c/code\u003eという最頻値をとるフィルターをかけます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/ac6ccee2cb7aa15a05d269a4999dc1c382a1553b/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137353231342f62623238616662652d353236662d373338372d323063622d6161336361623561663136622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2Fbb28afbe-526f-7387-20cb-aa3cab5af16b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4395994fc3373e10c60c5e31b8a54b3c\" alt=\"mode.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/bb28afbe-526f-7387-20cb-aa3cab5af16b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2Fbb28afbe-526f-7387-20cb-aa3cab5af16b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2be97049f459c628b777934f80836a57 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n凹部分もうまくなめらかになりました。\u003cbr\u003e\nあとは\u003ccode\u003ecv2.findContours\u003c/code\u003eで外接する輪郭を取得して内側を白で塗りつぶします。\u003cbr\u003e\nこれはドーナツのように内側に穴のあるような画像を考慮しての後処理になります。\u003c/p\u003e\n\u003cp data-sourcepos=\"89:1-90:119\"\u003e最後に元の画像と合成して完成です。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a1614939c158f499be06f5dbf1aa59f5d7be7afe/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137353231342f34613636663765372d376337662d636166662d396132332d6231313332393837353662662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2F4a66f7e7-7c7f-caff-9a23-b113298756bf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6b9aae3aef834ad020fc22d7beadb486\" alt=\"ret.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/4a66f7e7-7c7f-caff-9a23-b113298756bf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F175214%2F4a66f7e7-7c7f-caff-9a23-b113298756bf.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2f24fb1e04417621d7139ea20d978d50 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"92:1-92:12\"\u003e\n\u003cspan id=\"その他\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eその他\u003c/h2\u003e\n\u003cp data-sourcepos=\"93:1-94:103\"\u003eわりといいかんじにできました。\u003cbr\u003e\n元ネタ：\u003ca href=\"https://teratail.com/questions/glod0xjc398xr7\" rel=\"nofollow noopener\" target=\"_blank\"\u003e画像輪郭のなめらか処理の方法\u003c/a\u003e\u003c/p\u003e\n","body":"## 概要\n\nこんな画像から\n![side.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/a869d441-1bef-11ae-6acd-fba5aa194129.png)\n出典：[フォクすけの画像](https://foxkeh.jp/downloads/materials/)\n\nこんな画像を作成します。\n![ret.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/d8990a15-a2e2-3559-98f4-bd2e244ea65c.png)\n画像は透過PNGであることが前提です。\n\n## コード\n```Python\nimport numpy as np\nimport cv2\nfrom PIL import Image, ImageFilter\n\n# 上下左右に縁取りを追加\ndef add_border(img, size):\n    border_h = np.zeros((size, img.shape[1], img.shape[2]), dtype=np.uint8)\n    border_v = np.zeros((img.shape[0] + 2*size, size, img.shape[2]), dtype=np.uint8)\n\n    img2 = np.vstack([border_h, img, border_h])\n    img2 = np.hstack([border_v, img2, border_v])\n\n    return img2\n\n\n# 輪郭をなめらかに膨張\n# img  : 中身が白、背景が黒のグレースケール画像\n# size : 膨張サイズ[pix]\ndef inflate(img, size):\n\n    # 円形（なめらか）に膨張\n    kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (size,size))\n    img2 = cv2.morphologyEx(img, cv2.MORPH_DILATE, kernel)\n    #cv2.imwrite('morph.png', img2)\n\n    # モード（最頻）フィルターを適用\n    img2 = Image.fromarray(img2) # cv -\u003e PIL\n    img2 = img2.filter(ImageFilter.ModeFilter(size))\n    img2 = np.array(img2, dtype=np.uint8) # PIL -\u003e cv\n    #cv2.imwrite('mode.png', img2)\n\n    # 外接する輪郭を取得して内部を塗りつぶす\n    contours, hierarchy = cv2.findContours(img2, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)\n    img2 = cv2.drawContours(img, contours, -1, (255,255,255), thickness=cv2.FILLED)\n\n    return img2\n\n\nsize = 50 # 膨張サイズ\nimg = cv2.imread('side.png', cv2.IMREAD_UNCHANGED) # 透過情報もそのまま読み込む\n\n# 上下左右に縁取りを追加\nimg = add_border(img, size)\n\n# 透過画像から中身が白、背景が黒のグレースケール画像を作成\nimg_gray = img.copy()\nth = img_gray[:,:,3] \u003e= 127\nimg_gray[th] = (255,255,255,255)\nimg_gray[np.logical_not(th)] = (0,0,0,0)\nimg_gray = img_gray[:,:,0:3]\nimg_gray = cv2.cvtColor(img_gray, cv2.COLOR_BGR2GRAY)\n#cv2.imwrite('gray.png', img_gray)\n\n# 輪郭画像を作成\nimg_inf = inflate(img_gray, size)\nimg_inf = cv2.cvtColor(img_inf, cv2.COLOR_GRAY2BGR)\n\n# 元画像を透過情報を維持しつつ合成\nimg_ret = img_inf[:,:] * (1 - img[:,:,3:] / 255) + img[:,:,:3] * (img[:,:,3:] / 255)\ncv2.imwrite('ret.png', img_ret)\n```\n\n## コード解説\n\nまずは元の画像から、中身が白で背景が黒の２値画像を作成します。\n![gray.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/70a2a907-0da2-8f8f-62f5-7e9a9731bf0b.png)\n\n次に`cv2.morphologyEx`で周囲が円形になるように画像を膨張させます。\n![morph.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/8a9b5e26-1a14-22e9-3415-36f655a14889.png)\nただ、そのまま膨張させると凹部分が鋭角のままになってしまいます。\nそこでPILの`ModeFilter`という最頻値をとるフィルターをかけます。\n![mode.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/bb28afbe-526f-7387-20cb-aa3cab5af16b.png)\n凹部分もうまくなめらかになりました。\nあとは`cv2.findContours`で外接する輪郭を取得して内側を白で塗りつぶします。\nこれはドーナツのように内側に穴のあるような画像を考慮しての後処理になります。\n\n最後に元の画像と合成して完成です。\n![ret.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/4a66f7e7-7c7f-caff-9a23-b113298756bf.png)\n\n## その他\nわりといいかんじにできました。\n元ネタ：[画像輪郭のなめらか処理の方法](https://teratail.com/questions/glod0xjc398xr7)\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:28:35+09:00","group":null,"id":"2acddf12feaa3d8b2e21","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"画像処理","versions":[]},{"name":"OpenCV","versions":[]}],"title":"OpenCVとPILでアクリルバッジの型枠画像を作成する","updated_at":"2022-09-18T21:37:02+09:00","url":"https://qiita.com/can110/items/2acddf12feaa3d8b2e21","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":2,"github_login_name":null,"id":"can110","items_count":10,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":175214,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/175214/profile-images/1565265486","team_only":false,"twitter_screen_name":"can110","website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:18\"\u003e\n\u003cspan id=\"エラー内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエラー内容\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-3:14\"\u003efedora36にて\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"5:1-7:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003epyenv \u003cspan class=\"nb\"\u003einstall \u003c/span\u003e3.8.13\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"9:1-9:69\"\u003eを実行し、python3.8.13をインストールしようとしたら\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"11:1-41:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eDownloading Python-3.8.13.tar.xz...\n-\u0026gt; https://www.python.org/ftp/python/3.8.13/Python-3.8.13.tar.xz\nInstalling Python-3.8.13...\nWARNING: The Python bz2 extension was not compiled. Missing the bzip2 lib?\nWARNING: The Python curses extension was not compiled. Missing the ncurses lib?\nWARNING: The Python ctypes extension was not compiled. Missing the libffi lib?\nWARNING: The Python readline extension was not compiled. Missing the GNU readline lib?\nERROR: The Python ssl extension was not compiled. Missing the OpenSSL lib?\n\nPlease consult to the Wiki page to fix the problem.\nhttps://github.com/pyenv/pyenv/wiki/Common-build-problems\n\n\nBUILD FAILED (Fedora Linux 36 using python-build 20180424)\n\nInspect or clean up the working tree at /tmp/python-build.20220918205119.66482\nResults logged to /tmp/python-build.20220918205119.66482.log\n\nLast 10 log lines:\n\t ./python -E -m ensurepip \\\n\t\t$ensurepip --root=/ ; \\\nfi\nLooking in links: /tmp/tmpkvcgm8zh\nProcessing /tmp/tmpkvcgm8zh/setuptools-56.0.0-py3-none-any.whl\nProcessing /tmp/tmpkvcgm8zh/pip-22.0.4-py3-none-any.whl\nInstalling collected packages: setuptools, pip\n  WARNING: The scripts pip3 and pip3.8 are installed in '/home/***/.pyenv/versions/3.8.13/bin' which is not on PATH.\n  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.\nSuccessfully installed pip-22.0.4 setuptools-56.0.0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"42:1-42:39\"\u003eとなってBUILD FAILEDとなった。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"44:1-44:12\"\u003e\n\u003cspan id=\"解決策\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決策\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"46:1-46:41\"\u003e\n\u003cspan id=\"openssl11-develをインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#openssl11-devel%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eopenssl1.1-develをインストール\u003c/h3\u003e\n\u003cp data-sourcepos=\"48:1-48:87\"\u003e\u003cqiita-embed-ogp src=\"https://fedora.pkgs.org/36/fedora-x86_64/openssl1.1-devel-1.1.1n-1.fc36.x86_64.rpm.html\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"50:1-51:179\"\u003e↑から\u003ccode\u003eopenssl1.1-devel\u003c/code\u003eのrpmパッケージをローカルにダウンロードして\u003cbr\u003e\n（\u003ca href=\"https://download-ib01.fedoraproject.org/pub/fedora/linux/releases/36/Everything/x86_64/os/Packages/o/openssl1.1-devel-1.1.1n-1.fc36.x86_64.rpm\" rel=\"nofollow noopener\" target=\"_blank\"\u003eダウンロードリンク\u003c/a\u003e）\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"52:1-54:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003esudo \u003c/span\u003ednf \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e localinstall ./openssl1.1-devel-1.1.1n-1.fc36.x86_64.rpm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"55:1-55:66\"\u003eを実行することで\u003ccode\u003eopenssl1.1-devel\u003c/code\u003eをインストール。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"57:1-57:31\"\u003e\n\u003cspan id=\"pyenv-installを再実行\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pyenv-install%E3%82%92%E5%86%8D%E5%AE%9F%E8%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003epyenv install\u003c/code\u003eを再実行\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"58:1-60:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003epyenv install インストールしたバージョン\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch3 data-sourcepos=\"62:1-62:10\"\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h3\u003e\n\u003cp data-sourcepos=\"64:1-66:51\"\u003eエラー情報に\u003cbr\u003e\n\u003ca href=\"https://github.com/pyenv/pyenv/wiki/Common-build-problems\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/pyenv/pyenv/wiki/Common-build-problems\u003c/a\u003e\u003cbr\u003e\nを参照しろとのガイドがありました。\u003c/p\u003e\n\u003cp data-sourcepos=\"68:1-68:25\"\u003eただ、↑のwikiには\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"69:1-71:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003esudo \u003c/span\u003eyum \u003cspan class=\"nb\"\u003einstall \u003c/span\u003eopenssl11-devel \u003cspan class=\"nt\"\u003e--allowerasing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"72:1-72:112\"\u003eで\u003ccode\u003eopenssl11-devel\u003c/code\u003eをインストールすることが書かれていたものの、Fedora36で実行すると\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"73:1-76:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eNo match for argument: openssl11-devel\nError: Unable to find a match: openssl11-devel\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"77:1-77:108\"\u003eとなるので、RPMパッケージをローカルにダウンロードすることで解決しました。\u003c/p\u003e\n","body":"## エラー内容\n\nfedora36にて\n\n```sh\npyenv install 3.8.13\n```\n\nを実行し、python3.8.13をインストールしようとしたら\n\n```\nDownloading Python-3.8.13.tar.xz...\n-\u003e https://www.python.org/ftp/python/3.8.13/Python-3.8.13.tar.xz\nInstalling Python-3.8.13...\nWARNING: The Python bz2 extension was not compiled. Missing the bzip2 lib?\nWARNING: The Python curses extension was not compiled. Missing the ncurses lib?\nWARNING: The Python ctypes extension was not compiled. Missing the libffi lib?\nWARNING: The Python readline extension was not compiled. Missing the GNU readline lib?\nERROR: The Python ssl extension was not compiled. Missing the OpenSSL lib?\n\nPlease consult to the Wiki page to fix the problem.\nhttps://github.com/pyenv/pyenv/wiki/Common-build-problems\n\n\nBUILD FAILED (Fedora Linux 36 using python-build 20180424)\n\nInspect or clean up the working tree at /tmp/python-build.20220918205119.66482\nResults logged to /tmp/python-build.20220918205119.66482.log\n\nLast 10 log lines:\n\t ./python -E -m ensurepip \\\n\t\t$ensurepip --root=/ ; \\\nfi\nLooking in links: /tmp/tmpkvcgm8zh\nProcessing /tmp/tmpkvcgm8zh/setuptools-56.0.0-py3-none-any.whl\nProcessing /tmp/tmpkvcgm8zh/pip-22.0.4-py3-none-any.whl\nInstalling collected packages: setuptools, pip\n  WARNING: The scripts pip3 and pip3.8 are installed in '/home/***/.pyenv/versions/3.8.13/bin' which is not on PATH.\n  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.\nSuccessfully installed pip-22.0.4 setuptools-56.0.0\n```\nとなってBUILD FAILEDとなった。\n\n## 解決策\n\n### openssl1.1-develをインストール\n\nhttps://fedora.pkgs.org/36/fedora-x86_64/openssl1.1-devel-1.1.1n-1.fc36.x86_64.rpm.html\n\n↑から`openssl1.1-devel`のrpmパッケージをローカルにダウンロードして\n（[ダウンロードリンク](https://download-ib01.fedoraproject.org/pub/fedora/linux/releases/36/Everything/x86_64/os/Packages/o/openssl1.1-devel-1.1.1n-1.fc36.x86_64.rpm)）\n```sh\nsudo dnf -y localinstall ./openssl1.1-devel-1.1.1n-1.fc36.x86_64.rpm\n```\nを実行することで`openssl1.1-devel`をインストール。\n\n### `pyenv install`を再実行\n```\npyenv install インストールしたバージョン\n```\n\n### 参考\n\nエラー情報に\nhttps://github.com/pyenv/pyenv/wiki/Common-build-problems\nを参照しろとのガイドがありました。\n\nただ、↑のwikiには\n```sh\nsudo yum install openssl11-devel --allowerasing\n```\nで`openssl11-devel`をインストールすることが書かれていたものの、Fedora36で実行すると\n```\nNo match for argument: openssl11-devel\nError: Unable to find a match: openssl11-devel\n```\nとなるので、RPMパッケージをローカルにダウンロードすることで解決しました。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:25:43+09:00","group":null,"id":"9ea1ab7aa24e2d3fcf67","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Linux","versions":[]},{"name":"fedora","versions":[]},{"name":"pyenv","versions":[]}],"title":"fedora36でpyenvでのインストールがFailedするのをなおす","updated_at":"2022-09-18T21:25:43+09:00","url":"https://qiita.com/tomomichelle/items/9ea1ab7aa24e2d3fcf67","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":0,"github_login_name":"tomomichelle","id":"tomomichelle","items_count":1,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":2849917,"profile_image_url":"https://avatars.githubusercontent.com/u/44546456?v=4","team_only":false,"twitter_screen_name":null,"website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:15\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-3:242\"\u003e身近なもので何かないかなと考えていたのですが、昔やった色塗り問題を思い出しました。例えば下のように3マスあって、3色で色を塗り分けた場合、塗り方が何通りあるかです。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:122\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/0daed9097079ac089ae7dc1fd6fd43558ff569f0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313235393935312f32326461636666362d353633372d613866342d333839392d6135366533613864343465662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1259951%2F22dacff6-5637-a8f4-3899-a56e3a8d44ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d06518b99f9bbaa095a2ee47d6cbfbd6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1259951/22dacff6-5637-a8f4-3899-a56e3a8d44ef.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1259951%2F22dacff6-5637-a8f4-3899-a56e3a8d44ef.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fa5ab676bd5c31766c1fbf5519d620e6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-8:115\"\u003eマスを区別するので全体は3×3×3=27通りです。この時、隣同士で色が重複しない塗り方は何通りあるか考えてみましょう。\u003cbr\u003e\n・・・正直アルゴリズム使わなくても、ごり押しで求められます(★の部分で12通り)。\u003c/p\u003e\n\u003cp data-sourcepos=\"10:1-10:122\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/e59fd21ccd2696d049396b1ed7d7023868bed0ce/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313235393935312f35636239373432372d613137312d343432302d613934322d3862636534303631313537642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1259951%2F5cb97427-a171-4420-a942-8bce4061157d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ba6b3a848dac36b876e6274c087748b3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1259951/5cb97427-a171-4420-a942-8bce4061157d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1259951%2F5cb97427-a171-4420-a942-8bce4061157d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4ace70a338e56f24dab3a619e08461fa 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"12:1-12:99\"\u003eでもせっかくなので、アルゴリズムを使って考えてみることにしました。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"14:1-14:51\"\u003e\n\u003cspan id=\"アルゴリズム的な何かを書いてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E7%9A%84%E3%81%AA%E4%BD%95%E3%81%8B%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアルゴリズム的な何かを書いてみる\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"16:1-35:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eitertools\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#重複を許して3種類の組み合わせを作成(赤：0　黄：1　青：2)\n\u003c/span\u003e\u003cspan class=\"n\"\u003ecomb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitertools\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eproduct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003erepeat\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003cspan class=\"n\"\u003el_comb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecomb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e#リスト化\n\u003c/span\u003e\n\u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#組み合わせの1番目と2番目、もしくは2番目と3番目が同じ場合は削除\n\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el_comb\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003el_comb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003el_comb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"ow\"\u003eor\u003c/span\u003e \u003cspan class=\"n\"\u003el_comb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003el_comb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el_comb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e#得られた組み合わせとその数を表示\n\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"36:1-36:122\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/503104c11e966d9c1a93d20be0856f7ffbbbcb91/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313235393935312f65356138366265312d646261342d313935362d636466392d3566613736633837333262652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1259951%2Fe5a86be1-dba4-1956-cdf9-5fa76c8732be.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c610fea4616371b30d5de3fa4a3b442a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1259951/e5a86be1-dba4-1956-cdf9-5fa76c8732be.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1259951%2Fe5a86be1-dba4-1956-cdf9-5fa76c8732be.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a123168d761052236b885d8c4cfe2ccb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"38:1-39:59\"\u003eまず組み合わせを作成しています。そこから1番目-2番目もしくは2番目-3番目の値が被っていないものだけを、新しいリストに入れて作りました。\u003cbr\u003e\nちゃんと12個作成されたことがわかります。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"41:1-41:12\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\u003cp data-sourcepos=\"42:1-42:198\"\u003eアルゴリズムってその道のプロじゃないと書けないかなと思っていたのですが、素人でもやりようによっては作れることがわかってよかったです。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"44:1-44:9\"\u003e\n\u003cspan id=\"参考\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考\u003c/h2\u003e\n\u003cp data-sourcepos=\"45:1-46:69\"\u003e\u003ca href=\"https://hibiki-press.tech/python/itertools/1796\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://hibiki-press.tech/python/itertools/1796\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://docs.python.org/ja/3/library/itertools.html#itertools.product\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://docs.python.org/ja/3/library/itertools.html#itertools.product\u003c/a\u003e\u003c/p\u003e\n","body":"## はじめに\n\n身近なもので何かないかなと考えていたのですが、昔やった色塗り問題を思い出しました。例えば下のように3マスあって、3色で色を塗り分けた場合、塗り方が何通りあるかです。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1259951/22dacff6-5637-a8f4-3899-a56e3a8d44ef.png)\n\nマスを区別するので全体は3×3×3=27通りです。この時、隣同士で色が重複しない塗り方は何通りあるか考えてみましょう。\n・・・正直アルゴリズム使わなくても、ごり押しで求められます(★の部分で12通り)。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1259951/5cb97427-a171-4420-a942-8bce4061157d.png)\n\nでもせっかくなので、アルゴリズムを使って考えてみることにしました。\n\n## アルゴリズム的な何かを書いてみる\n\n```python\nimport itertools\n\n#重複を許して3種類の組み合わせを作成(赤：0　黄：1　青：2)\ncomb = itertools.product(range(3), repeat=3) \nl_comb = list(comb) #リスト化\n\nresult = []\n\n#組み合わせの1番目と2番目、もしくは2番目と3番目が同じ場合は削除\nfor i in range(len(l_comb)):\n    if l_comb[i][0] == l_comb[i][1] or l_comb[i][1] == l_comb[i][2]:\n        continue\n    else:\n        result.append(l_comb[i])\n\n#得られた組み合わせとその数を表示\nprint(result)\nprint(len(result)) \n```\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1259951/e5a86be1-dba4-1956-cdf9-5fa76c8732be.png)\n\nまず組み合わせを作成しています。そこから1番目-2番目もしくは2番目-3番目の値が被っていないものだけを、新しいリストに入れて作りました。\nちゃんと12個作成されたことがわかります。\n\n## まとめ\nアルゴリズムってその道のプロじゃないと書けないかなと思っていたのですが、素人でもやりようによっては作れることがわかってよかったです。\n\n## 参考\nhttps://hibiki-press.tech/python/itertools/1796\nhttps://docs.python.org/ja/3/library/itertools.html#itertools.product\n","coediting":false,"comments_count":1,"created_at":"2022-09-18T21:25:24+09:00","group":null,"id":"6d613847ac88b1708611","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"アルゴリズム","versions":[]},{"name":"数学","versions":[]},{"name":"colaboratory","versions":[]}],"title":"色の塗り分け問題をアルゴリズムで解いてみる","updated_at":"2022-09-18T21:25:24+09:00","url":"https://qiita.com/dem_kk/items/6d613847ac88b1708611","user":{"description":"メーカー勤務。業務でPythonを始めています。備忘録用。","facebook_id":"","followees_count":1,"followers_count":6,"github_login_name":null,"id":"dem_kk","items_count":46,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":1259951,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/1259951/6432ede662ff536e08c0116c33ea70ca69b20fe5/x_large.png?1617169370","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:11\"\u003e\n\u003cspan id=\"問題点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題点\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-2:105\"\u003e初期設定の\u003ccode\u003ehistory\u003c/code\u003eコマンドでは、いつコマンドが入力されたかが分からない。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"3:1-3:35\"\u003e\n\u003cspan id=\"特に参考になったサイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%89%B9%E3%81%AB%E5%8F%82%E8%80%83%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e特に参考になったサイト\u003c/h1\u003e\n\u003cp data-sourcepos=\"4:1-4:45\"\u003e\u003cqiita-embed-ogp src=\"https://linuxfan.info/add-datetime-to-history\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"5:1-5:8\"\u003e\n\u003cspan id=\"解決\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E6%B1%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解決\u003c/h1\u003e\n\u003cp data-sourcepos=\"6:1-6:108\"\u003e以下のコマンドを入力すると、各コマンドの入力日時が表示されるようになる。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"7:1-9:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eexport HISTTIMEFORMAT='%F %T '\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"10:1-10:141\"\u003eただしこれだと上記コマンド以前の入力コマンドの日付は全て、上記コマンド入力時点になってしまう。\u003c/p\u003e\n\u003cp data-sourcepos=\"12:1-13:72\"\u003eそこで毎回自動的にこのコマンドが実行されるように、\u003cbr\u003e\n環境作成時に、まずはこれを初めにやった方がいい。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"14:1-16:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ echo \"export HISTTIMEFORMAT='%F %T '\" \u0026gt;\u0026gt; ~/.bashrc\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"shell\" data-sourcepos=\"17:1-23:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e/home/USERNAME/.bashrc\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# .bashrc\u003c/span\u003e\n\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eHISTTIMEFORMAT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e'%F %T '\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"25:1-26:97\"\u003eというかそもそも、\u003cbr\u003e\nhistory表示は絶対初めからに日時が分かった方がいいと思うのだが・・・\u003c/p\u003e\n","body":"# 問題点\n初期設定の`history`コマンドでは、いつコマンドが入力されたかが分からない。\n# 特に参考になったサイト\nhttps://linuxfan.info/add-datetime-to-history\n# 解決\n以下のコマンドを入力すると、各コマンドの入力日時が表示されるようになる。\n```\nexport HISTTIMEFORMAT='%F %T '\n```\nただしこれだと上記コマンド以前の入力コマンドの日付は全て、上記コマンド入力時点になってしまう。\n\nそこで毎回自動的にこのコマンドが実行されるように、\n環境作成時に、まずはこれを初めにやった方がいい。\n```\n$ echo \"export HISTTIMEFORMAT='%F %T '\" \u003e\u003e ~/.bashrc\n```\n```/home/USERNAME/.bashrc\n# .bashrc\n.\n.\n.\nexport HISTTIMEFORMAT='%F %T '\n```\n\nというかそもそも、\nhistory表示は絶対初めからに日時が分かった方がいいと思うのだが・・・\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:25:03+09:00","group":null,"id":"44c49f40ea422a0a9d2d","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Linuxコマンド","versions":[]}],"title":"LINUXのhistoryコマンド、初期設定で日時が分かるようにして欲しいですね","updated_at":"2022-09-18T21:25:03+09:00","url":"https://qiita.com/shini12/items/44c49f40ea422a0a9d2d","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":0,"github_login_name":null,"id":"shini12","items_count":7,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":111408,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/111408/profile-images/1473711556","team_only":false,"twitter_screen_name":"shini12","website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:15\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\u003cp data-sourcepos=\"2:1-2:231\"\u003eこの記事ではASEで自作の\u003ccode\u003eCalculator\u003c/code\u003eを実装する方法について解説します。材料分野でよく使われるGNNモデルを用いて結晶構造のエネルギーを算出する\u003ccode\u003eCalculator\u003c/code\u003eを例とします。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"4:1-4:27\"\u003e\n\u003cspan id=\"必要なパッケージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必要なパッケージ\u003c/h2\u003e\n\u003cul data-sourcepos=\"5:1-8:0\"\u003e\n\u003cli data-sourcepos=\"5:1-5:5\"\u003ease\u003c/li\u003e\n\u003cli data-sourcepos=\"6:1-6:7\"\u003etorch\u003c/li\u003e\n\u003cli data-sourcepos=\"7:1-8:0\"\u003eocpmodels\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 data-sourcepos=\"9:1-9:12\"\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\u003cp data-sourcepos=\"10:1-10:60\"\u003eいきなりですが、コードは以下になります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"12:1-81:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003e__future__\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eannotations\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ease\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eAtoms\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ease.calculators.calculator\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eCalculator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eall_changes\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eocpmodels.models\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eBaseModel\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eocpmodels.preprocessing.atoms_to_graphs\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eAtomsToGraphs\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eALL_CHANGES\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etuple\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eall_changes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eNNPCalculator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCalculator\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"\"\"\n    Calculator using a neural network potential model.\n    \n    Args:\n        model: OCP model\n        cutoff: Cutoff radius to get a graph.\n        device: Calculation device\n        **kwargs: Keyward arguments passed to :meth:`Calculator.__init__`\n    \"\"\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimplemented_properties\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"energy\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"forces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBaseModel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecutoff\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e6.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003ekwargs\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003ekwargs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enamed_parameters\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erequires_grad_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eatg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAtomsToGraphs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eradius\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecutoff\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecalculate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eatoms\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAtoms\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003etuple\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"energy\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"forces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esystem_changes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003etuple\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eALL_CHANGES\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"\"\"\n        Args:\n            atoms: Atoms object\n            properties: Properties to be calculated.\n            system_changes: Parameters to detect if Atoms have been changed.\n        \"\"\"\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003ecalculate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eatoms\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esystem_changes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eatg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econvert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eatoms\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eneighbors\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etensor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eedge_index\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"s\"\u003e\"forces\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eregress_forces\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eno_grad\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eenergy\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eforces\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresults\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"forces\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eforces\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecpu\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003enumpy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eregress_forces\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eno_grad\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eenergy\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresults\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"energy\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eenergy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"83:1-83:21\"\u003e\n\u003cspan id=\"コードの説明\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E8%AA%AC%E6%98%8E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコードの説明\u003c/h2\u003e\n\u003cp data-sourcepos=\"84:1-84:36\"\u003e順にコードを説明します。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"86:1-86:14\"\u003e\n\u003cspan id=\"__init__\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#__init__\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e__init__\u003c/code\u003e\n\u003c/h3\u003e\n\u003cp data-sourcepos=\"87:1-88:340\"\u003eまずは\u003ccode\u003e__init__\u003c/code\u003e内で、\u003ccode\u003esuper().__init__()\u003c/code\u003eを呼び出します。これは\u003ccode\u003eCalculator\u003c/code\u003eを継承したときに必須の操作で、諸々の設定を行ってくれます。\u003cbr\u003e\n今回はmodelを引数に渡しています。これはocpmodelsで利用可能なモデルを渡すことができます。予測時にモデルのパラメータ更新は不要ですので、各パラメータが計算グラフを作成しないように設定します。また、\u003ccode\u003emodel.eval()\u003c/code\u003eで予測モードにしておきます。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"90:1-90:15\"\u003e\n\u003cspan id=\"calculate\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#calculate\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecalculate\u003c/code\u003e\n\u003c/h3\u003e\n\u003cp data-sourcepos=\"91:1-94:57\"\u003ecalculatorのコアの部分です。この部分にenergyやforcesを計算するプロセスを記述します。計算可能なpropertyは\u003ccode\u003eimplemented_property\u003c/code\u003eで設定しておく必要があります。\u003cbr\u003e\n\u003ccode\u003ecalculate\u003c/code\u003eの引数には\u003ccode\u003eatoms\u003c/code\u003e（計算するAtomsオブジェクト）, \u003ccode\u003eproperties\u003c/code\u003e（計算する物性）, \u003ccode\u003esystem_changes\u003c/code\u003e（Atomsオブジェクトが変更されたか判断するための量）があります。Calculatorはキャッシュをうまく使っており、計算対象のAtomsが前回計算したものと同じである場合、計算はスキップされキャッシュを使用します。この同一判断に\u003ccode\u003esystem_changes\u003c/code\u003eが用いられます。\u003cbr\u003e\nなお、\u003ccode\u003esystem_changes\u003c/code\u003eの引数にはASEの実装では\u003ccode\u003eall_changes\u003c/code\u003eというものが使われています。これはリストになっているのですが、関数のデフォルト値としてリストを渡すのは非推奨です（内部で意図せず変更された場合にデフォルト値も変わってしまうため）。上記実装では代わりにtupleを渡しています。\u003cbr\u003e\n\u003ccode\u003esuper().calculate()\u003c/code\u003eで上記の処理を行います。\u003c/p\u003e\n\u003cp data-sourcepos=\"96:1-96:269\"\u003eキャッシュが使用できない場合、計算に進みます。\u003ccode\u003eBaseModel\u003c/code\u003eの入力はtorch_geometricの\u003ccode\u003eData\u003c/code\u003eか\u003ccode\u003eBatch\u003c/code\u003eオブジェクトである必要があるので、まずはAtomsを変換します。これを計算するデバイスに移動させます。\u003c/p\u003e\n\u003cp data-sourcepos=\"98:1-99:363\"\u003eその後は\u003ccode\u003eBaseModel\u003c/code\u003eにデータを渡してenergy, forcesを計算します。ocpmodelsの実装では、modelのattributeに\u003ccode\u003eregress_forces\u003c/code\u003eというものがあります。これがTrueだと(energy, forces)のtupleが返され、Falseだとenergyのみ返されます。\u003cbr\u003e\nなお、forcesはenergyをpositionで微分するので、\u003ccode\u003etorch.no_grad()\u003c/code\u003eでは計算グラフが作られず、energyの自動微分が出来ないと思われるかもしれませんが、ocpmodelsでは内部でうまく処理していて、\u003ccode\u003eregress_forces\u003c/code\u003eがTrueになっていると、計算グラフを作るモードに自動的に変更されます。\u003c/p\u003e\n\u003cp data-sourcepos=\"101:1-101:142\"\u003eあとは計算結果を\u003ccode\u003eself.results\u003c/code\u003eに保存すれば完了です。numpy配列にする必要があることに注意してください。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"103:1-103:25\"\u003e\n\u003cspan id=\"calculatorの使い方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#calculator%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCalculatorの使い方\u003c/h2\u003e\n\u003cp data-sourcepos=\"104:1-104:133\"\u003e上記の実装で、通常のCalculatorと同様に使用可能です。例えば、以下でエネルギーを取得できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"105:1-111:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eocpmodels.models\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eSchNet\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emodel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSchNet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecalc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNNPCalculator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eenergy\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecalc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_potential_energy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eatoms\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"113:1-113:12\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h2\u003e\n\u003cp data-sourcepos=\"114:1-115:87\"\u003eこのようにCalculatorの実装方法を勉強すれば、自作のNNPモデルで各種計算が可能です。例えばstressも実装することで、結晶構造の構造緩和も可能になり、DFT計算よりも圧倒的に高速に実行することができます。\u003cbr\u003e\n色々応用範囲も広いので、他の例も追々投稿したいと思います。\u003c/p\u003e\n","body":"## はじめに\nこの記事ではASEで自作の`Calculator`を実装する方法について解説します。材料分野でよく使われるGNNモデルを用いて結晶構造のエネルギーを算出する`Calculator`を例とします。\n\n## 必要なパッケージ\n* ase\n* torch\n* ocpmodels\n\n## コード\nいきなりですが、コードは以下になります。\n\n```python\nfrom __future__ import annotations\n\nfrom ase import Atoms\nfrom ase.calculators.calculator import Calculator, all_changes\nfrom ocpmodels.models import BaseModel\nfrom ocpmodels.preprocessing.atoms_to_graphs import AtomsToGraphs\nimport torch\n\nALL_CHANGES = tuple(all_changes)\n\n\nclass NNPCalculator(Calculator):\n    \"\"\"\n    Calculator using a neural network potential model.\n    \n    Args:\n        model: OCP model\n        cutoff: Cutoff radius to get a graph.\n        device: Calculation device\n        **kwargs: Keyward arguments passed to :meth:`Calculator.__init__`\n    \"\"\"\n    implemented_properties = (\"energy\", \"forces\")\n    \n    def __init__(\n        self,\n        model: BaseModel,\n        cutoff: float = 6.0,\n        device: str = \"cpu\",\n        **kwargs\n    ):\n        super().__init__(**kwargs)\n        \n        self.model = model\n        for n, p in self.model.named_parameters():\n            p.requires_grad_(False)\n        self.model.eval()\n        self.device = device\n        self.model.to(self.device)\n        self.atg = AtomsToGraphs(radius=cutoff)\n    \n    def calculate(\n        self,\n        atoms: Atoms | None = None,\n        properties: tuple[str] = (\"energy\", \"forces\"),\n        system_changes: tuple[str] = ALL_CHANGES\n    ) -\u003e None:\n        \"\"\"\n        Args:\n            atoms: Atoms object\n            properties: Properties to be calculated.\n            system_changes: Parameters to detect if Atoms have been changed.\n        \"\"\"\n        super().calculate(atoms, properties, system_changes)\n        \n        data = self.atg.convert(atoms)\n        data.neighbors = torch.tensor(data.edge_index.size(1))\n        data.to(self.device)\n        \n        if \"forces\" in properties:\n            self.model.regress_forces = True\n            with torch.no_grad():\n                energy, forces = self.model(data)\n            self.results[\"forces\"] = forces.cpu().numpy()\n        else:\n            self.model.regress_forces = False\n            with torch.no_grad():\n                energy = self.model(data)\n        self.results[\"energy\"] = energy.item()\n```\n\n## コードの説明\n順にコードを説明します。\n\n### `__init__`\nまずは`__init__`内で、`super().__init__()`を呼び出します。これは`Calculator`を継承したときに必須の操作で、諸々の設定を行ってくれます。\n今回はmodelを引数に渡しています。これはocpmodelsで利用可能なモデルを渡すことができます。予測時にモデルのパラメータ更新は不要ですので、各パラメータが計算グラフを作成しないように設定します。また、`model.eval()`で予測モードにしておきます。\n\n### `calculate`\ncalculatorのコアの部分です。この部分にenergyやforcesを計算するプロセスを記述します。計算可能なpropertyは`implemented_property`で設定しておく必要があります。\n`calculate`の引数には`atoms`（計算するAtomsオブジェクト）, `properties`（計算する物性）, `system_changes`（Atomsオブジェクトが変更されたか判断するための量）があります。Calculatorはキャッシュをうまく使っており、計算対象のAtomsが前回計算したものと同じである場合、計算はスキップされキャッシュを使用します。この同一判断に`system_changes`が用いられます。\nなお、`system_changes`の引数にはASEの実装では`all_changes`というものが使われています。これはリストになっているのですが、関数のデフォルト値としてリストを渡すのは非推奨です（内部で意図せず変更された場合にデフォルト値も変わってしまうため）。上記実装では代わりにtupleを渡しています。\n`super().calculate()`で上記の処理を行います。\n\nキャッシュが使用できない場合、計算に進みます。`BaseModel`の入力はtorch_geometricの`Data`か`Batch`オブジェクトである必要があるので、まずはAtomsを変換します。これを計算するデバイスに移動させます。\n\nその後は`BaseModel`にデータを渡してenergy, forcesを計算します。ocpmodelsの実装では、modelのattributeに`regress_forces`というものがあります。これがTrueだと(energy, forces)のtupleが返され、Falseだとenergyのみ返されます。\nなお、forcesはenergyをpositionで微分するので、`torch.no_grad()`では計算グラフが作られず、energyの自動微分が出来ないと思われるかもしれませんが、ocpmodelsでは内部でうまく処理していて、`regress_forces`がTrueになっていると、計算グラフを作るモードに自動的に変更されます。\n\nあとは計算結果を`self.results`に保存すれば完了です。numpy配列にする必要があることに注意してください。\n\n## Calculatorの使い方\n上記の実装で、通常のCalculatorと同様に使用可能です。例えば、以下でエネルギーを取得できます。\n```python\nfrom ocpmodels.models import SchNet\n\nmodel = SchNet(None, None, 1)\ncalc = NNPCalculator(model)\nenergy = calc.get_potential_energy(atoms)\n```\n\n## まとめ\nこのようにCalculatorの実装方法を勉強すれば、自作のNNPモデルで各種計算が可能です。例えばstressも実装することで、結晶構造の構造緩和も可能になり、DFT計算よりも圧倒的に高速に実行することができます。\n色々応用範囲も広いので、他の例も追々投稿したいと思います。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:24:55+09:00","group":null,"id":"575f86a64bb1d93b687c","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"PyTorch","versions":[]},{"name":"ASE","versions":[]},{"name":"GNN","versions":[]}],"title":"ASEでGNNを用いたCalculatorを自作する","updated_at":"2022-09-18T21:24:55+09:00","url":"https://qiita.com/mi-212/items/575f86a64bb1d93b687c","user":{"description":"元々は材料の実験研究者で、現在はマテリアルズインフォマティクスの研究をしています（主に機械学習ポテンシャル）。\r\ntwitter, githubで論文紹介などしています。","facebook_id":"","followees_count":2,"followers_count":2,"github_login_name":"mjrs33","id":"mi-212","items_count":2,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":334977,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/334977/cd3247c9b77c00cfb03002a5bda2de35c4d8144e/large.png?1607786008","team_only":false,"twitter_screen_name":"mi21216","website_url":"https://mobile.twitter.com/mi21216"},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-3:111\"\u003eRockyLinux8 vps環境設定9) サーバ再起動時の設定\u003cbr\u003e\n\u003ca href=\"https://qiita.com/naga_kt/items/11026238e56b134e93ad\" class=\"autolink\" id=\"reference-69356208b1e1c3672e32\"\u003ehttps://qiita.com/naga_kt/items/11026238e56b134e93ad\u003c/a\u003e\u003cbr\u003e\nの続き。WebArena Indigo(RockyLinux8.4)及びKagoya(RockyLinux8.5)での環境設定について述べる。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"5:1-5:34\"\u003e\n\u003cspan id=\"systemd-tmpfilesの設定変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#systemd-tmpfiles%E3%81%AE%E8%A8%AD%E5%AE%9A%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003esystemd-tmpfilesの設定変更\u003c/h2\u003e\n\u003cp data-sourcepos=\"7:2-7:156\"\u003e/tmpに作成したファイルが時々削除されていることに気付いた。これはCentOS7以降の仕様とのこと（参考記事参照）。\u003c/p\u003e\n\u003cp data-sourcepos=\"9:1-9:145\"\u003e　systemd-tmpfilesが/tmp以下のファイルの削除を行う。/tmp削除の設定は/usr/lib/tmpfiles.d/tmp.confに記述されている。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"11:1-35:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ cat /usr/lib/tmpfiles.d/tmp.conf\n#  This file is part of systemd.\n#\n#  systemd is free software; you can redistribute it and/or modify it\n#  under the terms of the GNU Lesser General Public License as published by\n#  the Free Software Foundation; either version 2.1 of the License, or\n#  (at your option) any later version.\n\n# See tmpfiles.d(5) for details\n\n# Clear tmp directories separately, to make them easier to override\nq /tmp 1777 root root 10d\nq /var/tmp 1777 root root 30d\n\n# Exclude namespace mountpoints created with PrivateTmp=yes\nx /tmp/systemd-private-%b-*\nX /tmp/systemd-private-%b-*/tmp\nx /var/tmp/systemd-private-%b-*\nX /var/tmp/systemd-private-%b-*/tmp\n\n# Remove top-level private temporary directories on each boot\nR! /tmp/systemd-private-*\nR! /var/tmp/systemd-private-*\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"37:1-37:318\"\u003e　上記にあるように/tmp以下のファイルが10日（10d）経ったら削除されるように設定されている。mtime(最終変更時間)、atime(最終アクセス時間)、ctime(最終属性変更時間)の全ての時間が削除までの期間を超過した時にファイルが削除される。\u003c/p\u003e\n\u003cp data-sourcepos=\"39:1-40:33\"\u003e　設定を変更するためには、上記のファイルを/etc/tmpfiles.dにコピーして、設定を追加する。/etc/tmpfiles.d/での設定は、/usr/lib/tmpfiles.d/の設定より優先される。\u003cbr\u003e\n　以下のように行った。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"42:1-45:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e# cp -p /usr/lib/tmpfiles.d/tmp.conf /etc/tmpfiles.d/\n# vi /etc/tmpfiles.d/tmp.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"47:1-47:42\"\u003e　ファイルに以下を追記した。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"48:1-50:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eX /tmp/xxxxx\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"52:1-52:160\"\u003e　systemd-tmpfilesの挙動の確認は、以下のようにするとデバッグログが吐き出されて、削除しなかった理由が述べられる。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"54:1-58:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ SYSTEMD_LOG_TARGET=console SYSTEMD_LOG_LEVEL=debug /usr/bin/systemd-tmpfiles --clean\n\nRunning clean action for entry X /tmp/xxxxx\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003chr data-sourcepos=\"61:1-65:0\"\u003e\n\u003chr data-sourcepos=\"66:1-67:0\"\u003e\n\u003ch3 data-sourcepos=\"68:1-68:16\"\u003e\n\u003cspan id=\"参考記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考記事\u003c/h3\u003e\n\u003cp data-sourcepos=\"70:1-71:51\"\u003eお前らもさっさとハマって泣くべきCentOS7の落とし穴4つ\u003cbr\u003e\n\u003ca href=\"https://qiita.com/suemoc/items/e29285e8e67263298f35\" class=\"autolink\" id=\"reference-d46bac5aa70148ba0336\"\u003ehttps://qiita.com/suemoc/items/e29285e8e67263298f35\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"73:1-74:54\"\u003etmpwatch（CentOS6まで）とsystemd-tmpfiles（CentOS7）の挙動の違い\u003cbr\u003e\n\u003ca href=\"https://qiita.com/kuroneko9/items/70a102a7bb1aa53661a2\" class=\"autolink\" id=\"reference-5d79dd13c49f0c39cec3\"\u003ehttps://qiita.com/kuroneko9/items/70a102a7bb1aa53661a2\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"76:1-77:58\"\u003e【CentOS】/tmp配下のファイルが消える理由\u003cbr\u003e\n\u003ca href=\"https://densan-hoshigumi.com/server/tmp-file-disappearance\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://densan-hoshigumi.com/server/tmp-file-disappearance\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"79:1-80:66\"\u003e【systemd-tmpfiles】CentOS8でディレクトリ内のファイルを定期的に消す方法\u003cbr\u003e\n\u003ca href=\"https://mikemikeblog.com/how-to-use-systemd-tmpfiles-with-centos8/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://mikemikeblog.com/how-to-use-systemd-tmpfiles-with-centos8/\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"82:1-83:50\"\u003etmpfiles.d(5) [centos man page]\u003cbr\u003e\n\u003ca href=\"https://www.unix.com/man-page/centos/5/tmpfiles.d/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.unix.com/man-page/centos/5/tmpfiles.d/\u003c/a\u003e\u003c/p\u003e\n","body":"RockyLinux8 vps環境設定9) サーバ再起動時の設定\nhttps://qiita.com/naga_kt/items/11026238e56b134e93ad\nの続き。WebArena Indigo(RockyLinux8.4)及びKagoya(RockyLinux8.5)での環境設定について述べる。\n\n## systemd-tmpfilesの設定変更\n\n /tmpに作成したファイルが時々削除されていることに気付いた。これはCentOS7以降の仕様とのこと（参考記事参照）。\n\n　systemd-tmpfilesが/tmp以下のファイルの削除を行う。/tmp削除の設定は/usr/lib/tmpfiles.d/tmp.confに記述されている。\n\n~~~linux\n$ cat /usr/lib/tmpfiles.d/tmp.conf\n#  This file is part of systemd.\n#\n#  systemd is free software; you can redistribute it and/or modify it\n#  under the terms of the GNU Lesser General Public License as published by\n#  the Free Software Foundation; either version 2.1 of the License, or\n#  (at your option) any later version.\n\n# See tmpfiles.d(5) for details\n\n# Clear tmp directories separately, to make them easier to override\nq /tmp 1777 root root 10d\nq /var/tmp 1777 root root 30d\n\n# Exclude namespace mountpoints created with PrivateTmp=yes\nx /tmp/systemd-private-%b-*\nX /tmp/systemd-private-%b-*/tmp\nx /var/tmp/systemd-private-%b-*\nX /var/tmp/systemd-private-%b-*/tmp\n\n# Remove top-level private temporary directories on each boot\nR! /tmp/systemd-private-*\nR! /var/tmp/systemd-private-*\n~~~\n\n　上記にあるように/tmp以下のファイルが10日（10d）経ったら削除されるように設定されている。mtime(最終変更時間)、atime(最終アクセス時間)、ctime(最終属性変更時間)の全ての時間が削除までの期間を超過した時にファイルが削除される。\n\n　設定を変更するためには、上記のファイルを/etc/tmpfiles.dにコピーして、設定を追加する。/etc/tmpfiles.d/での設定は、/usr/lib/tmpfiles.d/の設定より優先される。\n　以下のように行った。\n\n~~~linux\n# cp -p /usr/lib/tmpfiles.d/tmp.conf /etc/tmpfiles.d/\n# vi /etc/tmpfiles.d/tmp.conf\n~~~\n\n　ファイルに以下を追記した。\n~~~linux\nX /tmp/xxxxx\n~~~\n\n　systemd-tmpfilesの挙動の確認は、以下のようにするとデバッグログが吐き出されて、削除しなかった理由が述べられる。\n\n~~~linux\n$ SYSTEMD_LOG_TARGET=console SYSTEMD_LOG_LEVEL=debug /usr/bin/systemd-tmpfiles --clean\n\nRunning clean action for entry X /tmp/xxxxx\n~~~\n\n\n---\n\n\n\n\n---\n\n### 参考記事\n\nお前らもさっさとハマって泣くべきCentOS7の落とし穴4つ\nhttps://qiita.com/suemoc/items/e29285e8e67263298f35\n\ntmpwatch（CentOS6まで）とsystemd-tmpfiles（CentOS7）の挙動の違い\nhttps://qiita.com/kuroneko9/items/70a102a7bb1aa53661a2\n\n【CentOS】/tmp配下のファイルが消える理由\nhttps://densan-hoshigumi.com/server/tmp-file-disappearance\n\n【systemd-tmpfiles】CentOS8でディレクトリ内のファイルを定期的に消す方法\nhttps://mikemikeblog.com/how-to-use-systemd-tmpfiles-with-centos8/\n\ntmpfiles.d(5) [centos man page]\nhttps://www.unix.com/man-page/centos/5/tmpfiles.d/\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:24:09+09:00","group":null,"id":"87900d6a0b5172c091ea","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"tmp","versions":[]},{"name":"kagoya","versions":[]},{"name":"WebArena","versions":[]},{"name":"tmpfiles.d","versions":[]},{"name":"RockyLinux8","versions":[]}],"title":"RockyLinux8 vps環境設定10) /tmpフォルダのファイルの削除処理の変更","updated_at":"2022-09-18T21:24:09+09:00","url":"https://qiita.com/naga_kt/items/87900d6a0b5172c091ea","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"naga_kt","items_count":21,"linkedin_id":"","location":"","name":"naga k","organization":"","permanent_id":2384942,"profile_image_url":"https://secure.gravatar.com/avatar/456061c656e1ad812e80e3ef1834b81b","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-3:111\"\u003eRockyLinux8 vps環境設定8) ファイアウォールのポート設定\u003cbr\u003e\n\u003ca href=\"https://qiita.com/naga_kt/items/a93913d4c4aec4ff7eeb\" class=\"autolink\" id=\"reference-997409f4113c4fd73e23\"\u003ehttps://qiita.com/naga_kt/items/a93913d4c4aec4ff7eeb\u003c/a\u003e\u003cbr\u003e\nの続き。WebArena Indigo(RockyLinux8.4)及びKagoya(RockyLinux8.5)での環境設定について述べる。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:126\"\u003e　VPSを再起動したときにもサービスなどが自動起動するように設定する方法について述べる。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"7:1-7:36\"\u003e\n\u003cspan id=\"サービスの再起動の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサービスの再起動の設定\u003c/h2\u003e\n\u003cp data-sourcepos=\"9:1-9:108\"\u003e　デフォルトで自動起動するサービスは以下のようにしてリストアップできる。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"11:1-50:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ systemctl list-unit-files | grep enabled\nauditd.service                             enabled\nautovt@.service                            enabled\nchronyd.service                            enabled\ncloud-config.service                       enabled\ncloud-final.service                        enabled\ncloud-init-local.service                   enabled\ncloud-init.service                         enabled\ncrond.service                              enabled\ndbus-org.freedesktop.nm-dispatcher.service enabled\ndbus-org.freedesktop.timedate1.service     enabled\ngetty@.service                             enabled\nimport-state.service                       enabled\nirqbalance.service                         enabled\nkdump.service                              enabled\nloadmodules.service                        enabled\nmicrocode.service                          enabled\nNetworkManager-dispatcher.service          enabled\nNetworkManager-wait-online.service         enabled\nNetworkManager.service                     enabled\nnis-domainname.service                     enabled\nqemu-guest-agent.service                   enabled\nrngd.service                               enabled\nrpcbind.service                            enabled\nrsyslog.service                            enabled\nselinux-autorelabel-mark.service           enabled\nsshd.service                               enabled\nsssd.service                               enabled\nsyslog.service                             enabled\ntimedatex.service                          enabled\ntuned.service                              enabled\nrpcbind.socket                             enabled\nsssd-kcm.socket                            enabled\ncloud-init.target                          enabled-runtime\nnfs-client.target                          enabled\nremote-fs.target                           enabled\ndnf-makecache.timer                        enabled\nunbound-anchor.timer                       enabled\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"52:1-52:128\"\u003e　自動起動設定するサービスとしてhttpdを例にする。デフォルトでは以下のようになっている。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"54:1-57:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ systemctl list-unit-files | grep httpd.service\nhttpd.service                              disabled\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"59:1-59:54\"\u003e　以下のようにして自動起動設定する。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"61:1-64:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ sudo systemctl enable httpd.service\nCreated symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"66:1-66:51\"\u003e　設定確認するとenableになっている。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"68:1-71:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ systemctl list-unit-files | grep httpd.service\nhttpd.service                              enabled\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"73:1-73:30\"\u003e\n\u003cspan id=\"etcrcdrclocalの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#etcrcdrclocal%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e/etc/rc.d/rc.localの設定\u003c/h2\u003e\n\u003cp data-sourcepos=\"75:1-75:243\"\u003e　/etc/rc.d/rc.localファイルはサーバが再起動したときの動作を指定する。サーバが再起動したときに各アカウントでさせたい動作を追記する。デフォルトは以下のようになっている。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"77:1-92:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e!/bin/bash\n# THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES\n#\n# It is highly advisable to create own systemd services or udev rules\n# to run scripts during boot instead of using this file.\n#\n# In contrast to previous versions due to parallel execution during boot\n# this script will NOT be run after all other services.\n#\n# Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure\n# that this script will be executed during boot.\n\ntouch /var/lock/subsys/local\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003chr data-sourcepos=\"94:1-95:0\"\u003e\n\u003cp data-sourcepos=\"96:1-98:12\"\u003eRockyLinux8 vps環境設定10) /tmpフォルダのファイルの削除処理の変更\u003cbr\u003e\n\u003ca href=\"https://qiita.com/naga_kt/items/87900d6a0b5172c091ea\" class=\"autolink\" id=\"reference-1510b200fcb0d0b76213\"\u003ehttps://qiita.com/naga_kt/items/87900d6a0b5172c091ea\u003c/a\u003e\u003cbr\u003e\nに続く。\u003c/p\u003e\n\u003chr data-sourcepos=\"100:1-101:0\"\u003e\n\u003ch2 data-sourcepos=\"102:1-102:15\"\u003e\n\u003cspan id=\"参考記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考記事\u003c/h2\u003e\n\u003chr data-sourcepos=\"103:1-104:0\"\u003e\n\u003cp data-sourcepos=\"105:1-106:38\"\u003e【新旧対応】Linuxでの自動起動の設定方法を解説\u003cbr\u003e\n\u003ca href=\"https://eng-entrance.com/linux_startup\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://eng-entrance.com/linux_startup\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"108:1-109:60\"\u003eCentOS8で起動時にプログラムを実行する(rc.localからの置き換え)\u003cbr\u003e\n\u003ca href=\"https://tire-retire.blogspot.com/2020/05/centos8rclocal.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://tire-retire.blogspot.com/2020/05/centos8rclocal.html\u003c/a\u003e\u003c/p\u003e\n","body":"RockyLinux8 vps環境設定8) ファイアウォールのポート設定\nhttps://qiita.com/naga_kt/items/a93913d4c4aec4ff7eeb\nの続き。WebArena Indigo(RockyLinux8.4)及びKagoya(RockyLinux8.5)での環境設定について述べる。\n\n　VPSを再起動したときにもサービスなどが自動起動するように設定する方法について述べる。\n\n## サービスの再起動の設定\n\n　デフォルトで自動起動するサービスは以下のようにしてリストアップできる。\n\n~~~linux\n$ systemctl list-unit-files | grep enabled\nauditd.service                             enabled\nautovt@.service                            enabled\nchronyd.service                            enabled\ncloud-config.service                       enabled\ncloud-final.service                        enabled\ncloud-init-local.service                   enabled\ncloud-init.service                         enabled\ncrond.service                              enabled\ndbus-org.freedesktop.nm-dispatcher.service enabled\ndbus-org.freedesktop.timedate1.service     enabled\ngetty@.service                             enabled\nimport-state.service                       enabled\nirqbalance.service                         enabled\nkdump.service                              enabled\nloadmodules.service                        enabled\nmicrocode.service                          enabled\nNetworkManager-dispatcher.service          enabled\nNetworkManager-wait-online.service         enabled\nNetworkManager.service                     enabled\nnis-domainname.service                     enabled\nqemu-guest-agent.service                   enabled\nrngd.service                               enabled\nrpcbind.service                            enabled\nrsyslog.service                            enabled\nselinux-autorelabel-mark.service           enabled\nsshd.service                               enabled\nsssd.service                               enabled\nsyslog.service                             enabled\ntimedatex.service                          enabled\ntuned.service                              enabled\nrpcbind.socket                             enabled\nsssd-kcm.socket                            enabled\ncloud-init.target                          enabled-runtime\nnfs-client.target                          enabled\nremote-fs.target                           enabled\ndnf-makecache.timer                        enabled\nunbound-anchor.timer                       enabled\n~~~\n\n　自動起動設定するサービスとしてhttpdを例にする。デフォルトでは以下のようになっている。\n\n~~~linux\n$ systemctl list-unit-files | grep httpd.service\nhttpd.service                              disabled\n~~~\n\n　以下のようにして自動起動設定する。\n\n~~~linux\n$ sudo systemctl enable httpd.service\nCreated symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.\n~~~\n\n　設定確認するとenableになっている。\n\n~~~linux\n$ systemctl list-unit-files | grep httpd.service\nhttpd.service                              enabled\n~~~\n\n## /etc/rc.d/rc.localの設定\n\n　/etc/rc.d/rc.localファイルはサーバが再起動したときの動作を指定する。サーバが再起動したときに各アカウントでさせたい動作を追記する。デフォルトは以下のようになっている。\n\n~~~linux\n!/bin/bash\n# THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES\n#\n# It is highly advisable to create own systemd services or udev rules\n# to run scripts during boot instead of using this file.\n#\n# In contrast to previous versions due to parallel execution during boot\n# this script will NOT be run after all other services.\n#\n# Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure\n# that this script will be executed during boot.\n\ntouch /var/lock/subsys/local\n\n~~~\n\n---\n\nRockyLinux8 vps環境設定10) /tmpフォルダのファイルの削除処理の変更\nhttps://qiita.com/naga_kt/items/87900d6a0b5172c091ea\nに続く。\n\n---\n\n## 参考記事\n---\n\n【新旧対応】Linuxでの自動起動の設定方法を解説\nhttps://eng-entrance.com/linux_startup\n\nCentOS8で起動時にプログラムを実行する(rc.localからの置き換え)\nhttps://tire-retire.blogspot.com/2020/05/centos8rclocal.html\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:17:37+09:00","group":null,"id":"11026238e56b134e93ad","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"systemctl","versions":[]},{"name":"kagoya","versions":[]},{"name":"WebArena","versions":[]},{"name":"RockyLinux8","versions":[]}],"title":"RockyLinux8 vps環境設定9) サーバ再起動時の設定","updated_at":"2022-09-18T21:25:04+09:00","url":"https://qiita.com/naga_kt/items/11026238e56b134e93ad","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"naga_kt","items_count":21,"linkedin_id":"","location":"","name":"naga k","organization":"","permanent_id":2384942,"profile_image_url":"https://secure.gravatar.com/avatar/456061c656e1ad812e80e3ef1834b81b","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:2-1:163\"\u003eIterator パターンは、要素の集まりを保有するオブジェクトの各要素に順番にアクセスする方法を提供するためのパターン\u003c/p\u003e\n\u003cp data-sourcepos=\"4:2-6:122\"\u003e何らかの集約体が必ずAggregate インタフェースを実装する\u003cbr\u003e\nAggregate とは、集約を意味する単語で、Aggregate インタフェースでは Iterator インタフェースの実装クラスを返す、iterator() というメソッドを定義している\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/a7c231bdd88c942fd2cdb70e53a14923b783708a/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323139333035332f32373165616564332d643031622d646130652d613963352d6438353763376462613637642e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2193053%2F271eaed3-d01b-da0e-a9c5-d857c7dba67d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b314d212e3a6885fb1faa537bd6dd6a0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2193053/271eaed3-d01b-da0e-a9c5-d857c7dba67d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2193053%2F271eaed3-d01b-da0e-a9c5-d857c7dba67d.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=527fabaefa8d1aa55553540d370c71b7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"10:1-104:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eAggregate\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eitereter\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003eItereter\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eItereter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003eboolean\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//male:1 female:2\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003egetSex\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esex\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudentList\u003c/span\u003e \u003cspan class=\"k\"\u003eimplements\u003c/span\u003e \u003cspan class=\"nx\"\u003eAggregate\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003estudents\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudent\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estudents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003egetStudentAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudent\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estudents\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eget\u003c/span\u003e \u003cspan class=\"nx\"\u003egetLength\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elast\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estudent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudent\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estudents\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estudent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elast\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003eitereter\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003eItereter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyStudentIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMyStudentIterator\u003c/span\u003e \u003cspan class=\"k\"\u003eimplements\u003c/span\u003e \u003cspan class=\"nx\"\u003eItereter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudentList\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003elist\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003eboolean\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetLength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetStudentAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eindex\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudentList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eyuki\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eStudent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eaya\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emyStudentList\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eitereter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()){\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eMain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"106:1-106:15\"\u003e\n\u003cspan id=\"参考文献\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考文献\u003c/h2\u003e\n\u003cul data-sourcepos=\"107:1-107:78\"\u003e\n\u003cli data-sourcepos=\"107:1-107:78\"\u003e\u003ca href=\"https://www.techscore.com/tech/DesignPattern/Iterator/Iterator2\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTECHSCORE\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":" Iterator パターンは、要素の集まりを保有するオブジェクトの各要素に順番にアクセスする方法を提供するためのパターン\n\n\n 何らかの集約体が必ずAggregate インタフェースを実装する\nAggregate とは、集約を意味する単語で、Aggregate インタフェースでは Iterator インタフェースの実装クラスを返す、iterator() というメソッドを定義している\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2193053/271eaed3-d01b-da0e-a9c5-d857c7dba67d.png)\n\n\n\n```typescript\ninterface Aggregate {\n    itereter(): Itereter\n}\n\ninterface Itereter {\n    hasNext(): boolean;\n    next(): Object;\n}\n\nclass Student {\n    name: string;\n    sex: number; //male:1 female:2\n\n    constructor(name: string, sex: number) {\n        this.name = name;\n        this.sex = sex;\n    }\n\n    getName() {\n        return this.name;\n    }\n\n    getSex() {\n        return this.sex\n    }\n}\n\nclass StudentList implements Aggregate{\n    last: number = 0;\n    students: Student[];\n\n    constructor() {\n        this.students = [];\n    }\n\n    public getStudentAt(last: number): Student {\n        return this.students[last];\n    }\n\nget getLength() {\n        return this.last\n    }\n\n    public add(student: Student): void {\n        this.students[this.last] = student;\n        this.last++;\n    }\n\n    public itereter(): Itereter {\n        return new MyStudentIterator(this)\n    }\n}\n\n\n\nclass MyStudentIterator implements Itereter {\n    index: number\n    myStudentList: StudentList\n\n    constructor(list: StudentList) {\n        this.index = 0;\n        this.myStudentList = list\n    }\n\n    hasNext(): boolean {\n        if (this.index \u003c this.myStudentList.getLength) {\n            return true\n        }\n        else {\n            return false;\n        };\n    };\n\n    next(): Object {\n        const s = this.myStudentList.getStudentAt(this.index);\n        this.index++;\n        return s\n    }\n}\n\n\nfunction Main() {\n    const myStudentList: StudentList = new StudentList()\n    myStudentList.add(new Student('yuki', 1))\n    myStudentList.add(new Student('aya', 2))\n\n    const it = myStudentList.itereter()\n    while(it.hasNext()){\n        console.log(it.next())\n    }\n}\n\nMain()\n```\n\n## 参考文献\n* [TECHSCORE](https://www.techscore.com/tech/DesignPattern/Iterator/Iterator2)\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:08:50+09:00","group":null,"id":"7e4377570bb1ee23ee99","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"デザインパターン","versions":[]}],"title":"デザインパターン Iterator(typescript) ","updated_at":"2022-09-18T21:08:50+09:00","url":"https://qiita.com/ponchuchu/items/7e4377570bb1ee23ee99","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":null,"id":"ponchuchu","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":2193053,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2193053/profile-images/1650371091","team_only":false,"twitter_screen_name":"cookie_enginee","website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:8\"\u003e\n\u003cspan id=\"内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e内容\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-3:53\"\u003e\u003ca href=\"https://prog-8.com/docs/rails-env-win\" rel=\"nofollow noopener\" target=\"_blank\"\u003eProgateのサイト\u003c/a\u003eの通りに環境構築をしていた時に出たエラー\u003cbr\u003e\nrails sが通らない/サーバーが起動しない\u003c/p\u003e\n\u003ch1 data-sourcepos=\"5:1-5:8\"\u003e\n\u003cspan id=\"構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構成\u003c/h1\u003e\n\u003cp data-sourcepos=\"6:1-8:11\"\u003eWindows 11 Pro 21H2\u003cbr\u003e\nruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x64-mingw-ucrt]\u003cbr\u003e\nRails 7.0.4\u003c/p\u003e\n\u003ch1 data-sourcepos=\"10:1-10:17\"\u003e\n\u003cspan id=\"エラー内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A8%E3%83%A9%E3%83%BC%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eエラー内容\u003c/h1\u003e\n\u003cp data-sourcepos=\"11:1-12:123\"\u003erails aborted!\u003cbr\u003e\nTZInfo::DataSourceNotFound: tzinfo-data is not present. Please add gem 'tzinfo-data' to your Gemfile and run bundle install\u003c/p\u003e\n\u003ch1 data-sourcepos=\"14:1-14:24\"\u003e\n\u003cspan id=\"改善方法-２工程\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%94%B9%E5%96%84%E6%96%B9%E6%B3%95-%EF%BC%92%E5%B7%A5%E7%A8%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e改善方法 ２工程\u003c/h1\u003e\n\u003cp data-sourcepos=\"15:1-16:47\"\u003e1, プロジェクト内のGemfileの40行目を変更する\u003cbr\u003e\ngem \"tzinfo-data\"以降をコメントアウト\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"diff\" data-sourcepos=\"17:1-20:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"gd\"\u003e- gem \"tzinfo-data\", platforms: %i[ mingw mswin x64_mingw jruby ]\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+ gem \"tzinfo-data\" #, platforms: %i[ mingw mswin x64_mingw jruby ]\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"21:1-21:62\"\u003e2, Bundlerのバージョンを更新する　コマンド2つ\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"22:1-32:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eterminal\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"no\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e:\\\u003c/span\u003e\u003cspan class=\"no\"\u003eUsers\u003c/span\u003e\u003cspan class=\"p\"\u003e\\\u003c/span\u003e\u003cspan class=\"err\"\u003e〇〇〇\u003c/span\u003e\u003cspan class=\"p\"\u003e\\\u003c/span\u003e\u003cspan class=\"n\"\u003esample_app\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003egem\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e \u003cspan class=\"n\"\u003ebundler\u003c/span\u003e\n\u003cspan class=\"err\"\u003e～～省略～～\u003c/span\u003e\n\u003cspan class=\"no\"\u003eDone\u003c/span\u003e \u003cspan class=\"n\"\u003einstalling\u003c/span\u003e \u003cspan class=\"n\"\u003edocumentation\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ebundler\u003c/span\u003e \u003cspan class=\"n\"\u003eafter\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003eseconds\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003egem\u003c/span\u003e \u003cspan class=\"n\"\u003einstalled\u003c/span\u003e\n\n\u003cspan class=\"no\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e:\\\u003c/span\u003e\u003cspan class=\"no\"\u003eUsers\u003c/span\u003e\u003cspan class=\"p\"\u003e\\\u003c/span\u003e\u003cspan class=\"err\"\u003e〇〇〇\u003c/span\u003e\u003cspan class=\"p\"\u003e\\\u003c/span\u003e\u003cspan class=\"n\"\u003esample_app\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ebundle\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e\n\u003cspan class=\"err\"\u003e～～省略～～\u003c/span\u003e\n\u003cspan class=\"no\"\u003eBundle\u003c/span\u003e \u003cspan class=\"n\"\u003ecomplete!\u003c/span\u003e \u003cspan class=\"mi\"\u003e15\u003c/span\u003e \u003cspan class=\"no\"\u003eGemfile\u003c/span\u003e \u003cspan class=\"n\"\u003edependencies\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e71\u003c/span\u003e \u003cspan class=\"n\"\u003egems\u003c/span\u003e \u003cspan class=\"n\"\u003enow\u003c/span\u003e \u003cspan class=\"n\"\u003einstalled\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003cspan class=\"no\"\u003eUse\u003c/span\u003e \u003cspan class=\"sb\"\u003e`bundle info [gemname]`\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003esee\u003c/span\u003e \u003cspan class=\"n\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"n\"\u003ebundled\u003c/span\u003e \u003cspan class=\"n\"\u003egem\u003c/span\u003e \u003cspan class=\"n\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003einstalled\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"33:1-33:49\"\u003eこの二つを行うことでrails sが通った\u003c/p\u003e\n\u003ch1 data-sourcepos=\"35:1-35:11\"\u003e\n\u003cspan id=\"おまけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%BE%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおまけ\u003c/h1\u003e\n\u003cp data-sourcepos=\"36:1-36:24\"\u003e実行したコマンド\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"37:1-48:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eterminal\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003egem\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e \u003cspan class=\"n\"\u003erails\u003c/span\u003e\n\u003cspan class=\"n\"\u003erails\u003c/span\u003e \u003cspan class=\"n\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003esample_app\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"no\"\u003eG\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecd\u003c/span\u003e \u003cspan class=\"n\"\u003esample_app\u003c/span\u003e\n\u003cspan class=\"n\"\u003eridk\u003c/span\u003e \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e \u003cspan class=\"n\"\u003epacman\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"no\"\u003eS\u003c/span\u003e \u003cspan class=\"n\"\u003emingw\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ew64\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ex86_64\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003esqlite3\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebundle\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e\n\u003cspan class=\"n\"\u003erails\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\n\u003cspan class=\"n\"\u003egem\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e \u003cspan class=\"n\"\u003ebundler\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebundler\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebundle\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e\n\u003cspan class=\"n\"\u003erails\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n","body":"# 内容\n[Progateのサイト](https://prog-8.com/docs/rails-env-win)の通りに環境構築をしていた時に出たエラー\nrails sが通らない/サーバーが起動しない\n\n# 構成\nWindows 11 Pro 21H2\nruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x64-mingw-ucrt]\nRails 7.0.4\n\n# エラー内容\nrails aborted!\nTZInfo::DataSourceNotFound: tzinfo-data is not present. Please add gem 'tzinfo-data' to your Gemfile and run bundle install\n\n# 改善方法 ２工程\n1, プロジェクト内のGemfileの40行目を変更する\ngem \"tzinfo-data\"以降をコメントアウト\n```diff:\n- gem \"tzinfo-data\", platforms: %i[ mingw mswin x64_mingw jruby ]\n+ gem \"tzinfo-data\" #, platforms: %i[ mingw mswin x64_mingw jruby ]\n```\n2, Bundlerのバージョンを更新する　コマンド2つ\n```ruby:terminal\nC:\\Users\\〇〇〇\\sample_app\u003e gem install bundler\n～～省略～～\nDone installing documentation for bundler after 0 seconds\n1 gem installed\n\nC:\\Users\\〇〇〇\\sample_app\u003e bundle install\n～～省略～～\nBundle complete! 15 Gemfile dependencies, 71 gems now installed.\nUse `bundle info [gemname]` to see where a bundled gem is installed.\n```\nこの二つを行うことでrails sが通った\n\n# おまけ\n実行したコマンド\n```ruby:terminal\ngem install rails\nrails new sample_app -G\ncd sample_app\nridk exec pacman -S mingw-w64-x86_64-sqlite3\nbundle install\nrails s\ngem install bundler\nbundler -v\nbundle install\nrails s\n```\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:02:48+09:00","group":null,"id":"10eac0c07e347613ddb7","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Ruby","versions":[]},{"name":"Rails","versions":[]},{"name":"Windows","versions":[]},{"name":"エラー","versions":[]},{"name":"error","versions":[]}],"title":"Ruby on Railsでrails sが起動しない rails aborted! TZInfo::DataSourceNotFound","updated_at":"2022-09-18T21:02:48+09:00","url":"https://qiita.com/mosunset/items/10eac0c07e347613ddb7","user":{"description":"さっきまで高校生でした","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"mosunset","id":"mosunset","items_count":2,"linkedin_id":"","location":"","name":"へんな こあら","organization":"","permanent_id":1100169,"profile_image_url":"https://lh3.googleusercontent.com/a-/AOh14GiS1x0AzlGKgFhUOQ55Q9u3yj6V-LSO4kzvN2_Oiw=s50","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"2:1-2:123\"\u003e「prettier 動かない」で検索して、いろんな記事を漁って試してみても解決しませんでした。\u003c/p\u003e\n\u003cp data-sourcepos=\"4:1-7:19\"\u003e確認した項目\u003cbr\u003e\n*　Editor:Format On Save\u003cbr\u003e\n*　Editor:Default Formatter\u003cbr\u003e\n*　disableLanguage\u003c/p\u003e\n\u003ch1 data-sourcepos=\"9:1-9:41\"\u003e\n\u003cspan id=\"取り敢えずsettingjsonへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%96%E3%82%8A%E6%95%A2%E3%81%88%E3%81%9Asettingjson%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e取り敢えず、setting.jsonへ　　\u003c/h1\u003e\n\u003cp data-sourcepos=\"10:1-11:328\"\u003eコマンドパレット ( Ctrl/Cmd + Shift + P ) から、 Open Settings (JSON) という項目を選択することで、 settings.json ファイルを直接開いてみます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/b20fdde9bb1027bb52d58c98bf3eb7f18f19fe9e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323732393037382f35373065616438372d376239352d633638642d353163382d3266643764643163656662652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2729078%2F570ead87-7b95-c68d-51c8-2fd7dd1cefbe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6954323805a262f0e5d3f3f9e196e923\" alt=\"スクリーンショット 2022-09-18 21.02.55.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2729078/570ead87-7b95-c68d-51c8-2fd7dd1cefbe.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2729078%2F570ead87-7b95-c68d-51c8-2fd7dd1cefbe.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=67ab6ae6cb0ae3fb137f5e8cd5a3c4d1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003ca href=\"https://camo.qiitausercontent.com/3f97afdb4665da90a10f9f1cce5e880cff0883ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323732393037382f37633739633939322d343535662d643139612d656432362d3039383234643731653038662e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2729078%2F7c79c992-455f-d19a-ed26-09824d71e08f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=af5be40c9084b6e887764851152563c8\" alt=\"スクリーンショット 2022-09-18 20.52.49.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2729078/7c79c992-455f-d19a-ed26-09824d71e08f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2729078%2F7c79c992-455f-d19a-ed26-09824d71e08f.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c7085d300e4a615a4284733f5f8553d7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-13:138\"\u003eeditor.formatOnPasteはtrueになってる、editor.formatOnSaveもtrueになってる、んん、なんだこの3行目のパスは？？\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"json\" data-sourcepos=\"14:1-18:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esetting.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nl\"\u003e\"editor.formatOnPaste\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"err\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"editor.formatOnSave\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"err\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nl\"\u003e\"prettier.prettierPath\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"/Users/matsunakahikaru/.vscode/extensions/esbenp.prettier-vscode-8.0.1\"\u003c/span\u003e\u003cspan class=\"err\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"20:1-22:81\"\u003evscodeの拡張機能として、prettierを入れておいたつもりが、なんか変なパスを読んでしまっている。。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bf6f8cd3b62111536e689cf9000d56c8faf5b615/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323732393037382f61393634626530612d386630322d303466622d376161312d3236343637366665363664322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2729078%2Fa964be0a-8f02-04fb-7aa1-264676fe66d2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d33abd13a1aa41fcb9037e9f78260d8\" alt=\"スクリーンショット 2022-09-18 20.53.08.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2729078/a964be0a-8f02-04fb-7aa1-264676fe66d2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2729078%2Fa964be0a-8f02-04fb-7aa1-264676fe66d2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc828086f9ca9fdc3fd7a4c493610c45 1x\" loading=\"lazy\"\u003e\u003c/a\u003e　　\u003cbr\u003e\nこの行をコメントアウトしたら、使えるようになりました！\u003c/p\u003e\n\u003ch1 data-sourcepos=\"24:1-24:11\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\u003cp data-sourcepos=\"25:1-25:149\"\u003eprettierが動かなくなった時は、取り敢えずsetting.jsonを見に行くのが良さそうです。めっちゃ雑な結論ですけど。\u003c/p\u003e\n","body":" \n「prettier 動かない」で検索して、いろんな記事を漁って試してみても解決しませんでした。\n\n確認した項目\n*　Editor:Format On Save\n*　Editor:Default Formatter\n*　disableLanguage\n\n# 取り敢えず、setting.jsonへ　　\nコマンドパレット ( Ctrl/Cmd + Shift + P ) から、 Open Settings (JSON) という項目を選択することで、 settings.json ファイルを直接開いてみます。\n![スクリーンショット 2022-09-18 21.02.55.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2729078/570ead87-7b95-c68d-51c8-2fd7dd1cefbe.png)![スクリーンショット 2022-09-18 20.52.49.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2729078/7c79c992-455f-d19a-ed26-09824d71e08f.png)\n\neditor.formatOnPasteはtrueになってる、editor.formatOnSaveもtrueになってる、んん、なんだこの3行目のパスは？？\n```setting.json\n\"editor.formatOnPaste\": true,\n\"editor.formatOnSave\": true,\n\"prettier.prettierPath\": \"/Users/matsunakahikaru/.vscode/extensions/esbenp.prettier-vscode-8.0.1\",\n```\n\nvscodeの拡張機能として、prettierを入れておいたつもりが、なんか変なパスを読んでしまっている。。\n![スクリーンショット 2022-09-18 20.53.08.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2729078/a964be0a-8f02-04fb-7aa1-264676fe66d2.png)　　\nこの行をコメントアウトしたら、使えるようになりました！\n\n# まとめ\nprettierが動かなくなった時は、取り敢えずsetting.jsonを見に行くのが良さそうです。めっちゃ雑な結論ですけど。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:02:00+09:00","group":null,"id":"352983864e4dac1ceb4e","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"トラブルシューティング","versions":[]},{"name":"問題解決","versions":[]},{"name":"VSCode","versions":[]},{"name":"prettier","versions":[]}],"title":"VSCodeでprettierがどうしても動かない問題を解決する","updated_at":"2022-09-18T21:09:42+09:00","url":"https://qiita.com/HikaruMatsunaka/items/352983864e4dac1ceb4e","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":"HikaruMatsunaka","id":"HikaruMatsunaka","items_count":1,"linkedin_id":"","location":"","name":"hikaru matsunaka","organization":"","permanent_id":2729078,"profile_image_url":"https://avatars.githubusercontent.com/u/90782448?v=4","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:90\"\u003e米国国勢調査のデータを使って、データの並べ替えをしてみました。\u003cbr\u003e\n\u003ca href=\"https://science-log.com/wp/wp-content/uploads/2021/07/nst-est2019-01.csv\" rel=\"nofollow noopener\" target=\"_blank\"\u003enst-est2019-01\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"4:1-4:9\"\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h2\u003e\n\u003cp data-sourcepos=\"5:1-6:16\"\u003ePython version:3.9.7\u003cbr\u003e\nOS: windows 10.0\u003c/p\u003e\n\u003ch2 data-sourcepos=\"8:1-8:15\"\u003e\n\u003cspan id=\"イメージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイメージ\u003c/h2\u003e\n\u003cp data-sourcepos=\"9:1-10:121\"\u003e下記用に年ごとに並べられたデータを年ごとに下に追加していくようにデータを並び替えをします。また、並び替えをしたデータをもとの形に戻します。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/15b6f754557eeb4f12d6c743ddb05deea0a49b5c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3137363135382f33343063386535622d613663322d643932372d643765392d3263623839346437643233302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F176158%2F340c8e5b-a6c2-d927-d7e9-2cb894d7d230.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=005490fd5891278b6f9f474d53e7d42f\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/176158/340c8e5b-a6c2-d927-d7e9-2cb894d7d230.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F176158%2F340c8e5b-a6c2-d927-d7e9-2cb894d7d230.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4f8d79ebe3294e8196853cef6c980a25 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"12:1-12:18\"\u003e\n\u003cspan id=\"プログラム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプログラム\u003c/h2\u003e\n\u003cp data-sourcepos=\"13:1-16:64\"\u003eまず、上記csvファイルをダウンロードして、実行させるプログラムを同じディレクトリに配置します。\u003cbr\u003e\n行っていることは、単純で並べたいデータフレームを各年毎に作って、それをconcatでどんどん下へ結合しているだけの操作になります。\u003cbr\u003e\nデータフレームの年毎とそれ以外の情報は、columnのheaderの部分で分けることができるので、listを作って分割し、yearの情報をforで回していくようにしています。\u003cbr\u003e\n最後に、columnのyearの位置を並べ替えています。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"18:1-58:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esort_by_year.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecsv\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epandas\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edebug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# get csv data \n\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread_csv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'nst-est2019-01.csv'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# print index and columns for debug\n\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_numpy\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# print index\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_numpy\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e# print column\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e       \u003cspan class=\"c1\"\u003e# print column length\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# change from numpy.array to list.\n\u003c/span\u003e\u003cspan class=\"n\"\u003edf_column_s\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_numpy\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"n\"\u003edf_column_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_column_s\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etolist\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# split to label and year.\n\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_column_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eyear_list\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_column_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eyaer_list\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e    \n        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[[\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erename\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'value'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edf_new\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[[\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003elabel_list\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e        \n        \u003cspan class=\"n\"\u003edf_new\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_new\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erename\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e'value'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edf_new\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eyear_num\u003c/span\u003e       \n        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edf_new\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eignore_index\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# move year order. \n\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_move_last_column\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_move_last_column\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \n\u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_csv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"nst-est2019-02.csv\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"59:1-60:201\"\u003e次に、sortした情報を元に戻します。最初にyear以外の情報をラベルにして、そのラベルと同じ情報がある行へyearの情報を追加してしています。\u003cbr\u003e\n追加した後は、ラベルの隣にyearの情報が出てくるので、最後の列に移動しています。最後に、不要になったlabelの情報を消して、元に戻しています。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"61:1-113:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esplit_by_year.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecsv\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epandas\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edebug\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n\u003cspan class=\"n\"\u003eflag\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# get csv data \n\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread_csv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'nst-est2019-02.csv'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# make the label \n# df.insert(loc, column, value, allow_duplicates=False)[source])\n\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'label'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'Unnamed: 0'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'Census'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'Estimates Base'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# print index and columns for debug\n\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edebug\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e                    \u003cspan class=\"c1\"\u003e# data frame \n\u003c/span\u003e    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_numpy\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# print index\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_numpy\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e# print column\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003enunique\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# Get the number of elements information for year series\n\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Get the type of elements information for year series\n\u003c/span\u003e\u003cspan class=\"n\"\u003eyear_unique_list\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"year\"\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eunique\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eyear_unique_list\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# make data frame par year.\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# Get the value for per year \n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# Rename the value for per year (from vlaue to per year)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erename\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'value'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# Remove value for per year not to use it.      \n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edrop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'columns'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eflag\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# make new df.\n\u003c/span\u003e        \u003cspan class=\"c1\"\u003e# 1.Get the next year value from main df.\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_append\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'year'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 2.Extract label and next year label.        \n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_append\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_append\u003c/span\u003e\u003cspan class=\"p\"\u003e[[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"label\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"value\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 3.Rename the value to next year .           \n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_append\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_append\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erename\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e'value'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 4.merge df_base and df_append at label.           \n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emerge\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf_append\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehow\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"outer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eon\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"label\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 5.move to next year last column.         \n\u003c/span\u003e        \u003cspan class=\"n\"\u003evalue_move_last_column\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# df.insert(last_column_number, column_name, column_value,)\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einsert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"n\"\u003ecol_year_val\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_move_last_column\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edf_base\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edrop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'label'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'columns'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e        \n\u003cspan class=\"n\"\u003edf_base\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_csv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"nst-est2019-01_a.csv\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n","body":"米国国勢調査のデータを使って、データの並べ替えをしてみました。\n[nst-est2019-01](https://science-log.com/wp/wp-content/uploads/2021/07/nst-est2019-01.csv)\n\n## 環境\nPython version:3.9.7\nOS: windows 10.0\n\n## イメージ\n下記用に年ごとに並べられたデータを年ごとに下に追加していくようにデータを並び替えをします。また、並び替えをしたデータをもとの形に戻します。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/176158/340c8e5b-a6c2-d927-d7e9-2cb894d7d230.png)\n\n## プログラム\nまず、上記csvファイルをダウンロードして、実行させるプログラムを同じディレクトリに配置します。\n行っていることは、単純で並べたいデータフレームを各年毎に作って、それをconcatでどんどん下へ結合しているだけの操作になります。\nデータフレームの年毎とそれ以外の情報は、columnのheaderの部分で分けることができるので、listを作って分割し、yearの情報をforで回していくようにしています。\n最後に、columnのyearの位置を並べ替えています。\n\n```sort_by_year.py\nimport csv\nimport pandas as pd\nimport numpy as np\n\ndebug = False\n\n# get csv data \ndf = pd.read_csv('nst-est2019-01.csv')\n\n# print index and columns for debug\nif (debug):\n    print(df.index.to_numpy())   # print index\n    print(df.columns.to_numpy()) # print column\n    print(len(df.columns))       # print column length\n\n# change from numpy.array to list.\ndf_column_s = df.columns.to_numpy()\ndf_column_list = df_column_s.tolist()\n\n# split to label and year.\nlabel_list = df_column_list[:3]\nyear_list  = df_column_list[3:]\n\nfor flag, year_num in enumerate(yaer_list,0):\n    if flag == 0:    \n        df_base = df[[label_list[0],label_list[1],label_list[2],year_num]]\n        df_base  = df_base.rename(columns={year_num: 'value'})\n        df_base['year'] = year_num\n    else:\n        df_new = df[[label_list[0],label_list[1],label_list[2],year_num]]        \n        df_new  = df_new.rename(columns={year_num: 'value'})\n        df_new['year'] = year_num       \n        df_base = pd.concat([df_base, df_new], axis=0, ignore_index=True)\n\n# move year order. \nvalue_move_last_column = df_base.pop('year')\ndf_base.insert(3,'year',value_move_last_column)\n        \ndf_base.to_csv(\"nst-est2019-02.csv\", index = False)\n```\n次に、sortした情報を元に戻します。最初にyear以外の情報をラベルにして、そのラベルと同じ情報がある行へyearの情報を追加してしています。\n追加した後は、ラベルの隣にyearの情報が出てくるので、最後の列に移動しています。最後に、不要になったlabelの情報を消して、元に戻しています。\n```split_by_year.py\nimport csv\nimport pandas as pd\nimport numpy as np\n\ndebug = False\nflag  = 0\n\n# get csv data \ndf = pd.read_csv('nst-est2019-02.csv')\n\n# make the label \n# df.insert(loc, column, value, allow_duplicates=False)[source])\ndf.insert(0, 'label', df['Unnamed: 0']+ df['Census']+df['Estimates Base'])\n\n# print index and columns for debug\nif (debug):\n    print(df)                    # data frame \n    print(df.index.to_numpy())   # print index\n    print(df.columns.to_numpy()) # print column\n    print(f['year'].nunique())   # Get the number of elements information for year series\n\n# Get the type of elements information for year series\nyear_unique_list = df[\"year\"].unique()\n\nfor col_year_val in year_unique_list:\n    # make data frame par year.\n    if flag == 0:\n        # Get the value for per year \n        df_base  = df[df['year'] == col_year_val]\n        # Rename the value for per year (from vlaue to per year)\n        df_base  = df_base.rename(columns={'value': col_year_val})\n        # Remove value for per year not to use it.      \n        df_base  = df_base.drop('year',axis='columns')\n        flag = flag + 1\n    else:\n        # make new df.\n        # 1.Get the next year value from main df.\n        df_append = df[df['year'] == col_year_val]\n        # 2.Extract label and next year label.        \n        df_append = df_append[[\"label\",\"value\"]]\n        # 3.Rename the value to next year .           \n        df_append = df_append.rename(columns={'value': col_year_val})\n        # 4.merge df_base and df_append at label.           \n        df_base =pd.merge(df_append, df_base, how=\"outer\", on = \"label\")\n        # 5.move to next year last column.         \n        value_move_last_column = df_base.pop(col_year_val)\n        # df.insert(last_column_number, column_name, column_value,)\n        df_base.insert(len(df_base.columns),col_year_val,value_move_last_column)\n\ndf_base  = df_base.drop('label',axis='columns')        \ndf_base.to_csv(\"nst-est2019-01_a.csv\", index = False)\n```\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T21:00:12+09:00","group":null,"id":"3afe921d8908bc42b750","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"#pandas","versions":[]}],"title":"pandas dataframeの結合、分割をしてみた","updated_at":"2022-09-18T21:00:12+09:00","url":"https://qiita.com/yutaka_m/items/3afe921d8908bc42b750","user":{"description":"テストプログラム作ってます。\r\npythonを中心にできることを勉強中。","facebook_id":"","followees_count":17,"followers_count":6,"github_login_name":"yutti","id":"yutaka_m","items_count":45,"linkedin_id":"","location":"Hiroshima,Japan","name":"yuta mori","organization":"","permanent_id":176158,"profile_image_url":"https://avatars3.githubusercontent.com/u/5346200?v=3","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:95\"\u003eSalesforce の Apex コードから HTTP 要求 (RESTfulサービス）を送信し、\u003cbr\u003e\n受信した応答を解析して、Apex にて外部サービスを利用する方法です。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:85\"\u003e今回はYahoo! 郵便番号検索APIを使った機能を実装していきます。\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-10:128\"\u003e住所入力があるようなWebフォームをSalesforce（Visualforce＋Apex Controller）で作成します。\u003cbr\u003e\n郵便番号を入力して検索ボタンをポチってすると、都道府県・市区町村情報がパッと表示される、アレです。\u003cimg alt=\":relaxed:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/263a-fe0f.png\" title=\":relaxed:\" width=\"20\" loading=\"lazy\"\u003e\u003cbr\u003e\n今回は都道府県・市区町村を表示する機能を実装しますが、最寄り駅の情報なども表示できます。便利！\u003cbr\u003e\n　⇒API：\u003ca href=\"https://developer.yahoo.co.jp/webapi/map/openlocalplatform/v1/zipcodesearch.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWebサービス by Yahoo! JAPAN\u003c/a\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"13:1-13:16\"\u003e\n\u003cspan id=\"前提条件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提条件\u003c/h3\u003e\n\u003cp data-sourcepos=\"14:1-16:49\"\u003e①以下２つの値をカスタム表示ラベルとして作成しておく。（※URLやAppIdが変わる可能性を考慮）\u003cbr\u003e\n・Yahoo!へのGETリクエストURL（ZipSearchRequestURL)\u003cbr\u003e\n・アプリケーションID（ZipSearchAppId）\u003c/p\u003e\n\u003cp data-sourcepos=\"18:1-19:40\"\u003e②表記ゆれを防ぐため郵便番号をハイフンの前後で分けて入力することを想定し、Visualforceにて入力欄を２個用意\u003cbr\u003e\n（inputZipcode1） -（inputZipCode2）\u003c/p\u003e\n\u003ch3 data-sourcepos=\"21:1-21:13\"\u003e\n\u003cspan id=\"構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構成　\u003c/h3\u003e\n\u003cp data-sourcepos=\"22:1-28:58\"\u003e1.　Webフォームで入力された郵便番号を取得\u003cbr\u003e\n2.　全角数字を半角数字に変換 （※\u003ca href=\"https://qiita.com/miku_shinkawa_/items/c3124353f3683f23418b\" id=\"reference-429c1cdb176ea0f70be5\"\u003e全角数字⇒半角数字変換メソッド\u003c/a\u003e）\u003cbr\u003e\n3.　文字種をチェック（半角数字以外ではないことを確認）\u003cbr\u003e\n4.　郵便番号形式（または桁数）チェック\u003cbr\u003e\n5.　2~4のチェックで問題がなければ、\u003cstrong\u003eHttpRequestを使用し、Yahoo! 郵便番号検索APIへGETリクエストを送信\u003c/strong\u003e\u003cbr\u003e\n6.　\u003cstrong\u003eレスポンスを受信し、解析する\u003c/strong\u003e　※今回はJSON形式で受け取る\u003cbr\u003e\n7.　Webフォーム（Visualforce）へ住所をセット\u003c/p\u003e\n\u003cp data-sourcepos=\"31:1-33:4\"\u003e★1～4は外部API関係ないので、構築時の参考程度に。\u003cbr\u003e\n今回は、主に\u003cstrong\u003e５以降の手順\u003c/strong\u003e、外部APIの呼び出しの部分のみ書いていく。\u003cbr\u003e\n\u003cbr\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"36:1-36:10\"\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"apex\" data-sourcepos=\"38:1-85:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003esample.cls\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"n\"\u003ePageReference\u003c/span\u003e \u003cspan class=\"nf\"\u003eSearchZipcode\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ereqURL\u003c/span\u003e       \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eLabel\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eZipSearchRequestURL\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e      \u003cspan class=\"c1\"\u003e//リクエストURL\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eappid\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSystem\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eLabel\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eZipSearchAppId\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e            \u003cspan class=\"c1\"\u003e//アプリケーションID\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003equeryZipCode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einputZipcode1\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e-'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003einputZipCode2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//クエリ用の郵便番号\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eprefecture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//都道府県格納用変数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003ecity\u003c/span\u003e       \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//市区町村格納用変数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eString\u003c/span\u003e \u003cspan class=\"n\"\u003eoaza\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e//大字格納用変数\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/* リクエストを作成 */\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHttpRequest\u003c/span\u003e \u003cspan class=\"n\"\u003ereq\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttpRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e            \n    \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereqURL\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e?query='\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003equeryZipCode\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;appid='\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eappid\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;output=json\u0026amp;detail=full'\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esetMethod\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003eGET'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"cm\"\u003e/* リクエスト送信 */\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHttp\u003c/span\u003e \u003cspan class=\"n\"\u003ehttp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nf\"\u003eHttp\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eHTTPResponse\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehttp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n            \n    \u003cspan class=\"cm\"\u003e/* レスポンス受信 */\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eresBody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eJSON\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003edeserializeUntyped\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetBody\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e \u003cspan class=\"c1\"\u003e//JSONをMap\u0026lt;String, Object\u0026gt;に並列化\u003c/span\u003e\n  \n\n    \u003cspan class=\"cm\"\u003e/* Featureがない場合、郵便番号が存在しないためエラー\n      （Feature配下に検索結果1件分のデータ群が入っている）*/\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eresBody\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003eFeature'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eApexPages\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eaddMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eApexPages\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eApexPages\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eSeverity\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"py\"\u003eERROR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e郵便番号が存在しません。'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003edetail - error'\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \n    \u003cspan class=\"cm\"\u003e/* Jsonを解析していく */\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eaddressList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eresBody\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003eFeature'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e        \n        \u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003efeatureMap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epropertyMap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003efeatureMap\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003eProperty'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e \u003cspan class=\"nl\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003epropertyMap\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003eAddressElement'\u003c/span\u003e\u003cspan class=\"p\"\u003e)){\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003enameMap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eObject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"cm\"\u003e/* AddressElementの配下のNameに都道府県、市区町村、大字・・・などの階層で情報が格納されている*/\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eaddressList\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003enameMap\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003eName'\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 上記で格納した順番に取り出し、住所（都道府県から大字まで）を作成していく */\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprefecture\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaddressList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecity\u003c/span\u003e       \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaddressList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eoaza\u003c/span\u003e       \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eooazaaddressList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esubstringBefore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s2\"\u003e（'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/*　（後続処理については省略）　*/\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"88:1-88:192\"\u003e住所によって、大字の階層に、（大規模ビルを除く）（その他）などの文字が入ってくるので、カッコがあったらそれ以降を切捨てています。\u003c/p\u003e\n\u003cp data-sourcepos=\"91:1-91:108\"\u003e後続処理では、prefecture、city、oazaに入った文字列を画面にセットするだけ\u003cimg alt=\":relaxed:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/263a-fe0f.png\" title=\":relaxed:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\u003cdiv data-sourcepos=\"95:1-102:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"96:1-96:36\"\u003eテストクラス作成時の注意\u003c/p\u003e\n\u003cp data-sourcepos=\"98:1-101:52\"\u003eApexテストメソッドは HTTP コールアウトをサポートしないため、コールアウトを実行するテストは失敗します。\u003cbr\u003e\nHttpCalloutMock インターフェースを実装するか、\u003cbr\u003e\n静的リソースを使用してStaticResourceCalloutMock を実装することで\u003cbr\u003e\nテストクラスが通ります。\u003cimg alt=\":ok_woman_tone1:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f646-1f3fb.png\" title=\":ok_woman_tone1:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"105:1-105:13\"\u003e\n\u003cspan id=\"最後に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最後に\u003c/h3\u003e\n\u003cp data-sourcepos=\"106:1-107:90\"\u003eJSONの解析が大変でした。もっと効率の良い方法はないだろうかとは思うが一旦これで実装できたのでよしとする。\u003cbr\u003e\nどなたかのお役に立てればいいな・・・疲れた・・・( ˘ω˘)ｽﾔｧ\u003c/p\u003e\n","body":"Salesforce の Apex コードから HTTP 要求 (RESTfulサービス）を送信し、\n受信した応答を解析して、Apex にて外部サービスを利用する方法です。\n\n\n今回はYahoo! 郵便番号検索APIを使った機能を実装していきます。\n\n住所入力があるようなWebフォームをSalesforce（Visualforce＋Apex Controller）で作成します。\n郵便番号を入力して検索ボタンをポチってすると、都道府県・市区町村情報がパッと表示される、アレです。:relaxed:\n今回は都道府県・市区町村を表示する機能を実装しますが、最寄り駅の情報なども表示できます。便利！\n　⇒API：[Webサービス by Yahoo! JAPAN](https://developer.yahoo.co.jp/webapi/map/openlocalplatform/v1/zipcodesearch.html)\t\n\n\n### 前提条件\n①以下２つの値をカスタム表示ラベルとして作成しておく。（※URLやAppIdが変わる可能性を考慮）\n・Yahoo!へのGETリクエストURL（ZipSearchRequestURL)\n・アプリケーションID（ZipSearchAppId）\n\n②表記ゆれを防ぐため郵便番号をハイフンの前後で分けて入力することを想定し、Visualforceにて入力欄を２個用意\n（inputZipcode1） -（inputZipCode2）\n\n### 構成　\n1.　Webフォームで入力された郵便番号を取得\n2.　全角数字を半角数字に変換 （※[全角数字⇒半角数字変換メソッド](https://qiita.com/miku_shinkawa_/items/c3124353f3683f23418b)）\n3.　文字種をチェック（半角数字以外ではないことを確認）\n4.　郵便番号形式（または桁数）チェック\n5.　2~4のチェックで問題がなければ、**HttpRequestを使用し、Yahoo! 郵便番号検索APIへGETリクエストを送信**\n6.　**レスポンスを受信し、解析する**　※今回はJSON形式で受け取る\n7.　Webフォーム（Visualforce）へ住所をセット\n\n\n★1～4は外部API関係ないので、構築時の参考程度に。\n今回は、主に**５以降の手順**、外部APIの呼び出しの部分のみ書いていく。\n\u003cbr\u003e\n\n\n### 実装\n\n```apex:sample.cls\npublic PageReference SearchZipcode() {\n    String reqURL       = System.Label.ZipSearchRequestURL;      //リクエストURL\n    String appid        = System.Label.ZipSearchAppId;            //アプリケーションID\n    String queryZipCode = inputZipcode1+'-'+inputZipCode2; //クエリ用の郵便番号\n    String prefecture = '';   //都道府県格納用変数\n    String city       = '';   //市区町村格納用変数\n    String oaza      = '';   //大字格納用変数\n\n    /* リクエストを作成 */\n    HttpRequest req = new HttpRequest();            \n    req.setEndpoint(reqURL + '?query=' + queryZipCode + '\u0026appid=' + appid + +'\u0026output=json\u0026detail=full' );\n    req.setMethod('GET');\n\n    /* リクエスト送信 */\n    Http http = new Http();\n    HTTPResponse res = http.send(req);\n            \n    /* レスポンス受信 */\n    Map\u003cString, Object\u003e resBody = (Map\u003cString, Object\u003e)JSON.deserializeUntyped(res.getBody()); //JSONをMap\u003cString, Object\u003eに並列化\n  \n\n    /* Featureがない場合、郵便番号が存在しないためエラー\n      （Feature配下に検索結果1件分のデータ群が入っている）*/\n    if((List\u003cObject\u003e)resBody.get('Feature') == null){\n        ApexPages.addMessage(new ApexPages.Message(ApexPages.Severity.ERROR, '郵便番号が存在しません。', 'detail - error'));\n        return null;\n    }\n    \n    /* Jsonを解析していく */\n    List\u003cString\u003e addressList = new List\u003cString\u003e();\n    for (Object result : (List\u003cObject\u003e)resBody.get('Feature')) {        \n        Map\u003cString, Object\u003e featureMap = (Map\u003cString, Object\u003e)result;\n        Map\u003cString, Object\u003e propertyMap = (Map\u003cString, Object\u003e)featureMap.get('Property');\n        for(Object address: (List\u003cObject\u003e)propertyMap.get('AddressElement')){\n            Map\u003cString, Object\u003e nameMap = (Map\u003cString, Object\u003e)address;\n            /* AddressElementの配下のNameに都道府県、市区町村、大字・・・などの階層で情報が格納されている*/\n            addressList.add((String)(nameMap.get('Name')));\n        }\n        /* 上記で格納した順番に取り出し、住所（都道府県から大字まで）を作成していく */\n        prefecture = addressList[0];\n        city       = addressList[1]\n        oaza       = ooazaaddressList[2].substringBefore('（'); \n    }\n    /*　（後続処理については省略）　*/\n    return null;\n}\n```\n\n\n住所によって、大字の階層に、（大規模ビルを除く）（その他）などの文字が入ってくるので、カッコがあったらそれ以降を切捨てています。\n\n\n後続処理では、prefecture、city、oazaに入った文字列を画面にセットするだけ:relaxed:\n\n\n\n:::note warn\nテストクラス作成時の注意\n\nApexテストメソッドは HTTP コールアウトをサポートしないため、コールアウトを実行するテストは失敗します。\nHttpCalloutMock インターフェースを実装するか、\n静的リソースを使用してStaticResourceCalloutMock を実装することで\nテストクラスが通ります。:ok_woman_tone1:\n:::\n\n\n### 最後に\nJSONの解析が大変でした。もっと効率の良い方法はないだろうかとは思うが一旦これで実装できたのでよしとする。\nどなたかのお役に立てればいいな・・・疲れた・・・( ˘ω˘)ｽﾔｧ\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:58:25+09:00","group":null,"id":"e2ce88236b9c87ff8b08","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"api","versions":[]},{"name":"JSON","versions":[]},{"name":"Salesforce","versions":[]},{"name":"Httprequest","versions":[]},{"name":"YahooAPI","versions":[]}],"title":"Salesforce：Apexから外部サービス呼び出しをする（API）","updated_at":"2022-09-18T21:12:06+09:00","url":"https://qiita.com/O__O/items/e2ce88236b9c87ff8b08","user":{"description":"SIer企業勤務、３年目システムエンジニア。\r\nSalesforceでの開発をメインに行っています。\r\n\r\n技術メモ、備忘録用。\r\n","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"O__O","items_count":6,"linkedin_id":"","location":"新宿区","name":"Miku Shinkawa","organization":"(株)ケーピーエス","permanent_id":539431,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/539431/c8b327eccdf0118345e4f5539974084e3a80c9dc/x_large.png?1662948425","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:386\"\u003e東北大学 大関教授による\u003ca href=\"https://altema.is.tohoku.ac.jp/QC4U/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQC4U\u003c/a\u003eの解説コードの理解を深めるために\u003ca href=\"https://qiskit.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQiskit\u003c/a\u003eコードを写経をしているうちに、前から気になってた\u003ca href=\"https://quantumai.google/cirq\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCirq\u003c/a\u003eへの翻訳(移植)も同時にチャレンジしてしちゃおうと思い立って、まずはやってみました。\u003c/p\u003e\n\u003cp data-sourcepos=\"3:1-4:263\"\u003e両方を見比べることで、それぞれの特徴や、使い方の向き不向きみたいなのも今後掴めてくれば良いなと思います。\u003cbr\u003e\n今のところ、Qiskitは日本語のドキュメントやコンテンツが充実していて学びやすいことと、一方でCirqはTensorflowなど機械学習との組み合わせをしていったときに親和性が高いのかなと感じてます。\u003c/p\u003e\n\u003cp data-sourcepos=\"6:1-6:92\"\u003e以下、Github(Google Colab Notebook)へのリンクと初回分の冒頭の抜粋です。\u003c/p\u003e\n\u003cul data-sourcepos=\"8:1-11:0\"\u003e\n\u003cli data-sourcepos=\"8:1-9:97\"\u003e\u003ca href=\"https://github.com/yoshihiroo/programming-workshop/blob/master/QC4U_2022/qc4uchapter1_cirq.ipynb\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQC4U 第1回 Cirq写経翻訳\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"10:1-11:0\"\u003e\u003ca href=\"https://github.com/yoshihiroo/programming-workshop/blob/master/QC4U_2022/qc4uchapter2_cirq.ipynb\" rel=\"nofollow noopener\" target=\"_blank\"\u003eQC4U 第2回 Cirq写経翻訳\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote data-sourcepos=\"12:1-15:428\"\u003e\n\u003cp data-sourcepos=\"12:2-13:13\"\u003eQC4U 第1回 Cirq写経翻訳\u003cbr\u003e\n2022.9.18版\u003c/p\u003e\n\u003cp data-sourcepos=\"15:2-15:428\"\u003e東北大学 大関先生によるQC4Uの解説コードをもとに、理解を深めるためにCirqへの翻訳をやってみているものです。Cirq初心者ですので、正しくないコードの書き方や理解が間違っているところがあるかも知れませんがご容赦ください。（掲載については大関先生の了解を得ております。ご承諾ありがとうございます。）\u003c/p\u003e\n\u003c/blockquote\u003e\n","body":"東北大学 大関教授による[QC4U](https://altema.is.tohoku.ac.jp/QC4U/)の解説コードの理解を深めるために[Qiskit](https://qiskit.org/)コードを写経をしているうちに、前から気になってた[Cirq](https://quantumai.google/cirq)への翻訳(移植)も同時にチャレンジしてしちゃおうと思い立って、まずはやってみました。\n\n両方を見比べることで、それぞれの特徴や、使い方の向き不向きみたいなのも今後掴めてくれば良いなと思います。\n今のところ、Qiskitは日本語のドキュメントやコンテンツが充実していて学びやすいことと、一方でCirqはTensorflowなど機械学習との組み合わせをしていったときに親和性が高いのかなと感じてます。\n\n以下、Github(Google Colab Notebook)へのリンクと初回分の冒頭の抜粋です。\n\n* [QC4U 第1回 Cirq写経翻訳](\nhttps://github.com/yoshihiroo/programming-workshop/blob/master/QC4U_2022/qc4uchapter1_cirq.ipynb)\n* [QC4U 第2回 Cirq写経翻訳](https://github.com/yoshihiroo/programming-workshop/blob/master/QC4U_2022/qc4uchapter2_cirq.ipynb)\n\n\u003eQC4U 第1回 Cirq写経翻訳\n\u003e2022.9.18版\n\u003e\n\u003e東北大学 大関先生によるQC4Uの解説コードをもとに、理解を深めるためにCirqへの翻訳をやってみているものです。Cirq初心者ですので、正しくないコードの書き方や理解が間違っているところがあるかも知れませんがご容赦ください。（掲載については大関先生の了解を得ております。ご承諾ありがとうございます。）\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:50:44+09:00","group":null,"id":"10ddd53d80e03a1c4ed4","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"量子コンピュータ","versions":[]},{"name":"QuantumComputing","versions":[]},{"name":"cirq","versions":[]},{"name":"大関真之","versions":[]},{"name":"QC4U","versions":[]}],"title":"東北大学Quantum computing for you (QC4U) の解説コードをCirqに移植してみる","updated_at":"2022-09-18T20:50:44+09:00","url":"https://qiita.com/yoshihiroojp/items/10ddd53d80e03a1c4ed4","user":{"description":"","facebook_id":"yoshihiroo","followees_count":8,"followers_count":5,"github_login_name":"yoshihiroo","id":"yoshihiroojp","items_count":5,"linkedin_id":"yoshihiro-ochi","location":"","name":"Yoshihiro Ochi","organization":"","permanent_id":233015,"profile_image_url":"https://avatars2.githubusercontent.com/u/9767564?v=4","team_only":false,"twitter_screen_name":"yoshihiroojp","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:14\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-4:104\"\u003eiOSDC Japan 2022にオンラインで参加しました！\u003cbr\u003e\niwillblogということで、個人的に印象に残った発表について感想について書いていこうと思います。\u003cbr\u003e\nイベントの詳細については、\u003ca href=\"https://iosdc.jp/2022/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式サイト\u003c/a\u003eをご覧ください。\u003c/p\u003e\n\u003cp data-sourcepos=\"6:1-6:94\"\u003e※トークの動画については後日Youtubeにアップロードされるそうです。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"8:1-8:17\"\u003e\n\u003cspan id=\"day0前夜祭\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#day0%E5%89%8D%E5%A4%9C%E7%A5%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDay0(前夜祭)\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"9:1-9:85\"\u003e\n\u003cspan id=\"ウーニャしってるみんなふんいきでswiftuiをつかってる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A6%E3%83%BC%E3%83%8B%E3%83%A3%E3%81%97%E3%81%A3%E3%81%A6%E3%82%8B%E3%81%BF%E3%82%93%E3%81%AA%E3%81%B5%E3%82%93%E3%81%84%E3%81%8D%E3%81%A7swiftui%E3%82%92%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%A6%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eウーニャ、しってる。みんなふんいきでSwiftUIをつかってる。\u003c/h2\u003e\n\u003cp data-sourcepos=\"10:1-11:158\"\u003eSwiftUIのViewの分割と命名についてウーニャ(uhooiさん)なりの考え方を発表しつつ、参加者のツイートを通して議論するといった内容のトークでした。\u003cbr\u003e\nTwitterで参加者の意見や感想を拾いやすいよう「#ウーニャ」という独自のタグを作るといった工夫をされていました！\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-14:193\"\u003eSwiftUIについてはまだまだ初心者なため、Labelは画像を付けられることや、分割の考え方など大変参考になる発表でした。\u003cbr\u003e\n参加者からも「Previewが必要なときはstructを利用」など、発表にはなかった新たな知見が得られるなど双方向のやりとりがとても良かったです。\u003c/p\u003e\n\u003cp data-sourcepos=\"16:1-16:95\"\u003e登壇の資料と一緒に是非Twitterの「#ウーニャ」も見てほしい発表です。\u003c/p\u003e\n\u003cp data-sourcepos=\"18:1-18:218\"\u003e\u003ca href=\"https://fortee.jp/iosdc-japan-2022/proposal/28a7ecff-a0f1-40c9-80a5-b8ed2fb0fd94\" rel=\"nofollow noopener\" target=\"_blank\"\u003eウーニャ、しってる。みんなふんいきでSwiftUIをつかってる。 by uhooi | トーク | iOSDC Japan 2022 - fortee.jp\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"20:1-20:6\"\u003e\n\u003cspan id=\"day1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#day1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDay1\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"21:1-21:72\"\u003e\n\u003cspan id=\"uikit-ベースの大規模なプロジェクトへの-swiftui-導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#uikit-%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E5%A4%A7%E8%A6%8F%E6%A8%A1%E3%81%AA%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%B8%E3%81%AE-swiftui-%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUIKit ベースの大規模なプロジェクトへの SwiftUI 導入\u003c/h2\u003e\n\u003cp data-sourcepos=\"22:1-23:120\"\u003eUIKitベースでのプロジェクトへのSwiftUIの導入についての流れやメリット、辛かったことについてのトークでした。\u003cbr\u003e\n実際に移行してみないと分からない実体験を元にした発表で、非常に参考になりました。\u003c/p\u003e\n\u003cp data-sourcepos=\"25:1-27:156\"\u003eUIKitでもXcode Previewsが利用できるということを知らなかったため、活用できそうな知見を得られてよかったです。\u003cbr\u003e\nまた、iOS13でSwiftUIを導入するにはマイナーバージョンへの考慮多くて大変なことを知ることができ、参考になりました。\u003cbr\u003e\nSwiftUIを導入するにはiOS14～が良いということが知れたのは、携わっているプロジェクト的にもとても助かりました。\u003c/p\u003e\n\u003cp data-sourcepos=\"29:1-29:212\"\u003e\u003ca href=\"https://fortee.jp/iosdc-japan-2022/proposal/8f120179-7a65-429c-a471-ed11344f08b2\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUIKit ベースの大規模なプロジェクトへの SwiftUI 導入 by 久利龍義 | トーク | iOSDC Japan 2022 - fortee.jp\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"31:1-31:39\"\u003e\n\u003cspan id=\"swiftuiとuikitを仲良くさせる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#swiftui%E3%81%A8uikit%E3%82%92%E4%BB%B2%E8%89%AF%E3%81%8F%E3%81%95%E3%81%9B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSwiftUIとUIKitを仲良くさせる\u003c/h2\u003e\n\u003cp data-sourcepos=\"32:1-33:138\"\u003eUIKitのUIViewやUIViewControllerとSwiftUIのViewを相互から呼び出して使う方法や、Appのライフサイクル、UIKitとSwiftUIの相互の状態管理についてのトークでした。\u003cbr\u003e\n具体的なコードの例や修正の方法を交えながら解説されていたため、とても分かりやすい内容でした。\u003c/p\u003e\n\u003cp data-sourcepos=\"35:1-36:176\"\u003eUIKitとSwiftUIを相互から利用する方法について詳しくなかったため、非常に今後役立ちそうな知見を得ることができました。\u003cbr\u003e\nUIHostingControllerやRepresentableのレイアウトの決定方法や状態の持ち方など、非常に詳しく説明されており、とても参考になりました。\u003c/p\u003e\n\u003cp data-sourcepos=\"38:1-38:181\"\u003e\u003ca href=\"https://fortee.jp/iosdc-japan-2022/proposal/8b26bb21-27ec-4495-82bd-80a52f2fdee4\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSwiftUIとUIKitを仲良くさせる by Apurin Mikhail | トーク | iOSDC Japan 2022 - fortee.jp\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"40:1-40:6\"\u003e\n\u003cspan id=\"day2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#day2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDay2\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"41:1-41:53\"\u003e\n\u003cspan id=\"swift-concurrency時代のiosアプリの作り方\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#swift-concurrency%E6%99%82%E4%BB%A3%E3%81%AEios%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eSwift Concurrency時代のiOSアプリの作り方\u003c/h2\u003e\n\u003cp data-sourcepos=\"42:1-42:230\"\u003eSwift Concurrencyについて、実際にどのようにアプリに取り入れるかについてから、単体テストの書き方まで具体的な実装の流れを見ながら解説していくというトークでした。\u003c/p\u003e\n\u003cp data-sourcepos=\"44:1-47:116\"\u003eactorやTaskについて具体的かつ分かりやすい解説が少なく、今まで理解が追い付いていない部分が多かった状態でした。\u003cbr\u003e\nこちらのトークでは実際の実装の流れを追いながら使い方や注意点などを開設されていたため、非常に分かりやすいと感じました。\u003cbr\u003e\n特に非同期処理の単体テストはどのように書けばいいのか疑問が多かったのですが、Swift Concurrencyを利用すれば非常に効率的に書けることが分かり、大変参考になりました。\u003cbr\u003e\nSwift Concurrencyよく分からない…と途方に暮れている人には是非見てほしいトークです。\u003c/p\u003e\n\u003cp data-sourcepos=\"49:1-50:108\"\u003e\u003ca href=\"https://fortee.jp/iosdc-japan-2022/proposal/b50a5503-00e3-4dd3-ba1a-b28cd59c6a33\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSwift Concurrency時代のiOSアプリの作り方 by Yuta Koshizawa | トーク | iOSDC Japan 2022 - fortee.jp\u003c/a\u003e\u003cbr\u003e\n登壇資料は\u003ca href=\"https://speakerdeck.com/koher/swift-concurrencyshi-dai-noiosapurinozuo-rifang\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003e。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"52:1-52:75\"\u003e\n\u003cspan id=\"サポートiosバージョンを定期的にあげる仕組みづくり\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88ios%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E5%AE%9A%E6%9C%9F%E7%9A%84%E3%81%AB%E3%81%82%E3%81%92%E3%82%8B%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%A5%E3%81%8F%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eサポートiOSバージョンを定期的にあげる仕組みづくり\u003c/h2\u003e\n\u003cp data-sourcepos=\"53:1-53:98\"\u003eサポートiOSバージョンを上げるための基準や仕組みについてのLTでした。\u003c/p\u003e\n\u003cp data-sourcepos=\"55:1-57:147\"\u003eサポートバージョンはそのバージョンを利用できない端末(アクティブユーザー)の割合や課金額を基準に決定するという方法がとても良いと感じました。\u003cbr\u003e\nよくバージョンの割合で決めがちなものだと思いますが、アップデートができないアクティブユーザーを基準にする方が普段アップデートしない人に対してはアップデートを呼びかけしやすくてよい仕組みだと思いました。\u003cbr\u003e\nまた、定期的にサポートバージョンを見直すというイベントを設定するのも仕組みとしてよいと感じました。\u003c/p\u003e\n\u003cp data-sourcepos=\"59:1-59:211\"\u003e\u003ca href=\"https://fortee.jp/iosdc-japan-2022/proposal/38dd500c-5e65-494c-bb35-16a72eaf33ea\" rel=\"nofollow noopener\" target=\"_blank\"\u003eサポートiOSバージョンを定期的にあげる仕組みづくり by FromAtom | トーク | iOSDC Japan 2022 - fortee.jp\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"61:1-61:22\"\u003e\n\u003cspan id=\"iosdcチャレンジ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#iosdc%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eiOSDCチャレンジ\u003c/h1\u003e\n\u003cp data-sourcepos=\"62:1-63:168\"\u003e個人的に去年トークンが全然見つけられなかったのが悔しくて、本腰を入れてiOSDCチャレンジに挑戦していました！\u003cbr\u003e\nスポンサー各社のパンフレットやブログ記事などトークン探しがてら事前にじっくり見れたのが楽しかったなぁと思います。\u003c/p\u003e\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eiOSDCチャレンジ5位でした！！\u003cbr\u003eトークン探し大変だったけど楽しかったです！！\u003cbr\u003e残り10個見つけられなかったのが悔しかったので来年余裕があれば反省を生かします。\u003ca href=\"https://twitter.com/hashtag/iosdc?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#iosdc\u003c/a\u003e \u003ca href=\"https://t.co/WmYKhkrLW2\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/WmYKhkrLW2\u003c/a\u003e\u003c/p\u003e— 実験室のピヨコ🐤 (@LabosPiyoko) \u003ca href=\"https://twitter.com/LabosPiyoko/status/1569264236718858240?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSeptember 12, 2022\u003c/a\u003e\n\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e\n\u003cp data-sourcepos=\"67:1-68:79\"\u003eそして入賞の景品にフライングボールなるものをいただきました！\u003cbr\u003e\nが、これがなかなかに難しいです。修業が必要そうです🤣\u003c/p\u003e\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eiOSDCチャレンジの景品が届きました！！\u003cbr\u003e\u003cbr\u003eしかしこのフライングボール、電源入れてから飛ばすのも、操るの難しすぎてwwww\u003cbr\u003eもうちょっと修行しますね！！！？？\u003cbr\u003e\u003cbr\u003e※どこに飛んでも危なくない広い撮影場所が階段しかなかったのですが、フライングボールは無事です。\u003ca href=\"https://twitter.com/hashtag/iosdc?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#iosdc\u003c/a\u003e \u003ca href=\"https://t.co/ThnjL0AIWN\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/ThnjL0AIWN\u003c/a\u003e \u003ca href=\"https://t.co/pJsHq7uOhL\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/pJsHq7uOhL\u003c/a\u003e\u003c/p\u003e— 実験室のピヨコ🐤 (@LabosPiyoko) \u003ca href=\"https://twitter.com/LabosPiyoko/status/1571464595239477248?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSeptember 18, 2022\u003c/a\u003e\n\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e\n\u003ch1 data-sourcepos=\"71:1-71:14\"\u003e\n\u003cspan id=\"さいごに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eさいごに\u003c/h1\u003e\n\u003cp data-sourcepos=\"72:1-74:33\"\u003e今年はオフラインとオンラインのハイブリット開催でした。\u003cbr\u003e\niOSDCで初めての試みで、スタッフの皆さんは音響トラブルなど大変だったかと思います。\u003cbr\u003e\n本当にお疲れ様でした。\u003c/p\u003e\n\u003cp data-sourcepos=\"76:1-77:57\"\u003eオフラインの会場も非常に楽しそうな雰囲気がTwitterなどから伝わってきて、来年はオフライン参加もできたらいいなぁと思います。\u003cbr\u003e\nまた来年の開催も楽しみにしています！！\u003c/p\u003e\n","body":"# はじめに\niOSDC Japan 2022にオンラインで参加しました！\niwillblogということで、個人的に印象に残った発表について感想について書いていこうと思います。\nイベントの詳細については、[公式サイト](https://iosdc.jp/2022/)をご覧ください。\n\n※トークの動画については後日Youtubeにアップロードされるそうです。\n\n# Day0(前夜祭)\n## ウーニャ、しってる。みんなふんいきでSwiftUIをつかってる。\nSwiftUIのViewの分割と命名についてウーニャ(uhooiさん)なりの考え方を発表しつつ、参加者のツイートを通して議論するといった内容のトークでした。\nTwitterで参加者の意見や感想を拾いやすいよう「#ウーニャ」という独自のタグを作るといった工夫をされていました！\n\nSwiftUIについてはまだまだ初心者なため、Labelは画像を付けられることや、分割の考え方など大変参考になる発表でした。\n参加者からも「Previewが必要なときはstructを利用」など、発表にはなかった新たな知見が得られるなど双方向のやりとりがとても良かったです。\n\n登壇の資料と一緒に是非Twitterの「#ウーニャ」も見てほしい発表です。\n\n[ウーニャ、しってる。みんなふんいきでSwiftUIをつかってる。 by uhooi | トーク | iOSDC Japan 2022 - fortee.jp](https://fortee.jp/iosdc-japan-2022/proposal/28a7ecff-a0f1-40c9-80a5-b8ed2fb0fd94)\n\n# Day1\n## UIKit ベースの大規模なプロジェクトへの SwiftUI 導入\nUIKitベースでのプロジェクトへのSwiftUIの導入についての流れやメリット、辛かったことについてのトークでした。\n実際に移行してみないと分からない実体験を元にした発表で、非常に参考になりました。\n\nUIKitでもXcode Previewsが利用できるということを知らなかったため、活用できそうな知見を得られてよかったです。\nまた、iOS13でSwiftUIを導入するにはマイナーバージョンへの考慮多くて大変なことを知ることができ、参考になりました。\nSwiftUIを導入するにはiOS14～が良いということが知れたのは、携わっているプロジェクト的にもとても助かりました。\n\n[UIKit ベースの大規模なプロジェクトへの SwiftUI 導入 by 久利龍義 | トーク | iOSDC Japan 2022 - fortee.jp](https://fortee.jp/iosdc-japan-2022/proposal/8f120179-7a65-429c-a471-ed11344f08b2)\n\n## SwiftUIとUIKitを仲良くさせる\nUIKitのUIViewやUIViewControllerとSwiftUIのViewを相互から呼び出して使う方法や、Appのライフサイクル、UIKitとSwiftUIの相互の状態管理についてのトークでした。\n具体的なコードの例や修正の方法を交えながら解説されていたため、とても分かりやすい内容でした。\n\nUIKitとSwiftUIを相互から利用する方法について詳しくなかったため、非常に今後役立ちそうな知見を得ることができました。\nUIHostingControllerやRepresentableのレイアウトの決定方法や状態の持ち方など、非常に詳しく説明されており、とても参考になりました。\n\n[SwiftUIとUIKitを仲良くさせる by Apurin Mikhail | トーク | iOSDC Japan 2022 - fortee.jp](https://fortee.jp/iosdc-japan-2022/proposal/8b26bb21-27ec-4495-82bd-80a52f2fdee4)\n\n# Day2\n## Swift Concurrency時代のiOSアプリの作り方\nSwift Concurrencyについて、実際にどのようにアプリに取り入れるかについてから、単体テストの書き方まで具体的な実装の流れを見ながら解説していくというトークでした。\n\nactorやTaskについて具体的かつ分かりやすい解説が少なく、今まで理解が追い付いていない部分が多かった状態でした。\nこちらのトークでは実際の実装の流れを追いながら使い方や注意点などを開設されていたため、非常に分かりやすいと感じました。\n特に非同期処理の単体テストはどのように書けばいいのか疑問が多かったのですが、Swift Concurrencyを利用すれば非常に効率的に書けることが分かり、大変参考になりました。\nSwift Concurrencyよく分からない…と途方に暮れている人には是非見てほしいトークです。\n\n[Swift Concurrency時代のiOSアプリの作り方 by Yuta Koshizawa | トーク | iOSDC Japan 2022 - fortee.jp](https://fortee.jp/iosdc-japan-2022/proposal/b50a5503-00e3-4dd3-ba1a-b28cd59c6a33)\n登壇資料は[こちら](https://speakerdeck.com/koher/swift-concurrencyshi-dai-noiosapurinozuo-rifang)。\n\n## サポートiOSバージョンを定期的にあげる仕組みづくり\nサポートiOSバージョンを上げるための基準や仕組みについてのLTでした。\n\nサポートバージョンはそのバージョンを利用できない端末(アクティブユーザー)の割合や課金額を基準に決定するという方法がとても良いと感じました。\nよくバージョンの割合で決めがちなものだと思いますが、アップデートができないアクティブユーザーを基準にする方が普段アップデートしない人に対してはアップデートを呼びかけしやすくてよい仕組みだと思いました。\nまた、定期的にサポートバージョンを見直すというイベントを設定するのも仕組みとしてよいと感じました。\n\n[サポートiOSバージョンを定期的にあげる仕組みづくり by FromAtom | トーク | iOSDC Japan 2022 - fortee.jp](https://fortee.jp/iosdc-japan-2022/proposal/38dd500c-5e65-494c-bb35-16a72eaf33ea)\n\n# iOSDCチャレンジ\n個人的に去年トークンが全然見つけられなかったのが悔しくて、本腰を入れてiOSDCチャレンジに挑戦していました！\nスポンサー各社のパンフレットやブログ記事などトークン探しがてら事前にじっくり見れたのが楽しかったなぁと思います。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eiOSDCチャレンジ5位でした！！\u003cbr\u003eトークン探し大変だったけど楽しかったです！！\u003cbr\u003e残り10個見つけられなかったのが悔しかったので来年余裕があれば反省を生かします。\u003ca href=\"https://twitter.com/hashtag/iosdc?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#iosdc\u003c/a\u003e \u003ca href=\"https://t.co/WmYKhkrLW2\"\u003epic.twitter.com/WmYKhkrLW2\u003c/a\u003e\u003c/p\u003e\u0026mdash; 実験室のピヨコ🐤 (@LabosPiyoko) \u003ca href=\"https://twitter.com/LabosPiyoko/status/1569264236718858240?ref_src=twsrc%5Etfw\"\u003eSeptember 12, 2022\u003c/a\u003e\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\nそして入賞の景品にフライングボールなるものをいただきました！\nが、これがなかなかに難しいです。修業が必要そうです🤣\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eiOSDCチャレンジの景品が届きました！！\u003cbr\u003e\u003cbr\u003eしかしこのフライングボール、電源入れてから飛ばすのも、操るの難しすぎてwwww\u003cbr\u003eもうちょっと修行しますね！！！？？\u003cbr\u003e\u003cbr\u003e※どこに飛んでも危なくない広い撮影場所が階段しかなかったのですが、フライングボールは無事です。\u003ca href=\"https://twitter.com/hashtag/iosdc?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#iosdc\u003c/a\u003e \u003ca href=\"https://t.co/ThnjL0AIWN\"\u003ehttps://t.co/ThnjL0AIWN\u003c/a\u003e \u003ca href=\"https://t.co/pJsHq7uOhL\"\u003epic.twitter.com/pJsHq7uOhL\u003c/a\u003e\u003c/p\u003e\u0026mdash; 実験室のピヨコ🐤 (@LabosPiyoko) \u003ca href=\"https://twitter.com/LabosPiyoko/status/1571464595239477248?ref_src=twsrc%5Etfw\"\u003eSeptember 18, 2022\u003c/a\u003e\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e\n\n# さいごに\n今年はオフラインとオンラインのハイブリット開催でした。\niOSDCで初めての試みで、スタッフの皆さんは音響トラブルなど大変だったかと思います。\n本当にお疲れ様でした。\n\nオフラインの会場も非常に楽しそうな雰囲気がTwitterなどから伝わってきて、来年はオフライン参加もできたらいいなぁと思います。\nまた来年の開催も楽しみにしています！！\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:49:24+09:00","group":null,"id":"52fb646ecc137bc74750","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"参加レポート","versions":[]},{"name":"iOSDC2022","versions":[]}],"title":"iOSDC Japan 2022に参加しました！","updated_at":"2022-09-18T20:49:24+09:00","url":"https://qiita.com/LabosPiyoko/items/52fb646ecc137bc74750","user":{"description":"2015年くらいからモバイルアプリ開発の仕事をやっている人のアカウント。なんやかんやでObjCという考古学とずっと戦っている。","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"LabosPiyoko","items_count":1,"linkedin_id":"","location":"埼玉県","name":"実験室のピヨコ","organization":"","permanent_id":536693,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/536693/ca7df6452e408ee4ce2a6a50c2b2652174969725/x_large.png?1663236282","team_only":false,"twitter_screen_name":"LabosPiyoko","website_url":"https://twitter.com/LabosPiyoko"},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-3:245\"\u003eDockerって環境を汚さないで使えて便利ですよね。\u003cbr\u003e\nvscodeっていろんな言語の開発環境を手軽に作れて便利ですよね。\u003cbr\u003e\nということでRemote Developmentによる作業コンテナ(devcontainer)を使ってコンテナ側に引き篭って開発できる環境を作ってみたので、環境構成と要点をここに書き出してみようと思います。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"5:1-5:14\"\u003e\n\u003cspan id=\"注意事項\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意事項\u003c/h1\u003e\n\u003cp data-sourcepos=\"7:1-7:15\"\u003eこの記事は\u003c/p\u003e\n\u003cul data-sourcepos=\"9:1-12:0\"\u003e\n\u003cli data-sourcepos=\"9:1-9:32\"\u003eホストOSがWindows環境で\u003c/li\u003e\n\u003cli data-sourcepos=\"10:1-10:41\"\u003evscodeとDockerコンテナを使って\u003c/li\u003e\n\u003cli data-sourcepos=\"11:1-12:0\"\u003eなるべくUnix系に寄せて使えるようにする\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"13:1-14:218\"\u003e前提での環境構築のお話になっています。\u003cbr\u003e\nホストOSにLinuxやMacを使っていたりコンテナを使わなかったりホストはWindows上のシェル操作で十分な場合は、この記事は適合しない内容が多分に含まれています。\u003c/p\u003e\n\u003cp data-sourcepos=\"16:1-16:171\"\u003eまた、個々のツールや環境のセットアップ操作などはほぼ書かれない予定なので、必要に応じて他の記事を参照してください。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"18:1-18:8\"\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h1\u003e\n\u003cul data-sourcepos=\"20:1-30:0\"\u003e\n\u003cli data-sourcepos=\"20:1-21:16\"\u003eホスト\n\u003cul data-sourcepos=\"21:5-21:16\"\u003e\n\u003cli data-sourcepos=\"21:5-21:16\"\u003eWindows 10\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"22:1-24:18\"\u003eWSL\n\u003cul data-sourcepos=\"23:5-24:18\"\u003e\n\u003cli data-sourcepos=\"23:5-23:10\"\u003eWSL2\u003c/li\u003e\n\u003cli data-sourcepos=\"24:5-24:18\"\u003eUbuntu 20.04\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"25:1-27:36\"\u003eDocker\n\u003cul data-sourcepos=\"26:5-27:36\"\u003e\n\u003cli data-sourcepos=\"26:5-26:44\"\u003eDocker version 20.10.17, build 100c701\u003c/li\u003e\n\u003cli data-sourcepos=\"27:5-27:36\"\u003eDocker Compose version v2.10.2\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"28:1-30:0\"\u003edevcontainer\n\u003cul data-sourcepos=\"29:5-30:0\"\u003e\n\u003cli data-sourcepos=\"29:5-30:0\"\u003eDebian bullseye\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv data-sourcepos=\"31:1-33:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"32:1-32:221\"\u003e私の場合はGoの開発環境としてdevcontainerを作ったのでDebianベース(\u003ccode\u003egolang:1.19-bullseye\u003c/code\u003e)になっていますが、他のディストリビューションでも同じことはできると思います\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"35:1-35:8\"\u003e\n\u003cspan id=\"tldr\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tldr\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTL;DR;\u003c/h1\u003e\n\u003cul data-sourcepos=\"37:1-40:0\"\u003e\n\u003cli data-sourcepos=\"37:1-37:101\"\u003eワークスペースはサービスのコンテナとは独立してdevcontainer上に構築する\u003c/li\u003e\n\u003cli data-sourcepos=\"38:1-38:86\"\u003eサービス用のコンテナとdevcontainerを同じネットワークにつなぐ\u003c/li\u003e\n\u003cli data-sourcepos=\"39:1-40:0\"\u003eDockerはDooDで操作し、ワークスペースの配置はWSL上とDocker上でパスを合わせる\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"41:1-41:29\"\u003e\n\u003cspan id=\"経緯とか変遷の流れ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%8C%E7%B7%AF%E3%81%A8%E3%81%8B%E5%A4%89%E9%81%B7%E3%81%AE%E6%B5%81%E3%82%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e経緯とか変遷の流れ\u003c/h1\u003e\n\u003cp data-sourcepos=\"43:1-43:171\"\u003evscode + Remote Developmentを扱い始めた際、既存のコンテナにアタッチしてそこにvscodeのワークスペースを構築して使っていました。\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMTcxcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo2MDhweDtoZWlnaHQ6MTcxcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNjA4IDE3MSIgd2lkdGg9IjYwOHB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImZ6MTZrN3BpeTNsMXYiIHdpZHRoPSIzMDAlIiB4PSItMSIgeT0iLTEiPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIHN0ZERldmlhdGlvbj0iMi4wIi8+PGZlQ29sb3JNYXRyaXggaW49ImJsdXJPdXQiIHJlc3VsdD0iYmx1ck91dDIiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAuNCAwIi8+PGZlT2Zmc2V0IGR4PSI0LjAiIGR5PSI0LjAiIGluPSJibHVyT3V0MiIgcmVzdWx0PSJibHVyT3V0MyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImJsdXJPdXQzIiBtb2RlPSJub3JtYWwiLz48L2ZpbHRlcj48L2RlZnM+PGc+PCEtLU1ENT1bMTNjYzdkNzk3NDMxMTE0MTI5NjVmNTdhZWRhYTlhNTldCmNsdXN0ZXIgdnNjb2RlLS0+PHJlY3QgZmlsbD0iI0ZGRkZFMCIgZmlsdGVyPSJ1cmwoI2Z6MTZrN3BpeTNsMXYpIiBoZWlnaHQ9IjE0NSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMjI0IiB4PSI3IiB5PSIxMC41Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iOTUiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBREFBQUFBd0NBSUFBQURZWUc3UUFBQUNHa2xFUVZSNFhzMlpQVTRETVJCRzV3cGNnU3R3QmE3QUZiZ0N0SFNJbGdxSmxvYUNsb0tHRm9tS0J2SUhLV2locERXVFRPUlkvdGIyckQwbVNDOUZiSy85TWp2MmJCSnlidm12SUd6cXdmZlBjdjlpY25BNXVYcGFZRzhJWVpNNVlrT25yNTdqdTluaTZ3Tkh1ajhRUWh2UFlNQUlwekFrWXhNU0JveHdGaXQ0amIyek4xdytCUWZNOVJOU3hpYUNyeUtjcTUwNkcrb2tWRzFEUFlSYWJBaUZIbWJ2UnpmVDFBbFJaR3dXSTFzaFZ1RWtsMWFlbE4vaWVua2FZeU5zaEFZbk9uK2M0Nm9wMm1NanJJUldMK2dRRHErbjNJdkxSNWpFUmlnSU1ieFNQcVgwc2RFTUt3c0pXSEhHeG9ZVGdNSDJDSzBRcmN0Tm5ZM2ZJcFZDbkRlcDJQSTI5Q21sdkZQaEpaVkNKL2Z6ekdMeWNaV3g0U010akdpOVVERUFtUzRQcGwyVFVORXBBMS8xL0Rtd01WdUY2cHpDcExFWEd1dUVPOUZlU08rRVNkTkxTTE9uVW5sakw4UzkvaW1nU0w0ZTJ3anBiWVRvN0RFV0dtc2pwT3B4cTFDZGplRHJsNWtRVnpRY0xmQnU0dnpGZGlTNis1VkNmSmFrYk1LdHBIUUtIL0VxaFZMZzA2UFN5YWVVcFJBZVRxT2NhSDJqYllRRzA3UE9xWGk2VWxHSU45cmdCa1luVFczUnNKSnhpYTlCK1VxSlRqaERCUnNoNXZabEVXb1ZLeVZpRXFldGtNQWVmSnVLWlRKRmU1eGlvWFlhNDJRdjVOcWN1Z2k1QnFkZVFxN1dxYU9RRysvRTFjbjErOUZUMER5UDh3RDVkaXFYRU01aVM4YUpqeGcrLzZMeGhGT1lnMDY3L0d0QkVLZkIveElpQ0p0Mnl5L25UTGhWZzNoM2RBQUFBQUJKUlU1RXJrSmdnZz09IiB5PSIxMi41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjAiIHg9IjE0MyIgeT0iNzMuNDk1MSIvPjwhLS1NRDU9WzVlYzdlZWRkNTczMTA2NDhmODA1OWZmYjI2MjFjYTRiXQpjbHVzdGVyIGRvY2tlci0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmejE2azdwaXkzbDF2KSIgaGVpZ2h0PSIxNTIiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE4MCIgeD0iNDE2IiB5PSI3Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iNDgyIiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDU2tsRVFWUjRYdTJYdlZFY1FSQkdPd0dsb0JBSVFTRVFBaUVRZ2xKUUNCY0NKZzVWRkE0T0JvNGNPZEx4TDhGUmxCd2NHYXZIdFdpRytYYjNwZzZXeGxEVnE2dWI3M1ptSGpPOXM0dDEzZnhkWVJybFlocmxZaHJsWWhybFlocmxZaHJsWWhybFlocmxZaG8xc25Gd3MzbjBLL2gwZUszWHJJRnAxRWhsOEY5SVNCQzYrelAvOHYxeUNHcm94LzFKMENqRW1CcVdtRWJCL3VLTWFiYS9YamtmOXhieFhac3RRdGg0TC8wcE1JMENoRDUvdTR6bStCNjFDS0h5WWZjV1JweE1vK0RWaFZnZUY0S2RxM085b0h0am9iQUJTbEF2NkNvaDlyZ3NDNDY3cmVPZmFEa01FZCsxV1pYVTdPeENKeXVGZ0Z2aCtQY3BmZm5zRitJS3BtRlZIR3o0dTZQSmxQRjl2T2xPS2xSdW1VSVhWcVFXS2dkYWU4dXFjUUwrUXZVb29hT1ZIYVlXSWxlSmdMT3QweTJiVG9od1pJWGNCb3pyS0VDSGxIR2ppUTExSFUzS0s3NlBOMzBjYm16d2NXaFdCdFNUdnk5d01RN2hiWFJRMzZrWnV1ZlRoR1o5aDBLYTBNanlQQWhSdWRwblVvWWVHditFT0l1MHozUlF4U3J4VEtoYnZoMXJ6eW5nem1wNkgrSzIxTTRWL25oNm9YcjV6QnJpUWFobDF4RHlZME4vYW1TOGRKNEpBYWVURGxIQ2FyK0J6Wk5RdHp6N3EzKzFXQlZFOTVjdnNqcEhPNHlnRXcveEpNVEdNWEZ2Wi9aZXAybUJBY3ZIUWd0V050eXA5eGhkdWFjVmJISHZPQ3N4amZ4WnFIZEVveE1xOGVoZUE5T29lM3hWUUl1aFN6Ti9jMVVKaHk3dHhUdUVhUlN3Z3l3NzB5QUIrSG14aHdFaHYzcmhhL2YxTUkyR3dJK1Y0M1BsYWZzU1RLTmNUS05jVEtOY1RLTmNUS05jVEtOY1RLTmNUS05jL2dLR1RCa2pWd0NxTUFBQUFBQkpSVTVFcmtKZ2dnPT0iIHk9IjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMCIgeD0iNTMwIiB5PSI2OS45OTUxIi8+PCEtLU1ENT1bM2Q5OWQ1OWEyN2VjNTVjZDliMGIxNDkwODAxZjc4YmNdCmVudGl0eSBkZXYtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnoxNms3cGl5M2wxdikiIGhlaWdodD0iNDYuMjk2OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTkyIiB4PSIyMyIgeT0iOTMuNSIvPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE1IiB4PSIxOTUiIHk9Ijk4LjUiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQiIHg9IjE5MyIgeT0iMTAwLjUiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQiIHg9IjE5MyIgeT0iMTA0LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTIiIHg9IjM4IiB5PSIxMjYuNDk1MSI+UmVtb3RlIERldmVsb3BtZW50PC90ZXh0PjwhLS1NRDU9WzI1Mzc5M2FjMTJkYzcxYjViMzY2MTcyOGU4ZGMyMTQ3XQplbnRpdHkgc3ZjLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2Z6MTZrN3BpeTNsMXYpIiBoZWlnaHQ9IjUyLjU5MzgiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE0OCIgeD0iNDMyIiB5PSI5MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSI0NDIiIHk9IjExMi45OTUxIj7jg6/jg7zjgq/jgrnjg5rjg7zjgrk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI4IiB4PSI0NDIiIHk9IjEyOS4yOTIiPmluIOOCteODvOODk+OCueOCs+ODs+ODhuODijwvdGV4dD48IS0tTUQ1PVs5NmM2ODczM2UyNjE4YTVlMTQ2ZWIyZmU3NTA0NGJmM10KbGluayBkZXYgdG8gc3ZjLS0+PHBhdGggZD0iTTIxNS4xNiwxMTYuNSBDMjgwLjM3LDExNi41IDM2NS41MywxMTYuNSA0MjYuODIsMTE2LjUgIiBmaWxsPSJub25lIiBpZD0iZGV2LXRvLXN2YyIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSI0MzEuOTQsMTE2LjUsNDIyLjk0LDExMi41LDQyNi45NCwxMTYuNSw0MjIuOTQsMTIwLjUsNDMxLjk0LDExNi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxODAiIHg9IjIzMy41IiB5PSIxMDkuNTY2OSI+QXR0YWNoIHRvIFJ1bm5pbmcgQ29udGFpbmVyPC90ZXh0PjwhLS1NRDU9WzFlNjJmYzMzZTQ1YjJiZDU0ZTVmY2RkN2E4OTBiNzQ4XQpAc3RhcnR1bWwNCiFkZWZpbmUgSUNPTlVSTCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vdHVwYWRyMy9wbGFudHVtbC1pY29uLWZvbnQtc3ByaXRlcy92Mi40LjANCiFpbmNsdWRldXJsIElDT05VUkwvY29tbW9uLnB1bWwNCiFpbmNsdWRldXJsIElDT05VUkwvZGV2aWNvbnMyL3Zpc3VhbHN0dWRpby5wdW1sDQohaW5jbHVkZXVybCBJQ09OVVJML2Rldmljb25zMi9kb2NrZXIucHVtbA0KDQpERVYyX1ZJU1VBTFNUVURJTyh2c2NvZGUsIiIscmVjdGFuZ2xlLCMwMDc4ZDcpICNmZmZmZTAgew0KICAgIGNvbXBvbmVudCAiUmVtb3RlIERldmVsb3BtZW50IiBhcyBkZXYNCn0NCkRFVjJfRE9DS0VSKGRvY2tlciwiIixyZWN0YW5nbGUsIzBkYjdlZCkgI2ZmZmZlMCB7DQogICAgYWdlbnQgIuODr+ODvOOCr+OCueODmuODvOOCuVxuaW4g44K144O844OT44K544Kz44Oz44OG44OKIiBhcyBzdmMNCn0NCg0KZGV2IC0+IHN2YyA6IEF0dGFjaCB0byBSdW5uaW5nIENvbnRhaW5lcg0KQGVuZHVtbA0KCkBzdGFydHVtbA0KDQoNCmhpZGUgc3RlcmVvdHlwZQ0Kc3ByaXRlICR2aXN1YWxzdHVkaW8gWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREM2MDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGOTIwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkM2MDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGOTIwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZGRkMwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDA0QTIwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDA0Q0ZGRTQwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowREZGRkZGRjcwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkIxMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkQyMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZFRkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRkY2MDAwMDAwMDFERkZGRkZGRkZGRkZGNzdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRkY5MDAwMDAxREZGRkZGRkZGRkZGRTQwN0ZGRkZGRkZGRkZGMQ0KMUZGRkZCRUZGRkZGRkZDMTAwMkVGRkZGRkZGRkZGRkMxMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgyRUZGRkZGRkZFNDFERkZGRkZGRkZGRkZBMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAyRUZGRkZGRkZGRUZGRkZGRkZGRkZGNjAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAyRUZGRkZGRkZGRkZGRkZGRkZGRTMwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAyRUZGRkZGRkZGRkZGRkZGRkMxMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAyRUZGRkZGRkZGRkZGRkY5MDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDAyRUZGRkZGRkZGRkZGNjAwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwMDFERkZGRkZGRkZGRkUzMDAwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAxQ0ZGRkZGRkZGRkZGRkY3MDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMENGRkZGRkZGRkZGRkZGRkZBMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDBDRkZGRkZGRkZGRkZGRkZGRkZEMjAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwQ0ZGRkZGRkZGRkZGRkZGRkZGRkZFNDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MEJGRkZGRkZGRjYzRkZGRkZGRkZGRkZGODAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjlCRkZGRkZGRkUzMDAzRkZGRkZGRkZGRkZGQjEwMDdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRkZCMTAwMDAzRkZGRkZGRkZGRkZGRDIwN0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGODAwMDAwMDAzRkZGRkZGRkZGRkZGRjY3RkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRTQwMDAwMDAwMDAzRkZGRkZGRkZGRkZGRkRGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkMyMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMERGRkZGRkY5MDAwMDAwMDAwMDAwMDAzRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDVERkZGNjAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDA2QzMwMDAwMDAwMDAwMDAwMDAwMDAzRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGQjANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZFODIwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZDNTAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkY5MjAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUM2MDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBWSVNVQUxTVFVESU8+PiBXaGl0ZQ0Kc3ByaXRlICRkb2NrZXIgWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwREJCQkJDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBDMDAwMEMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMEMwMDAwQzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwQzAwMDBDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDE3Nzc3Nzc3NzdEMjIyMkMwMDAwMDAwMDAwMDAxMDAwMDAwMDAwMA0KMDAwMDAwMDAwNEM5OTlFOTk5OUU5OTk5QzAwMDAwMDAwMDAwMUU5MDAwMDAwMDAwDQowMDAwMDAwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMDAwMDAwMDA5RkY5MDAwMDAwMDANCjAwMDAwMDAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAwMDAwMDAwMEVGRkY1MDAwMDAwMA0KMDAwMDAwMDAwNDgwMDBDMDAwMEMwMDAwQzAwMDAwMDAwMDAwRkZGRkQwMDAwMDAwDQowMDAwMTk5OTlCQTQ0NEQ0NDQ0RDQ0NDRFOTk5OTYwMDAwMDBGRkZGRjIzNDMwMDANCjAwMDAyRDg4OEFDODg4RTg4ODhFODg4OEU4ODg5OTAwMDAwMEVGRkZGRkZGRkY5MQ0KMDAwMDI5MDAwNDgwMDBDMDAwMEMwMDAwQzAwMDI5MDAwMDAwQUZGRkZGRkZGRkYyDQowMDAwMjkwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMjkwMDAwMDAyRkZGRkZGRkZGNzANCjAwMDAyOTAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAyOTAwMDAwMkFGRkZGRkZGRjcwMA0KMjY2NjdDNjY2OEI2NjZENjY2NkQ2NjY2RDY2NjdDNTU2OENGRkZGRkVEQjcyMDAwDQo2RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZEMDAwMDAwMDANCjZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjYwMDAwMDAwMA0KNkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZEMDAwMDAwMDAwDQo0RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjUwMDAwMDAwMDANCjFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZCMDAwMDAwMDAwMA0KMERGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRTEwMDAwMDAwMDAwDQowOEZGRkZGRkZGRkZGOTZERkZGRkZGRkZGRkZGRkZGRkZGRkYzMDAwMDAwMDAwMDANCjAxRkZGRkZGRkZGRkY5REJGRkZGRkZGRkZGRkZGRkZGRkZGNTAwMDAwMDAwMDAwMA0KMDA3RkZGRkZGRkZGRkVCRkZGRkZGRkZGRkZGRkZGRkZGRjUwMDAwMDAwMDAwMDAwDQowMDBDREJCQkI5NzRDRkZGRkZGRkZGRkZGRkZGRkZGRkY0MDAwMDAwMDAwMDAwMDANCjAwMDFDNDAwMDAwMDNGRkZGRkZGRkZGRkZGRkZGRkZDMjAwMDAwMDAwMDAwMDAwMA0KMDAwMDFDNjAwMDAwMDdGRkZGRkZGRkZGRkZGRkZFNjAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDA4QzMwMDAwMDdGRkZGRkZGRkZGRkZFNzAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAyQUM3MzAwMDRERkZGRkZGRkZBNTAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMTZBRERDQkJGRkZEQTc0MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDEyMTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBET0NLRVI+PiBXaGl0ZQ0KDQpyZWN0YW5nbGUgIjxjb2xvcjojMDA3OGQ3PjwkdmlzdWFsc3R1ZGlvPjwvY29sb3I+XHIgIiBhcyB2c2NvZGUgPDxERVYyIFZJU1VBTFNUVURJTz4+ICNmZmZmZTAgew0KICAgIGNvbXBvbmVudCAiUmVtb3RlIERldmVsb3BtZW50IiBhcyBkZXYNCn0NCnJlY3RhbmdsZSAiPGNvbG9yOiMwZGI3ZWQ+PCRkb2NrZXI+PC9jb2xvcj5cciAiIGFzIGRvY2tlciA8PERFVjIgRE9DS0VSPj4gI2ZmZmZlMCB7DQogICAgYWdlbnQgIuODr+ODvOOCr+OCueODmuODvOOCuVxuaW4g44K144O844OT44K544Kz44Oz44OG44OKIiBhcyBzdmMNCn0NCg0KZGV2IC0+IHN2YyA6IEF0dGFjaCB0byBSdW5uaW5nIENvbnRhaW5lcg0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjE2KFdlZCBEZWMgMDggMTc6MjU6MjIgVVRDIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IG51bGwKLS0+PC9nPjwvc3ZnPg==\" loading=\"lazy\"\u003e\n\u003ch2 data-sourcepos=\"63:1-63:66\"\u003e\n\u003cspan id=\"ワークスペースのサービスコンテナからの分離\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%8B%E3%82%89%E3%81%AE%E5%88%86%E9%9B%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eワークスペースのサービスコンテナからの分離\u003c/h2\u003e\n\u003cp data-sourcepos=\"65:1-65:72\"\u003eサービスコンテナ上にワークスペースを構築すると、\u003c/p\u003e\n\u003cul data-sourcepos=\"67:1-74:0\"\u003e\n\u003cli data-sourcepos=\"67:1-70:120\"\u003eワークスペースに追加のツールなどをインストールするためには手動で行う必要がある\n\u003cul data-sourcepos=\"68:5-70:120\"\u003e\n\u003cli data-sourcepos=\"68:5-69:120\"\u003eDockerFileに書いてしまうとコミット時に差分を除く必要が出てしまう\n\u003cul data-sourcepos=\"69:9-69:120\"\u003e\n\u003cli data-sourcepos=\"69:9-69:120\"\u003e全作業者が環境構成を共有するならありだけど普通はそうじゃない(と思っている)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"70:5-70:120\"\u003e別ボリュームでマウントすれば使い回せるけどdocker-compose.ymlに書いてしまうと以下略\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"71:1-74:0\"\u003eサービスコンテナを破棄する度にツールの再インストールが必要になる\n\u003cul data-sourcepos=\"72:5-74:0\"\u003e\n\u003cli data-sourcepos=\"72:5-72:114\"\u003eコンテナは中身がよくわからなくて困ったら手軽に再作成できるのが売りの一つ\u003c/li\u003e\n\u003cli data-sourcepos=\"73:5-74:0\"\u003e別ボリュームやホストに退避したりで使い回せるようにしたこともあったけど、たまに回収し忘れると再度入れ直したりするのが手間\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"75:1-75:45\"\u003eというデメリットがありました。\u003c/p\u003e\n\u003cp data-sourcepos=\"77:1-78:373\"\u003eこの点を解消するために、ワークスペースを稼働中のサービスコンテナから切り離してホスト側で構築し直すようにしました。\u003cbr\u003e\nこの構成では通常のファイル操作などはvscodeからWindows上で行うことになりますが、コンテナにも同じファイルをマウントすることで変更が反映されるので問題なく作業できますし、vscode上で解決できない操作はサービスコンテナに対して \u003ccode\u003edocker exec\u003c/code\u003e などで直接操作もできます。\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMTcxcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo1MzZweDtoZWlnaHQ6MTcxcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNTM2IDE3MSIgd2lkdGg9IjUzNnB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImZ5b3hyYTZ3c2VxamYiIHdpZHRoPSIzMDAlIiB4PSItMSIgeT0iLTEiPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIHN0ZERldmlhdGlvbj0iMi4wIi8+PGZlQ29sb3JNYXRyaXggaW49ImJsdXJPdXQiIHJlc3VsdD0iYmx1ck91dDIiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAuNCAwIi8+PGZlT2Zmc2V0IGR4PSI0LjAiIGR5PSI0LjAiIGluPSJibHVyT3V0MiIgcmVzdWx0PSJibHVyT3V0MyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImJsdXJPdXQzIiBtb2RlPSJub3JtYWwiLz48L2ZpbHRlcj48L2RlZnM+PGc+PCEtLU1ENT1bYjNjMjhkMzU5MzVmMzg3NmE4MGZlNjk1Yzg0Mzc2N2FdCmNsdXN0ZXIgd2luZG93cy0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmeW94cmE2d3NlcWpmKSIgaGVpZ2h0PSIxNTIiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE1MCIgeD0iMTI4IiB5PSI3Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iMTc5IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFCVVVsRVFWUjRYdTJaMFdrQ1FSQ0d0NFZyd1Jac0lTM1lnaTJrQlZ0SUM5ZENXa2dMd2tBSUlpR0dFQ1NJeU9VL1I0N0x6bmh6Ym5ZNUh3YStCOTMxZHI2ZFdXUmNROVBRUGJBKzB2TVA3VTRVNUZ4cEVQWGxRUFdlSGo5cDhVN3pEUVc2QUtjZ0g4aElGM3YxRmNkV3lTeUV0SFBzNVFjOWJLbDZqZU9aSkFyeHZnRy94ZFlUWXF2WVF2MmM4NzVuYjVlSDRjR2Z5V1VUSWlFKzUwL2Z5bGxUS1NXRTNhZXRXRW9JS1pFVFkzQWhDeGV5Y0NFTEY3SndJUXNYc25BaEN5bUVGOWRBVzZlQ3Jxc1Btc0hRbkZ1ekRyU0lKdXhSaUNDSHB1VlB5V1NxQjlLT1RwZVhRS09kQUNvdVFZbitlNFpRUVRtVlRIdUdYR2dJRjdKd0lZc01RdTFYbVpoS3hvVXNYTWpDaFN4YW9Yb2ZqNDZrbEJBdmV1dDlYaWd0cERKc09ZR1F5dTU4THd0TDFKcEhxbnkvT2xLRXJ0R2xNN285dm9tY1Fpcjlvbyt4TEM2a01uQTBweEZTNmY2ZStnWFdVbnd3ai96U2Z3QUFBQUJKUlU1RXJrSmdnZz09IiB5PSI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjAiIHg9IjIyNyIgeT0iNjkuOTk1MSIvPjwhLS1NRDU9WzVlYzdlZWRkNTczMTA2NDhmODA1OWZmYjI2MjFjYTRiXQpjbHVzdGVyIGRvY2tlci0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmeW94cmE2d3NlcWpmKSIgaGVpZ2h0PSIxMzUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE2NCIgeD0iMzYwIiB5PSIxNS41Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iNDE4IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDU2tsRVFWUjRYdTJYdlZFY1FSQkdPd0dsb0JBSVFTRVFBaUVRZ2xKUUNCY0NKZzVWRkE0T0JvNGNPZEx4TDhGUmxCd2NHYXZIdFdpRytYYjNwZzZXeGxEVnE2dWI3M1ptSGpPOXM0dDEzZnhkWVJybFlocmxZaHJsWWhybFlocmxZaHJsWWhybFlocmxZaG8xc25Gd3MzbjBLL2gwZUszWHJJRnAxRWhsOEY5SVNCQzYrelAvOHYxeUNHcm94LzFKMENqRW1CcVdtRWJCL3VLTWFiYS9YamtmOXhieFhac3RRdGg0TC8wcE1JMENoRDUvdTR6bStCNjFDS0h5WWZjV1JweE1vK0RWaFZnZUY0S2RxM085b0h0am9iQUJTbEF2NkNvaDlyZ3NDNDY3cmVPZmFEa01FZCsxV1pYVTdPeENKeXVGZ0Z2aCtQY3BmZm5zRitJS3BtRlZIR3o0dTZQSmxQRjl2T2xPS2xSdW1VSVhWcVFXS2dkYWU4dXFjUUwrUXZVb29hT1ZIYVlXSWxlSmdMT3QweTJiVG9od1pJWGNCb3pyS0VDSGxIR2ppUTExSFUzS0s3NlBOMzBjYm16d2NXaFdCdFNUdnk5d01RN2hiWFJRMzZrWnV1ZlRoR1o5aDBLYTBNanlQQWhSdWRwblVvWWVHditFT0l1MHozUlF4U3J4VEtoYnZoMXJ6eW5nem1wNkgrSzIxTTRWL25oNm9YcjV6QnJpUWFobDF4RHlZME4vYW1TOGRKNEpBYWVURGxIQ2FyK0J6Wk5RdHp6N3EzKzFXQlZFOTVjdnNqcEhPNHlnRXcveEpNVEdNWEZ2Wi9aZXAybUJBY3ZIUWd0V050eXA5eGhkdWFjVmJISHZPQ3N4amZ4WnFIZEVveE1xOGVoZUE5T29lM3hWUUl1aFN6Ti9jMVVKaHk3dHhUdUVhUlN3Z3l3NzB5QUIrSG14aHdFaHYzcmhhL2YxTUkyR3dJK1Y0M1BsYWZzU1RLTmNUS05jVEtOY1RLTmNUS05jVEtOY1RLTmNUS05jL2dLR1RCa2pWd0NxTUFBQUFBQkpSVTVFcmtKZ2dnPT0iIHk9IjE3LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMCIgeD0iNDY2IiB5PSI3OC40OTUxIi8+PCEtLU1ENT1bYzk3NTBkYWZhNGFlNGEwMWY0Y2RiZGNmMTRkNGI5NDZdCmVudGl0eSB3cy0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmeW94cmE2d3NlcWpmKSIgaGVpZ2h0PSI1Mi41OTM4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMTgiIHg9IjE0NCIgeT0iOTAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OCIgeD0iMTU0IiB5PSIxMTIuOTk1MSI+44Ov44O844Kv44K544Oa44O844K5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0IiB4PSIxNTQiIHk9IjEyOS4yOTIiPm9uIFdpbmRvd3M8L3RleHQ+PCEtLU1ENT1bMjUzNzkzYWMxMmRjNzFiNWIzNjYxNzI4ZThkYzIxNDddCmVudGl0eSBzdmMtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnlveHJhNndzZXFqZikiIGhlaWdodD0iMzYuMjk2OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTMyIiB4PSIzNzYiIHk9Ijk4LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjM4NiIgeT0iMTIxLjQ5NTEiPuOCteODvOODk+OCueOCs+ODs+ODhuODijwvdGV4dD48IS0tTUQ1PVtlNDcxNzc0ZTQwODY2MmM4Yzc2YzM0YTdmNTQzNTZiOF0KZW50aXR5IHZzY29kZS0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmeW94cmE2d3NlcWpmKSIgaGVpZ2h0PSI4NC4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2OCIgeD0iNyIgeT0iNzQuNSIvPjxpbWFnZSBoZWlnaHQ9IjQ4IiB3aWR0aD0iNDgiIHg9IjE3IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDR2tsRVFWUjRYczJaUFU0RE1SQkc1d3BjZ1N0d0JhN0FGYmdDdEhTSWxncUpsb2FDbG9LR0ZvbUtCdklIS1dpaHBEV1RUT1JZL3RiMnJEMG1TQzlGYksvOU1qdjJiQkp5YnZtdklHenF3ZmZQY3Y5aWNuQTV1WHBhWUc4SVlaTTVZa09ucjU3anU5bmk2d05IdWo4UVFodlBZTUFJcHpBa1l4TVNCb3h3Rml0NGpiMnpOMXcrQlFmTTlSTlN4aWFDcnlLY3E1MDZHK29rVkcxRFBZUmFiQWlGSG1idlJ6ZlQxQWxSWkd3V0kxc2hWdUVrbDFhZWxOL2llbmthWXlOc2hBWW5PbitjNDZvcDJtTWpySVJXTCtnUURxK24zSXZMUjVqRVJpZ0lNYnhTUHFYMHNkRU1Ld3NKV0hIR3hvWVRnTUgyQ0swUXJjdE5uWTNmSXBWQ25EZXAyUEkyOUNtbHZGUGhKWlZDSi9menpHTHljWld4NFNNdGpHaTlVREVBbVM0UHBsMlRVTkVwQTEvMS9EbXdNVnVGNnB6Q3BMRVhHdXVFTzlGZVNPK0VTZE5MU0xPblVubGpMOFM5L2ltZ1NMNGUyd2pwYllUbzdERVdHbXNqcE9weHExQ2RqZURybDVrUVZ6UWNMZkJ1NHZ6RmRpUzYrNVZDZkpha2JNS3RwSFFLSC9FcWhWTGcwNlBTeWFlVXBSQWVUcU9jYUgyamJZUUcwN1BPcVhpNlVsR0lOOXJnQmtZblRXM1JzSkp4aWE5QitVcUpUamhEQlJzaDV2WmxFV29WS3lWaUVxZXRrTUFlZkp1S1pUSkZlNXhpb1hZYTQyUXY1TnFjdWdpNUJxZGVRcTdXcWFPUUcrL0UxY24xKzlGVDBEeVA4d0Q1ZGlxWEVNNWlTOGFKanhnKy82THhoRk9ZZzA2Ny9HdEJFS2ZCL3hJaUNKdDJ5eS9uVExoVmczaDNkQUFBQUFCSlJVNUVya0pnZ2c9PSIgeT0iODQuNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjAiIHg9IjIxIiB5PSIxNDUuNDk1MSIvPjwhLS1NRDU9Wzc4MjQzMjBkNDgyOTFlZGUzMGYxMGNiOThkYWMzN2RlXQpsaW5rIHZzY29kZSB0byB3cy0tPjxwYXRoIGQ9Ik03NS4zNiwxMTYuNSBDOTMuNzYsMTE2LjUgMTE3LjAzLDExNi41IDEzOC42NSwxMTYuNSAiIGZpbGw9Im5vbmUiIGlkPSJ2c2NvZGUtdG8td3MiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTQzLjgxLDExNi41LDEzNC44MSwxMTIuNSwxMzguODEsMTE2LjUsMTM0LjgxLDEyMC41LDE0My44MSwxMTYuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzIiIHg9IjkzLjUiIHk9IjEwOS41NjY5Ij5vcGVuPC90ZXh0PjwhLS1NRDU9WzlkNGFlYjJjMWQ3NDI3NjAzMWI2YmY3Nzg2NWEwNjdhXQpsaW5rIHdzIHRvIHN2Yy0tPjxwYXRoIGQ9Ik0yNjIuMDgsMTE2LjUgQzI5NC44OCwxMTYuNSAzMzUuOTQsMTE2LjUgMzcwLjU0LDExNi41ICIgZmlsbD0ibm9uZSIgaWQ9IndzLXRvLXN2YyIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSIzNzUuNiwxMTYuNSwzNjYuNiwxMTIuNSwzNzAuNiwxMTYuNSwzNjYuNiwxMjAuNSwzNzUuNiwxMTYuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzciIHg9IjI4MC41IiB5PSIxMDkuNTY2OSI+ZG9ja2VyIGV4ZWM8L3RleHQ+PCEtLU1ENT1bNGFmODk4ODkxMmQ5OTYwZmM1ZGE5ZTdhYjQyNGI0NGVdCkBzdGFydHVtbA0KIWRlZmluZSBJQ09OVVJMIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS90dXBhZHIzL3BsYW50dW1sLWljb24tZm9udC1zcHJpdGVzL3YyLjQuMA0KIWluY2x1ZGV1cmwgSUNPTlVSTC9jb21tb24ucHVtbA0KIWluY2x1ZGV1cmwgSUNPTlVSTC9kZXZpY29uczIvd2luZG93czhfb3JpZ2luYWwucHVtbA0KIWluY2x1ZGV1cmwgSUNPTlVSTC9kZXZpY29uczIvdmlzdWFsc3R1ZGlvLnB1bWwNCiFpbmNsdWRldXJsIElDT05VUkwvZGV2aWNvbnMyL2RvY2tlci5wdW1sDQoNCkRFVjJfVklTVUFMU1RVRElPKHZzY29kZSwiIixyZWN0YW5nbGUsIzAwNzhkNykgI2ZmZmZlMA0KREVWMl9XSU5ET1dTOF9PUklHSU5BTCh3aW5kb3dzLCIiLHJlY3RhbmdsZSwjMDBlMGUwKSAjZmZmZmUwIHsNCiAgICBhZ2VudCAi44Ov44O844Kv44K544Oa44O844K5XG5vbiBXaW5kb3dzIiBhcyB3cw0KfQ0KREVWMl9ET0NLRVIoZG9ja2VyLCIiLHJlY3RhbmdsZSwjMGRiN2VkKSAjZmZmZmUwIHsNCiAgICBhZ2VudCAi44K144O844OT44K544Kz44Oz44OG44OKIiBhcyBzdmMNCn0NCg0KdnNjb2RlIC0+IHdzIDogb3Blbg0Kd3MgLT4gc3ZjIDogZG9ja2VyIGV4ZWMNCkBlbmR1bWwNCgpAc3RhcnR1bWwNCg0KDQpoaWRlIHN0ZXJlb3R5cGUNCnNwcml0ZSAkd2luZG93czhfb3JpZ2luYWwgWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNDENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMTM1OEFDRkZGNA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDEzNTdBQ0ZGRkZGRkZGRkY0DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjU3OUJFRkZGRkZGRkZGRkZGRkZGRjQNCjAwMDAwMDAwMDAwMDAwMDAwMTMzMDBBRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KMDAwMDAwMDAwMDEzNTc5QkRGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQowMDAyNDY4QUNGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjVFRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZFRUVFRUVFRUVERERERERERENDQ0NDMw0KMDIyMjIxMTExMTExMTExMTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjZGRkZFRUVFRUVFRUVFREREREQ4MDBCQkJCQkJCQkJCQkJCQkJCQkJBQUFBQUFBMg0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjVGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KMDAyNDY4QUNGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQowMDAwMDAwMDAyNDY4QUNGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjAwMDAwMDAwMDAwMDAwMDAxMzY1MDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ2OUJERkZGRkZGRkZGRkZGRkZGRkYzDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ2OEJERkZGRkZGRkZGRjMNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ2OEFDRkZGMw0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQxDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBXSU5ET1dTOF9PUklHSU5BTD4+IFdoaXRlDQpzcHJpdGUgJHZpc3VhbHN0dWRpbyBbNDh4NDgvMTZdIHsNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFEQzYwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkY5MjAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGQzYwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkY5MjAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkZGQzANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDRBMjAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDRDRkZFNDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjBERkZGRkZGNzAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGQjEwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRDIwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkVGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRjYwMDAwMDAwMURGRkZGRkZGRkZGRkY3N0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGRjkwMDAwMDFERkZGRkZGRkZGRkZFNDA3RkZGRkZGRkZGRkYxDQoxRkZGRkJFRkZGRkZGRkMxMDAyRUZGRkZGRkZGRkZGQzEwMDdGRkZGRkZGRkZGRjENCjFGRkZGODJFRkZGRkZGRkU0MURGRkZGRkZGRkZGRkEwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDJFRkZGRkZGRkZFRkZGRkZGRkZGRkY2MDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDJFRkZGRkZGRkZGRkZGRkZGRkZFMzAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDJFRkZGRkZGRkZGRkZGRkZGQzEwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDJFRkZGRkZGRkZGRkZGRjkwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwMDJFRkZGRkZGRkZGRkY2MDAwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAwMURGRkZGRkZGRkZGRTMwMDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDFDRkZGRkZGRkZGRkZGRjcwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwQ0ZGRkZGRkZGRkZGRkZGRkEwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMENGRkZGRkZGRkZGRkZGRkZGRkQyMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDBDRkZGRkZGRkZGRkZGRkZGRkZGRkU0MDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwQkZGRkZGRkZGNjNGRkZGRkZGRkZGRkY4MDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGOUJGRkZGRkZGRTMwMDNGRkZGRkZGRkZGRkZCMTAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGRkIxMDAwMDNGRkZGRkZGRkZGRkZEMjA3RkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRkY4MDAwMDAwMDNGRkZGRkZGRkZGRkZGNjdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZFNDAwMDAwMDAwMDNGRkZGRkZGRkZGRkZGREZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGQzIwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowREZGRkZGRjkwMDAwMDAwMDAwMDAwMDNGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwNURGRkY2MDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDZDMzAwMDAwMDAwMDAwMDAwMDAwMDNGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZCMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkU4MjAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkM1MDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRjkyMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFQzYwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCn0NCg0KDQpza2lucGFyYW0gZm9sZGVyQmFja2dyb3VuZENvbG9yPDxERVYyIFZJU1VBTFNUVURJTz4+IFdoaXRlDQpzcHJpdGUgJGRvY2tlciBbNDh4NDgvMTZdIHsNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBEQkJCQkMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMEMwMDAwQzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwQzAwMDBDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBDMDAwMEMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMTc3Nzc3Nzc3N0QyMjIyQzAwMDAwMDAwMDAwMDEwMDAwMDAwMDAwDQowMDAwMDAwMDA0Qzk5OUU5OTk5RTk5OTlDMDAwMDAwMDAwMDAxRTkwMDAwMDAwMDANCjAwMDAwMDAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAwMDAwMDAwMDlGRjkwMDAwMDAwMA0KMDAwMDAwMDAwNDgwMDBDMDAwMEMwMDAwQzAwMDAwMDAwMDAwRUZGRjUwMDAwMDAwDQowMDAwMDAwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMDAwMDAwMDBGRkZGRDAwMDAwMDANCjAwMDAxOTk5OUJBNDQ0RDQ0NDRENDQ0NEU5OTk5NjAwMDAwMEZGRkZGMjM0MzAwMA0KMDAwMDJEODg4QUM4ODhFODg4OEU4ODg4RTg4ODk5MDAwMDAwRUZGRkZGRkZGRjkxDQowMDAwMjkwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMjkwMDAwMDBBRkZGRkZGRkZGRjINCjAwMDAyOTAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAyOTAwMDAwMDJGRkZGRkZGRkY3MA0KMDAwMDI5MDAwNDgwMDBDMDAwMEMwMDAwQzAwMDI5MDAwMDAyQUZGRkZGRkZGNzAwDQoyNjY2N0M2NjY4QjY2NkQ2NjY2RDY2NjZENjY2N0M1NTY4Q0ZGRkZGRURCNzIwMDANCjZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkQwMDAwMDAwMA0KNkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNjAwMDAwMDAwDQo2RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkQwMDAwMDAwMDANCjRGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNTAwMDAwMDAwMA0KMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkIwMDAwMDAwMDAwDQowREZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZFMTAwMDAwMDAwMDANCjA4RkZGRkZGRkZGRkY5NkRGRkZGRkZGRkZGRkZGRkZGRkZGRjMwMDAwMDAwMDAwMA0KMDFGRkZGRkZGRkZGRjlEQkZGRkZGRkZGRkZGRkZGRkZGRkY1MDAwMDAwMDAwMDAwDQowMDdGRkZGRkZGRkZGRUJGRkZGRkZGRkZGRkZGRkZGRkZGNTAwMDAwMDAwMDAwMDANCjAwMENEQkJCQjk3NENGRkZGRkZGRkZGRkZGRkZGRkZGRjQwMDAwMDAwMDAwMDAwMA0KMDAwMUM0MDAwMDAwM0ZGRkZGRkZGRkZGRkZGRkZGRkMyMDAwMDAwMDAwMDAwMDAwDQowMDAwMUM2MDAwMDAwN0ZGRkZGRkZGRkZGRkZGRkU2MDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDhDMzAwMDAwN0ZGRkZGRkZGRkZGRkU3MDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDJBQzczMDAwNERGRkZGRkZGRkE1MDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAxNkFERENCQkZGRkRBNzQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMTIxMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCn0NCg0KDQpza2lucGFyYW0gZm9sZGVyQmFja2dyb3VuZENvbG9yPDxERVYyIERPQ0tFUj4+IFdoaXRlDQoNCnJlY3RhbmdsZSAiPGNvbG9yOiMwMDc4ZDc+PCR2aXN1YWxzdHVkaW8+PC9jb2xvcj5cciAiIGFzIHZzY29kZSA8PERFVjIgVklTVUFMU1RVRElPPj4gI2ZmZmZlMA0KcmVjdGFuZ2xlICI8Y29sb3I6IzAwZTBlMD48JHdpbmRvd3M4X29yaWdpbmFsPjwvY29sb3I+XHIgIiBhcyB3aW5kb3dzIDw8REVWMiBXSU5ET1dTOF9PUklHSU5BTD4+ICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIFdpbmRvd3MiIGFzIHdzDQp9DQpyZWN0YW5nbGUgIjxjb2xvcjojMGRiN2VkPjwkZG9ja2VyPjwvY29sb3I+XHIgIiBhcyBkb2NrZXIgPDxERVYyIERPQ0tFUj4+ICNmZmZmZTAgew0KICAgIGFnZW50ICLjgrXjg7zjg5PjgrnjgrPjg7Pjg4bjg4oiIGFzIHN2Yw0KfQ0KDQp2c2NvZGUgLT4gd3MgOiBvcGVuDQp3cyAtPiBzdmMgOiBkb2NrZXIgZXhlYw0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjE2KFdlZCBEZWMgMDggMTc6MjU6MjIgVVRDIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IG51bGwKLS0+PC9nPjwvc3ZnPg==\" loading=\"lazy\"\u003e\n\u003ch2 data-sourcepos=\"101:1-101:53\"\u003e\n\u003cspan id=\"ワークスペースをwindows--devcontainerへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%92windows--devcontainer%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eワークスペースをWindows =\u0026gt; devcontainerへ\u003c/h2\u003e\n\u003cp data-sourcepos=\"103:1-103:58\"\u003eWindowsにワークスペースを配置することで、\u003c/p\u003e\n\u003cul data-sourcepos=\"105:1-109:0\"\u003e\n\u003cli data-sourcepos=\"105:1-105:96\"\u003eDocker関連のコマンドや周辺のCUIツールはWindows用でそろえる必要がある\u003c/li\u003e\n\u003cli data-sourcepos=\"106:1-109:0\"\u003eワークスペースのシェルはPowerShellかbatになる\n\u003cul data-sourcepos=\"107:5-109:0\"\u003e\n\u003cli data-sourcepos=\"107:5-107:74\"\u003ebashとかzshが動かない(git bashは挙動がやや残念、、)\u003c/li\u003e\n\u003cli data-sourcepos=\"108:5-109:0\"\u003eコンテナ内ではUnix系シェルなので操作やスクリプトが統一できない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"110:1-110:45\"\u003eという別の課題が出てきました。\u003c/p\u003e\n\u003cp data-sourcepos=\"112:1-114:342\"\u003eこの点を解消するためには、ワークスペースをUnix系に配置する必要があります。\u003cbr\u003e\nvscodeではRemote Developmentを使うとワークスペースをDockerコンテナ(devcontainer)上に構築できます。\u003cbr\u003e\nこの際、デフォルトではvscodeのプロジェクト(.devcontainerの一つ上のディレクトリ)がワークスペースとしてdevcontainer上にマウントされるので、あえてコンテナ内に作業用のファイルを配置する必要がなくほぼ透過的にコンテナ内でファイルを操作できます。\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMTcxcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo4MThweDtoZWlnaHQ6MTcxcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgODE4IDE3MSIgd2lkdGg9IjgxOHB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImYxN20wbmZ5a3N2a3htIiB3aWR0aD0iMzAwJSIgeD0iLTEiIHk9Ii0xIj48ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyT3V0IiBzdGREZXZpYXRpb249IjIuMCIvPjxmZUNvbG9yTWF0cml4IGluPSJibHVyT3V0IiByZXN1bHQ9ImJsdXJPdXQyIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgLjQgMCIvPjxmZU9mZnNldCBkeD0iNC4wIiBkeT0iNC4wIiBpbj0iYmx1ck91dDIiIHJlc3VsdD0iYmx1ck91dDMiLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJibHVyT3V0MyIgbW9kZT0ibm9ybWFsIi8+PC9maWx0ZXI+PC9kZWZzPjxnPjwhLS1NRDU9W2IzYzI4ZDM1OTM1ZjM4NzZhODBmZTY5NWM4NDM3NjdhXQpjbHVzdGVyIHdpbmRvd3MtLT48cmVjdCBmaWxsPSIjRkZGRkUwIiBmaWx0ZXI9InVybCgjZjE3bTBuZnlrc3ZreG0pIiBoZWlnaHQ9IjE1MiIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTUwIiB4PSI3IiB5PSI3Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iNTgiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBREFBQUFBd0NBSUFBQURZWUc3UUFBQUJVVWxFUVZSNFh1MlowV2tDUVJDR3Q0VnJ3UlpzSVMzWWdpMmtCVnRJQzlkQ1drZ0x3a0FJSWlHR0VDU0l5T1UvUjQ3THpuaHpiblk1SHdhK0I5MzFkcjZkV1dSY1E5UFFQYkErMHZNUDdVNFU1RnhwRVBYbFFQV2VIajlwOFU3ekRRVzZBS2NnSDhoSUYzdjFGY2RXeVN5RXRIUHM1UWM5YktsNmplT1pKQXJ4dmdHL3hkWVRZcXZZUXYyYzg3NW5iNWVINGNHZnlXVVRJaUUrNTAvZnlsbFRLU1dFM2FldFdFb0lLWkVUWTNBaEN4ZXljQ0VMRjdKd0lRc1hzbkFoQ3ltRUY5ZEFXNmVDcnFzUG1zSFFuRnV6RHJTSUp1eFJpQ0NIcHVWUHlXU3FCOUtPVHBlWFFLT2RBQ291UVluK2U0WlFRVG1WVEh1R1hHZ0lGN0p3SVlzTVF1MVhtWmhLeG9Vc1hNakNoU3hhb1hvZmo0NmtsQkF2ZXV0OVhpZ3RwREpzT1lHUXl1NThMd3RMMUpwSHFueS9PbEtFcnRHbE03bzl2b21jUWlyOW9vK3hMQzZrTW5BMHB4RlM2ZjZlK2dYV1Vud3dqL3pTZndBQUFBQkpSVTVFcmtKZ2dnPT0iIHk9IjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMCIgeD0iMTA2IiB5PSI2OS45OTUxIi8+PCEtLU1ENT1bMTNjYzdkNzk3NDMxMTE0MTI5NjVmNTdhZWRhYTlhNTldCmNsdXN0ZXIgdnNjb2RlLS0+PHJlY3QgZmlsbD0iI0ZGRkZFMCIgZmlsdGVyPSJ1cmwoI2YxN20wbmZ5a3N2a3htKSIgaGVpZ2h0PSIxNDUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIyNCIgeD0iMTgxIiB5PSIxMC41Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iMjY5IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDR2tsRVFWUjRYczJaUFU0RE1SQkc1d3BjZ1N0d0JhN0FGYmdDdEhTSWxncUpsb2FDbG9LR0ZvbUtCdklIS1dpaHBEV1RUT1JZL3RiMnJEMG1TQzlGYksvOU1qdjJiQkp5YnZtdklHenF3ZmZQY3Y5aWNuQTV1WHBhWUc4SVlaTTVZa09ucjU3anU5bmk2d05IdWo4UVFodlBZTUFJcHpBa1l4TVNCb3h3Rml0NGpiMnpOMXcrQlFmTTlSTlN4aWFDcnlLY3E1MDZHK29rVkcxRFBZUmFiQWlGSG1idlJ6ZlQxQWxSWkd3V0kxc2hWdUVrbDFhZWxOL2llbmthWXlOc2hBWW5PbitjNDZvcDJtTWpySVJXTCtnUURxK24zSXZMUjVqRVJpZ0lNYnhTUHFYMHNkRU1Ld3NKV0hIR3hvWVRnTUgyQ0swUXJjdE5uWTNmSXBWQ25EZXAyUEkyOUNtbHZGUGhKWlZDSi9menpHTHljWld4NFNNdGpHaTlVREVBbVM0UHBsMlRVTkVwQTEvMS9EbXdNVnVGNnB6Q3BMRVhHdXVFTzlGZVNPK0VTZE5MU0xPblVubGpMOFM5L2ltZ1NMNGUyd2pwYllUbzdERVdHbXNqcE9weHExQ2RqZURybDVrUVZ6UWNMZkJ1NHZ6RmRpUzYrNVZDZkpha2JNS3RwSFFLSC9FcWhWTGcwNlBTeWFlVXBSQWVUcU9jYUgyamJZUUcwN1BPcVhpNlVsR0lOOXJnQmtZblRXM1JzSkp4aWE5QitVcUpUamhEQlJzaDV2WmxFV29WS3lWaUVxZXRrTUFlZkp1S1pUSkZlNXhpb1hZYTQyUXY1TnFjdWdpNUJxZGVRcTdXcWFPUUcrL0UxY24xKzlGVDBEeVA4d0Q1ZGlxWEVNNWlTOGFKanhnKy82THhoRk9ZZzA2Ny9HdEJFS2ZCL3hJaUNKdDJ5eS9uVExoVmczaDNkQUFBQUFCSlJVNUVya0pnZ2c9PSIgeT0iMTIuNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIwIiB4PSIzMTciIHk9IjczLjQ5NTEiLz48IS0tTUQ1PVs1ZWM3ZWVkZDU3MzEwNjQ4ZjgwNTlmZmIyNjIxY2E0Yl0KY2x1c3RlciBkb2NrZXItLT48cmVjdCBmaWxsPSIjRkZGRkUwIiBmaWx0ZXI9InVybCgjZjE3bTBuZnlrc3ZreG0pIiBoZWlnaHQ9IjE1MiIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMzU0IiB4PSI0NTIiIHk9IjciLz48aW1hZ2UgaGVpZ2h0PSI0OCIgd2lkdGg9IjQ4IiB4PSI2MDUiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBREFBQUFBd0NBSUFBQURZWUc3UUFBQUNTa2xFUVZSNFh1Mlh2VkVjUVJCR093R2xvQkFJUVNFUUFpRVFnbEpRQ0JjQ0pnNVZGQTRPQm80Y09kTHhMOEZSbEJ3Y0dhdkh0V2lHK1hiM3BnNld4bERWcTZ1YjczWm1Iak85czR0MTNmeGRZUnJsWWhybFlocmxZaHJsWWhybFlocmxZaHJsWWhybFlobzFzbkZ3czNuMEsvaDBlSzNYcklGcDFFaGw4RjlJU0JDNit6UC84djF5Q0dyb3gvMUowQ2pFbUJxV21FYkIvdUtNYWJhL1hqa2Y5eGJ4WFpzdFF0aDRMLzBwTUkwQ2hENS91NHptK0I2MUNLSHlZZmNXUnB4TW8rRFZoVmdlRjRLZHEzTzlvSHRqb2JBQlNsQXY2Q29oOXJnc0M0NjdyZU9mYURrTUVkKzFXWlhVN094Q0p5dUZnRnZoK1BjcGZmbnNGK0lLcG1GVkhHejR1NlBKbFBGOXZPbE9LbFJ1bVVJWFZxUVdLZ2RhZTh1cWNRTCtRdlVvb2FPVkhhWVdJbGVKZ0xPdDB5MmJUb2h3WklYY0JvenJLRUNIbEhHamlRMTFIVTNLSzc2UE4zMGNibXp3Y1doV0J0U1R2eTl3TVE3aGJYUlEzNmtadXVmVGhHWjloMEthME1qeVBBaFJ1ZHBuVW9ZZUd2K0VPSXUwejNSUXhTcnhUS2hidmgxcnp5bmd6bXA2SCtLMjFNNFYvbmg2b1hyNXpCcmlRYWhsMXhEeVkwTi9hbVM4ZEo0SkFhZVREbEhDYXIrQnpaTlF0eno3cTMrMVdCVkU5NWN2c2pwSE80eWdFdy94Sk1UR01YRnZaL1plcDJtQkFjdkhRZ3RXTnR5cDl4aGR1YWNWYkhIdk9Dc3hqZnhacUhkRW94TXE4ZWhlQTlPb2UzeFZRSXVoU3pOL2MxVUpoeTd0eFR1RWFSU3dneXc3MHlBQitIbXhod0VodjNyaGEvZjFNSTJHd0krVjQzUGxhZnNTVEtOY1RLTmNUS05jVEtOY1RLTmNUS05jVEtOY1RLTmMvZ0tHVEJralZ3Q3FNQUFBQUFCSlJVNUVya0pnZ2c9PSIgeT0iOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIwIiB4PSI2NTMiIHk9IjY5Ljk5NTEiLz48IS0tTUQ1PVs3NWUyYzc5ODY0MDBiNDczNDg4NzgxMTgyODkxNzkwMV0KZW50aXR5IHdzaC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMTdtMG5meWtzdmt4bSkiIGhlaWdodD0iNTIuNTkzOCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTE4IiB4PSIyMyIgeT0iOTAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OCIgeD0iMzMiIHk9IjExMi45OTUxIj7jg6/jg7zjgq/jgrnjg5rjg7zjgrk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODQiIHg9IjMzIiB5PSIxMjkuMjkyIj5vbiBXaW5kb3dzPC90ZXh0PjwhLS1NRDU9WzNkOTlkNTlhMjdlYzU1Y2Q5YjBiMTQ5MDgwMWY3OGJjXQplbnRpdHkgZGV2LS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2YxN20wbmZ5a3N2a3htKSIgaGVpZ2h0PSI0Ni4yOTY5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxOTIiIHg9IjE5NyIgeT0iOTMuNSIvPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE1IiB4PSIzNjkiIHk9Ijk4LjUiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQiIHg9IjM2NyIgeT0iMTAwLjUiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQiIHg9IjM2NyIgeT0iMTA0LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTIiIHg9IjIxMiIgeT0iMTI2LjQ5NTEiPlJlbW90ZSBEZXZlbG9wZW1udDwvdGV4dD48IS0tTUQ1PVswOTA4YjQ3MWU2ZDgwZjEyMWQwNmY3ZThjYTlkZjBiZV0KZW50aXR5IHdzYy0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMTdtMG5meWtzdmt4bSkiIGhlaWdodD0iNTIuNTkzOCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTMyIiB4PSI0NjgiIHk9IjkwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTgiIHg9IjQ3OCIgeT0iMTEyLjk5NTEiPuODr+ODvOOCr+OCueODmuODvOOCuTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjQ3OCIgeT0iMTI5LjI5MiI+b24gZGV2Y29udGFpbmVyPC90ZXh0PjwhLS1NRDU9WzI1Mzc5M2FjMTJkYzcxYjViMzY2MTcyOGU4ZGMyMTQ3XQplbnRpdHkgc3ZjLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2YxN20wbmZ5a3N2a3htKSIgaGVpZ2h0PSIzNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMzIiIHg9IjY1OCIgeT0iOTguNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMiIgeD0iNjY4IiB5PSIxMjEuNDk1MSI+44K144O844OT44K544Kz44Oz44OG44OKPC90ZXh0PjwhLS1NRDU9W2ZjOWU5NDM1ZTIwOWNkYTE2ZWQ0ZjZkMTk1YTIxZTBhXQpsaW5rIHdzaCB0byBkZXYtLT48cGF0aCBkPSJNMTQxLjM0LDExNi41IEMxNTguMDgsMTE2LjUgMTc0LjgxLDExNi41IDE5MS41NCwxMTYuNSAiIGZpbGw9Im5vbmUiIGlkPSJ3c2gtdG8tZGV2IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjE5Ni43MywxMTYuNSwxODcuNzMsMTEyLjUsMTkxLjczLDExNi41LDE4Ny43MywxMjAuNSwxOTYuNzMsMTE2LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1NRDU9WzJhNWY2ODMwY2VlY2IxZDM0MTdlYjljYTliMjFlYmMxXQpsaW5rIGRldiB0byB3c2MtLT48cGF0aCBkPSJNMzg5LjI5LDExNi41IEM0MTMuNzksMTE2LjUgNDM5LjY4LDExNi41IDQ2Mi42OSwxMTYuNSAiIGZpbGw9Im5vbmUiIGlkPSJkZXYtdG8td3NjIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjQ2Ny44NSwxMTYuNSw0NTguODUsMTEyLjUsNDYyLjg1LDExNi41LDQ1OC44NSwxMjAuNSw0NjcuODUsMTE2LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQyIiB4PSI0MDcuNSIgeT0iMTA5LjU2NjkiPm1vdW50PC90ZXh0PjwhLS1NRDU9W2E0NmY0NTYwNGRjMzAyM2FjNDU0YjVhZTMwNjU1NzQ3XQpsaW5rIHdzYyB0byBzdmMtLT48cGF0aCBkPSJNNjAwLjE5LDExNi41IEM2MTcuMDcsMTE2LjUgNjM1LjMsMTE2LjUgNjUyLjQ1LDExNi41ICIgZmlsbD0ibm9uZSIgaWQ9IndzYy10by1zdmMiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6Ny4wLDcuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjY1Ny43MywxMTYuNSw2NDguNzMsMTEyLjUsNjUyLjczLDExNi41LDY0OC43MywxMjAuNSw2NTcuNzMsMTE2LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxIiB4PSI2MTguNSIgeT0iMTA5LjU2NjkiPj8/PzwvdGV4dD48IS0tTUQ1PVtkZmJiZmZhNmQ2ZmRkYzA1MjYyZWQxZTcwZDJkM2Y1OF0KQHN0YXJ0dW1sDQohZGVmaW5lIElDT05VUkwgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3R1cGFkcjMvcGxhbnR1bWwtaWNvbi1mb250LXNwcml0ZXMvdjIuNC4wDQohaW5jbHVkZXVybCBJQ09OVVJML2NvbW1vbi5wdW1sDQohaW5jbHVkZXVybCBJQ09OVVJML2Rldmljb25zMi93aW5kb3dzOF9vcmlnaW5hbC5wdW1sDQohaW5jbHVkZXVybCBJQ09OVVJML2Rldmljb25zMi92aXN1YWxzdHVkaW8ucHVtbA0KIWluY2x1ZGV1cmwgSUNPTlVSTC9kZXZpY29uczIvZG9ja2VyLnB1bWwNCg0KREVWMl9XSU5ET1dTOF9PUklHSU5BTCh3aW5kb3dzLCIiLHJlY3RhbmdsZSwjMDBlMGUwKSAjZmZmZmUwIHsNCiAgICBhZ2VudCAi44Ov44O844Kv44K544Oa44O844K5XG5vbiBXaW5kb3dzIiBhcyB3c2gNCn0NCkRFVjJfVklTVUFMU1RVRElPKHZzY29kZSwiIixyZWN0YW5nbGUsIzAwNzhkNykgI2ZmZmZlMCB7DQogICAgY29tcG9uZW50ICJSZW1vdGUgRGV2ZWxvcGVtbnQiIGFzIGRldg0KfQ0KREVWMl9ET0NLRVIoZG9ja2VyLCIiLHJlY3RhbmdsZSwjMGRiN2VkKSAjZmZmZmUwIHsNCiAgICBhZ2VudCAi44Ov44O844Kv44K544Oa44O844K5XG5vbiBkZXZjb250YWluZXIiIGFzIHdzYw0KICAgIGFnZW50ICLjgrXjg7zjg5PjgrnjgrPjg7Pjg4bjg4oiIGFzIHN2Yw0KfQ0KDQp3c2ggLT4gZGV2DQpkZXYgLT4gd3NjIDogbW91bnQNCndzYyAuPiBzdmMgOiA/Pz8NCkBlbmR1bWwNCgpAc3RhcnR1bWwNCg0KDQpoaWRlIHN0ZXJlb3R5cGUNCnNwcml0ZSAkd2luZG93czhfb3JpZ2luYWwgWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNDENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMTM1OEFDRkZGNA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDEzNTdBQ0ZGRkZGRkZGRkY0DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjU3OUJFRkZGRkZGRkZGRkZGRkZGRjQNCjAwMDAwMDAwMDAwMDAwMDAwMTMzMDBBRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KMDAwMDAwMDAwMDEzNTc5QkRGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQowMDAyNDY4QUNGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjVFRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZFRUVFRUVFRUVERERERERERENDQ0NDMw0KMDIyMjIxMTExMTExMTExMTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjZGRkZFRUVFRUVFRUVFREREREQ4MDBCQkJCQkJCQkJCQkJCQkJCQkJBQUFBQUFBMg0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjVGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KMDAyNDY4QUNGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQowMDAwMDAwMDAyNDY4QUNGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjAwMDAwMDAwMDAwMDAwMDAxMzY1MDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ2OUJERkZGRkZGRkZGRkZGRkZGRkYzDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ2OEJERkZGRkZGRkZGRjMNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ2OEFDRkZGMw0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQxDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBXSU5ET1dTOF9PUklHSU5BTD4+IFdoaXRlDQpzcHJpdGUgJHZpc3VhbHN0dWRpbyBbNDh4NDgvMTZdIHsNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFEQzYwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkY5MjAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGQzYwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkY5MjAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkZGQzANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDRBMjAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDRDRkZFNDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjBERkZGRkZGNzAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGQjEwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRDIwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkVGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRjYwMDAwMDAwMURGRkZGRkZGRkZGRkY3N0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGRjkwMDAwMDFERkZGRkZGRkZGRkZFNDA3RkZGRkZGRkZGRkYxDQoxRkZGRkJFRkZGRkZGRkMxMDAyRUZGRkZGRkZGRkZGQzEwMDdGRkZGRkZGRkZGRjENCjFGRkZGODJFRkZGRkZGRkU0MURGRkZGRkZGRkZGRkEwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDJFRkZGRkZGRkZFRkZGRkZGRkZGRkY2MDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDJFRkZGRkZGRkZGRkZGRkZGRkZFMzAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDJFRkZGRkZGRkZGRkZGRkZGQzEwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDJFRkZGRkZGRkZGRkZGRjkwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwMDJFRkZGRkZGRkZGRkY2MDAwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAwMURGRkZGRkZGRkZGRTMwMDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDFDRkZGRkZGRkZGRkZGRjcwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwQ0ZGRkZGRkZGRkZGRkZGRkEwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMENGRkZGRkZGRkZGRkZGRkZGRkQyMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDBDRkZGRkZGRkZGRkZGRkZGRkZGRkU0MDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwQkZGRkZGRkZGNjNGRkZGRkZGRkZGRkY4MDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGOUJGRkZGRkZGRTMwMDNGRkZGRkZGRkZGRkZCMTAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGRkIxMDAwMDNGRkZGRkZGRkZGRkZEMjA3RkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRkY4MDAwMDAwMDNGRkZGRkZGRkZGRkZGNjdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZFNDAwMDAwMDAwMDNGRkZGRkZGRkZGRkZGREZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGQzIwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowREZGRkZGRjkwMDAwMDAwMDAwMDAwMDNGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwNURGRkY2MDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDZDMzAwMDAwMDAwMDAwMDAwMDAwMDNGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDNFRkZGRkZGRkZGRkZGRkZCMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkU4MjAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkM1MDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRjkyMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFQzYwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCn0NCg0KDQpza2lucGFyYW0gZm9sZGVyQmFja2dyb3VuZENvbG9yPDxERVYyIFZJU1VBTFNUVURJTz4+IFdoaXRlDQpzcHJpdGUgJGRvY2tlciBbNDh4NDgvMTZdIHsNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBEQkJCQkMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMEMwMDAwQzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwQzAwMDBDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBDMDAwMEMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMTc3Nzc3Nzc3N0QyMjIyQzAwMDAwMDAwMDAwMDEwMDAwMDAwMDAwDQowMDAwMDAwMDA0Qzk5OUU5OTk5RTk5OTlDMDAwMDAwMDAwMDAxRTkwMDAwMDAwMDANCjAwMDAwMDAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAwMDAwMDAwMDlGRjkwMDAwMDAwMA0KMDAwMDAwMDAwNDgwMDBDMDAwMEMwMDAwQzAwMDAwMDAwMDAwRUZGRjUwMDAwMDAwDQowMDAwMDAwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMDAwMDAwMDBGRkZGRDAwMDAwMDANCjAwMDAxOTk5OUJBNDQ0RDQ0NDRENDQ0NEU5OTk5NjAwMDAwMEZGRkZGMjM0MzAwMA0KMDAwMDJEODg4QUM4ODhFODg4OEU4ODg4RTg4ODk5MDAwMDAwRUZGRkZGRkZGRjkxDQowMDAwMjkwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMjkwMDAwMDBBRkZGRkZGRkZGRjINCjAwMDAyOTAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAyOTAwMDAwMDJGRkZGRkZGRkY3MA0KMDAwMDI5MDAwNDgwMDBDMDAwMEMwMDAwQzAwMDI5MDAwMDAyQUZGRkZGRkZGNzAwDQoyNjY2N0M2NjY4QjY2NkQ2NjY2RDY2NjZENjY2N0M1NTY4Q0ZGRkZGRURCNzIwMDANCjZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkQwMDAwMDAwMA0KNkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNjAwMDAwMDAwDQo2RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkQwMDAwMDAwMDANCjRGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNTAwMDAwMDAwMA0KMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkIwMDAwMDAwMDAwDQowREZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZFMTAwMDAwMDAwMDANCjA4RkZGRkZGRkZGRkY5NkRGRkZGRkZGRkZGRkZGRkZGRkZGRjMwMDAwMDAwMDAwMA0KMDFGRkZGRkZGRkZGRjlEQkZGRkZGRkZGRkZGRkZGRkZGRkY1MDAwMDAwMDAwMDAwDQowMDdGRkZGRkZGRkZGRUJGRkZGRkZGRkZGRkZGRkZGRkZGNTAwMDAwMDAwMDAwMDANCjAwMENEQkJCQjk3NENGRkZGRkZGRkZGRkZGRkZGRkZGRjQwMDAwMDAwMDAwMDAwMA0KMDAwMUM0MDAwMDAwM0ZGRkZGRkZGRkZGRkZGRkZGRkMyMDAwMDAwMDAwMDAwMDAwDQowMDAwMUM2MDAwMDAwN0ZGRkZGRkZGRkZGRkZGRkU2MDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDhDMzAwMDAwN0ZGRkZGRkZGRkZGRkU3MDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDJBQzczMDAwNERGRkZGRkZGRkE1MDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAxNkFERENCQkZGRkRBNzQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMTIxMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCn0NCg0KDQpza2lucGFyYW0gZm9sZGVyQmFja2dyb3VuZENvbG9yPDxERVYyIERPQ0tFUj4+IFdoaXRlDQoNCnJlY3RhbmdsZSAiPGNvbG9yOiMwMGUwZTA+PCR3aW5kb3dzOF9vcmlnaW5hbD48L2NvbG9yPlxyICIgYXMgd2luZG93cyA8PERFVjIgV0lORE9XUzhfT1JJR0lOQUw+PiAjZmZmZmUwIHsNCiAgICBhZ2VudCAi44Ov44O844Kv44K544Oa44O844K5XG5vbiBXaW5kb3dzIiBhcyB3c2gNCn0NCnJlY3RhbmdsZSAiPGNvbG9yOiMwMDc4ZDc+PCR2aXN1YWxzdHVkaW8+PC9jb2xvcj5cciAiIGFzIHZzY29kZSA8PERFVjIgVklTVUFMU1RVRElPPj4gI2ZmZmZlMCB7DQogICAgY29tcG9uZW50ICJSZW1vdGUgRGV2ZWxvcGVtbnQiIGFzIGRldg0KfQ0KcmVjdGFuZ2xlICI8Y29sb3I6IzBkYjdlZD48JGRvY2tlcj48L2NvbG9yPlxyICIgYXMgZG9ja2VyIDw8REVWMiBET0NLRVI+PiAjZmZmZmUwIHsNCiAgICBhZ2VudCAi44Ov44O844Kv44K544Oa44O844K5XG5vbiBkZXZjb250YWluZXIiIGFzIHdzYw0KICAgIGFnZW50ICLjgrXjg7zjg5PjgrnjgrPjg7Pjg4bjg4oiIGFzIHN2Yw0KfQ0KDQp3c2ggLT4gZGV2DQpkZXYgLT4gd3NjIDogbW91bnQNCndzYyAuPiBzdmMgOiA/Pz8NCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS4xNihXZWQgRGVjIDA4IDE3OjI1OjIyIFVUQyAyMDIxKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogT3BlbkpESyBSdW50aW1lIEVudmlyb25tZW50CkpWTTogT3BlbkpESyA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBudWxsCi0tPjwvZz48L3N2Zz4=\" loading=\"lazy\"\u003e\n\u003cdiv data-sourcepos=\"141:1-166:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"142:1-142:183\"\u003eRemote Development経由でdevcontainerのワークスペースをvscodeで開いた場合、gitの認証情報はホストでの情報を引き継いで利用できるようです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"144:1-147:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edevcontainer上ではcredential.helperは関数で定義されている\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit config \u003cspan class=\"nt\"\u003e--global\u003c/span\u003e \u003cspan class=\"nt\"\u003e-l\u003c/span\u003e | \u003cspan class=\"nb\"\u003egrep \u003c/span\u003ecredential\ncredential.helper\u003cspan class=\"o\"\u003e=!\u003c/span\u003ef\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e /home/vscode/.vscode-server/bin/e7f30e38c5a4efafeec8ad52861eb772a9ee4dfb/node /tmp/vscode-remote-containers-3cf86db779288bfea4d1bb570de933a68c3055de.js \u003cspan class=\"nv\"\u003e$*\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e f\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"149:1-150:179\"\u003e仕組みとしてはおそらく上記のところで、認証処理をRemote Containersの拡張機能に含まれるスクリプトに紐付けてホストの認証情報に問い合わせてるのだと思われます。\u003cbr\u003e\nちなみに私の環境ではpushの際に以下のエラーが出ていますが、特にpushが失敗するわけでもないので今のところは手当していません。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"152:1-165:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003egit pushでエラーが出ているがその後問題なくリモートに反映されている\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003egit push\n\u0026lt;3\u0026gt;init: \u003cspan class=\"o\"\u003e(\u003c/span\u003e1388\u003cspan class=\"o\"\u003e)\u003c/span\u003e ERROR: UtilConnectUnix:467: connect failed 111\n\u0026lt;3\u0026gt;init: \u003cspan class=\"o\"\u003e(\u003c/span\u003e1391\u003cspan class=\"o\"\u003e)\u003c/span\u003e ERROR: UtilConnectUnix:467: connect failed 111\nEnumerating objects: 7, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nCounting objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e7/7\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nDelta compression using up to 8 threads\nCompressing objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e4/4\u003cspan class=\"o\"\u003e)\u003c/span\u003e, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nWriting objects: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e6/6\u003cspan class=\"o\"\u003e)\u003c/span\u003e, 1.04 KiB | 1.04 MiB/s, \u003cspan class=\"k\"\u003edone\u003c/span\u003e\u003cspan class=\"nb\"\u003e.\u003c/span\u003e\nTotal 6 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 1\u003cspan class=\"o\"\u003e)\u003c/span\u003e, reused 0 \u003cspan class=\"o\"\u003e(\u003c/span\u003edelta 0\u003cspan class=\"o\"\u003e)\u003c/span\u003e, pack-reused 0\nremote: Resolving deltas: 100% \u003cspan class=\"o\"\u003e(\u003c/span\u003e1/1\u003cspan class=\"o\"\u003e)\u003c/span\u003e, completed with 1 \u003cspan class=\"nb\"\u003elocal \u003c/span\u003eobject.\nTo https://github.com/aaaaaaa/bbbbbb\n   04f2bcc..7749211  develop -\u0026gt; develop\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"168:1-168:84\"\u003e\n\u003cspan id=\"devcontainerとサービスコンテナを同じネットワークで接続する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#devcontainer%E3%81%A8%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%92%E5%90%8C%E3%81%98%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edevcontainerとサービスコンテナを同じネットワークで接続する\u003c/h2\u003e\n\u003cp data-sourcepos=\"170:1-172:222\"\u003eさて、ワークスペースをUnix系に押し込めることに成功しましたが、このままだとdevcontainerからサービスコンテナに対して通信することができません。\u003cbr\u003e\n例えばmysqlのコンテナを立てた時にdevcontainer上から直接データをのぞいたり、ユニットテストがDBを触ることがあってもdevcontainer上で直接テストを行ったりしたいですよね？\u003cbr\u003e\ndevcontainerとサービスコンテナを通信できるようにするためにはdocker用のネットワークを作成し、それぞれのコンテナをネットワークでつなげてやる必要があります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"174:1-176:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elocal-nw の名称でネットワークを作成する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker network create local-nw\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"178:1-178:159\"\u003eサービスコンテナの起動時にオプションでネットワークを指定することで、コンテナをネットワークに接続できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"180:1-182:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003emysqldをネットワークに接続して起動する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003edocker run \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e \u003cspan class=\"nt\"\u003e--name\u003c/span\u003e mysql \u003cspan class=\"nt\"\u003e--network\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003elocal-nw mysql:8.0 mysqld\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"184:1-184:124\"\u003edocker-composeを使う場合はexternal属性を指定することで作成済のネットワークを指定できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"186:1-198:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emysql\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emysql:8.0\u003c/span\u003e\n    \u003cspan class=\"na\"\u003econtainer_name\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emysql\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enetworks\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003elocal\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emysqld\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003enetworks\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003elocal\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003elocal-nw\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eexternal\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"no\"\u003etrue\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMTcxcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo4MzVweDtoZWlnaHQ6MTcxcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgODM1IDE3MSIgd2lkdGg9IjgzNXB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImZrOWNxbDNmbzhwajgiIHdpZHRoPSIzMDAlIiB4PSItMSIgeT0iLTEiPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIHN0ZERldmlhdGlvbj0iMi4wIi8+PGZlQ29sb3JNYXRyaXggaW49ImJsdXJPdXQiIHJlc3VsdD0iYmx1ck91dDIiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAuNCAwIi8+PGZlT2Zmc2V0IGR4PSI0LjAiIGR5PSI0LjAiIGluPSJibHVyT3V0MiIgcmVzdWx0PSJibHVyT3V0MyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImJsdXJPdXQzIiBtb2RlPSJub3JtYWwiLz48L2ZpbHRlcj48L2RlZnM+PGc+PCEtLU1ENT1bYjNjMjhkMzU5MzVmMzg3NmE4MGZlNjk1Yzg0Mzc2N2FdCmNsdXN0ZXIgd2luZG93cy0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmazljcWwzZm84cGo4KSIgaGVpZ2h0PSIxNTIiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE1MCIgeD0iNyIgeT0iNyIvPjxpbWFnZSBoZWlnaHQ9IjQ4IiB3aWR0aD0iNDgiIHg9IjU4IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFCVVVsRVFWUjRYdTJaMFdrQ1FSQ0d0NFZyd1Jac0lTM1lnaTJrQlZ0SUM5ZENXa2dMd2tBSUlpR0dFQ1NJeU9VL1I0N0x6bmh6Ym5ZNUh3YStCOTMxZHI2ZFdXUmNROVBRUGJBKzB2TVA3VTRVNUZ4cEVQWGxRUFdlSGo5cDhVN3pEUVc2QUtjZ0g4aElGM3YxRmNkV3lTeUV0SFBzNVFjOWJLbDZqZU9aSkFyeHZnRy94ZFlUWXF2WVF2MmM4NzVuYjVlSDRjR2Z5V1VUSWlFKzUwL2Z5bGxUS1NXRTNhZXRXRW9JS1pFVFkzQWhDeGV5Y0NFTEY3SndJUXNYc25BaEN5bUVGOWRBVzZlQ3Jxc1Btc0hRbkZ1ekRyU0lKdXhSaUNDSHB1VlB5V1NxQjlLT1RwZVhRS09kQUNvdVFZbitlNFpRUVRtVlRIdUdYR2dJRjdKd0lZc01RdTFYbVpoS3hvVXNYTWpDaFN4YW9Yb2ZqNDZrbEJBdmV1dDlYaWd0cERKc09ZR1F5dTU4THd0TDFKcEhxbnkvT2xLRXJ0R2xNN285dm9tY1Fpcjlvbyt4TEM2a01uQTBweEZTNmY2ZStnWFdVbnd3ai96U2Z3QUFBQUJKUlU1RXJrSmdnZz09IiB5PSI5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjAiIHg9IjEwNiIgeT0iNjkuOTk1MSIvPjwhLS1NRDU9WzEzY2M3ZDc5NzQzMTExNDEyOTY1ZjU3YWVkYWE5YTU5XQpjbHVzdGVyIHZzY29kZS0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmazljcWwzZm84cGo4KSIgaGVpZ2h0PSIxNDUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjIyNCIgeD0iMTgxIiB5PSIxMC41Ii8+PGltYWdlIGhlaWdodD0iNDgiIHdpZHRoPSI0OCIgeD0iMjY5IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDR2tsRVFWUjRYczJaUFU0RE1SQkc1d3BjZ1N0d0JhN0FGYmdDdEhTSWxncUpsb2FDbG9LR0ZvbUtCdklIS1dpaHBEV1RUT1JZL3RiMnJEMG1TQzlGYksvOU1qdjJiQkp5YnZtdklHenF3ZmZQY3Y5aWNuQTV1WHBhWUc4SVlaTTVZa09ucjU3anU5bmk2d05IdWo4UVFodlBZTUFJcHpBa1l4TVNCb3h3Rml0NGpiMnpOMXcrQlFmTTlSTlN4aWFDcnlLY3E1MDZHK29rVkcxRFBZUmFiQWlGSG1idlJ6ZlQxQWxSWkd3V0kxc2hWdUVrbDFhZWxOL2llbmthWXlOc2hBWW5PbitjNDZvcDJtTWpySVJXTCtnUURxK24zSXZMUjVqRVJpZ0lNYnhTUHFYMHNkRU1Ld3NKV0hIR3hvWVRnTUgyQ0swUXJjdE5uWTNmSXBWQ25EZXAyUEkyOUNtbHZGUGhKWlZDSi9menpHTHljWld4NFNNdGpHaTlVREVBbVM0UHBsMlRVTkVwQTEvMS9EbXdNVnVGNnB6Q3BMRVhHdXVFTzlGZVNPK0VTZE5MU0xPblVubGpMOFM5L2ltZ1NMNGUyd2pwYllUbzdERVdHbXNqcE9weHExQ2RqZURybDVrUVZ6UWNMZkJ1NHZ6RmRpUzYrNVZDZkpha2JNS3RwSFFLSC9FcWhWTGcwNlBTeWFlVXBSQWVUcU9jYUgyamJZUUcwN1BPcVhpNlVsR0lOOXJnQmtZblRXM1JzSkp4aWE5QitVcUpUamhEQlJzaDV2WmxFV29WS3lWaUVxZXRrTUFlZkp1S1pUSkZlNXhpb1hZYTQyUXY1TnFjdWdpNUJxZGVRcTdXcWFPUUcrL0UxY24xKzlGVDBEeVA4d0Q1ZGlxWEVNNWlTOGFKanhnKy82THhoRk9ZZzA2Ny9HdEJFS2ZCL3hJaUNKdDJ5eS9uVExoVmczaDNkQUFBQUFCSlJVNUVya0pnZ2c9PSIgeT0iMTIuNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIwIiB4PSIzMTciIHk9IjczLjQ5NTEiLz48IS0tTUQ1PVs1ZWM3ZWVkZDU3MzEwNjQ4ZjgwNTlmZmIyNjIxY2E0Yl0KY2x1c3RlciBkb2NrZXItLT48cmVjdCBmaWxsPSIjRkZGRkUwIiBmaWx0ZXI9InVybCgjZms5Y3FsM2ZvOHBqOCkiIGhlaWdodD0iMTUyIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIzNzEiIHg9IjQ1MiIgeT0iNyIvPjxpbWFnZSBoZWlnaHQ9IjQ4IiB3aWR0aD0iNDgiIHg9IjYxMy41IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDU2tsRVFWUjRYdTJYdlZFY1FSQkdPd0dsb0JBSVFTRVFBaUVRZ2xKUUNCY0NKZzVWRkE0T0JvNGNPZEx4TDhGUmxCd2NHYXZIdFdpRytYYjNwZzZXeGxEVnE2dWI3M1ptSGpPOXM0dDEzZnhkWVJybFlocmxZaHJsWWhybFlocmxZaHJsWWhybFlocmxZaG8xc25Gd3MzbjBLL2gwZUszWHJJRnAxRWhsOEY5SVNCQzYrelAvOHYxeUNHcm94LzFKMENqRW1CcVdtRWJCL3VLTWFiYS9YamtmOXhieFhac3RRdGg0TC8wcE1JMENoRDUvdTR6bStCNjFDS0h5WWZjV1JweE1vK0RWaFZnZUY0S2RxM085b0h0am9iQUJTbEF2NkNvaDlyZ3NDNDY3cmVPZmFEa01FZCsxV1pYVTdPeENKeXVGZ0Z2aCtQY3BmZm5zRitJS3BtRlZIR3o0dTZQSmxQRjl2T2xPS2xSdW1VSVhWcVFXS2dkYWU4dXFjUUwrUXZVb29hT1ZIYVlXSWxlSmdMT3QweTJiVG9od1pJWGNCb3pyS0VDSGxIR2ppUTExSFUzS0s3NlBOMzBjYm16d2NXaFdCdFNUdnk5d01RN2hiWFJRMzZrWnV1ZlRoR1o5aDBLYTBNanlQQWhSdWRwblVvWWVHditFT0l1MHozUlF4U3J4VEtoYnZoMXJ6eW5nem1wNkgrSzIxTTRWL25oNm9YcjV6QnJpUWFobDF4RHlZME4vYW1TOGRKNEpBYWVURGxIQ2FyK0J6Wk5RdHp6N3EzKzFXQlZFOTVjdnNqcEhPNHlnRXcveEpNVEdNWEZ2Wi9aZXAybUJBY3ZIUWd0V050eXA5eGhkdWFjVmJISHZPQ3N4amZ4WnFIZEVveE1xOGVoZUE5T29lM3hWUUl1aFN6Ti9jMVVKaHk3dHhUdUVhUlN3Z3l3NzB5QUIrSG14aHdFaHYzcmhhL2YxTUkyR3dJK1Y0M1BsYWZzU1RLTmNUS05jVEtOY1RLTmNUS05jVEtOY1RLTmNUS05jL2dLR1RCa2pWd0NxTUFBQUFBQkpSVTVFcmtKZ2dnPT0iIHk9IjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMCIgeD0iNjYxLjUiIHk9IjY5Ljk5NTEiLz48IS0tTUQ1PVs3NWUyYzc5ODY0MDBiNDczNDg4NzgxMTgyODkxNzkwMV0KZW50aXR5IHdzaC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmazljcWwzZm84cGo4KSIgaGVpZ2h0PSI1Mi41OTM4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMTgiIHg9IjIzIiB5PSI5MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSIzMyIgeT0iMTEyLjk5NTEiPuODr+ODvOOCr+OCueODmuODvOOCuTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NCIgeD0iMzMiIHk9IjEyOS4yOTIiPm9uIFdpbmRvd3M8L3RleHQ+PCEtLU1ENT1bM2Q5OWQ1OWEyN2VjNTVjZDliMGIxNDkwODAxZjc4YmNdCmVudGl0eSBkZXYtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZms5Y3FsM2ZvOHBqOCkiIGhlaWdodD0iNDYuMjk2OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTkyIiB4PSIxOTciIHk9IjkzLjUiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxNSIgeD0iMzY5IiB5PSI5OC41Ii8+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0IiB4PSIzNjciIHk9IjEwMC41Ii8+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0IiB4PSIzNjciIHk9IjEwNC41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUyIiB4PSIyMTIiIHk9IjEyNi40OTUxIj5SZW1vdGUgRGV2ZWxvcGVtbnQ8L3RleHQ+PCEtLU1ENT1bMDkwOGI0NzFlNmQ4MGYxMjFkMDZmN2U4Y2E5ZGYwYmVdCmVudGl0eSB3c2MtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZms5Y3FsM2ZvOHBqOCkiIGhlaWdodD0iNTIuNTkzOCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTMyIiB4PSI0NjgiIHk9IjkwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTgiIHg9IjQ3OCIgeT0iMTEyLjk5NTEiPuODr+ODvOOCr+OCueODmuODvOOCuTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9IjQ3OCIgeT0iMTI5LjI5MiI+b24gZGV2Y29udGFpbmVyPC90ZXh0PjwhLS1NRDU9WzI1Mzc5M2FjMTJkYzcxYjViMzY2MTcyOGU4ZGMyMTQ3XQplbnRpdHkgc3ZjLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2ZrOWNxbDNmbzhwajgpIiBoZWlnaHQ9IjM2LjI5NjkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEzMiIgeD0iNjc1IiB5PSI5OC41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyIiB4PSI2ODUiIHk9IjEyMS40OTUxIj7jgrXjg7zjg5PjgrnjgrPjg7Pjg4bjg4o8L3RleHQ+PCEtLU1ENT1bZmM5ZTk0MzVlMjA5Y2RhMTZlZDRmNmQxOTVhMjFlMGFdCmxpbmsgd3NoIHRvIGRldi0tPjxwYXRoIGQ9Ik0xNDEuMzQsMTE2LjUgQzE1OS44MSwxMTYuNSAxNzguMjcsMTE2LjUgMTk2LjczLDExNi41ICIgZmlsbD0ibm9uZSIgaWQ9IndzaC1kZXYiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1NRDU9WzJhNWY2ODMwY2VlY2IxZDM0MTdlYjljYTliMjFlYmMxXQpsaW5rIGRldiB0byB3c2MtLT48cGF0aCBkPSJNMzg5LjI5LDExNi41IEM0MTMuNzksMTE2LjUgNDM5LjY4LDExNi41IDQ2Mi42OSwxMTYuNSAiIGZpbGw9Im5vbmUiIGlkPSJkZXYtdG8td3NjIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjQ2Ny44NSwxMTYuNSw0NTguODUsMTEyLjUsNDYyLjg1LDExNi41LDQ1OC44NSwxMjAuNSw0NjcuODUsMTE2LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQyIiB4PSI0MDcuNSIgeT0iMTA5LjU2NjkiPm1vdW50PC90ZXh0PjwhLS1NRDU9W2E0NmY0NTYwNGRjMzAyM2FjNDU0YjVhZTMwNjU1NzQ3XQpsaW5rIHdzYyB0byBzdmMtLT48cGF0aCBkPSJNNjAwLjA3LDExNi41IEM2MjIuMjksMTE2LjUgNjQ3LjE3LDExNi41IDY2OS43NywxMTYuNSAiIGZpbGw9Im5vbmUiIGlkPSJ3c2MtdG8tc3ZjIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjY3NC44NSwxMTYuNSw2NjUuODUsMTEyLjUsNjY5Ljg1LDExNi41LDY2NS44NSwxMjAuNSw2NzQuODUsMTE2LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM4IiB4PSI2MTguNSIgeT0iMTA5LjU2NjkiPm15c3FsPC90ZXh0PjwhLS1NRDU9W2Y5NGQzNjhhMDM3ZjllNDVjMmIzMzQ3OGExNmI0NWI0XQpAc3RhcnR1bWwNCiFkZWZpbmUgSUNPTlVSTCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vdHVwYWRyMy9wbGFudHVtbC1pY29uLWZvbnQtc3ByaXRlcy92Mi40LjANCiFpbmNsdWRldXJsIElDT05VUkwvY29tbW9uLnB1bWwNCiFpbmNsdWRldXJsIElDT05VUkwvZGV2aWNvbnMyL3dpbmRvd3M4X29yaWdpbmFsLnB1bWwNCiFpbmNsdWRldXJsIElDT05VUkwvZGV2aWNvbnMyL3Zpc3VhbHN0dWRpby5wdW1sDQohaW5jbHVkZXVybCBJQ09OVVJML2Rldmljb25zMi9kb2NrZXIucHVtbA0KDQpERVYyX1dJTkRPV1M4X09SSUdJTkFMKHdpbmRvd3MsIiIscmVjdGFuZ2xlLCMwMGUwZTApICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIFdpbmRvd3MiIGFzIHdzaA0KfQ0KREVWMl9WSVNVQUxTVFVESU8odnNjb2RlLCIiLHJlY3RhbmdsZSwjMDA3OGQ3KSAjZmZmZmUwIHsNCiAgICBjb21wb25lbnQgIlJlbW90ZSBEZXZlbG9wZW1udCIgYXMgZGV2DQp9DQpERVYyX0RPQ0tFUihkb2NrZXIsIiIscmVjdGFuZ2xlLCMwZGI3ZWQpICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIGRldmNvbnRhaW5lciIgYXMgd3NjDQogICAgYWdlbnQgIuOCteODvOODk+OCueOCs+ODs+ODhuODiiIgYXMgc3ZjDQp9DQoNCndzaCAtIGRldg0KZGV2IC0+IHdzYyA6IG1vdW50DQp3c2MtPiBzdmMgOiBteXNxbA0KQGVuZHVtbA0KCkBzdGFydHVtbA0KDQoNCmhpZGUgc3RlcmVvdHlwZQ0Kc3ByaXRlICR3aW5kb3dzOF9vcmlnaW5hbCBbNDh4NDgvMTZdIHsNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDI0MQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxMzU4QUNGRkY0DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMTM1N0FDRkZGRkZGRkZGRjQNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNTc5QkVGRkZGRkZGRkZGRkZGRkZGNA0KMDAwMDAwMDAwMDAwMDAwMDAxMzMwMEFFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQowMDAwMDAwMDAwMTM1NzlCREZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjAwMDI0NjhBQ0ZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNUVGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY0DQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjQNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGNA0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEVGRkVFRUVFRUVFRUREREREREREQ0NDQ0MzDQowMjIyMjExMTExMTExMTExMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KNkZGRkVFRUVFRUVFRUVERERERDgwMEJCQkJCQkJCQkJCQkJCQkJCQkFBQUFBQUEyDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNkZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQo2RkZGRkZGRkZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjZGRkZGRkZGRkZGRkZGRkZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KNUZGRkZGRkZGRkZGRkZGRkZGRkEwMEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQowMDI0NjhBQ0ZGRkZGRkZGRkZGQTAwRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjMNCjAwMDAwMDAwMDI0NjhBQ0ZGRkZBMDBGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMw0KMDAwMDAwMDAwMDAwMDAwMDEzNjUwMEVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYzDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNDY5QkRGRkZGRkZGRkZGRkZGRkZGRjMNCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNDY4QkRGRkZGRkZGRkZGMw0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNDY4QUNGRkYzDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyNDENCn0NCg0KDQpza2lucGFyYW0gZm9sZGVyQmFja2dyb3VuZENvbG9yPDxERVYyIFdJTkRPV1M4X09SSUdJTkFMPj4gV2hpdGUNCnNwcml0ZSAkdmlzdWFsc3R1ZGlvIFs0OHg0OC8xNl0gew0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURDNjAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRjkyMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZDNjAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRjkyMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkZGRkZDMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwNEEyMDAwMDAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwNENGRkU0MDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMERGRkZGRkY3MDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZCMTAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZEMjAwMDAwMDAwMDJFRkZGRkZGRkZGRkZGRUZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGNjAwMDAwMDAxREZGRkZGRkZGRkZGRjc3RkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRkZGOTAwMDAwMURGRkZGRkZGRkZGRkU0MDdGRkZGRkZGRkZGRjENCjFGRkZGQkVGRkZGRkZGQzEwMDJFRkZGRkZGRkZGRkZDMTAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MkVGRkZGRkZGRTQxREZGRkZGRkZGRkZGQTAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMkVGRkZGRkZGRkVGRkZGRkZGRkZGRjYwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMkVGRkZGRkZGRkZGRkZGRkZGRkUzMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMkVGRkZGRkZGRkZGRkZGRkZDMTAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwMkVGRkZGRkZGRkZGRkZGOTAwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAwMkVGRkZGRkZGRkZGRjYwMDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDAxREZGRkZGRkZGRkZFMzAwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwMUNGRkZGRkZGRkZGRkZGNzAwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDBDRkZGRkZGRkZGRkZGRkZGQTAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwQ0ZGRkZGRkZGRkZGRkZGRkZGRDIwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMENGRkZGRkZGRkZGRkZGRkZGRkZGRTQwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODBCRkZGRkZGRkY2M0ZGRkZGRkZGRkZGRjgwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY5QkZGRkZGRkZFMzAwM0ZGRkZGRkZGRkZGRkIxMDA3RkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRkZGQjEwMDAwM0ZGRkZGRkZGRkZGRkQyMDdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRjgwMDAwMDAwM0ZGRkZGRkZGRkZGRkY2N0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkU0MDAwMDAwMDAwM0ZGRkZGRkZGRkZGRkZERkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZDMjAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjBERkZGRkZGOTAwMDAwMDAwMDAwMDAwM0ZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDA1REZGRjYwMDAwMDAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwNkMzMDAwMDAwMDAwMDAwMDAwMDAwM0ZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM0VGRkZGRkZGRkZGRkZGRkIwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGRkZGRTgyMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGQzUwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMkVGRkZGOTIwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMkVDNjAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KfQ0KDQoNCnNraW5wYXJhbSBmb2xkZXJCYWNrZ3JvdW5kQ29sb3I8PERFVjIgVklTVUFMU1RVRElPPj4gV2hpdGUNCnNwcml0ZSAkZG9ja2VyIFs0OHg0OC8xNl0gew0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMERCQkJCQzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwQzAwMDBDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBDMDAwMEMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMEMwMDAwQzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAxNzc3Nzc3Nzc3RDIyMjJDMDAwMDAwMDAwMDAwMTAwMDAwMDAwMDANCjAwMDAwMDAwMDRDOTk5RTk5OTlFOTk5OUMwMDAwMDAwMDAwMDFFOTAwMDAwMDAwMA0KMDAwMDAwMDAwNDgwMDBDMDAwMEMwMDAwQzAwMDAwMDAwMDAwOUZGOTAwMDAwMDAwDQowMDAwMDAwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMDAwMDAwMDBFRkZGNTAwMDAwMDANCjAwMDAwMDAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAwMDAwMDAwMEZGRkZEMDAwMDAwMA0KMDAwMDE5OTk5QkE0NDRENDQ0NEQ0NDQ0RTk5OTk2MDAwMDAwRkZGRkYyMzQzMDAwDQowMDAwMkQ4ODhBQzg4OEU4ODg4RTg4ODhFODg4OTkwMDAwMDBFRkZGRkZGRkZGOTENCjAwMDAyOTAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAyOTAwMDAwMEFGRkZGRkZGRkZGMg0KMDAwMDI5MDAwNDgwMDBDMDAwMEMwMDAwQzAwMDI5MDAwMDAwMkZGRkZGRkZGRjcwDQowMDAwMjkwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMjkwMDAwMDJBRkZGRkZGRkY3MDANCjI2NjY3QzY2NjhCNjY2RDY2NjZENjY2NkQ2NjY3QzU1NjhDRkZGRkZFREI3MjAwMA0KNkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRDAwMDAwMDAwDQo2RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY2MDAwMDAwMDANCjZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRDAwMDAwMDAwMA0KNEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY1MDAwMDAwMDAwDQoxRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGQjAwMDAwMDAwMDANCjBERkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkUxMDAwMDAwMDAwMA0KMDhGRkZGRkZGRkZGRjk2REZGRkZGRkZGRkZGRkZGRkZGRkZGMzAwMDAwMDAwMDAwDQowMUZGRkZGRkZGRkZGOURCRkZGRkZGRkZGRkZGRkZGRkZGRjUwMDAwMDAwMDAwMDANCjAwN0ZGRkZGRkZGRkZFQkZGRkZGRkZGRkZGRkZGRkZGRkY1MDAwMDAwMDAwMDAwMA0KMDAwQ0RCQkJCOTc0Q0ZGRkZGRkZGRkZGRkZGRkZGRkZGNDAwMDAwMDAwMDAwMDAwDQowMDAxQzQwMDAwMDAzRkZGRkZGRkZGRkZGRkZGRkZGQzIwMDAwMDAwMDAwMDAwMDANCjAwMDAxQzYwMDAwMDA3RkZGRkZGRkZGRkZGRkZGRTYwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwOEMzMDAwMDA3RkZGRkZGRkZGRkZGRTcwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMkFDNzMwMDA0REZGRkZGRkZGQTUwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDE2QUREQ0JCRkZGREE3NDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAxMjExMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KfQ0KDQoNCnNraW5wYXJhbSBmb2xkZXJCYWNrZ3JvdW5kQ29sb3I8PERFVjIgRE9DS0VSPj4gV2hpdGUNCg0KcmVjdGFuZ2xlICI8Y29sb3I6IzAwZTBlMD48JHdpbmRvd3M4X29yaWdpbmFsPjwvY29sb3I+XHIgIiBhcyB3aW5kb3dzIDw8REVWMiBXSU5ET1dTOF9PUklHSU5BTD4+ICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIFdpbmRvd3MiIGFzIHdzaA0KfQ0KcmVjdGFuZ2xlICI8Y29sb3I6IzAwNzhkNz48JHZpc3VhbHN0dWRpbz48L2NvbG9yPlxyICIgYXMgdnNjb2RlIDw8REVWMiBWSVNVQUxTVFVESU8+PiAjZmZmZmUwIHsNCiAgICBjb21wb25lbnQgIlJlbW90ZSBEZXZlbG9wZW1udCIgYXMgZGV2DQp9DQpyZWN0YW5nbGUgIjxjb2xvcjojMGRiN2VkPjwkZG9ja2VyPjwvY29sb3I+XHIgIiBhcyBkb2NrZXIgPDxERVYyIERPQ0tFUj4+ICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIGRldmNvbnRhaW5lciIgYXMgd3NjDQogICAgYWdlbnQgIuOCteODvOODk+OCueOCs+ODs+ODhuODiiIgYXMgc3ZjDQp9DQoNCndzaCAtIGRldg0KZGV2IC0+IHdzYyA6IG1vdW50DQp3c2MtPiBzdmMgOiBteXNxbA0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjE2KFdlZCBEZWMgMDggMTc6MjU6MjIgVVRDIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IG51bGwKLS0+PC9nPjwvc3ZnPg==\" loading=\"lazy\"\u003e\n\u003cdiv data-sourcepos=\"225:1-251:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"226:1-227:186\"\u003edocker-compose内で作成したネットワークにdevcontainerを接続することも可能です。\u003cbr\u003e\nこの場合はdocker-composeのプロジェクトに連動してネットワークが作成されるため、事前に \u003ccode\u003edocker network create\u003c/code\u003e をしておく必要がありません。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"229:1-232:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edocker-compose.yamlで新規にネットワークを定義\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003enetworks\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"s\"\u003elocal\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"js\" data-sourcepos=\"234:1-239:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edevcontainer.jsonではdocker-composeで構築したネットワークを参照\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// ネットワーク名はdocker-composeのプロジェクト名 + 内部で指定したネットワーク名になる\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erunArgs\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e--networks=hoge_local\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"241:1-241:33\"\u003eただしこの構成の場合は\u003c/p\u003e\n\u003cul data-sourcepos=\"243:1-246:0\"\u003e\n\u003cli data-sourcepos=\"243:1-244:87\"\u003edevcontainer起動中に \u003ccode\u003edocker-compose down\u003c/code\u003e するとネットワーク削除がエラーになる\n\u003cul data-sourcepos=\"244:5-244:87\"\u003e\n\u003cli data-sourcepos=\"244:5-244:87\"\u003eネットワークが消えないだけで特に実害はなさそうだが、、\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"245:1-246:0\"\u003e\n\u003ccode\u003edocker-compose up\u003c/code\u003e でネットワークを作成してからでないとdevcontainerの起動ができない\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"247:1-247:86\"\u003eなどの問題があるため、 \u003cstrong\u003e個人的にはあまりお勧めしません。\u003c/strong\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"249:1-250:266\"\u003eただし、チーム開発などの場合は \u003ccode\u003edocker-compose up\u003c/code\u003e の前に \u003ccode\u003edocker network create\u003c/code\u003e が必要になるというのが、初期構築の際の負荷になる場合もあります。\u003cbr\u003e\n上記のようなデメリットがあることを理解した上であれば作業負荷を低減するために、devcontainerをdocker-compose上のネットワークに接続する構成というのも選択肢の一つにはなりうることもあります。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"253:1-253:74\"\u003e\n\u003cspan id=\"ホスト側のワークスペースの配置パスをwindows--wslへ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%9B%E3%82%B9%E3%83%88%E5%81%B4%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E9%85%8D%E7%BD%AE%E3%83%91%E3%82%B9%E3%82%92windows--wsl%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eホスト側のワークスペースの配置パスをWindows =\u0026gt; WSLへ\u003c/h2\u003e\n\u003cp data-sourcepos=\"255:1-257:313\"\u003epythonやrubyなどスクリプトがそのまま動く言語ではdevcontainerのワークスペースと同じ階層をサービスコンテナにもマウントすることで編集内容をそのまま動作させることができますが、GoやTypeScriptなどのコンパイルやトランスパイルが必要な言語ではソースの編集後にもう一処理追加してやる必要があります。\u003cbr\u003e\nそしてソースを修正後のコンパイルは手動で実行するのではなく、Goの場合はair、TypeScriptの場合はdev-serverなどを用いていわゆるホットリロードによって対処することが多いと思います。\u003cbr\u003e\nUnix系環境ではホットリロードの仕組みをinotifyのファイルイベントをトリガーに動作する仕組みが多いですが、ここで問題になるのがWindowsからコンテナにマウントしたファイル群は編集してもinotifyのイベント通知が飛んできません。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"259:1-262:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"260:1-261:267\"\u003eWindowsの制限と言うよりはWSL2の上drvfsを利用した際の制限。\u003cbr\u003e\nDocker Desktopを用いてWindows側のファイルをコンテナにマウントする場合、一度WSL上でdrvfsを用いて \u003ccode\u003e/mnt/C\u003c/code\u003e 配下に配置されるので、Docker側ではそのファイルパスをベースにマウントすることができます。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv data-sourcepos=\"264:1-266:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"265:1-265:137\"\u003eWSL1 + drvfsではinotifyの通知をサポートしていたようですが、WSL2では通知を受け取ることはありません。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"268:1-269:301\"\u003eこの点を解消するためには、ワークスペースのファイルをWindows側のファイルパスに配置しない、つまりWSL側で \u003ccode\u003e/mnt\u003c/code\u003e 以外のパスに配置するようにします。\u003cbr\u003e\n具体的にはWindowsからは \u003ccode\u003e\\\\wsl$\\[distribution name]\u003c/code\u003e でWSLのディストリビューション配下のファイルパスにアクセスできるのでそこを経由してファイルを配置するか、WSLにログインして以下でファイルを移動することで実現します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"271:1-274:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eWSL上でファイルを移動する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# 権限によっては失敗するのでcpのほうがよいかも\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003emv\u003c/span\u003e /mnt/C/Users/[user]/some-project /home/[user]/some-project\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"276:1-276:162\"\u003eこのとき、WSL側でログインされるユーザーが操作できるパスにワークスペースのファイル群を配置する必要があります。\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMTcxcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo4OTdweDtoZWlnaHQ6MTcxcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgODk3IDE3MSIgd2lkdGg9Ijg5N3B4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImYxeGNqaXFta2ZraDlwIiB3aWR0aD0iMzAwJSIgeD0iLTEiIHk9Ii0xIj48ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyT3V0IiBzdGREZXZpYXRpb249IjIuMCIvPjxmZUNvbG9yTWF0cml4IGluPSJibHVyT3V0IiByZXN1bHQ9ImJsdXJPdXQyIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgLjQgMCIvPjxmZU9mZnNldCBkeD0iNC4wIiBkeT0iNC4wIiBpbj0iYmx1ck91dDIiIHJlc3VsdD0iYmx1ck91dDMiLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJibHVyT3V0MyIgbW9kZT0ibm9ybWFsIi8+PC9maWx0ZXI+PC9kZWZzPjxnPjwhLS1NRDU9WzAyZTllYWFjNWY2NTQxZWJjZDdmYWI0ZmM5ZGU2YWQ1XQpjbHVzdGVyIHVidW50dS0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmMXhjamlxbWtma2g5cCkiIGhlaWdodD0iMTUyIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxODAiIHg9IjciIHk9IjciLz48aW1hZ2UgaGVpZ2h0PSI0OCIgd2lkdGg9IjQ4IiB4PSI3MyIgeGxpbms6aHJlZj0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFEQUFBQUF3Q0FJQUFBRFlZRzdRQUFBREFVbEVRVlI0WHMxWnZZb1VRUkR1aC9BSmZBSmZ3Rnd3Rmt4TnpNeE1EQTJNQmVQREI3Z0hFR1BCMk1CUUJvNUZXQTRSeERzT1JKYjJtNm1sdHJhK25xN2VtV0VkK0RoMjY3cXJ2cTdmbnRtVTg5V3FrRmpVZ3QzTjE5dFBGNzh1WDErL2VicDk5Zmo3aTRjQVB1QXJoUGdYRnZDdUZpUVdWZkIzKy9ubis1ZWJadys2Ui9kQ1lCa1dZd3ZycVNDeHFJZy8zejdDQVd5MUJkaUk3YXl6aU1RaUJ6Z2ZnV0F6cHdLMFd1S1lXR1NCYkdEVmN3Q0ZiTVVpc1VpQkRHQ044d0cxYkV1UldDU1lIeVlrOVk5M3o0dVpCK1Zzc1Vab1BodFFVVzNJNktzbjk5MkNNVTRGUW90RXl1bEVjK0kxeGRoNVFoT3lHS2RIVjBTQTFBMzQ2dFRlZmJua2pWMHB4NDhJb1N4NXp4Z1FGSmh4NnZMZ1lEQnp3dDhmM3JLR2JqaU02d1ZIaE5wVEJ3YWNTWVdjQ2pHeUVzNGhoVXVtQXlHa0hxOTJRRnpFK2ZqQVZCUVNkOVFYYUluRFdKV0Y3ZU1IUXNYNnRFQm1pSHNsUTYwUEdMQ0JvOHZRRFdlZmRkS2VFRVlncjdPQVVodHNzUUdyb0lXVDRDc2dMdUZwaW8waEo5MjFKeFNXdWpNelZqVUNuTmlsYW5oZzlmZWVVUDBFcm1GQWUzMTlOM2pVbmFGK1prM0tubEJZN1ZadnlGN2hvaHhha2NVOW9Yb3pkR1dKOXNOcnhtQUhTSTdhaWpUSm5sQ3hyN3QxamFkazJNRFZNMC9TcUNma2lLTlFSUXYrb25CczI2MVRMOExtWC8wOEVvcWVrTzFBM1BXUkNsb0NZYTlpWUl2VlZtbVNzckluQkplbzFFVTlEOVdoU2h2VDJVSGFZOWdoWlNTdmt0RHFRc1pKTGRNT1NTM0hVblVUa3RxTmZWNmdPQ1IxM2N4L0tQdlZOY2J3M0ZacGJrN3Q2YU1qdE9HR2E4dDFnb2RyM2JWSHd6VkhvN2c3OGZvQjIzT3ZIK0VHNTMveFVQc0ZyVkx0QW45Qnl3MDlac0lWRml6RGZ0Z1ZyN0NpZ3BjNmJFNjg1T1BoWlBvbFAwZGxhWEdPeHlEVjFZaHpQQ2ptcUVrV01lZFJtby9rQ2VXR0Z0QUNwN000blpwZU5namFrMmtNUzc2T0Vjem50Rm53aFpWZ2tkZ3hpcEZTSkJaWklNZloyNU1CVlp6RkRvbEZEcnVGWGd0ZjAvTjFFWWxGUldEV1RLYTFYZmJGdVFWb29ZREQyU1RZREpkeG5yVjFKQmExWUxlU0gxL09nSDhQcklGM2JqQVBId0FBQUFCSlJVNUVya0pnZ2c9PSIgeT0iOSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIwIiB4PSIxMjEiIHk9IjY5Ljk5NTEiLz48IS0tTUQ1PVsxM2NjN2Q3OTc0MzExMTQxMjk2NWY1N2FlZGFhOWE1OV0KY2x1c3RlciB2c2NvZGUtLT48cmVjdCBmaWxsPSIjRkZGRkUwIiBmaWx0ZXI9InVybCgjZjF4Y2ppcW1rZmtoOXApIiBoZWlnaHQ9IjE0NSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMjI0IiB4PSIyMTEiIHk9IjEwLjUiLz48aW1hZ2UgaGVpZ2h0PSI0OCIgd2lkdGg9IjQ4IiB4PSIyOTkiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBREFBQUFBd0NBSUFBQURZWUc3UUFBQUNHa2xFUVZSNFhzMlpQVTRETVJCRzV3cGNnU3R3QmE3QUZiZ0N0SFNJbGdxSmxvYUNsb0tHRm9tS0J2SUhLV2locERXVFRPUlkvdGIyckQwbVNDOUZiSy85TWp2MmJCSnlidm12SUd6cXdmZlBjdjlpY25BNXVYcGFZRzhJWVpNNVlrT25yNTdqdTluaTZ3Tkh1ajhRUWh2UFlNQUlwekFrWXhNU0JveHdGaXQ0amIyek4xdytCUWZNOVJOU3hpYUNyeUtjcTUwNkcrb2tWRzFEUFlSYWJBaUZIbWJ2UnpmVDFBbFJaR3dXSTFzaFZ1RWtsMWFlbE4vaWVua2FZeU5zaEFZbk9uK2M0Nm9wMm1NanJJUldMK2dRRHErbjNJdkxSNWpFUmlnSU1ieFNQcVgwc2RFTUt3c0pXSEhHeG9ZVGdNSDJDSzBRcmN0Tm5ZM2ZJcFZDbkRlcDJQSTI5Q21sdkZQaEpaVkNKL2Z6ekdMeWNaV3g0U010akdpOVVERUFtUzRQcGwyVFVORXBBMS8xL0Rtd01WdUY2cHpDcExFWEd1dUVPOUZlU08rRVNkTkxTTE9uVW5sakw4UzkvaW1nU0w0ZTJ3anBiWVRvN0RFV0dtc2pwT3B4cTFDZGplRHJsNWtRVnpRY0xmQnU0dnpGZGlTNis1VkNmSmFrYk1LdHBIUUtIL0VxaFZMZzA2UFN5YWVVcFJBZVRxT2NhSDJqYllRRzA3UE9xWGk2VWxHSU45cmdCa1luVFczUnNKSnhpYTlCK1VxSlRqaERCUnNoNXZabEVXb1ZLeVZpRXFldGtNQWVmSnVLWlRKRmU1eGlvWFlhNDJRdjVOcWN1Z2k1QnFkZVFxN1dxYU9RRysvRTFjbjErOUZUMER5UDh3RDVkaXFYRU01aVM4YUpqeGcrLzZMeGhGT1lnMDY3L0d0QkVLZkIveElpQ0p0Mnl5L25UTGhWZzNoM2RBQUFBQUJKUlU1RXJrSmdnZz09IiB5PSIxMi41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjAiIHg9IjM0NyIgeT0iNzMuNDk1MSIvPjwhLS1NRDU9WzVlYzdlZWRkNTczMTA2NDhmODA1OWZmYjI2MjFjYTRiXQpjbHVzdGVyIGRvY2tlci0tPjxyZWN0IGZpbGw9IiNGRkZGRTAiIGZpbHRlcj0idXJsKCNmMXhjamlxbWtma2g5cCkiIGhlaWdodD0iMTUyIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0MDMiIHg9IjQ4MiIgeT0iNyIvPjxpbWFnZSBoZWlnaHQ9IjQ4IiB3aWR0aD0iNDgiIHg9IjY1OS41IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQURBQUFBQXdDQUlBQUFEWVlHN1FBQUFDU2tsRVFWUjRYdTJYdlZFY1FSQkdPd0dsb0JBSVFTRVFBaUVRZ2xKUUNCY0NKZzVWRkE0T0JvNGNPZEx4TDhGUmxCd2NHYXZIdFdpRytYYjNwZzZXeGxEVnE2dWI3M1ptSGpPOXM0dDEzZnhkWVJybFlocmxZaHJsWWhybFlocmxZaHJsWWhybFlocmxZaG8xc25Gd3MzbjBLL2gwZUszWHJJRnAxRWhsOEY5SVNCQzYrelAvOHYxeUNHcm94LzFKMENqRW1CcVdtRWJCL3VLTWFiYS9YamtmOXhieFhac3RRdGg0TC8wcE1JMENoRDUvdTR6bStCNjFDS0h5WWZjV1JweE1vK0RWaFZnZUY0S2RxM085b0h0am9iQUJTbEF2NkNvaDlyZ3NDNDY3cmVPZmFEa01FZCsxV1pYVTdPeENKeXVGZ0Z2aCtQY3BmZm5zRitJS3BtRlZIR3o0dTZQSmxQRjl2T2xPS2xSdW1VSVhWcVFXS2dkYWU4dXFjUUwrUXZVb29hT1ZIYVlXSWxlSmdMT3QweTJiVG9od1pJWGNCb3pyS0VDSGxIR2ppUTExSFUzS0s3NlBOMzBjYm16d2NXaFdCdFNUdnk5d01RN2hiWFJRMzZrWnV1ZlRoR1o5aDBLYTBNanlQQWhSdWRwblVvWWVHditFT0l1MHozUlF4U3J4VEtoYnZoMXJ6eW5nem1wNkgrSzIxTTRWL25oNm9YcjV6QnJpUWFobDF4RHlZME4vYW1TOGRKNEpBYWVURGxIQ2FyK0J6Wk5RdHp6N3EzKzFXQlZFOTVjdnNqcEhPNHlnRXcveEpNVEdNWEZ2Wi9aZXAybUJBY3ZIUWd0V050eXA5eGhkdWFjVmJISHZPQ3N4amZ4WnFIZEVveE1xOGVoZUE5T29lM3hWUUl1aFN6Ti9jMVVKaHk3dHhUdUVhUlN3Z3l3NzB5QUIrSG14aHdFaHYzcmhhL2YxTUkyR3dJK1Y0M1BsYWZzU1RLTmNUS05jVEtOY1RLTmNUS05jVEtOY1RLTmNUS05jL2dLR1RCa2pWd0NxTUFBQUFBQkpSVTVFcmtKZ2dnPT0iIHk9IjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMCIgeD0iNzA3LjUiIHk9IjY5Ljk5NTEiLz48IS0tTUQ1PVs3NWUyYzc5ODY0MDBiNDczNDg4NzgxMTgyODkxNzkwMV0KZW50aXR5IHdzaC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMXhjamlxbWtma2g5cCkiIGhlaWdodD0iNTIuNTkzOCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTQ3IiB4PSIyMy41IiB5PSI5MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSIzMy41IiB5PSIxMTIuOTk1MSI+44Ov44O844Kv44K544Oa44O844K5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNyIgeD0iMzMuNSIgeT0iMTI5LjI5MiI+b24gdWJ1bnR1IG9uIFdTTDwvdGV4dD48IS0tTUQ1PVszZDk5ZDU5YTI3ZWM1NWNkOWIwYjE0OTA4MDFmNzhiY10KZW50aXR5IGRldi0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMXhjamlxbWtma2g5cCkiIGhlaWdodD0iNDYuMjk2OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTkyIiB4PSIyMjciIHk9IjkzLjUiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxNSIgeD0iMzk5IiB5PSI5OC41Ii8+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0IiB4PSIzOTciIHk9IjEwMC41Ii8+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0IiB4PSIzOTciIHk9IjEwNC41Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUyIiB4PSIyNDIiIHk9IjEyNi40OTUxIj5SZW1vdGUgRGV2ZWxvcGVtbnQ8L3RleHQ+PCEtLU1ENT1bMDkwOGI0NzFlNmQ4MGYxMjFkMDZmN2U4Y2E5ZGYwYmVdCmVudGl0eSB3c2MtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZjF4Y2ppcW1rZmtoOXApIiBoZWlnaHQ9IjUyLjU5MzgiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEzMiIgeD0iNDk4IiB5PSI5MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSI1MDgiIHk9IjExMi45OTUxIj7jg6/jg7zjgq/jgrnjg5rjg7zjgrk8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEyIiB4PSI1MDgiIHk9IjEyOS4yOTIiPm9uIGRldmNvbnRhaW5lcjwvdGV4dD48IS0tTUQ1PVsyNTM3OTNhYzEyZGM3MWI1YjM2NjE3MjhlOGRjMjE0N10KZW50aXR5IHN2Yy0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMXhjamlxbWtma2g5cCkiIGhlaWdodD0iMzYuMjk2OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTMyIiB4PSI3MzciIHk9Ijk4LjUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTIiIHg9Ijc0NyIgeT0iMTIxLjQ5NTEiPuOCteODvOODk+OCueOCs+ODs+ODhuODijwvdGV4dD48IS0tTUQ1PVtmYzllOTQzNWUyMDljZGExNmVkNGY2ZDE5NWEyMWUwYV0KbGluayB3c2ggdG8gZGV2LS0+PHBhdGggZD0iTTE3MC43MSwxMTYuNSBDMTg5LjQ1LDExNi41IDIwOC4xOSwxMTYuNSAyMjYuOTMsMTE2LjUgIiBmaWxsPSJub25lIiBpZD0id3NoLWRldiIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLU1ENT1bMmE1ZjY4MzBjZWVjYjFkMzQxN2ViOWNhOWIyMWViYzFdCmxpbmsgZGV2IHRvIHdzYy0tPjxwYXRoIGQ9Ik00MTkuMjksMTE2LjUgQzQ0My43OSwxMTYuNSA0NjkuNjgsMTE2LjUgNDkyLjY5LDExNi41ICIgZmlsbD0ibm9uZSIgaWQ9ImRldi10by13c2MiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNDk3Ljg1LDExNi41LDQ4OC44NSwxMTIuNSw0OTIuODUsMTE2LjUsNDg4Ljg1LDEyMC41LDQ5Ny44NSwxMTYuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjQzNy41IiB5PSIxMDkuNTY2OSI+bW91bnQ8L3RleHQ+PCEtLU1ENT1bYTQ2ZjQ1NjA0ZGMzMDIzYWM0NTRiNWFlMzA2NTU3NDddCmxpbmsgd3NjIHRvIHN2Yy0tPjxwYXRoIGQ9Ik02MzAuMjYsMTE2LjUgQzY2MS43MywxMTYuNSA2OTkuMzksMTE2LjUgNzMxLjUxLDExNi41ICIgZmlsbD0ibm9uZSIgaWQ9IndzYy10by1zdmMiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNzM2LjYxLDExNi41LDcyNy42MSwxMTIuNSw3MzEuNjEsMTE2LjUsNzI3LjYxLDEyMC41LDczNi42MSwxMTYuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzgiIHg9IjY2NC41IiB5PSI5NC41NjY5Ij5pbm90aWZ5PC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwIiB4PSI2NDguNSIgeT0iMTA5LjY5OTciPm5vdGlmaWNhdGlvbjwvdGV4dD48IS0tTUQ1PVtmNWNiYmYxZDRkZGIzZjg1OTc2MmEyNGNlNjczYWNmMV0KQHN0YXJ0dW1sDQohZGVmaW5lIElDT05VUkwgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3R1cGFkcjMvcGxhbnR1bWwtaWNvbi1mb250LXNwcml0ZXMvdjIuNC4wDQohaW5jbHVkZXVybCBJQ09OVVJML2NvbW1vbi5wdW1sDQohaW5jbHVkZXVybCBJQ09OVVJML2Rldmljb25zMi91YnVudHUucHVtbA0KIWluY2x1ZGV1cmwgSUNPTlVSTC9kZXZpY29uczIvdmlzdWFsc3R1ZGlvLnB1bWwNCiFpbmNsdWRldXJsIElDT05VUkwvZGV2aWNvbnMyL2RvY2tlci5wdW1sDQoNCkRFVjJfVUJVTlRVKHVidW50dSwiIixyZWN0YW5nbGUsI2RkNDgxNCkgI2ZmZmZlMCB7DQogICAgYWdlbnQgIuODr+ODvOOCr+OCueODmuODvOOCuVxub24gdWJ1bnR1IG9uIFdTTCIgYXMgd3NoDQp9DQpERVYyX1ZJU1VBTFNUVURJTyh2c2NvZGUsIiIscmVjdGFuZ2xlLCMwMDc4ZDcpICNmZmZmZTAgew0KICAgIGNvbXBvbmVudCAiUmVtb3RlIERldmVsb3BlbW50IiBhcyBkZXYNCn0NCkRFVjJfRE9DS0VSKGRvY2tlciwiIixyZWN0YW5nbGUsIzBkYjdlZCkgI2ZmZmZlMCB7DQogICAgYWdlbnQgIuODr+ODvOOCr+OCueODmuODvOOCuVxub24gZGV2Y29udGFpbmVyIiBhcyB3c2MNCiAgICBhZ2VudCAi44K144O844OT44K544Kz44Oz44OG44OKIiBhcyBzdmMNCn0NCg0Kd3NoIC0gZGV2DQpkZXYgLT4gd3NjIDogbW91bnQNCndzYy0+IHN2YyA6IGlub3RpZnlcbm5vdGlmaWNhdGlvbg0KQGVuZHVtbA0KCkBzdGFydHVtbA0KDQoNCmhpZGUgc3RlcmVvdHlwZQ0Kc3ByaXRlICR1YnVudHUgWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDE1N0FCQ0NCQTc1MTAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMjhERkZGRkZGRkZGRkZGRDgyMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwM0JGRkZGRkZGRkZGRkZGRkZGRkZCMzAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMUFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGQjEwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjUwMDAwMDAwMDAwDQowMDAwMDAwMDA4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjgwMDAwMDAwMDANCjAwMDAwMDAwQUZGRkZGRkZGRkZGRkZGRkZGRkZGRkQ5QkZGRkZGRkEwMDAwMDAwMA0KMDAwMDAwMEFGRkZGRkZGRkZGRkZGRkZGRkZGRkY5MDAwM0VGRkZGRkEwMDAwMDAwDQowMDAwMDA4RkZGRkZGRkZGRkZGRkZGRkZGRkZGRjAwMDAwN0ZGRkZGRjgwMDAwMDANCjAwMDAwNUZGRkZGRkZGRkZGRkZGRkZFQ0RFRkZDMDAwMDA0RkZGRkZGRjUwMDAwMA0KMDAwMDFGRkZGRkZGRkZGRkZGRjk0MDAwMDAwOEUwMDAwMDZGRkZGRkZGRTEwMDAwDQowMDAwQUZGRkZGRkZGRkZGRkY2MDAwMDAwMDAxRjcwMDAxRUZGRkZGRkZGQTAwMDANCjAwMDNGRkZGRkZGRkZGRkQ0RkQwMDAwMDAwMDA1RkI3OEVGRkZGRkZGRkZGMzAwMA0KMDAwQkZGRkZGRkZGRkZDMTA3RjcwMDAwMDAwMDAzQUNDREZGRkZGRkZGRkZBMDAwDQowMDJGRkZGRkZGRkZGRDEwMDBERjM3QkREQjcyMDAwMDAxREZGRkZGRkZGRkYyMDANCjAwOEZGRkZGRkZGRkYyMDAwMDRGRkZGRkZGRkZBMTAwMDAyRkZGRkZGRkZGRjcwMA0KMDBERkZGRkZGRkZGODAwMDAyREZGRkZGRkZGRkZEMjAwMDA4RkZGRkZGRkZGRDAwDQowMUZGRkZGRkZGRkYwMDAwMERGRkZGRkZGRkZGRkZEMTAwMDFGRkZGRkZGRkZGMTANCjA1RkZGRkZGRkZGQTAwMDA5RkZGRkZGRkZGRkZGRkY5MDAwMEFGRkZGRkZGRkY1MA0KMDdGRkZGRkZGRkY1MDAwMUZGRkZGRkZGRkZGRkZGRkYyMDAwNEZGRkZGRkZGRjcwDQowQUZGRkZDMjAyQkUwMDA3RkZGRkZGRkZGRkZGRkZGRjgwMDAxRkZGRkZGRkZGQTANCjBCRkZGRTAwMDAwRDcwMEJGRkZGRkZGRkZGRkZGRkZGQjAwMDBFRkZGRkZGRkZCMA0KMENGRkY5MDAwMDA4QjAwREZGRkZGRkZGRkZGRkZGRkZGQ0NDREZGRkZGRkZGRkMwDQowQ0ZGRjkwMDAwMDhCMDBERkZGRkZGRkZGRkZGRkZGRkZDQ0NERkZGRkZGRkZGQzANCjBCRkZGRTAwMDAwRDcwMEJGRkZGRkZGRkZGRkZGRkZGQjAwMDBFRkZGRkZGRkZCMA0KMEFGRkZGQzMwMkNEMDAwN0ZGRkZGRkZGRkZGRkZGRkY3MDAwMUZGRkZGRkZGRkEwDQowN0ZGRkZGRkZGRjUwMDAxRkZGRkZGRkZGRkZGRkZGRjIwMDA0RkZGRkZGRkZGNzANCjA1RkZGRkZGRkZGQTAwMDA5RkZGRkZGRkZGRkZGRkY5MDAwMEFGRkZGRkZGRkY1MA0KMDFGRkZGRkZGRkZGMDAwMDBERkZGRkZGRkZGRkZGRDEwMDAxRkZGRkZGRkZGRjEwDQowMERGRkZGRkZGRkY4MDAwMDFERkZGRkZGRkZGRkQyMDAwMDlGRkZGRkZGRkZEMDANCjAwOEZGRkZGRkZGRkYyMDAwMDRGRkZGRkZGRkY5MTAwMDAyRkZGRkZGRkZGRjcwMA0KMDAyRkZGRkZGRkZGRkQxMDAwREYzN0JEREI3MjAwMDAwMUVGRkZGRkZGRkZGMjAwDQowMDBCRkZGRkZGRkZGRkMxMDdGNzAwMDAwMDAwMDNBRENERkZGRkZGRkZGRkEwMDANCjAwMDNGRkZGRkZGRkZGRkQ0RkQwMDAwMDAwMDA1RkI2OEVGRkZGRkZGRkZGMzAwMA0KMDAwMEFGRkZGRkZGRkZGRkZGNjAwMDAwMDAwMUY3MDAwMUVGRkZGRkZGRkEwMDAwDQowMDAwMUZGRkZGRkZGRkZGRkZGOTQwMDAwMDA4RTAwMDAwNkZGRkZGRkZFMTAwMDANCjAwMDAwNUZGRkZGRkZGRkZGRkZGRkZFQ0RFRkZDMDAwMDA0RkZGRkZGRjQwMDAwMA0KMDAwMDAwOEZGRkZGRkZGRkZGRkZGRkZGRkZGRkYwMDAwMDdGRkZGRkY4MDAwMDAwDQowMDAwMDAwQUZGRkZGRkZGRkZGRkZGRkZGRkZGRjkwMDAzRUZGRkZGQTAwMDAwMDANCjAwMDAwMDAwQUZGRkZGRkZGRkZGRkZGRkZGRkZGRkQ5QkZGRkZGRkEwMDAwMDAwMA0KMDAwMDAwMDAwOEZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkY4MDAwMDAwMDAwDQowMDAwMDAwMDAwNUVGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZFNDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMUFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGQTEwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDJBRkZGRkZGRkZGRkZGRkZGRkZGQjMwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAyN0RGRkZGRkZGRkZGRkZENzIwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDE1N0FCQ0NCQTc1MTAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBVQlVOVFU+PiBXaGl0ZQ0Kc3ByaXRlICR2aXN1YWxzdHVkaW8gWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREM2MDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGOTIwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkM2MDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGOTIwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZGRkMwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDFERkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDA0QTIwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDA0Q0ZGRTQwMDAwMDAwMDAwMDAwMDAwMURGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowREZGRkZGRjcwMDAwMDAwMDAwMDAwMDJFRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkIxMDAwMDAwMDAwMDAxREZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkQyMDAwMDAwMDAwMkVGRkZGRkZGRkZGRkZFRkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRkY2MDAwMDAwMDFERkZGRkZGRkZGRkZGNzdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRkY5MDAwMDAxREZGRkZGRkZGRkZGRTQwN0ZGRkZGRkZGRkZGMQ0KMUZGRkZCRUZGRkZGRkZDMTAwMkVGRkZGRkZGRkZGRkMxMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgyRUZGRkZGRkZFNDFERkZGRkZGRkZGRkZBMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAyRUZGRkZGRkZGRUZGRkZGRkZGRkZGNjAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAyRUZGRkZGRkZGRkZGRkZGRkZGRTMwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAyRUZGRkZGRkZGRkZGRkZGRkMxMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAyRUZGRkZGRkZGRkZGRkY5MDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMDAyRUZGRkZGRkZGRkZGNjAwMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDAwMDFERkZGRkZGRkZGRkUzMDAwMDAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwMDAxQ0ZGRkZGRkZGRkZGRkY3MDAwMDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MDAwMENGRkZGRkZGRkZGRkZGRkZBMDAwMDAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjgwMDBDRkZGRkZGRkZGRkZGRkZGRkZEMjAwMDAwMDdGRkZGRkZGRkZGRjENCjFGRkZGODAwQ0ZGRkZGRkZGRkZGRkZGRkZGRkZFNDAwMDAwN0ZGRkZGRkZGRkZGMQ0KMUZGRkY4MEJGRkZGRkZGRjYzRkZGRkZGRkZGRkZGODAwMDA3RkZGRkZGRkZGRkYxDQoxRkZGRjlCRkZGRkZGRkUzMDAzRkZGRkZGRkZGRkZGQjEwMDdGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkZGRkZCMTAwMDAzRkZGRkZGRkZGRkZGRDIwN0ZGRkZGRkZGRkZGMQ0KMUZGRkZGRkZGRkZGODAwMDAwMDAzRkZGRkZGRkZGRkZGRjY3RkZGRkZGRkZGRkYxDQoxRkZGRkZGRkZGRTQwMDAwMDAwMDAzRkZGRkZGRkZGRkZGRkRGRkZGRkZGRkZGRjENCjFGRkZGRkZGRkMyMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMERGRkZGRkY5MDAwMDAwMDAwMDAwMDAzRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDVERkZGNjAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDA2QzMwMDAwMDAwMDAwMDAwMDAwMDAzRkZGRkZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGRjENCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkZGMQ0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGRkYxDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAzRUZGRkZGRkZGRkZGRkZGQjANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZGRkZFODIwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkZGRkZDNTAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUZGRkY5MjAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyRUM2MDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBWSVNVQUxTVFVESU8+PiBXaGl0ZQ0Kc3ByaXRlICRkb2NrZXIgWzQ4eDQ4LzE2XSB7DQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwREJCQkJDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDBDMDAwMEMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMEMwMDAwQzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwQzAwMDBDMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDE3Nzc3Nzc3NzdEMjIyMkMwMDAwMDAwMDAwMDAxMDAwMDAwMDAwMA0KMDAwMDAwMDAwNEM5OTlFOTk5OUU5OTk5QzAwMDAwMDAwMDAwMUU5MDAwMDAwMDAwDQowMDAwMDAwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMDAwMDAwMDA5RkY5MDAwMDAwMDANCjAwMDAwMDAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAwMDAwMDAwMEVGRkY1MDAwMDAwMA0KMDAwMDAwMDAwNDgwMDBDMDAwMEMwMDAwQzAwMDAwMDAwMDAwRkZGRkQwMDAwMDAwDQowMDAwMTk5OTlCQTQ0NEQ0NDQ0RDQ0NDRFOTk5OTYwMDAwMDBGRkZGRjIzNDMwMDANCjAwMDAyRDg4OEFDODg4RTg4ODhFODg4OEU4ODg5OTAwMDAwMEVGRkZGRkZGRkY5MQ0KMDAwMDI5MDAwNDgwMDBDMDAwMEMwMDAwQzAwMDI5MDAwMDAwQUZGRkZGRkZGRkYyDQowMDAwMjkwMDA0ODAwMEMwMDAwQzAwMDBDMDAwMjkwMDAwMDAyRkZGRkZGRkZGNzANCjAwMDAyOTAwMDQ4MDAwQzAwMDBDMDAwMEMwMDAyOTAwMDAwMkFGRkZGRkZGRjcwMA0KMjY2NjdDNjY2OEI2NjZENjY2NkQ2NjY2RDY2NjdDNTU2OENGRkZGRkVEQjcyMDAwDQo2RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZEMDAwMDAwMDANCjZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjYwMDAwMDAwMA0KNkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZEMDAwMDAwMDAwDQo0RkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRjUwMDAwMDAwMDANCjFGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZCMDAwMDAwMDAwMA0KMERGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRTEwMDAwMDAwMDAwDQowOEZGRkZGRkZGRkZGOTZERkZGRkZGRkZGRkZGRkZGRkZGRkYzMDAwMDAwMDAwMDANCjAxRkZGRkZGRkZGRkY5REJGRkZGRkZGRkZGRkZGRkZGRkZGNTAwMDAwMDAwMDAwMA0KMDA3RkZGRkZGRkZGRkVCRkZGRkZGRkZGRkZGRkZGRkZGRjUwMDAwMDAwMDAwMDAwDQowMDBDREJCQkI5NzRDRkZGRkZGRkZGRkZGRkZGRkZGRkY0MDAwMDAwMDAwMDAwMDANCjAwMDFDNDAwMDAwMDNGRkZGRkZGRkZGRkZGRkZGRkZDMjAwMDAwMDAwMDAwMDAwMA0KMDAwMDFDNjAwMDAwMDdGRkZGRkZGRkZGRkZGRkZFNjAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDA4QzMwMDAwMDdGRkZGRkZGRkZGRkZFNzAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAyQUM3MzAwMDRERkZGRkZGRkZBNTAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMTZBRERDQkJGRkZEQTc0MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDEyMTEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQowMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDANCjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMA0KMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwDQp9DQoNCg0Kc2tpbnBhcmFtIGZvbGRlckJhY2tncm91bmRDb2xvcjw8REVWMiBET0NLRVI+PiBXaGl0ZQ0KDQpyZWN0YW5nbGUgIjxjb2xvcjojZGQ0ODE0PjwkdWJ1bnR1PjwvY29sb3I+XHIgIiBhcyB1YnVudHUgPDxERVYyIFVCVU5UVT4+ICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIHVidW50dSBvbiBXU0wiIGFzIHdzaA0KfQ0KcmVjdGFuZ2xlICI8Y29sb3I6IzAwNzhkNz48JHZpc3VhbHN0dWRpbz48L2NvbG9yPlxyICIgYXMgdnNjb2RlIDw8REVWMiBWSVNVQUxTVFVESU8+PiAjZmZmZmUwIHsNCiAgICBjb21wb25lbnQgIlJlbW90ZSBEZXZlbG9wZW1udCIgYXMgZGV2DQp9DQpyZWN0YW5nbGUgIjxjb2xvcjojMGRiN2VkPjwkZG9ja2VyPjwvY29sb3I+XHIgIiBhcyBkb2NrZXIgPDxERVYyIERPQ0tFUj4+ICNmZmZmZTAgew0KICAgIGFnZW50ICLjg6/jg7zjgq/jgrnjg5rjg7zjgrlcbm9uIGRldmNvbnRhaW5lciIgYXMgd3NjDQogICAgYWdlbnQgIuOCteODvOODk+OCueOCs+ODs+ODhuODiiIgYXMgc3ZjDQp9DQoNCndzaCAtIGRldg0KZGV2IC0+IHdzYyA6IG1vdW50DQp3c2MtPiBzdmMgOiBpbm90aWZ5XG5ub3RpZmljYXRpb24NCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS4xNihXZWQgRGVjIDA4IDE3OjI1OjIyIFVUQyAyMDIxKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogT3BlbkpESyBSdW50aW1lIEVudmlyb25tZW50CkpWTTogT3BlbkpESyA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBudWxsCi0tPjwvZz48L3N2Zz4=\" loading=\"lazy\"\u003e\n\u003ch2 data-sourcepos=\"303:1-303:60\"\u003e\n\u003cspan id=\"devcontainerからdockerを操作できるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#devcontainer%E3%81%8B%E3%82%89docker%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edevcontainerからdockerを操作できるようにする\u003c/h2\u003e\n\u003cp data-sourcepos=\"305:1-307:102\"\u003eWSLからサービスコンテナにファイルをマウントすることで、inotifyの通知を受け取ることができるようになりました。\u003cbr\u003e\nこれで大体の作業はdevcontainer内で完結できるようになったのですが、今のところではコンテナのログを見たり作り直したりするのにはホストに切り替えて操作を行う必要があります。\u003cbr\u003e\nそのため、Dockerの操作についてもdevcontainer内で行えるようにしていきます。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"309:1-309:49\"\u003e\n\u003cspan id=\"dockerクライアントのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#docker%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDockerクライアントのインストール\u003c/h3\u003e\n\u003cp data-sourcepos=\"311:1-313:103\"\u003eまず、dockerコマンドとdocker-composeコマンドをdevcontainer内で利用できるようにクライアントをインストールします。\u003cbr\u003e\ndevcontainerのOSとしてDebian以外を選択した場合はgpgの周りを適宜調整してください。\u003cbr\u003e\n(Ubuntuで構築したなら \u003ccode\u003edebian\u003c/code\u003e となっている部分を \u003ccode\u003eubuntu\u003c/code\u003e と変えれば動きます)\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"dockerfile\" data-sourcepos=\"316:1-328:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edevcontainer用のDockerfileに記述する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# dockerクライアントとdocker-composeをインストール\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003e\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /etc/apt/keyrings \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e curl \u003cspan class=\"nt\"\u003e-fsSL\u003c/span\u003e https://download.docker.com/linux/debian/gpg | gpg \u003cspan class=\"nt\"\u003e--dearmor\u003c/span\u003e \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e /etc/apt/keyrings/docker.gpg \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deb [arch=\u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003edpkg \u003cspan class=\"nt\"\u003e--print-architecture\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003elsb_release \u003cspan class=\"nt\"\u003e-cs\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e stable\"\u003c/span\u003e | \u003cspan class=\"nb\"\u003esudo tee\u003c/span\u003e /etc/apt/sources.list.d/docker.list \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e /dev/null \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt update \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt autoremove \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e docker-ce-cli docker-compose-plugin\n\n\u003cspan class=\"c\"\u003e# aptで取得されるdocker-composeは古いので新しいバージョンに置き換える\u003c/span\u003e\n\u003cspan class=\"k\"\u003eARG\u003c/span\u003e\u003cspan class=\"s\"\u003e DCVERSION=\"2.10.2\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eENV\u003c/span\u003e\u003cspan class=\"s\"\u003e DCURL=\"https://github.com/docker/compose/releases/download/v${DCVERSION}/docker-compose-linux-x86_64\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-L\u003c/span\u003e \u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDCURL\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e /usr/local/bin/docker-compose \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003echmod\u003c/span\u003e +x /usr/local/bin/docker-compose\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"330:1-330:85\"\u003e\n\u003cspan id=\"dockerクライアントの通信先をホストのdockerデーモンに向ける\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#docker%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%81%AE%E9%80%9A%E4%BF%A1%E5%85%88%E3%82%92%E3%83%9B%E3%82%B9%E3%83%88%E3%81%AEdocker%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E3%81%AB%E5%90%91%E3%81%91%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDockerクライアントの通信先をホストのDockerデーモンに向ける\u003c/h3\u003e\n\u003cp data-sourcepos=\"332:1-334:410\"\u003eDockerのデーモンが動いているのはdevcontainer内でなくWSL環境です。\u003cbr\u003e\nそのためDockerのクライアントが操作する先のデーモンをWSLに向けます。\u003cbr\u003e\nDockerのクライアントから外部のデーモンに通信するためにはデーモン側でTCP接続を許可してDOCKER_HOST環境変数を指定するのがオーソドックスですが、Dockerデーモン自体が稼働させているコンテナからホストのデーモンを操作する場合に限りDocker outside of Docker(DooD)という仕組みを使って簡易に対応できます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"js\" data-sourcepos=\"336:1-340:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edevcontainer.jsonでホストのsockをコンテナにマウントすることでホストのデーモンと通信できる\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emounts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etype=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv data-sourcepos=\"342:1-357:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"343:1-343:28\"\u003eDooDについて調べると\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"344:1-346:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003edocker run \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e /var/run/docker:/var/run/docker ...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"347:1-347:234\"\u003eのように省略記法で説明されている場合がありますが、devcontainerで使う場合は \u003ccode\u003emounts\u003c/code\u003e 要素は \u003ccode\u003e--mount\u003c/code\u003e オプションに相当するもので省略記法は使えないので注意してください。\u003c/p\u003e\n\u003cp data-sourcepos=\"349:1-349:185\"\u003eこれとは別にdocker-compose.yamlを用意してマウント定義をする場合は、volumesで定義することになるので省略記法での指定もできるようです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"351:1-356:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"na\"\u003eservices\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eapp\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evolumes\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e/var/run/docker:/var/run/docker\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"359:1-359:94\"\u003e\n\u003cspan id=\"wsl上のワークスペースの配置をコンテナ内とそろうように移動する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#wsl%E4%B8%8A%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E9%85%8D%E7%BD%AE%E3%82%92%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%86%85%E3%81%A8%E3%81%9D%E3%82%8D%E3%81%86%E3%82%88%E3%81%86%E3%81%AB%E7%A7%BB%E5%8B%95%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWSL上のワークスペースの配置をコンテナ内とそろうように移動する\u003c/h3\u003e\n\u003cp data-sourcepos=\"361:1-363:149\"\u003eここまででdevcontainer内からの \u003ccode\u003edocker-compose ps\u003c/code\u003e や \u003ccode\u003edocker-compose logs mysql\u003c/code\u003e のコマンドは動くようになりますが、\u003ccode\u003edocker-compose down\u003c/code\u003e とした後に \u003ccode\u003edocker-compose up (-d)\u003c/code\u003e とするとコンテナが起動できないことがあり、起動してもコンテナ内の処理で失敗することがあります。\u003cbr\u003e\nここで失敗するのはホストから \u003cstrong\u003e相対パスで指定したパス\u003c/strong\u003e をマウントしている場合で、ワークスペースのパスがWSL上とdevcontainer上でずれているとdevcontainer上のdockerコマンドからはマウントすることができなくなります。\u003cbr\u003e\n(ここを後で強調して説明するために、前の手順ではあえて失敗するパスにワークスペースを配置していました)\u003c/p\u003e\n\u003cp data-sourcepos=\"365:1-366:174\"\u003eこの点を解消するためには、WSL上でのワークスペースのファイルをコンテナにマウントされた時と同じ配置になるように移動します。\u003cbr\u003e\ndevcontainerではデフォルトで \u003ccode\u003e/workspaces/[プロジェクト名]\u003c/code\u003e でワークスペースをマウントするので、WSL上でも同じように配置します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"368:1-370:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eWSL上でプロジェクトの配置を変更する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003emv\u003c/span\u003e /home/[user]/some-project /workspaces/some-project\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv data-sourcepos=\"372:1-384:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"373:1-373:156\"\u003eもしWSL上でこのパスをすでに利用していた場合は、別のパスに配置した上でマウント先を変更する必要があります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"375:1-377:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eWSL上で配置を変更する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$ \u003c/span\u003e\u003cspan class=\"nb\"\u003emv\u003c/span\u003e /home/[user]/some-project /dev-workspace/some-project\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"js\" data-sourcepos=\"379:1-382:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003edevcontainer.jsonでワークスペースのマウント先と配置を変更する\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eworkspaceMount\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esrc=/dev-workspace/some-project,target=/dev-workspace/some-project,type=bind\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eworkspaceFolder\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/dev-workspace/some-project\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"386:1-386:32\"\u003e\n\u003cspan id=\"最終的な設定ファイル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E7%B5%82%E7%9A%84%E3%81%AA%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最終的な設定ファイル\u003c/h1\u003e\n\u003cp data-sourcepos=\"388:1-388:102\"\u003eこれらを踏まえてdevcontainerの環境を作った結果、以下のようになりました。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"dockerfile\" data-sourcepos=\"390:1-423:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.devcontainer/Dockerfile\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eARG\u003c/span\u003e\u003cspan class=\"s\"\u003e GO_VERISION=\"1.19-bullseye\"\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# [Choice] Go version (use -bullseye variants on local arm64/Apple Silicon): 1, 1.19, 1.18, 1-bullseye, 1.19-bullseye, 1.18-bullseye, 1-buster, 1.19-buster, 1.18-buster\u003c/span\u003e\n\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"s\"\u003e mcr.microsoft.com/vscode/devcontainers/go:0-${GO_VERISION}\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# [Choice] Node.js version: none, lts/*, 18, 16, 14\u003c/span\u003e\n\u003cspan class=\"k\"\u003eARG\u003c/span\u003e\u003cspan class=\"s\"\u003e NODE_VERSION=\"none\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN if\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNODE_VERSION\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"none\"\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen \u003c/span\u003esu vscode \u003cspan class=\"nt\"\u003e-c\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"umask 0002 \u0026amp;\u0026amp; . /usr/local/share/nvm/nvm.sh \u0026amp;\u0026amp; nvm install \u003c/span\u003e\u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNODE_VERSION\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e 2\u0026gt;\u0026amp;1\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# [Optional] Uncomment this section to install additional OS packages.\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003eapt update \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003eexport \u003c/span\u003e\u003cspan class=\"nv\"\u003eDEBIAN_FRONTEND\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enoninteractive \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt autoremove \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt update \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e--no-install-recommends\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    curl \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    git \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    gnupg\n\n\u003cspan class=\"c\"\u003e# Docker\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003e\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /etc/apt/keyrings \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e curl \u003cspan class=\"nt\"\u003e-fsSL\u003c/span\u003e https://download.docker.com/linux/debian/gpg | gpg \u003cspan class=\"nt\"\u003e--dearmor\u003c/span\u003e \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e /etc/apt/keyrings/docker.gpg \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"deb [arch=\u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003edpkg \u003cspan class=\"nt\"\u003e--print-architecture\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \u003c/span\u003e\u003cspan class=\"si\"\u003e$(\u003c/span\u003elsb_release \u003cspan class=\"nt\"\u003e-cs\u003c/span\u003e\u003cspan class=\"si\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e stable\"\u003c/span\u003e | \u003cspan class=\"nb\"\u003esudo tee\u003c/span\u003e /etc/apt/sources.list.d/docker.list \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e /dev/null \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt update \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt autoremove \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e docker-ce-cli docker-compose-plugin\n\n\u003cspan class=\"c\"\u003e# docker-composeは古いので指定したバージョンに更新\u003c/span\u003e\n\u003cspan class=\"k\"\u003eARG\u003c/span\u003e\u003cspan class=\"s\"\u003e DCVERSION=\"2.10.2\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eENV\u003c/span\u003e\u003cspan class=\"s\"\u003e DCURL=\"https://github.com/docker/compose/releases/download/v${DCVERSION}/docker-compose-linux-x86_64\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-L\u003c/span\u003e \u003cspan class=\"k\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDCURL\u003c/span\u003e\u003cspan class=\"k\"\u003e}\u003c/span\u003e \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e /usr/local/bin/docker-compose \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003echmod\u003c/span\u003e +x /usr/local/bin/docker-compose\n\n\u003cspan class=\"k\"\u003eUSER\u003c/span\u003e\u003cspan class=\"s\"\u003e vscode\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"js\" data-sourcepos=\"425:1-446:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e.devcontainer/devcontainer.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ename\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eGo\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ebuild\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003edockerfile\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eDockerfile\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eargs\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\t\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eGO_VERISION\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e1.19-bullseye\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eNODE_VERSION\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e18\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erunArgs\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e--cap-add=SYS_PTRACE\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e--security-opt\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eseccomp=unconfined\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e--network=local-nw\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emounts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\t\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etype=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\t\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\t\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eremoteUser\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003evscode\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"448:1-448:14\"\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h1\u003e\n\u003cp data-sourcepos=\"450:1-451:303\"\u003e今までは同じワークスペースでも操作に応じてvscodeを複数開くと言ったことをやっていましたが、これでdevcontainerの起動だけをホスト側で行えばその他のことはdevcontainer内で完結できるようになりました。\u003cbr\u003e\nまだ作ったばかりで使用感は完全には測れていませんが、vscodeのプロセスが減らせてマシンが軽くなったのとコンテキストスイッチが減って集中が続くようになっただけでも、この構成にした甲斐はあるかなと感じています。\u003c/p\u003e\n\u003cp data-sourcepos=\"453:1-453:117\"\u003eもっとこう作った方がいいとかご意見ありましたらコメントいただければと思います。\u003c/p\u003e\n","body":"Dockerって環境を汚さないで使えて便利ですよね。\nvscodeっていろんな言語の開発環境を手軽に作れて便利ですよね。\nということでRemote Developmentによる作業コンテナ(devcontainer)を使ってコンテナ側に引き篭って開発できる環境を作ってみたので、環境構成と要点をここに書き出してみようと思います。\n\n# 注意事項\n\nこの記事は\n\n- ホストOSがWindows環境で\n- vscodeとDockerコンテナを使って\n- なるべくUnix系に寄せて使えるようにする\n\n前提での環境構築のお話になっています。\nホストOSにLinuxやMacを使っていたりコンテナを使わなかったりホストはWindows上のシェル操作で十分な場合は、この記事は適合しない内容が多分に含まれています。\n\nまた、個々のツールや環境のセットアップ操作などはほぼ書かれない予定なので、必要に応じて他の記事を参照してください。\n\n# 環境\n\n- ホスト\n    - Windows 10\n- WSL\n    - WSL2\n    - Ubuntu 20.04\n- Docker\n    - Docker version 20.10.17, build 100c701\n    - Docker Compose version v2.10.2\n- devcontainer\n    - Debian bullseye\n\n:::note info\n私の場合はGoの開発環境としてdevcontainerを作ったのでDebianベース(`golang:1.19-bullseye`)になっていますが、他のディストリビューションでも同じことはできると思います\n:::\n\n# TL;DR;\n\n- ワークスペースはサービスのコンテナとは独立してdevcontainer上に構築する\n- サービス用のコンテナとdevcontainerを同じネットワークにつなぐ\n- DockerはDooDで操作し、ワークスペースの配置はWSL上とDocker上でパスを合わせる\n\n# 経緯とか変遷の流れ\n\nvscode + Remote Developmentを扱い始めた際、既存のコンテナにアタッチしてそこにvscodeのワークスペースを構築して使っていました。\n\n```plantuml\n@startuml\n!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0\n!includeurl ICONURL/common.puml\n!includeurl ICONURL/devicons2/visualstudio.puml\n!includeurl ICONURL/devicons2/docker.puml\n\nDEV2_VISUALSTUDIO(vscode,\"\",rectangle,#0078d7) #ffffe0 {\n    component \"Remote Development\" as dev\n}\nDEV2_DOCKER(docker,\"\",rectangle,#0db7ed) #ffffe0 {\n    agent \"ワークスペース\\nin サービスコンテナ\" as svc\n}\n\ndev -\u003e svc : Attach to Running Container\n@enduml\n```\n\n## ワークスペースのサービスコンテナからの分離\n\nサービスコンテナ上にワークスペースを構築すると、\n\n- ワークスペースに追加のツールなどをインストールするためには手動で行う必要がある\n    - DockerFileに書いてしまうとコミット時に差分を除く必要が出てしまう\n        - 全作業者が環境構成を共有するならありだけど普通はそうじゃない(と思っている)\n    - 別ボリュームでマウントすれば使い回せるけどdocker-compose.ymlに書いてしまうと以下略\n- サービスコンテナを破棄する度にツールの再インストールが必要になる\n    - コンテナは中身がよくわからなくて困ったら手軽に再作成できるのが売りの一つ\n    - 別ボリュームやホストに退避したりで使い回せるようにしたこともあったけど、たまに回収し忘れると再度入れ直したりするのが手間\n\nというデメリットがありました。\n\nこの点を解消するために、ワークスペースを稼働中のサービスコンテナから切り離してホスト側で構築し直すようにしました。\nこの構成では通常のファイル操作などはvscodeからWindows上で行うことになりますが、コンテナにも同じファイルをマウントすることで変更が反映されるので問題なく作業できますし、vscode上で解決できない操作はサービスコンテナに対して `docker exec` などで直接操作もできます。\n\n```plantuml\n@startuml\n!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0\n!includeurl ICONURL/common.puml\n!includeurl ICONURL/devicons2/windows8_original.puml\n!includeurl ICONURL/devicons2/visualstudio.puml\n!includeurl ICONURL/devicons2/docker.puml\n\nDEV2_VISUALSTUDIO(vscode,\"\",rectangle,#0078d7) #ffffe0\nDEV2_WINDOWS8_ORIGINAL(windows,\"\",rectangle,#00e0e0) #ffffe0 {\n    agent \"ワークスペース\\non Windows\" as ws\n}\nDEV2_DOCKER(docker,\"\",rectangle,#0db7ed) #ffffe0 {\n    agent \"サービスコンテナ\" as svc\n}\n\nvscode -\u003e ws : open\nws -\u003e svc : docker exec\n@enduml\n```\n\n## ワークスペースをWindows =\u003e devcontainerへ\n\nWindowsにワークスペースを配置することで、\n\n- Docker関連のコマンドや周辺のCUIツールはWindows用でそろえる必要がある\n- ワークスペースのシェルはPowerShellかbatになる\n    - bashとかzshが動かない(git bashは挙動がやや残念、、)\n    - コンテナ内ではUnix系シェルなので操作やスクリプトが統一できない\n\nという別の課題が出てきました。\n\nこの点を解消するためには、ワークスペースをUnix系に配置する必要があります。\nvscodeではRemote Developmentを使うとワークスペースをDockerコンテナ(devcontainer)上に構築できます。\nこの際、デフォルトではvscodeのプロジェクト(.devcontainerの一つ上のディレクトリ)がワークスペースとしてdevcontainer上にマウントされるので、あえてコンテナ内に作業用のファイルを配置する必要がなくほぼ透過的にコンテナ内でファイルを操作できます。\n\n```plantuml\n@startuml\n!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0\n!includeurl ICONURL/common.puml\n!includeurl ICONURL/devicons2/windows8_original.puml\n!includeurl ICONURL/devicons2/visualstudio.puml\n!includeurl ICONURL/devicons2/docker.puml\n\nDEV2_WINDOWS8_ORIGINAL(windows,\"\",rectangle,#00e0e0) #ffffe0 {\n    agent \"ワークスペース\\non Windows\" as wsh\n}\nDEV2_VISUALSTUDIO(vscode,\"\",rectangle,#0078d7) #ffffe0 {\n    component \"Remote Developemnt\" as dev\n}\nDEV2_DOCKER(docker,\"\",rectangle,#0db7ed) #ffffe0 {\n    agent \"ワークスペース\\non devcontainer\" as wsc\n    agent \"サービスコンテナ\" as svc\n}\n\nwsh -\u003e dev\ndev -\u003e wsc : mount\nwsc .\u003e svc : ???\n@enduml\n```\n\n:::note info\nRemote Development経由でdevcontainerのワークスペースをvscodeで開いた場合、gitの認証情報はホストでの情報を引き継いで利用できるようです。\n\n```bash:devcontainer上ではcredential.helperは関数で定義されている\n$ git config --global -l | grep credential\ncredential.helper=!f() { /home/vscode/.vscode-server/bin/e7f30e38c5a4efafeec8ad52861eb772a9ee4dfb/node /tmp/vscode-remote-containers-3cf86db779288bfea4d1bb570de933a68c3055de.js $*; }; f\n```\n\n仕組みとしてはおそらく上記のところで、認証処理をRemote Containersの拡張機能に含まれるスクリプトに紐付けてホストの認証情報に問い合わせてるのだと思われます。\nちなみに私の環境ではpushの際に以下のエラーが出ていますが、特にpushが失敗するわけでもないので今のところは手当していません。\n\n```bash:git pushでエラーが出ているがその後問題なくリモートに反映されている\n$ git push\n\u003c3\u003einit: (1388) ERROR: UtilConnectUnix:467: connect failed 111\n\u003c3\u003einit: (1391) ERROR: UtilConnectUnix:467: connect failed 111\nEnumerating objects: 7, done.\nCounting objects: 100% (7/7), done.\nDelta compression using up to 8 threads\nCompressing objects: 100% (4/4), done.\nWriting objects: 100% (6/6), 1.04 KiB | 1.04 MiB/s, done.\nTotal 6 (delta 1), reused 0 (delta 0), pack-reused 0\nremote: Resolving deltas: 100% (1/1), completed with 1 local object.\nTo https://github.com/aaaaaaa/bbbbbb\n   04f2bcc..7749211  develop -\u003e develop\n```\n:::\n\n## devcontainerとサービスコンテナを同じネットワークで接続する\n\nさて、ワークスペースをUnix系に押し込めることに成功しましたが、このままだとdevcontainerからサービスコンテナに対して通信することができません。\n例えばmysqlのコンテナを立てた時にdevcontainer上から直接データをのぞいたり、ユニットテストがDBを触ることがあってもdevcontainer上で直接テストを行ったりしたいですよね？\ndevcontainerとサービスコンテナを通信できるようにするためにはdocker用のネットワークを作成し、それぞれのコンテナをネットワークでつなげてやる必要があります。\n\n```bash:local-nw の名称でネットワークを作成する\n$ docker network create local-nw\n```\n\nサービスコンテナの起動時にオプションでネットワークを指定することで、コンテナをネットワークに接続できます。\n\n```bash:mysqldをネットワークに接続して起動する\n$ docker run -d --name mysql --network=local-nw mysql:8.0 mysqld\n```\n\ndocker-composeを使う場合はexternal属性を指定することで作成済のネットワークを指定できます。\n\n```yaml\nservices:\n  mysql:\n    image: mysql:8.0\n    container_name: mysql\n    networks: local\n    command: mysqld\n\nnetworks:\n  local:\n    name: local-nw\n    external: true\n```\n\n```plantuml\n@startuml\n!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0\n!includeurl ICONURL/common.puml\n!includeurl ICONURL/devicons2/windows8_original.puml\n!includeurl ICONURL/devicons2/visualstudio.puml\n!includeurl ICONURL/devicons2/docker.puml\n\nDEV2_WINDOWS8_ORIGINAL(windows,\"\",rectangle,#00e0e0) #ffffe0 {\n    agent \"ワークスペース\\non Windows\" as wsh\n}\nDEV2_VISUALSTUDIO(vscode,\"\",rectangle,#0078d7) #ffffe0 {\n    component \"Remote Developemnt\" as dev\n}\nDEV2_DOCKER(docker,\"\",rectangle,#0db7ed) #ffffe0 {\n    agent \"ワークスペース\\non devcontainer\" as wsc\n    agent \"サービスコンテナ\" as svc\n}\n\nwsh - dev\ndev -\u003e wsc : mount\nwsc-\u003e svc : mysql\n@enduml\n```\n\n:::note warn\ndocker-compose内で作成したネットワークにdevcontainerを接続することも可能です。\nこの場合はdocker-composeのプロジェクトに連動してネットワークが作成されるため、事前に `docker network create` をしておく必要がありません。\n\n```yaml:docker-compose.yamlで新規にネットワークを定義\nnetworks:\n  local\n```\n\n```js:devcontainer.jsonではdocker-composeで構築したネットワークを参照\n// ネットワーク名はdocker-composeのプロジェクト名 + 内部で指定したネットワーク名になる\n{\n  \"runArgs\": [ \"--networks=hoge_local\" ]\n}\n```\n\nただしこの構成の場合は\n\n- devcontainer起動中に `docker-compose down` するとネットワーク削除がエラーになる\n    - ネットワークが消えないだけで特に実害はなさそうだが、、\n- `docker-compose up` でネットワークを作成してからでないとdevcontainerの起動ができない\n\nなどの問題があるため、 **個人的にはあまりお勧めしません。**\n\nただし、チーム開発などの場合は `docker-compose up` の前に `docker network create` が必要になるというのが、初期構築の際の負荷になる場合もあります。\n上記のようなデメリットがあることを理解した上であれば作業負荷を低減するために、devcontainerをdocker-compose上のネットワークに接続する構成というのも選択肢の一つにはなりうることもあります。\n:::\n\n## ホスト側のワークスペースの配置パスをWindows =\u003e WSLへ\n\npythonやrubyなどスクリプトがそのまま動く言語ではdevcontainerのワークスペースと同じ階層をサービスコンテナにもマウントすることで編集内容をそのまま動作させることができますが、GoやTypeScriptなどのコンパイルやトランスパイルが必要な言語ではソースの編集後にもう一処理追加してやる必要があります。\nそしてソースを修正後のコンパイルは手動で実行するのではなく、Goの場合はair、TypeScriptの場合はdev-serverなどを用いていわゆるホットリロードによって対処することが多いと思います。\nUnix系環境ではホットリロードの仕組みをinotifyのファイルイベントをトリガーに動作する仕組みが多いですが、ここで問題になるのがWindowsからコンテナにマウントしたファイル群は編集してもinotifyのイベント通知が飛んできません。\n\n:::note info\nWindowsの制限と言うよりはWSL2の上drvfsを利用した際の制限。\nDocker Desktopを用いてWindows側のファイルをコンテナにマウントする場合、一度WSL上でdrvfsを用いて `/mnt/C` 配下に配置されるので、Docker側ではそのファイルパスをベースにマウントすることができます。\n:::\n\n:::note warn\nWSL1 + drvfsではinotifyの通知をサポートしていたようですが、WSL2では通知を受け取ることはありません。\n:::\n\nこの点を解消するためには、ワークスペースのファイルをWindows側のファイルパスに配置しない、つまりWSL側で `/mnt` 以外のパスに配置するようにします。\n具体的にはWindowsからは `\\\\wsl$\\[distribution name]` でWSLのディストリビューション配下のファイルパスにアクセスできるのでそこを経由してファイルを配置するか、WSLにログインして以下でファイルを移動することで実現します。\n\n```bash:WSL上でファイルを移動する\n# 権限によっては失敗するのでcpのほうがよいかも\n$ mv /mnt/C/Users/[user]/some-project /home/[user]/some-project\n```\n\nこのとき、WSL側でログインされるユーザーが操作できるパスにワークスペースのファイル群を配置する必要があります。\n\n```plantuml\n@startuml\n!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.4.0\n!includeurl ICONURL/common.puml\n!includeurl ICONURL/devicons2/ubuntu.puml\n!includeurl ICONURL/devicons2/visualstudio.puml\n!includeurl ICONURL/devicons2/docker.puml\n\nDEV2_UBUNTU(ubuntu,\"\",rectangle,#dd4814) #ffffe0 {\n    agent \"ワークスペース\\non ubuntu on WSL\" as wsh\n}\nDEV2_VISUALSTUDIO(vscode,\"\",rectangle,#0078d7) #ffffe0 {\n    component \"Remote Developemnt\" as dev\n}\nDEV2_DOCKER(docker,\"\",rectangle,#0db7ed) #ffffe0 {\n    agent \"ワークスペース\\non devcontainer\" as wsc\n    agent \"サービスコンテナ\" as svc\n}\n\nwsh - dev\ndev -\u003e wsc : mount\nwsc-\u003e svc : inotify\\nnotification\n@enduml\n```\n\n## devcontainerからdockerを操作できるようにする\n\nWSLからサービスコンテナにファイルをマウントすることで、inotifyの通知を受け取ることができるようになりました。\nこれで大体の作業はdevcontainer内で完結できるようになったのですが、今のところではコンテナのログを見たり作り直したりするのにはホストに切り替えて操作を行う必要があります。\nそのため、Dockerの操作についてもdevcontainer内で行えるようにしていきます。\n\n### Dockerクライアントのインストール\n\nまず、dockerコマンドとdocker-composeコマンドをdevcontainer内で利用できるようにクライアントをインストールします。\ndevcontainerのOSとしてDebian以外を選択した場合はgpgの周りを適宜調整してください。\n(Ubuntuで構築したなら `debian` となっている部分を `ubuntu` と変えれば動きます)\n\n\n```dockerfile:devcontainer用のDockerfileに記述する\n# dockerクライアントとdocker-composeをインストール\nRUN mkdir -p /etc/apt/keyrings \\\n    \u0026\u0026 curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg \\\n    \u0026\u0026 echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null \\\n    \u0026\u0026 apt update -y \u0026\u0026 apt autoremove -y \\\n    \u0026\u0026 apt install -y docker-ce-cli docker-compose-plugin\n\n# aptで取得されるdocker-composeは古いので新しいバージョンに置き換える\nARG DCVERSION=\"2.10.2\"\nENV DCURL=\"https://github.com/docker/compose/releases/download/v${DCVERSION}/docker-compose-linux-x86_64\"\nRUN curl -L ${DCURL} -o /usr/local/bin/docker-compose \u0026\u0026 chmod +x /usr/local/bin/docker-compose\n```\n\n### Dockerクライアントの通信先をホストのDockerデーモンに向ける\n\nDockerのデーモンが動いているのはdevcontainer内でなくWSL環境です。\nそのためDockerのクライアントが操作する先のデーモンをWSLに向けます。\nDockerのクライアントから外部のデーモンに通信するためにはデーモン側でTCP接続を許可してDOCKER_HOST環境変数を指定するのがオーソドックスですが、Dockerデーモン自体が稼働させているコンテナからホストのデーモンを操作する場合に限りDocker outside of Docker(DooD)という仕組みを使って簡易に対応できます。\n\n```js:devcontainer.jsonでホストのsockをコンテナにマウントすることでホストのデーモンと通信できる\n\t\"mounts\": [\n\t\t\"type=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock\"\n\t],\n```\n\n:::note warn\nDooDについて調べると\n```bash\ndocker run -v /var/run/docker:/var/run/docker ...\n```\nのように省略記法で説明されている場合がありますが、devcontainerで使う場合は `mounts` 要素は `--mount` オプションに相当するもので省略記法は使えないので注意してください。\n\nこれとは別にdocker-compose.yamlを用意してマウント定義をする場合は、volumesで定義することになるので省略記法での指定もできるようです。\n\n```yaml\nservices:\n  app:\n    volumes:\n      - /var/run/docker:/var/run/docker \n```\n:::\n\n### WSL上のワークスペースの配置をコンテナ内とそろうように移動する\n\nここまででdevcontainer内からの `docker-compose ps` や `docker-compose logs mysql` のコマンドは動くようになりますが、`docker-compose down` とした後に `docker-compose up (-d)` とするとコンテナが起動できないことがあり、起動してもコンテナ内の処理で失敗することがあります。\nここで失敗するのはホストから **相対パスで指定したパス** をマウントしている場合で、ワークスペースのパスがWSL上とdevcontainer上でずれているとdevcontainer上のdockerコマンドからはマウントすることができなくなります。\n(ここを後で強調して説明するために、前の手順ではあえて失敗するパスにワークスペースを配置していました)\n\nこの点を解消するためには、WSL上でのワークスペースのファイルをコンテナにマウントされた時と同じ配置になるように移動します。\ndevcontainerではデフォルトで `/workspaces/[プロジェクト名]` でワークスペースをマウントするので、WSL上でも同じように配置します。\n\n```bash:WSL上でプロジェクトの配置を変更する\n$ mv /home/[user]/some-project /workspaces/some-project\n```\n\n:::note warn\nもしWSL上でこのパスをすでに利用していた場合は、別のパスに配置した上でマウント先を変更する必要があります。\n\n```bash:WSL上で配置を変更する\n$ mv /home/[user]/some-project /dev-workspace/some-project\n```\n\n```js:devcontainer.jsonでワークスペースのマウント先と配置を変更する\n    \"workspaceMount\": \"src=/dev-workspace/some-project,target=/dev-workspace/some-project,type=bind\",\n    \"workspaceFolder\": \"/dev-workspace/some-project\"\n```\n\n:::\n\n# 最終的な設定ファイル\n\nこれらを踏まえてdevcontainerの環境を作った結果、以下のようになりました。\n\n```dockerfile:.devcontainer/Dockerfile\nARG GO_VERISION=\"1.19-bullseye\"\n\n# [Choice] Go version (use -bullseye variants on local arm64/Apple Silicon): 1, 1.19, 1.18, 1-bullseye, 1.19-bullseye, 1.18-bullseye, 1-buster, 1.19-buster, 1.18-buster\nFROM mcr.microsoft.com/vscode/devcontainers/go:0-${GO_VERISION}\n\n# [Choice] Node.js version: none, lts/*, 18, 16, 14\nARG NODE_VERSION=\"none\"\nRUN if [ \"${NODE_VERSION}\" != \"none\" ]; then su vscode -c \"umask 0002 \u0026\u0026 . /usr/local/share/nvm/nvm.sh \u0026\u0026 nvm install ${NODE_VERSION} 2\u003e\u00261\"; fi\n\n# [Optional] Uncomment this section to install additional OS packages.\nRUN apt update -y \\\n    \u0026\u0026 export DEBIAN_FRONTEND=noninteractive \\\n    \u0026\u0026 apt autoremove -y \\\n    \u0026\u0026 apt update -y \\\n    \u0026\u0026 apt -y install --no-install-recommends \\\n    curl \\\n    git \\\n    gnupg\n\n# Docker\nRUN mkdir -p /etc/apt/keyrings \\\n    \u0026\u0026 curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg \\\n    \u0026\u0026 echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null \\\n    \u0026\u0026 apt update -y \u0026\u0026 apt autoremove -y \\\n    \u0026\u0026 apt install -y docker-ce-cli docker-compose-plugin\n\n# docker-composeは古いので指定したバージョンに更新\nARG DCVERSION=\"2.10.2\"\nENV DCURL=\"https://github.com/docker/compose/releases/download/v${DCVERSION}/docker-compose-linux-x86_64\"\nRUN curl -L ${DCURL} -o /usr/local/bin/docker-compose \u0026\u0026 chmod +x /usr/local/bin/docker-compose\n\nUSER vscode\n```\n\n```js:.devcontainer/devcontainer.json\n{\n\t\"name\": \"Go\",\n\t\"build\": {\n\t\t\"dockerfile\": \"Dockerfile\",\n\t\t\"args\": {\n\t\t\t\"GO_VERISION\": \"1.19-bullseye\",\n\t\t\t\"NODE_VERSION\": \"18\"\n\t\t}\n\t},\n\t\"runArgs\": [\n\t\t\"--cap-add=SYS_PTRACE\",\n\t\t\"--security-opt\",\n\t\t\"seccomp=unconfined\",\n\t\t\"--network=local-nw\"\n\t],\n\t\"mounts\": [\n\t\t\"type=bind,src=/var/run/docker.sock,dst=/var/run/docker.sock\"\n\t],\n\t\"remoteUser\": \"vscode\"\n}\n```\n\n# 終わりに\n\n今までは同じワークスペースでも操作に応じてvscodeを複数開くと言ったことをやっていましたが、これでdevcontainerの起動だけをホスト側で行えばその他のことはdevcontainer内で完結できるようになりました。\nまだ作ったばかりで使用感は完全には測れていませんが、vscodeのプロセスが減らせてマシンが軽くなったのとコンテキストスイッチが減って集中が続くようになっただけでも、この構成にした甲斐はあるかなと感じています。\n\nもっとこう作った方がいいとかご意見ありましたらコメントいただければと思います。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:44:33+09:00","group":null,"id":"1987c843b616500100bb","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Windows","versions":[]},{"name":"Docker","versions":[]},{"name":"VSCode","versions":[]},{"name":"WSL2","versions":[]},{"name":"devcontainer","versions":[]}],"title":"Windows環境でdevcontainerにほぼ引き篭れる構成を作った","updated_at":"2022-09-18T20:54:52+09:00","url":"https://qiita.com/kitamin/items/1987c843b616500100bb","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":4,"github_login_name":"meian","id":"kitamin","items_count":31,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":75716,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/75716/profile-images/1473700245","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:15\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-3:120\"\u003eシングルノード構成のk8sは本番環境で使用しないので、マルチノードで構築してみたい。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"5:1-5:9\"\u003e\n\u003cspan id=\"環境\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境\u003c/h2\u003e\n\u003cp data-sourcepos=\"7:1-8:121\"\u003e複雑な環境だが、podmanでmaster及びnodeを構築してみる。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e31e7be302ea80d13bf8c1c417865d49f5806941/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3138333539392f66326434376535312d323537312d383130302d303865622d3237666439646430633638652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F183599%2Ff2d47e51-2571-8100-08eb-27fd9dd0c68e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2fc99e970fbb3166baf3455a6c20a67e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/183599/f2d47e51-2571-8100-08eb-27fd9dd0c68e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F183599%2Ff2d47e51-2571-8100-08eb-27fd9dd0c68e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c610c4a24d37e7d98a291956ef3d0bf4 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"10:1-10:9\"\u003e\n\u003cspan id=\"構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構築\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"11:1-11:10\"\u003e\n\u003cspan id=\"master\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#master\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003emaster\u003c/h3\u003e\n\u003cp data-sourcepos=\"13:1-13:66\"\u003epodman buildでエラー終了してしまった。原因調査中\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"15:1-19:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eSTEP 26/29: systemctl enable kubelet\nERRO[0008] +(UNHANDLED LOGLEVEL) \u0026amp;imagebuilder.Step{Env:[]string{\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", \"container=podman\"}, Command:\"systemctl\", Args:[]string{\"\"}, Flags:[]string{}, Attrs:map[string]bool(nil), Message:\"SYSTEMCTL \", Original:\"systemctl enable kubelet\"}\nError: error building at STEP \"SYSTEMCTL \": Build error: Unknown instruction: \"SYSTEMCTL\" \u0026amp;imagebuilder.Step{Env:[]string{\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", \"container=podman\"}, Command:\"systemctl\", Args:[]string{\"\"}, Flags:[]string{}, Attrs:map[string]bool(nil), Message:\"SYSTEMCTL \", Original:\"systemctl enable kubelet\"}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"21:1-21:111\"\u003e\u003ca href=\"https://github.com/Kon-y/study_k8s/blob/main/podmanfile_for_k8s_master\" rel=\"nofollow noopener\" target=\"_blank\"\u003epodmanfile\u003c/a\u003eはgithubにuploadした。\u003c/p\u003e\n","body":"## はじめに\n\nシングルノード構成のk8sは本番環境で使用しないので、マルチノードで構築してみたい。\n\n## 環境\n\n複雑な環境だが、podmanでmaster及びnodeを構築してみる。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/183599/f2d47e51-2571-8100-08eb-27fd9dd0c68e.png)\n\n## 構築\n### master\n\npodman buildでエラー終了してしまった。原因調査中\n\n```\nSTEP 26/29: systemctl enable kubelet\nERRO[0008] +(UNHANDLED LOGLEVEL) \u0026imagebuilder.Step{Env:[]string{\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", \"container=podman\"}, Command:\"systemctl\", Args:[]string{\"\"}, Flags:[]string{}, Attrs:map[string]bool(nil), Message:\"SYSTEMCTL \", Original:\"systemctl enable kubelet\"}\nError: error building at STEP \"SYSTEMCTL \": Build error: Unknown instruction: \"SYSTEMCTL\" \u0026imagebuilder.Step{Env:[]string{\"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\", \"container=podman\"}, Command:\"systemctl\", Args:[]string{\"\"}, Flags:[]string{}, Attrs:map[string]bool(nil), Message:\"SYSTEMCTL \", Original:\"systemctl enable kubelet\"}\n```\n\n[podmanfile](https://github.com/Kon-y/study_k8s/blob/main/podmanfile_for_k8s_master)はgithubにuploadした。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:40:03+09:00","group":null,"id":"3c84fd239b7949c9f0fa","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Windows","versions":[]},{"name":"kubernetes","versions":[]},{"name":"Podman","versions":[]},{"name":"WSL2","versions":[]}],"title":"podmanでk8sクラスタを構築してみよう。","updated_at":"2022-09-18T21:54:05+09:00","url":"https://qiita.com/nok-ay/items/3c84fd239b7949c9f0fa","user":{"description":"nok-ayです。\r\n自分の投稿が皆様に気に入られたら幸甚です。","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":null,"id":"nok-ay","items_count":3,"linkedin_id":"","location":"","name":"nok ay","organization":"PLC","permanent_id":183599,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/183599/profile-images/1507901767","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:28\"\u003e\n\u003cspan id=\"はじめにintroduction\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%ABintroduction\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに(Introduction)\u003c/h1\u003e\n\u003cp data-sourcepos=\"3:1-3:59\"\u003eN4910  Working Draft, Standard for Programming Language C++\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:65\"\u003e\u003cqiita-embed-ogp src=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4910.pdf\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-9:141\"\u003eC++ n4910は、ISO/IEC JTC1 SC22 WG21の作業原案(Working Draft)です。\u003cbr\u003e\n公式のISO/IEC 14882原本ではありません。\u003cbr\u003e\nISO/IEC JTC1 SC22 のWG21を含むいくつかのWGでは、可能な限り作業文書を公開し、幅広い意見を求めています。\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-11:452\"\u003eISO/IEC JTC1 SC7からISO/IEC JTC1 SC22リエゾンとして、2000年頃、C/C++の品質向上に貢献しようとした活動をしていたことがあります。その頃は、まだISO/IEC TS 17961の原案が出る前です。Cの精神が優勢で、セキュリティ対策は補助的な位置付けでした。ISO/IEC TS 17961の制定と、C/C++のライブラリ類の見直しと、C++の進化はどんどん進んでいきます。　\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-13:444\"\u003e進化の具合が、どちらに行こうとしているかは、コンパイルて実行させてみないとわかりません。C/C++の規格案の電子ファイルは、そのままコンパイルできる形式であるとよいと主張してきました。MISRA-C/C++, CERTC/C++でも同様です。MISRA-C/C++は、Example Suiteという形で、コード断片をコンパイルできる形で提供するようになりました。\u003c/p\u003e\n\u003cp data-sourcepos=\"15:1-17:102\"\u003e一連の記事はコード断片をコンパイルできる形にする方法を検討してコンパイル、リンク、実行して、規格案の原文と処理系(g++, Clang++)との違いを確認し、技術内容を検討し、ISO/IEC JTC1 SC22 WG21にフィードバックするために用います。\u003cbr\u003e\nまた、CERT C++, MISRA C++等のコーディング標準のコード断片をコンパイルする際の参考にさせていただこうと考えています。CERT C++, MISRA C++が標準化の動きとの時間的なずれがあれば確認できれば幸いです。また、boostライブラリとの関連、Linux OS, 箱庭プロジェクト、g++(GCC), clang++(LLVM）との関係も調査中です。\u003cbr\u003e\n何か、抜け漏れ、耳より情報がありましたらおしらせくださると幸いです。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"19:1-19:22\"\u003e\n\u003cspan id=\"背景back-ground\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%83%8C%E6%99%AFback-ground\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e背景(back ground)\u003c/h2\u003e\n\u003cp data-sourcepos=\"20:1-22:336\"\u003eC/C++でコンパイルエラーが出ると、途方にくれることがしばしばあります。\u003cbr\u003e\n何回かに１回は、該当するエラーが検索できます。\u003cbr\u003e\nただ、条件が違っていて、そこでの修正方法では目的を達成しないこともしばしばです。いろいろな条件のコンパイルエラーとその対応方法について、広く記録することによって、いつか同じエラーに遭遇した時にやくに立つことを目指しています。\u003c/p\u003e\n\u003cp data-sourcepos=\"24:1-25:192\"\u003eこの半年の間で、三度、自分のネットでの記録に助けられたことがあります。\u003cbr\u003e\nまた過去に解決できなかった記録を１０種類以上、最近になって解決できたことがあります。それは、主に次の３つの情報に基づいています。\u003c/p\u003e\n\u003cp data-sourcepos=\"27:1-27:25\"\u003e\u003cqiita-embed-ogp src=\"https://stackoverflow.com\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"29:1-29:27\"\u003e\u003cqiita-embed-ogp src=\"http://ja.cppreference.com/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"31:1-31:41\"\u003ecpprefjp - C++日本語リファレンス\u003c/p\u003e\n\u003cp data-sourcepos=\"33:1-33:27\"\u003e\u003cqiita-embed-ogp src=\"https://cpprefjp.github.io/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"35:1-35:30\"\u003eコンパイラの実装状況\u003c/p\u003e\n\u003cp data-sourcepos=\"37:1-37:53\"\u003e\u003cqiita-embed-ogp src=\"https://cpprefjp.github.io/implementation-status.html\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"39:1-41:60\"\u003eまた\u003cbr\u003e\n\u003ca href=\"https://researchmap.jp/joub9b3my-1797580/#_1797580\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://researchmap.jp/joub9b3my-1797580/#_1797580\u003c/a\u003e\u003cbr\u003e\nに記載したサイトのお世話になっています。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"43:1-43:25\"\u003e\n\u003cspan id=\"作業方針sequence\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%9C%E6%A5%AD%E6%96%B9%E9%87%9Dsequence\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e作業方針(sequence)\u003c/h2\u003e\n\u003cp data-sourcepos=\"44:1-46:24\"\u003eClang++では-std=c++03, C++2bの2種類\u003cbr\u003e\ng++では-std=c++03, c++2bの２種類\u003cbr\u003e\nでコンパイルし、\u003c/p\u003e\n\u003cp data-sourcepos=\"48:1-55:207\"\u003e１）コンパイルエラーを収集する。\u003cbr\u003e\n２）コンパイルエラーをなくす方法を検討する。\u003cbr\u003e\nコンパイルエラーになる例を示すだけが目的のコードは、コンパイルエラーをなくすのではなく、コンパイルエラーの種類を収集するだけにする。\u003cbr\u003e\n文法を示すのが目的のコード場合に、コンパイルエラーをなくすのに手間がかかる場合は、順次作業します。\u003cbr\u003e\n３）リンクエラーをなくす方法を検討する。\u003cbr\u003e\n文法を示すのが目的のコード場合に、リンクエラーをなくすのに手間がかかる場合は、順次作業します。\u003cbr\u003e\n４）意味のある出力を作る。\u003cbr\u003e\nコンパイル、リンクが通っても、意味のある出力を示そうとすると、コンパイル・リンクエラーが出て収拾できそうにない場合がある。順次作業します。\u003c/p\u003e\n\u003cp data-sourcepos=\"57:1-57:222\"\u003e１）だけのものから４）まで進んだものと色々ある状態です。一歩でも前に進むご助言をお待ちしています。「検討事項」の欄に現状を記録するようにしています。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"59:1-59:85\"\u003e\n\u003cspan id=\"cn49102022-standard-working-draft-on-isoiec-148820-sample-code-compile-list\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cn49102022-standard-working-draft-on-isoiec-148820-sample-code-compile-list\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++N4910:2022 Standard Working Draft on ISO/IEC 14882(0) sample code compile list\u003c/h3\u003e\n\u003cp data-sourcepos=\"61:1-61:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/fc957ddddd402004bb91\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"macOS\" data-sourcepos=\"63:1-65:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebash\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ docker run -v /Users/ogawakiyoshi/n4910:/Users/ogawakiyoshi/n4910 -it kaizenjapan/n4910 /bin/bash\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"67:1-67:83\"\u003e\n\u003cspan id=\"cn4741-2018-standard-working-draft-on-isoiec-14882-sample-code-compile-list\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cn4741-2018-standard-working-draft-on-isoiec-14882-sample-code-compile-list\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++N4741, 2018 Standard Working Draft on ISO/IEC 14882 sample code compile list\u003c/h3\u003e\n\u003cp data-sourcepos=\"68:1-68:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/3294c014044550896010\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"70:1-70:69\"\u003e\n\u003cspan id=\"cn4606-2016符号断片編纂一覧example-code-compile-list\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cn4606-2016%E7%AC%A6%E5%8F%B7%E6%96%AD%E7%89%87%E7%B7%A8%E7%BA%82%E4%B8%80%E8%A6%A7example-code-compile-list\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++N4606, 2016符号断片編纂一覧(example code compile list)\u003c/h3\u003e\n\u003cp data-sourcepos=\"71:1-72:59\"\u003eC++N4606, 2016 Working Draft 2016, ISO/IEC 14882, C++ standard(1) Example code compile list\u003cbr\u003e\n\u003ca href=\"https://qiita.com/kaizen_nagoya/items/df5d62c35bd6ed1c3d43/\" class=\"autolink\"\u003ehttps://qiita.com/kaizen_nagoya/items/df5d62c35bd6ed1c3d43/\u003c/a\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"74:1-74:62\"\u003e\n\u003cspan id=\"cn3242-2011-sample-code-compile-list-on-clang-and-g\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cn3242-2011-sample-code-compile-list-on-clang-and-g\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++N3242, 2011 sample code compile list on clang++ and g++\u003c/h3\u003e\n\u003cp data-sourcepos=\"75:1-75:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/685b5c1a2c17c1bf1318\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"77:1-77:18\"\u003e\n\u003cspan id=\"読書感想文\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%AA%AD%E6%9B%B8%E6%84%9F%E6%83%B3%E6%96%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e読書感想文\u003c/h2\u003e\n\u003cp data-sourcepos=\"79:1-79:89\"\u003eCコンパイラによるC言語規格の読書感想文として掲載しています。\u003c/p\u003e\n\u003cp data-sourcepos=\"81:1-81:141\"\u003eコンパイル実験が、C++N4910に対する、G++とClang++による感想文だということご理解いただけると幸いです。\u003c/p\u003e\n\u003cp data-sourcepos=\"83:1-85:150\"\u003e読書感想文は人間かAIだけが作るものとは限りません。\u003cbr\u003e\n本（電子書籍を含む）を入力として、その内容に対する文字列を読書感想文として受け止めましょう。\u003cbr\u003e\n元の文章をあり方、コンパイルできるように電子化しておくこと、コンパイラが解釈可能な断片の作り方など。\u003c/p\u003e\n\u003cp data-sourcepos=\"87:1-87:38\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/tags/%E8%AA%AD%E6%9B%B8%E6%84%9F%E6%83%B3%E6%96%87\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"89:1-89:15\"\u003e\n\u003cspan id=\"個人開発\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%80%8B%E4%BA%BA%E9%96%8B%E7%99%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e個人開発\u003c/h2\u003e\n\u003cp data-sourcepos=\"91:1-91:109\"\u003eCコンパイラの試験を一人でもくもくとやっているのは個人開発の一つの姿です。\u003c/p\u003e\n\u003cp data-sourcepos=\"93:1-93:35\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/tags/%E5%80%8B%E4%BA%BA%E9%96%8B%E7%99%BA\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"95:2-95:60\"\u003e\u0026lt;この項は書きかけです。順次追記します。\u0026gt;\u003c/p\u003e\n\u003ch2 data-sourcepos=\"97:1-97:22\"\u003e\n\u003cspan id=\"編纂器compiler\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B7%A8%E7%BA%82%E5%99%A8compiler\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e編纂器(Compiler)\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"98:1-98:21\"\u003e\n\u003cspan id=\"clang---version\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#clang---version\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eclang++ --version\u003c/h3\u003e\n\u003ch5 data-sourcepos=\"99:1-99:22\"\u003e\n\u003cspan id=\"20220826-以前\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#20220826-%E4%BB%A5%E5%89%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20220826 以前\u003c/h5\u003e\n\u003cblockquote data-sourcepos=\"100:1-101:72\"\u003e\n\u003cp data-sourcepos=\"100:3-101:72\"\u003eDebian clang version 14.0.5-++20220610033153+c12386ae247c-1~exp1~20220610153237.151\u003cbr\u003e\nTarget: x86_64-pc-linux-gnu, Thread model: posix, InstalledDir: /usr/bin\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch5 data-sourcepos=\"103:1-103:21\"\u003e\n\u003cspan id=\"20220827-以降\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#20220827-%E4%BB%A5%E9%99%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e20220827 以降\u003c/h5\u003e\n\u003cblockquote data-sourcepos=\"104:1-105:72\"\u003e\n\u003cp data-sourcepos=\"104:3-105:72\"\u003eDebian clang version 14.0.6-++20220622053050+f28c006a5895-1~exp1~20220622173135.152\u003cbr\u003e\nTarget: x86_64-pc-linux-gnu　Thread model: posix InstalledDir: /usr/bin\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 data-sourcepos=\"107:1-107:18\"\u003e\n\u003cspan id=\"g----version\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#g----version\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eg++- --version\u003c/h3\u003e\n\u003cblockquote data-sourcepos=\"108:1-110:75\"\u003e\n\u003cp data-sourcepos=\"108:3-110:75\"\u003eg++ (GCC) 12.1.0  Copyright (C) 2022 Free Software Foundation, Inc.\u003cbr\u003e\nThis is free software; see the source for copying conditions. There is NO\u003cbr\u003e\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 data-sourcepos=\"112:1-112:69\"\u003e\n\u003cspan id=\"323-header--synopsis-resyn-cn49102022-698-p1628cpp\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#323-header--synopsis-resyn-cn49102022-698-p1628cpp\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e32.3 Header  synopsis [re.syn] C++N4910:2022 (698) p1628.cpp\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"114:1-114:22\"\u003e\n\u003cspan id=\"算譜source-code\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AE%97%E8%AD%9Csource-code\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e算譜(source code)\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"c++\" data-sourcepos=\"116:1-345:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ep1628.cpp\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// C++N4910 Committee Draft, Standard for Programming Language C++\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4910.pdf\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003en4910\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"32.3 Header \u0026lt;regex\u0026gt; synopsis [re.syn] C++N4910:2022 (698) p1628.cpp\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Debian clang version 14.0.5-++20220610033153+c12386ae247c-\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// g++ (GCC) 12.1.0 Copyright (C) 2022 Free Software Foundation, Inc.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Edited by Dr. OGAWA Kiyoshi. Compile procedure and results record.\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// C++N4910:2022 Standard Working Draft on ISO/IEC 14882(0) sample code compile list\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// https://qiita.com/kaizen_nagoya/items/fc957ddddd402004bb91\u003c/span\u003e\n\n\u003cspan class=\"cp\"\u003e#include \"N4910.h\"\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 32.3 Header \u0026lt;regex\u0026gt; synopsis [re.syn]\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#include \u0026lt;compare\u0026gt; // see 17.11.1 \n#include \u0026lt;initializer_list\u0026gt; // see 17.10.2\n\u003c/span\u003e\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.4, regex constants\u003c/span\u003e\n\u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003esyntax_option_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eerror_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.5, class regex_error\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eregex_error\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.6, class template regex_traits\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eregex_traits\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.7, class template basic_regex\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eregex\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewregex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.7.6, basic_regex swap\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eswap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.8, class template sub_match\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003esub_match\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ecsub_match\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewcsub_match\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003essub_match\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewssub_match\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewstring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.8.3, sub_match non-member operators\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;=\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;=\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;=\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                 \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;=\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003elhs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                 \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003erhs\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"n\"\u003ebasic_ostream\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebasic_ostream\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBiIter\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.9, class template match_results\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eallocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\n                                     \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ecmatch\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewcmatch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003esmatch\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewsmatch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewstring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// match_results comparisons\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                         \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.9.8, match_results swap\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eswap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                   \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.10.2, function template regex_match\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                        \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                        \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_match\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                          \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.10.3, function template regex_search\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                   \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_search\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                                   \u003cspan class=\"n\"\u003eAllocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                           \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e\n                           \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.10.4, function template regex_replace\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOutputIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                  \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eOutputIterator\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eregex_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOutputIterator\u003c/span\u003e \u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eOutputIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eOutputIterator\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eregex_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eOutputIterator\u003c/span\u003e \u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e \u003cspan class=\"n\"\u003elast\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eFSA\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eregex_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eFSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eregex_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSA\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eregex_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eSA\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003ebasic_string\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eregex_replace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebasic_regex\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etraits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                       \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_flag_type\u003c/span\u003e \u003cspan class=\"n\"\u003eflags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_constants\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_default\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.11.1, class template regex_iterator\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                  \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"nc\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                  \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eregex_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ecregex_iterator\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewcregex_iterator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003esregex_iterator\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewsregex_iterator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewstring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 32.11.2, class template regex_token_iterator\u003c/span\u003e\n         \u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                  \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003echarT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"nc\"\u003eiterator_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                  \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etraits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_traits\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003echarT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eregex_token_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ecregex_token_iterator\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_token_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewcregex_token_iterator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_token_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003esregex_token_iterator\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_token_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewsregex_token_iterator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eregex_token_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewstring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n         \u003cspan class=\"k\"\u003enamespace\u003c/span\u003e \u003cspan class=\"n\"\u003epmr\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                   \u003cspan class=\"n\"\u003epolymorphic_allocator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003esub_match\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBidirectionalIterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                   \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ecmatch\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                   \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewcmatch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                   \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003esmatch\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                   \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ewsmatch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematch_results\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewstring\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003econst_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecout\u003c/span\u003e  \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e  \u003cspan class=\"n\"\u003en4910\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n          \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eEXIT_SUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"347:1-347:40\"\u003e\n\u003cspan id=\"編纂実行結果compile-and-go\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B7%A8%E7%BA%82%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9Ccompile-and-go\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e編纂・実行結果(compile and go)\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"ubuntu\" data-sourcepos=\"349:1-1161:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ebash\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ clang++ p1628.cpp -std=03 -o p1628l -I. -Wall\nIn file included from p1628.cpp:10:\nIn file included from ./N4910.h:11:\nIn file included from /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/atomic:38:\n/usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/bits/c++0x_warning.h:32:2: error: This file requires compiler and library support for the ISO C++ 2011 standard. This support must be enabled with the -std=c++11 or -std=gnu++11 compiler options.\n#error This file requires compiler and library support \\\n ^\np1628.cpp:20:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing syntax_option_type = T1; \n                           ^\np1628.cpp:20:28: error: unknown type name 'T1'\np1628.cpp:21:25: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing match_flag_type = T2; \n                        ^\np1628.cpp:21:25: error: unknown type name 'T2'\np1628.cpp:22:20: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing error_type = T3;\n                   ^\np1628.cpp:22:20: error: unknown type name 'T3'\np1628.cpp:29:56: error: a space is required between consecutive right angle brackets (use '\u0026gt; \u0026gt;')\ntemplate\u0026lt;class charT, class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt; class basic_regex;\n                                                       ^~\n                                                       \u0026gt; \u0026gt;\np1628.cpp:30:23: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using regex  = basic_regex\u0026lt;char\u0026gt;;\n                      ^\np1628.cpp:31:23: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using wregex = basic_regex\u0026lt;wchar_t\u0026gt;;\n                      ^\np1628.cpp:38:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using csub_match  = sub_match\u0026lt;const char*\u0026gt;;\n                           ^\np1628.cpp:39:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using wcsub_match = sub_match\u0026lt;const wchar_t*\u0026gt;;\n                           ^\np1628.cpp:40:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using ssub_match  = sub_match\u0026lt;string::const_iterator\u0026gt;;\n                           ^\np1628.cpp:41:21: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing wssub_match = sub_match\u0026lt;wstring::const_iterator\u0026gt;;\n                    ^\np1628.cpp:46:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs, const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; rhs);\n  ^\np1628.cpp:46:16: warning: '\u0026lt;=\u0026gt;' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs, const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; rhs);\n               ^\n                  \np1628.cpp:46:8: error: 'operator\u0026lt;=' cannot be the name of a variable or data member\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs, const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; rhs);\n       ^\np1628.cpp:46:18: error: expected ';' at end of declaration\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs, const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; rhs);\n                 ^\n                 ;\np1628.cpp:46:18: error: expected unqualified-id\np1628.cpp:52:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u0026lt;=\u0026gt;(\n  ^\np1628.cpp:52:16: warning: '\u0026lt;=\u0026gt;' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u0026lt;=\u0026gt;(\n               ^\n                  \np1628.cpp:52:8: error: 'operator\u0026lt;=' cannot be the name of a variable or data member\n  auto operator\u0026lt;=\u0026gt;(\n       ^\np1628.cpp:52:18: error: expected ';' at end of declaration\n  auto operator\u0026lt;=\u0026gt;(\n                 ^\n                 ;\np1628.cpp:52:18: error: expected unqualified-id\np1628.cpp:59:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n  ^\np1628.cpp:59:16: warning: '\u0026lt;=\u0026gt;' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n               ^\n                  \np1628.cpp:59:8: error: 'operator\u0026lt;=' cannot be the name of a variable or data member\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n       ^\np1628.cpp:59:18: error: expected ';' at end of declaration\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n                 ^\n                 ;\np1628.cpp:59:18: error: expected unqualified-id\np1628.cpp:65:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n  ^\np1628.cpp:65:16: warning: '\u0026lt;=\u0026gt;' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n               ^\n                  \np1628.cpp:65:8: error: 'operator\u0026lt;=' cannot be the name of a variable or data member\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n       ^\np1628.cpp:65:18: error: expected ';' at end of declaration\n  auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n                 ^\n                 ;\np1628.cpp:65:18: error: expected unqualified-id\np1628.cpp:72:69: error: a space is required between consecutive right angle brackets (use '\u0026gt; \u0026gt;')\n         class Allocator = allocator\u0026lt;sub_match\u0026lt;BidirectionalIterator\u0026gt;\u0026gt;\u0026gt;\n                                                                    ^~\n                                                                    \u0026gt; \u0026gt; \np1628.cpp:74:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing cmatch  = match_results\u0026lt;const char*\u0026gt;;\n                ^\np1628.cpp:75:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing wcmatch = match_results\u0026lt;const wchar_t*\u0026gt;;\n                ^\np1628.cpp:76:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing smatch  = match_results\u0026lt;string::const_iterator\u0026gt;;\n                ^\np1628.cpp:77:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing wsmatch = match_results\u0026lt;wstring::const_iterator\u0026gt;;\n                ^\np1628.cpp:91:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n21 warnings and 20 errors generated.\n$ clang++ p1628.cpp -std=2b -o p1628l -I. -Wall\np1628.cpp:20:28: error: unknown type name 'T1'\nusing syntax_option_type = T1; \n                           ^\np1628.cpp:21:25: error: unknown type name 'T2'\nusing match_flag_type = T2; \n                        ^\np1628.cpp:22:20: error: unknown type name 'T3'\nusing error_type = T3;\n                   ^\np1628.cpp:91:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:91:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:95:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:95:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:99:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:99:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:105:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:105:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:111:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type = regex_constants::match_default) = delete;\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:111:72: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type = regex_constants::match_default) = delete;\n                                                      ~~~~~~~~~~~~~~~~~^\np1628.cpp:115:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:115:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:119:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:119:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:125:38: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                    regex_constants::match_flag_type flags = regex_constants::match_default);\n                    ~~~~~~~~~~~~~~~~~^\np1628.cpp:125:79: error: no member named 'match_default' in namespace 'std::regex_constants'\n                    regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                             ~~~~~~~~~~~~~~~~~^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n20 errors generated.\n\n$ g++ p1628.cpp -std=03 -o p1628g -I. -Wall\nIn file included from /usr/local/include/c++/12.1.0/atomic:38,\n                 from N4910.h:11,\n                 from p1628.cpp:10:\n/usr/local/include/c++/12.1.0/bits/c++0x_warning.h:32:2: error: #error This file requires compiler and library support for the ISO C++ 2011 standard. This support must be enabled with the -std=c++11 or -std=gnu++11 compiler options.\n   32 | #error This file requires compiler and library support \\\n      |  ^~~~~\np1628.cpp:20:7: error: expected nested-name-specifier before 'syntax_option_type'\n   20 | using syntax_option_type = T1;\n      |       ^~~~~~~~~~~~~~~~~~\np1628.cpp:21:7: error: expected nested-name-specifier before 'match_flag_type'\n   21 | using match_flag_type = T2;\n      |       ^~~~~~~~~~~~~~~\np1628.cpp:22:7: error: expected nested-name-specifier before 'error_type'\n   22 | using error_type = T3;\n      |       ^~~~~~~~~~\np1628.cpp:29:56: error: spurious '\u0026gt;\u0026gt;', use '\u0026gt;' to terminate a template argument list\n   29 | template\u0026lt;class charT, class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt; class basic_regex;\n      |                                                        ^~\np1628.cpp:29:38: error: two or more data types in declaration of 'type name'\n   29 | template\u0026lt;class charT, class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt; class basic_regex;\n      |                                      ^~~~~~~~~~~~~~~~~~~~\np1628.cpp:29:76: error: expected '\u0026gt;' before ';' token\n   29 | template\u0026lt;class charT, class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt; class basic_regex;\n      |                                                                            ^\np1628.cpp:29:76: error: expected unqualified-id before ';' token\np1628.cpp:30:14: error: expected nested-name-specifier before 'regex'\n   30 |        using regex  = basic_regex\u0026lt;char\u0026gt;;\n      |              ^~~~~\np1628.cpp:31:14: error: expected nested-name-specifier before 'wregex'\n   31 |        using wregex = basic_regex\u0026lt;wchar_t\u0026gt;;\n      |              ^~~~~~\np1628.cpp:34:20: error: 'std::basic_regex' is not a template\n   34 |          void swap(basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e1, basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e2);\n      |                    ^~~~~~~~~~~\np1628.cpp:34:52: error: 'std::basic_regex' is not a template\n   34 |          void swap(basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e1, basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e2);\n      |                                                    ^~~~~~~~~~~\np1628.cpp:38:14: error: expected nested-name-specifier before 'csub_match'\n   38 |        using csub_match  = sub_match\u0026lt;const char*\u0026gt;;\n      |              ^~~~~~~~~~\np1628.cpp:39:14: error: expected nested-name-specifier before 'wcsub_match'\n   39 |        using wcsub_match = sub_match\u0026lt;const wchar_t*\u0026gt;;\n      |              ^~~~~~~~~~~\np1628.cpp:40:14: error: expected nested-name-specifier before 'ssub_match'\n   40 |        using ssub_match  = sub_match\u0026lt;string::const_iterator\u0026gt;;\n      |              ^~~~~~~~~~\np1628.cpp:41:7: error: expected nested-name-specifier before 'wssub_match'\n   41 | using wssub_match = sub_match\u0026lt;wstring::const_iterator\u0026gt;;\n      |       ^~~~~~~~~~~\np1628.cpp:46:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   46 |   auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs, const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; rhs);\n      |   ^~~~\n      |   ----\np1628.cpp:46:8: error: 'operator\u0026lt;=' does not name a type; did you mean 'iterator'?\n   46 |   auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs, const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; rhs);\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:52:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   52 |   auto operator\u0026lt;=\u0026gt;(\n      |   ^~~~\n      |   ----\np1628.cpp:52:8: error: 'operator\u0026lt;=' does not name a type; did you mean 'iterator'?\n   52 |   auto operator\u0026lt;=\u0026gt;(\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:59:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   59 |   auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n      |   ^~~~\n      |   ----\np1628.cpp:59:8: error: 'operator\u0026lt;=' does not name a type; did you mean 'iterator'?\n   59 |   auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:65:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   65 |   auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n      |   ^~~~\n      |   ----\np1628.cpp:65:8: error: 'operator\u0026lt;=' does not name a type; did you mean 'iterator'?\n   65 |   auto operator\u0026lt;=\u0026gt;(const sub_match\u0026lt;BiIter\u0026gt;\u0026amp; lhs,\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:72:69: error: '\u0026gt;\u0026gt;' should be '\u0026gt; \u0026gt;' within a nested template argument list\n   72 |          class Allocator = allocator\u0026lt;sub_match\u0026lt;BidirectionalIterator\u0026gt;\u0026gt;\u0026gt;\n      |                                                                     ^~\n      |                                                                     \u0026gt; \u0026gt;\np1628.cpp:74:7: error: expected nested-name-specifier before 'cmatch'\n   74 | using cmatch  = match_results\u0026lt;const char*\u0026gt;;\n      |       ^~~~~~\np1628.cpp:75:7: error: expected nested-name-specifier before 'wcmatch'\n   75 | using wcmatch = match_results\u0026lt;const wchar_t*\u0026gt;;\n      |       ^~~~~~~\np1628.cpp:76:7: error: expected nested-name-specifier before 'smatch'\n   76 | using smatch  = match_results\u0026lt;string::const_iterator\u0026gt;;\n      |       ^~~~~~\np1628.cpp:77:7: error: expected nested-name-specifier before 'wsmatch'\n   77 | using wsmatch = match_results\u0026lt;wstring::const_iterator\u0026gt;;\n      |       ^~~~~~~\np1628.cpp:90:26: error: 'std::basic_regex' is not a template\n   90 |                    const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                          ^~~~~~~~~~~\np1628.cpp:91:37: error: 'std::regex_constants::match_flag_type' has not been declared\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:91:78: error: 'match_default' is not a member of 'std::regex_constants'\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:94:26: error: 'std::basic_regex' is not a template\n   94 |                    const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                          ^~~~~~~~~~~\np1628.cpp:95:37: error: 'std::regex_constants::match_flag_type' has not been declared\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:95:78: error: 'match_default' is not a member of 'std::regex_constants'\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:98:26: error: 'std::basic_regex' is not a template\n   98 |                    const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                          ^~~~~~~~~~~\np1628.cpp:99:37: error: 'std::regex_constants::match_flag_type' has not been declared\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:99:78: error: 'match_default' is not a member of 'std::regex_constants'\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:104:26: error: 'std::basic_regex' is not a template\n  104 |                    const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                          ^~~~~~~~~~~\np1628.cpp:105:37: error: 'std::regex_constants::match_flag_type' has not been declared\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:105:78: error: 'match_default' is not a member of 'std::regex_constants'\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:107:53: error: expected ',' or '...' before '\u0026amp;\u0026amp;' token\n  107 |   bool regex_match(const basic_string\u0026lt;charT, ST, SA\u0026gt;\u0026amp;\u0026amp;,\n      |                                                     ^~\np1628.cpp:111:89: warning: defaulted and deleted functions only available with '-std=c++11' or '-std=gnu++11' [-Wc++11-extensions]\n  111 |                    regex_constants::match_flag_type = regex_constants::match_default) = delete;\n      |                                                                                         ^~~~~~\np1628.cpp:114:26: error: 'std::basic_regex' is not a template\n  114 |                    const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                          ^~~~~~~~~~~\np1628.cpp:115:37: error: 'std::regex_constants::match_flag_type' has not been declared\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:115:78: error: 'match_default' is not a member of 'std::regex_constants'\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:118:26: error: 'std::basic_regex' is not a template\n  118 |                    const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                          ^~~~~~~~~~~\np1628.cpp:119:37: error: 'std::regex_constants::match_flag_type' has not been declared\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:119:78: error: 'match_default' is not a member of 'std::regex_constants'\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:124:27: error: 'std::basic_regex' is not a template\n  124 |                     const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                           ^~~~~~~~~~~\np1628.cpp:125:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:125:79: error: 'match_default' is not a member of 'std::regex_constants'\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:128:27: error: 'std::basic_regex' is not a template\n  128 |                     const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                           ^~~~~~~~~~~\np1628.cpp:129:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:129:79: error: 'match_default' is not a member of 'std::regex_constants'\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:133:27: error: 'std::basic_regex' is not a template\n  133 |                     const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                           ^~~~~~~~~~~\np1628.cpp:134:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:134:79: error: 'match_default' is not a member of 'std::regex_constants'\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:137:27: error: 'std::basic_regex' is not a template\n  137 |                     const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                           ^~~~~~~~~~~\np1628.cpp:138:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:138:79: error: 'match_default' is not a member of 'std::regex_constants'\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:141:27: error: 'std::basic_regex' is not a template\n  141 |                     const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                           ^~~~~~~~~~~\np1628.cpp:142:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:142:79: error: 'match_default' is not a member of 'std::regex_constants'\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:147:27: error: 'std::basic_regex' is not a template\n  147 |                     const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                           ^~~~~~~~~~~\np1628.cpp:148:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:148:79: error: 'match_default' is not a member of 'std::regex_constants'\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:150:54: error: expected ',' or '...' before '\u0026amp;\u0026amp;' token\n  150 |   bool regex_search(const basic_string\u0026lt;charT, ST, SA\u0026gt;\u0026amp;\u0026amp;,\n      |                                                      ^~\np1628.cpp:155:59: warning: defaulted and deleted functions only available with '-std=c++11' or '-std=gnu++11' [-Wc++11-extensions]\n  155 |                       = regex_constants::match_default) = delete;\n      |                                                           ^~~~~~\np1628.cpp:162:25: error: 'std::basic_regex' is not a template\n  162 |                   const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                         ^~~~~~~~~~~\np1628.cpp:164:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:164:77: error: 'match_default' is not a member of 'std::regex_constants'\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:169:25: error: 'std::basic_regex' is not a template\n  169 |                   const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                         ^~~~~~~~~~~\np1628.cpp:171:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:171:77: error: 'match_default' is not a member of 'std::regex_constants'\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:175:25: error: 'std::basic_regex' is not a template\n  175 |                   const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                         ^~~~~~~~~~~\np1628.cpp:177:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:177:77: error: 'match_default' is not a member of 'std::regex_constants'\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:181:25: error: 'std::basic_regex' is not a template\n  181 |                   const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                         ^~~~~~~~~~~\np1628.cpp:183:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:183:77: error: 'match_default' is not a member of 'std::regex_constants'\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:187:25: error: 'std::basic_regex' is not a template\n  187 |                   const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                         ^~~~~~~~~~~\np1628.cpp:189:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:189:77: error: 'match_default' is not a member of 'std::regex_constants'\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:193:25: error: 'std::basic_regex' is not a template\n  193 |                   const basic_regex\u0026lt;charT, traits\u0026gt;\u0026amp; e,\n      |                         ^~~~~~~~~~~\np1628.cpp:195:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:195:77: error: 'match_default' is not a member of 'std::regex_constants'\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:199:44: error: spurious '\u0026gt;\u0026gt;', use '\u0026gt;' to terminate a template argument list\n  199 |           class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt;\n      |                                            ^~\np1628.cpp:199:26: error: two or more data types in declaration of 'type name'\n  199 |           class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt;\n      |                          ^~~~~~~~~~~~~~~~~~~~\np1628.cpp:200:23: error: expected '\u0026gt;' before ';' token\n  200 |   class regex_iterator;\n      |                       ^\np1628.cpp:200:23: error: expected unqualified-id before ';' token\np1628.cpp:201:7: error: expected nested-name-specifier before 'cregex_iterator'\n  201 | using cregex_iterator  = regex_iterator\u0026lt;const char*\u0026gt;;\n      |       ^~~~~~~~~~~~~~~\np1628.cpp:202:7: error: expected nested-name-specifier before 'wcregex_iterator'\n  202 | using wcregex_iterator = regex_iterator\u0026lt;const wchar_t*\u0026gt;;\n      |       ^~~~~~~~~~~~~~~~\np1628.cpp:203:7: error: expected nested-name-specifier before 'sregex_iterator'\n  203 | using sregex_iterator  = regex_iterator\u0026lt;string::const_iterator\u0026gt;;\n      |       ^~~~~~~~~~~~~~~\np1628.cpp:204:7: error: expected nested-name-specifier before 'wsregex_iterator'\n  204 | using wsregex_iterator = regex_iterator\u0026lt;wstring::const_iterator\u0026gt;;\n      |       ^~~~~~~~~~~~~~~~\np1628.cpp:208:44: error: spurious '\u0026gt;\u0026gt;', use '\u0026gt;' to terminate a template argument list\n  208 |           class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt;\n      |                                            ^~\np1628.cpp:208:26: error: two or more data types in declaration of 'type name'\n  208 |           class traits = regex_traits\u0026lt;charT\u0026gt;\u0026gt;\n      |                          ^~~~~~~~~~~~~~~~~~~~\np1628.cpp:209:29: error: expected '\u0026gt;' before ';' token\n  209 |   class regex_token_iterator;\n      |                             ^\np1628.cpp:209:29: error: expected unqualified-id before ';' token\np1628.cpp:210:7: error: expected nested-name-specifier before 'cregex_token_iterator'\n  210 | using cregex_token_iterator  = regex_token_iterator\u0026lt;const char*\u0026gt;;\n      |       ^~~~~~~~~~~~~~~~~~~~~\np1628.cpp:211:7: error: expected nested-name-specifier before 'wcregex_token_iterator'\n  211 | using wcregex_token_iterator = regex_token_iterator\u0026lt;const wchar_t*\u0026gt;;\n      |       ^~~~~~~~~~~~~~~~~~~~~~\np1628.cpp:212:7: error: expected nested-name-specifier before 'sregex_token_iterator'\n  212 | using sregex_token_iterator  = regex_token_iterator\u0026lt;string::const_iterator\u0026gt;;\n      |       ^~~~~~~~~~~~~~~~~~~~~\np1628.cpp:213:7: error: expected nested-name-specifier before 'wsregex_token_iterator'\n  213 | using wsregex_token_iterator = regex_token_iterator\u0026lt;wstring::const_iterator\u0026gt;;\n      |       ^~~~~~~~~~~~~~~~~~~~~~\np1628.cpp:216:7: error: expected unqualified-id before 'using'\n  216 |       using match_results =\n      |       ^~~~~\np1628.cpp:219:11: error: expected nested-name-specifier before 'cmatch'\n  219 |     using cmatch  = match_results\u0026lt;const char*\u0026gt;;\n      |           ^~~~~~\np1628.cpp:220:11: error: expected nested-name-specifier before 'wcmatch'\n  220 |     using wcmatch = match_results\u0026lt;const wchar_t*\u0026gt;;\n      |           ^~~~~~~\np1628.cpp:221:11: error: expected nested-name-specifier before 'smatch'\n  221 |     using smatch  = match_results\u0026lt;string::const_iterator\u0026gt;;\n      |           ^~~~~~\np1628.cpp:222:11: error: expected nested-name-specifier before 'wsmatch'\n  222 |     using wsmatch = match_results\u0026lt;wstring::const_iterator\u0026gt;;\n      |           ^~~~~~~\n\n$ g++ p1628.cpp -std=2b -o p1628g -I. -Wall\np1628.cpp:20:28: error: 'T1' does not name a type\n   20 | using syntax_option_type = T1;\n      |                            ^~\np1628.cpp:21:25: error: 'T2' does not name a type\n   21 | using match_flag_type = T2;\n      |                         ^~\np1628.cpp:22:20: error: 'T3' does not name a type\n   22 | using error_type = T3;\n      |                    ^~\np1628.cpp:91:20: error: 'std::regex_constants::match_flag_type' has not been declared\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:91:78: error: 'match_default' is not a member of 'std::regex_constants'\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:95:20: error: 'std::regex_constants::match_flag_type' has not been declared\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:95:78: error: 'match_default' is not a member of 'std::regex_constants'\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:99:20: error: 'std::regex_constants::match_flag_type' has not been declared\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:99:78: error: 'match_default' is not a member of 'std::regex_constants'\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:105:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:105:78: error: 'match_default' is not a member of 'std::regex_constants'\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:111:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  111 |                    regex_constants::match_flag_type = regex_constants::match_default) = delete;\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:111:72: error: 'match_default' is not a member of 'std::regex_constants'\n  111 |                    regex_constants::match_flag_type = regex_constants::match_default) = delete;\n      |                                                                        ^~~~~~~~~~~~~\np1628.cpp:115:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:115:78: error: 'match_default' is not a member of 'std::regex_constants'\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:119:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:119:78: error: 'match_default' is not a member of 'std::regex_constants'\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:125:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:125:79: error: 'match_default' is not a member of 'std::regex_constants'\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:129:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:129:79: error: 'match_default' is not a member of 'std::regex_constants'\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:134:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:134:79: error: 'match_default' is not a member of 'std::regex_constants'\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:138:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:138:79: error: 'match_default' is not a member of 'std::regex_constants'\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:142:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:142:79: error: 'match_default' is not a member of 'std::regex_constants'\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:148:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:148:79: error: 'match_default' is not a member of 'std::regex_constants'\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:154:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  154 |                     regex_constants::match_flag_type\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:155:42: error: 'match_default' is not a member of 'std::regex_constants'\n  155 |                       = regex_constants::match_default) = delete;\n      |                                          ^~~~~~~~~~~~~\np1628.cpp:164:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:164:77: error: 'match_default' is not a member of 'std::regex_constants'\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:171:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:171:77: error: 'match_default' is not a member of 'std::regex_constants'\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:177:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:177:77: error: 'match_default' is not a member of 'std::regex_constants'\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:183:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:183:77: error: 'match_default' is not a member of 'std::regex_constants'\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:189:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:189:77: error: 'match_default' is not a member of 'std::regex_constants'\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:195:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:195:77: error: 'match_default' is not a member of 'std::regex_constants'\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\nIn file included from /usr/local/include/c++/12.1.0/string:53,\n                 from /usr/local/include/c++/12.1.0/bits/locale_classes.h:40,\n                 from /usr/local/include/c++/12.1.0/bits/ios_base.h:41,\n                 from /usr/local/include/c++/12.1.0/ios:42,\n                 from /usr/local/include/c++/12.1.0/ostream:38,\n                 from /usr/local/include/c++/12.1.0/iostream:39,\n                 from N4910.h:2,\n                 from p1628.cpp:10:\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;':\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:89:31: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u0026lt;char\u0026gt;'\n   89 |         rebind\u0026lt;_CharT\u0026gt;::other _Char_alloc_type;\n      |                               ^~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u0026lt;char\u0026gt;'\n   61 |     template\u0026lt;typename _Tp\u0026gt; class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:50:   required from 'class std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;'\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:113:16: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u0026lt;char\u0026gt;'\n  113 |         struct _Alloc_traits_impl\u0026lt;char_traits\u0026lt;_CharT\u0026gt;, _Dummy_for_PR85282\u0026gt;\n      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u0026lt;char\u0026gt;'\n   61 |     template\u0026lt;typename _Tp\u0026gt; class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;':\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:57: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  127 |       typedef typename _Alloc_traits::size_type         size_type;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:128:57: error: no type named 'difference_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  128 |       typedef typename _Alloc_traits::difference_type   difference_type;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:129:57: error: no type named 'reference' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  129 |       typedef typename _Alloc_traits::reference         reference;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:130:57: error: no type named 'const_reference' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  130 |       typedef typename _Alloc_traits::const_reference   const_reference;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:131:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  131 |       typedef typename _Alloc_traits::pointer           pointer;\n      |                                                         ^~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:132:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  132 |       typedef typename _Alloc_traits::const_pointer     const_pointer;\n      |                                                         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:133:68: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  133 |       typedef __gnu_cxx::__normal_iterator\u0026lt;pointer, basic_string\u0026gt;  iterator;\n      |                                                                    ^~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:135:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  135 |                                                         const_iterator;\n      |                                                         ^~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:136:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  136 |       typedef std::reverse_iterator\u0026lt;const_iterator\u0026gt;     const_reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:137:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n  137 |       typedef std::reverse_iterator\u0026lt;iterator\u0026gt;           reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~\nIn file included from /usr/local/include/c++/12.1.0/ext/alloc_traits.h:34,\n                 from /usr/local/include/c++/12.1.0/bits/basic_string.h:40:\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h: In substitution of 'template\u0026lt;class _Alloc\u0026gt; using _RequireAllocator = typename std::enable_if\u0026lt;std::__is_allocator\u0026lt;_Alloc\u0026gt;::value, _Alloc\u0026gt;::type [with _Alloc = std::pmr::polymorphic_allocator\u0026lt;char\u0026gt;]':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:634:7:   required from 'class std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;'\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h:807:11: error: no type named 'type' in 'struct std::enable_if\u0026lt;false, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;'\n  807 |     using _RequireAllocator\n      |           ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;':\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2634:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n 2634 |         find(const _Tp\u0026amp; __svt, size_type __pos = 0) const\n      |         ^~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2700:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n 2700 |         rfind(const _Tp\u0026amp; __svt, size_type __pos = npos) const\n      |         ^~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2785:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n 2785 |         find_first_of(const _Tp\u0026amp; __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2874:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n 2874 |         find_last_of(const _Tp\u0026amp; __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2962:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n 2962 |         find_first_not_of(const _Tp\u0026amp; __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:3049:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;char, std::char_traits\u0026lt;char\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;char\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;char\u0026gt;, void\u0026gt;'\n 3049 |         find_last_not_of(const _Tp\u0026amp; __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~~~~~\np1628.cpp:221:57: error: template argument 1 is invalid\n  221 |     using smatch  = match_results\u0026lt;string::const_iterator\u0026gt;;\n      |                                                         ^\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;':\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:89:31: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt;'\n   89 |         rebind\u0026lt;_CharT\u0026gt;::other _Char_alloc_type;\n      |                               ^~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt;'\n   61 |     template\u0026lt;typename _Tp\u0026gt; class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:50:   required from 'class std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;'\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:113:16: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt;'\n  113 |         struct _Alloc_traits_impl\u0026lt;char_traits\u0026lt;_CharT\u0026gt;, _Dummy_for_PR85282\u0026gt;\n      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt;'\n   61 |     template\u0026lt;typename _Tp\u0026gt; class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;':\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:57: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  127 |       typedef typename _Alloc_traits::size_type         size_type;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:128:57: error: no type named 'difference_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  128 |       typedef typename _Alloc_traits::difference_type   difference_type;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:129:57: error: no type named 'reference' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  129 |       typedef typename _Alloc_traits::reference         reference;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:130:57: error: no type named 'const_reference' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  130 |       typedef typename _Alloc_traits::const_reference   const_reference;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:131:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  131 |       typedef typename _Alloc_traits::pointer           pointer;\n      |                                                         ^~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:132:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  132 |       typedef typename _Alloc_traits::const_pointer     const_pointer;\n      |                                                         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:133:68: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  133 |       typedef __gnu_cxx::__normal_iterator\u0026lt;pointer, basic_string\u0026gt;  iterator;\n      |                                                                    ^~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:135:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  135 |                                                         const_iterator;\n      |                                                         ^~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:136:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  136 |       typedef std::reverse_iterator\u0026lt;const_iterator\u0026gt;     const_reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:137:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n  137 |       typedef std::reverse_iterator\u0026lt;iterator\u0026gt;           reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h: In substitution of 'template\u0026lt;class _Alloc\u0026gt; using _RequireAllocator = typename std::enable_if\u0026lt;std::__is_allocator\u0026lt;_Alloc\u0026gt;::value, _Alloc\u0026gt;::type [with _Alloc = std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt;]':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:634:7:   required from 'class std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;'\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h:807:11: error: no type named 'type' in 'struct std::enable_if\u0026lt;false, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;'\n  807 |     using _RequireAllocator\n      |           ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;':\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2634:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n 2634 |         find(const _Tp\u0026amp; __svt, size_type __pos = 0) const\n      |         ^~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2700:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n 2700 |         rfind(const _Tp\u0026amp; __svt, size_type __pos = npos) const\n      |         ^~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2785:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n 2785 |         find_first_of(const _Tp\u0026amp; __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2874:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n 2874 |         find_last_of(const _Tp\u0026amp; __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2962:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n 2962 |         find_first_not_of(const _Tp\u0026amp; __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:3049:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u0026lt;wchar_t, std::char_traits\u0026lt;wchar_t\u0026gt;, std::pmr::polymorphic_allocator\u0026lt;wchar_t\u0026gt; \u0026gt;::_Alloc_traits_impl\u0026lt;std::char_traits\u0026lt;wchar_t\u0026gt;, void\u0026gt;'\n 3049 |         find_last_not_of(const _Tp\u0026amp; __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~~~~~\np1628.cpp:222:58: error: template argument 1 is invalid\n  222 |     using wsmatch = match_results\u0026lt;wstring::const_iterator\u0026gt;;\n      |     \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"1163:1-1163:22\"\u003e\n\u003cspan id=\"検討事項agenda\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A4%9C%E8%A8%8E%E4%BA%8B%E9%A0%85agenda\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e検討事項(agenda)\u003c/h1\u003e\n\u003cp data-sourcepos=\"1164:1-1164:90\"\u003eコンパイルエラーを取るか、コンパイルエラーの理由を解説する。\u003c/p\u003e\n\n\u003ch2 data-sourcepos=\"1169:1-1169:27\"\u003e\n\u003cspan id=\"応用例1autosar-c\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B1autosar-c\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例1　AUTOSAR C++\u003c/h2\u003e\n\u003cp data-sourcepos=\"1171:1-1172:119\"\u003eAUTOSARでC++のコーディング標準を作っている。　\u003cbr\u003e\nMISRA-C++コーディング標準の改訂をまたずに、C++14に対応したかったためかもしれない。　\u003c/p\u003e\n\u003cp data-sourcepos=\"1174:1-1174:50\"\u003eAutosar Guidelines C++14 example code compile list\u003c/p\u003e\n\u003cp data-sourcepos=\"1176:1-1176:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/8ccbf6675c3494d57a76\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1178:1-1178:34\"\u003eMISRA C++, AUTOSAR C++について\u003c/p\u003e\n\u003cp data-sourcepos=\"1180:1-1180:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/3436fbd49865e0da7d35\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"1182:1-1182:27\"\u003e\n\u003cspan id=\"応用例2misra-cc\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B2misra-cc\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例2　MISRA C/C++\u003c/h2\u003e\n\u003cp data-sourcepos=\"1184:1-1184:38\"\u003eMISRA C まとめ #include \u003c/p\u003e\n\u003cp data-sourcepos=\"1186:1-1186:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/f1a79a7cbd281607c7c9\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1188:1-1188:16\"\u003eMISRA C++ 5-0-16\u003c/p\u003e\n\u003cp data-sourcepos=\"1190:1-1190:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/7df2d4e05db724752a74\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"1192:1-1192:24\"\u003e\n\u003cspan id=\"応用例3-cert-cc\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B3-cert-cc\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例3 CERT C/C++\u003c/h2\u003e\n\u003cp data-sourcepos=\"1194:1-1194:58\"\u003eSEI CERT C++ Coding Standard AA. Bibliography 確認中。\u003c/p\u003e\n\u003cp data-sourcepos=\"1196:1-1196:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/fe06719aef10f3f985ae\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1198:1-1198:80\"\u003eMISRA C/C++, AUTOSAR C++, CERT C/C++とC/C++工業標準をコンパイルする\u003c/p\u003e\n\u003cp data-sourcepos=\"1200:1-1200:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/8dff19511e42b2593db1\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"1202:1-1202:23\"\u003e\n\u003cspan id=\"応用例4-箱庭\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%9C%E7%94%A8%E4%BE%8B4-%E7%AE%B1%E5%BA%AD\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e応用例4 箱庭　\u003c/h2\u003e\n\u003cp data-sourcepos=\"1203:2-1203:23\"\u003e箱庭もくもく会\u003c/p\u003e\n\u003cp data-sourcepos=\"1205:1-1205:29\"\u003e\u003cqiita-embed-ogp src=\"https://hakoniwa.connpass.com\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1207:1-1207:15\"\u003e第11回 未定\u003c/p\u003e\n\u003cp data-sourcepos=\"1209:1-1209:65\"\u003e箱庭ではUnityをはじめC++を使っているらしい。　\u003c/p\u003e\n\u003cp data-sourcepos=\"1211:1-1213:81\"\u003eここでコンパイルしたコードと同じようなコードを使っているか、\u003cbr\u003e\nここで出たコンパイルエラーと同じようなエラーがでたかを\u003cbr\u003e\nいろいろな版のコンパイラでコンパイルして確認していく。\u003c/p\u003e\n\u003cp data-sourcepos=\"1215:1-1217:80\"\u003eこの項目は、箱庭プロジェクトを市場分析の対象として、原則的には、箱庭プロジェクトの外部から分析し、外部から箱庭の広告宣伝のための戦略会議を仮想した結果、仮想「箱庭もくもく会」を開催してみることを企画するものである。　\u003cbr\u003e\n一切の内容は、箱庭プロジェクト、Athrill, TOPPERSとは無関係である。　\u003cbr\u003e\n一(いち)参加データアナリストの、個人的なつぶやきです。\u003c/p\u003e\n\u003cp data-sourcepos=\"1219:1-1219:30\"\u003e仮想戦略会議「箱庭」\u003c/p\u003e\n\u003cp data-sourcepos=\"1221:1-1221:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/73cb132707653176a461\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1223:1-1223:99\"\u003eお盆には「箱庭」記事を書きましょう「もくもく会」の題材になる（１）\u003c/p\u003e\n\u003cp data-sourcepos=\"1225:1-1225:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/a22bf2b1dab0ad3258d4\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1227:1-1227:97\"\u003eお盆には「箱庭」記事を書きましょう「もくもく会」の題材になる（2）\u003c/p\u003e\n\u003cp data-sourcepos=\"1229:1-1229:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/e3c0ceb2dcc9cf3f3fac\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"1232:1-1232:37\"\u003e\n\u003cspan id=\"自己参考資料self-reference\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%B7%B1%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99self-reference\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自己参考資料(self reference)\u003c/h2\u003e\n\u003cp data-sourcepos=\"1234:1-1234:66\"\u003e関連する自己参照以外は、こちらの先頭に移転。\u003c/p\u003e\n\u003cp data-sourcepos=\"1236:1-1236:65\"\u003eC言語（C++)に対する誤解、曲解、無理解、爽快。\u003c/p\u003e\n\u003cp data-sourcepos=\"1238:1-1238:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/3f3992c9722c1cee2e3a\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1240:1-1240:18\"\u003e#include \"N4910.h\"\u003c/p\u003e\n\u003cp data-sourcepos=\"1242:1-1242:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/163a47cef7d6bb1c33a8\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1244:1-1244:26\"\u003eC++N4910資料の改善点\u003c/p\u003e\n\u003cp data-sourcepos=\"1246:1-1246:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/fb4ceb5d117a54641af3\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1248:1-1248:14\"\u003edockerにclang\u003c/p\u003e\n\u003cp data-sourcepos=\"1250:1-1250:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/8829ffeee397eda50e80\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1252:1-1252:43\"\u003edocker gnu(gcc/g++) and llvm(clang/clang++)\u003c/p\u003e\n\u003cp data-sourcepos=\"1254:1-1254:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/059874ea39c4de64c0f7\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1256:1-1256:72\"\u003eコンパイル用shell script C版(clangとgcc)とC++版(clang++とg++)\u003c/p\u003e\n\u003cp data-sourcepos=\"1258:1-1258:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/74220c0577a512c2d7da\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1260:1-1260:84\"\u003eC++N4910:2022 tag follower 300人超えました。ありがとうございます。\u003c/p\u003e\n\u003cp data-sourcepos=\"1262:1-1262:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/a63fb96d351ac5c16ff7\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1264:1-1264:22\"\u003eastyle 使ってみた\u003c/p\u003e\n\u003cp data-sourcepos=\"1266:1-1266:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kaizen_nagoya/items/3c9a87a781d53a1a23f3\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"1268:2-1268:148\"\u003e＜この記事は個人の過去の経験に基づく個人の感想です。現在所属する組織、業務とは関係がありません。＞\u003c/p\u003e\n\u003ch1 data-sourcepos=\"1270:1-1270:32\"\u003e\n\u003cspan id=\"文書履歴document-history\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%87%E6%9B%B8%E5%B1%A5%E6%AD%B4document-history\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e文書履歴(document history)\u003c/h1\u003e\n\u003cp data-sourcepos=\"1271:1-1271:28\"\u003ever. 0.01 初稿 　20220918\u003c/p\u003e\n","body":"# はじめに(Introduction)\n\nN4910  Working Draft, Standard for Programming Language C++\n\nhttp://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4910.pdf\n\nC++ n4910は、ISO/IEC JTC1 SC22 WG21の作業原案(Working Draft)です。\n公式のISO/IEC 14882原本ではありません。\nISO/IEC JTC1 SC22 のWG21を含むいくつかのWGでは、可能な限り作業文書を公開し、幅広い意見を求めています。\n\nISO/IEC JTC1 SC7からISO/IEC JTC1 SC22リエゾンとして、2000年頃、C/C++の品質向上に貢献しようとした活動をしていたことがあります。その頃は、まだISO/IEC TS 17961の原案が出る前です。Cの精神が優勢で、セキュリティ対策は補助的な位置付けでした。ISO/IEC TS 17961の制定と、C/C++のライブラリ類の見直しと、C++の進化はどんどん進んでいきます。　\n\n進化の具合が、どちらに行こうとしているかは、コンパイルて実行させてみないとわかりません。C/C++の規格案の電子ファイルは、そのままコンパイルできる形式であるとよいと主張してきました。MISRA-C/C++, CERTC/C++でも同様です。MISRA-C/C++は、Example Suiteという形で、コード断片をコンパイルできる形で提供するようになりました。\n\n一連の記事はコード断片をコンパイルできる形にする方法を検討してコンパイル、リンク、実行して、規格案の原文と処理系(g++, Clang++)との違いを確認し、技術内容を検討し、ISO/IEC JTC1 SC22 WG21にフィードバックするために用います。\nまた、CERT C++, MISRA C++等のコーディング標準のコード断片をコンパイルする際の参考にさせていただこうと考えています。CERT C++, MISRA C++が標準化の動きとの時間的なずれがあれば確認できれば幸いです。また、boostライブラリとの関連、Linux OS, 箱庭プロジェクト、g++(GCC), clang++(LLVM）との関係も調査中です。\n何か、抜け漏れ、耳より情報がありましたらおしらせくださると幸いです。\n\n## 背景(back ground)\nC/C++でコンパイルエラーが出ると、途方にくれることがしばしばあります。\n何回かに１回は、該当するエラーが検索できます。\nただ、条件が違っていて、そこでの修正方法では目的を達成しないこともしばしばです。いろいろな条件のコンパイルエラーとその対応方法について、広く記録することによって、いつか同じエラーに遭遇した時にやくに立つことを目指しています。\n\nこの半年の間で、三度、自分のネットでの記録に助けられたことがあります。\nまた過去に解決できなかった記録を１０種類以上、最近になって解決できたことがあります。それは、主に次の３つの情報に基づいています。\n\nhttps://stackoverflow.com\n\nhttp://ja.cppreference.com/\n\ncpprefjp - C++日本語リファレンス\n\nhttps://cpprefjp.github.io/\n\nコンパイラの実装状況\n\nhttps://cpprefjp.github.io/implementation-status.html\n\nまた\nhttps://researchmap.jp/joub9b3my-1797580/#_1797580\nに記載したサイトのお世話になっています。\n\n## 作業方針(sequence)\nClang++では-std=c++03, C++2bの2種類\ng++では-std=c++03, c++2bの２種類\nでコンパイルし、\n\n１）コンパイルエラーを収集する。\n２）コンパイルエラーをなくす方法を検討する。\nコンパイルエラーになる例を示すだけが目的のコードは、コンパイルエラーをなくすのではなく、コンパイルエラーの種類を収集するだけにする。\n文法を示すのが目的のコード場合に、コンパイルエラーをなくすのに手間がかかる場合は、順次作業します。\n３）リンクエラーをなくす方法を検討する。\n文法を示すのが目的のコード場合に、リンクエラーをなくすのに手間がかかる場合は、順次作業します。\n４）意味のある出力を作る。\nコンパイル、リンクが通っても、意味のある出力を示そうとすると、コンパイル・リンクエラーが出て収拾できそうにない場合がある。順次作業します。\n\n１）だけのものから４）まで進んだものと色々ある状態です。一歩でも前に進むご助言をお待ちしています。「検討事項」の欄に現状を記録するようにしています。\n\n### C++N4910:2022 Standard Working Draft on ISO/IEC 14882(0) sample code compile list  \n\nhttps://qiita.com/kaizen_nagoya/items/fc957ddddd402004bb91\n\n```macOS:bash\n$ docker run -v /Users/ogawakiyoshi/n4910:/Users/ogawakiyoshi/n4910 -it kaizenjapan/n4910 /bin/bash\n```\n\n### C++N4741, 2018 Standard Working Draft on ISO/IEC 14882 sample code compile list\nhttps://qiita.com/kaizen_nagoya/items/3294c014044550896010\n\n### C++N4606, 2016符号断片編纂一覧(example code compile list)\nC++N4606, 2016 Working Draft 2016, ISO/IEC 14882, C++ standard(1) Example code compile list\nhttps://qiita.com/kaizen_nagoya/items/df5d62c35bd6ed1c3d43/\n\n### C++N3242, 2011 sample code compile list on clang++ and g++\nhttps://qiita.com/kaizen_nagoya/items/685b5c1a2c17c1bf1318\n\n## 読書感想文\n\nCコンパイラによるC言語規格の読書感想文として掲載しています。\n\nコンパイル実験が、C++N4910に対する、G++とClang++による感想文だということご理解いただけると幸いです。\n\n読書感想文は人間かAIだけが作るものとは限りません。\n本（電子書籍を含む）を入力として、その内容に対する文字列を読書感想文として受け止めましょう。\n元の文章をあり方、コンパイルできるように電子化しておくこと、コンパイラが解釈可能な断片の作り方など。\n\nhttps://qiita.com/tags/読書感想文\n\n## 個人開発\n\nCコンパイラの試験を一人でもくもくとやっているのは個人開発の一つの姿です。\n\nhttps://qiita.com/tags/個人開発\n\n \u003cこの項は書きかけです。順次追記します。\u003e\n\n## 編纂器(Compiler)\n### clang++ --version\n#####  20220826 以前\n\u003e Debian clang version 14.0.5-++20220610033153+c12386ae247c-1~exp1~20220610153237.151\nTarget: x86_64-pc-linux-gnu, Thread model: posix, InstalledDir: /usr/bin\n\n##### 20220827 以降\n\u003e Debian clang version 14.0.6-++20220622053050+f28c006a5895-1~exp1~20220622173135.152\nTarget: x86_64-pc-linux-gnu　Thread model: posix InstalledDir: /usr/bin\n\n### g++- --version\n\u003e g++ (GCC) 12.1.0  Copyright (C) 2022 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions. There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\n# 32.3 Header \u003cregex\u003e synopsis [re.syn] C++N4910:2022 (698) p1628.cpp\n\n## 算譜(source code)\n\n```c++:p1628.cpp\n// C++N4910 Committee Draft, Standard for Programming Language C++\n// http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/n4910.pdf\nconst char * n4910 = \"32.3 Header \u003cregex\u003e synopsis [re.syn] C++N4910:2022 (698) p1628.cpp\";\n// Debian clang version 14.0.5-++20220610033153+c12386ae247c-\n// g++ (GCC) 12.1.0 Copyright (C) 2022 Free Software Foundation, Inc.\n// Edited by Dr. OGAWA Kiyoshi. Compile procedure and results record.\n// C++N4910:2022 Standard Working Draft on ISO/IEC 14882(0) sample code compile list\n// https://qiita.com/kaizen_nagoya/items/fc957ddddd402004bb91\n\n#include \"N4910.h\"\n\nusing namespace std;\n\n// 32.3 Header \u003cregex\u003e synopsis [re.syn]\n#include \u003ccompare\u003e // see 17.11.1 \n#include \u003cinitializer_list\u003e // see 17.10.2\nnamespace std {\n// 32.4, regex constants\nnamespace regex_constants {\nusing syntax_option_type = T1;\nusing match_flag_type = T2;\nusing error_type = T3;\n}\n// 32.5, class regex_error\nclass regex_error;\n// 32.6, class template regex_traits\ntemplate\u003cclass charT\u003e struct regex_traits;\n// 32.7, class template basic_regex\ntemplate\u003cclass charT, class traits = regex_traits\u003ccharT\u003e\u003e class basic_regex;\nusing regex  = basic_regex\u003cchar\u003e;\nusing wregex = basic_regex\u003cwchar_t\u003e;\n// 32.7.6, basic_regex swap\ntemplate\u003cclass charT, class traits\u003e\nvoid swap(basic_regex\u003ccharT, traits\u003e\u0026 e1, basic_regex\u003ccharT, traits\u003e\u0026 e2);\n// 32.8, class template sub_match\ntemplate\u003cclass BidirectionalIterator\u003e\nclass sub_match;\nusing csub_match  = sub_match\u003cconst char*\u003e;\nusing wcsub_match = sub_match\u003cconst wchar_t*\u003e;\nusing ssub_match  = sub_match\u003cstring::const_iterator\u003e;\nusing wssub_match = sub_match\u003cwstring::const_iterator\u003e;\n// 32.8.3, sub_match non-member operators\ntemplate\u003cclass BiIter\u003e\nbool operator==(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\ntemplate\u003cclass BiIter\u003e\nauto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\ntemplate\u003cclass BiIter, class ST, class SA\u003e\nbool operator==(\n    const sub_match\u003cBiIter\u003e\u0026 lhs,\n    const basic_string\u003ctypename iterator_traits\u003cBiIter\u003e::value_type, ST, SA\u003e\u0026 rhs);\ntemplate\u003cclass BiIter, class ST, class SA\u003e\nauto operator\u003c=\u003e(\n    const sub_match\u003cBiIter\u003e\u0026 lhs,\n    const basic_string\u003ctypename iterator_traits\u003cBiIter\u003e::value_type, ST, SA\u003e\u0026 rhs);\ntemplate\u003cclass BiIter\u003e\nbool operator==(const sub_match\u003cBiIter\u003e\u0026 lhs,\n                const typename iterator_traits\u003cBiIter\u003e::value_type* rhs);\ntemplate\u003cclass BiIter\u003e\nauto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n                 const typename iterator_traits\u003cBiIter\u003e::value_type* rhs);\ntemplate\u003cclass BiIter\u003e\nbool operator==(const sub_match\u003cBiIter\u003e\u0026 lhs,\n                const typename iterator_traits\u003cBiIter\u003e::value_type\u0026 rhs);\ntemplate\u003cclass BiIter\u003e\nauto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n                 const typename iterator_traits\u003cBiIter\u003e::value_type\u0026 rhs);\ntemplate\u003cclass charT, class ST, class BiIter\u003e\nbasic_ostream\u003ccharT, ST\u003e\u0026\noperator\u003c\u003c(basic_ostream\u003ccharT, ST\u003e\u0026 os, const sub_match\u003cBiIter\u003e\u0026 m);\n// 32.9, class template match_results\ntemplate\u003cclass BidirectionalIterator,\n         class Allocator = allocator\u003csub_match\u003cBidirectionalIterator\u003e\u003e\u003e\n                                     class match_results;\n         using cmatch  = match_results\u003cconst char*\u003e;\n         using wcmatch = match_results\u003cconst wchar_t*\u003e;\n         using smatch  = match_results\u003cstring::const_iterator\u003e;\n         using wsmatch = match_results\u003cwstring::const_iterator\u003e;\n// match_results comparisons\n         template\u003cclass BidirectionalIterator, class Allocator\u003e\n         bool operator==(const match_results\u003cBidirectionalIterator, Allocator\u003e\u0026 m1,\n                         const match_results\u003cBidirectionalIterator, Allocator\u003e\u0026 m2);\n// 32.9.8, match_results swap\n         template\u003cclass BidirectionalIterator, class Allocator\u003e\n         void swap(match_results\u003cBidirectionalIterator, Allocator\u003e\u0026 m1,\n                   match_results\u003cBidirectionalIterator, Allocator\u003e\u0026 m2);\n// 32.10.2, function template regex_match\n         template\u003cclass BidirectionalIterator, class Allocator, class charT, class traits\u003e\n         bool regex_match(BidirectionalIterator first, BidirectionalIterator last,\n                          match_results\u003cBidirectionalIterator, Allocator\u003e\u0026 m,\n                          const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                          regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass BidirectionalIterator, class charT, class traits\u003e\n         bool regex_match(BidirectionalIterator first, BidirectionalIterator last,\n                          const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                          regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass charT, class Allocator, class traits\u003e\n         bool regex_match(const charT* str, match_results\u003cconst charT*, Allocator\u003e\u0026 m,\n                          const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                          regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass ST, class SA, class Allocator, class charT, class traits\u003e\n         bool regex_match(const basic_string\u003ccharT, ST, SA\u003e\u0026 s,\n                          match_results\u003ctypename basic_string\u003ccharT, ST, SA\u003e::const_iterator,\n                                        Allocator\u003e\u0026 m,\n                          const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                          regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass ST, class SA, class Allocator, class charT, class traits\u003e\n         bool regex_match(const basic_string\u003ccharT, ST, SA\u003e\u0026\u0026,\n                          match_results\u003ctypename basic_string\u003ccharT, ST, SA\u003e::const_iterator,\n                                        Allocator\u003e\u0026,\n                          const basic_regex\u003ccharT, traits\u003e\u0026,\n                          regex_constants::match_flag_type = regex_constants::match_default) = delete;\n         template\u003cclass charT, class traits\u003e\n         bool regex_match(const charT* str,\n                          const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                          regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass ST, class SA, class charT, class traits\u003e\n         bool regex_match(const basic_string\u003ccharT, ST, SA\u003e\u0026 s,\n                          const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                          regex_constants::match_flag_type flags = regex_constants::match_default);\n// 32.10.3, function template regex_search\n         template\u003cclass BidirectionalIterator, class Allocator, class charT, class traits\u003e\n         bool regex_search(BidirectionalIterator first, BidirectionalIterator last,\n                           match_results\u003cBidirectionalIterator, Allocator\u003e\u0026 m,\n                           const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                           regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass BidirectionalIterator, class charT, class traits\u003e\n         bool regex_search(BidirectionalIterator first, BidirectionalIterator last,\n                           const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                           regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass charT, class Allocator, class traits\u003e\n         bool regex_search(const charT* str,\n                           match_results\u003cconst charT*, Allocator\u003e\u0026 m,\n                           const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                           regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass charT, class traits\u003e\n         bool regex_search(const charT* str,\n                           const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                           regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass ST, class SA, class charT, class traits\u003e\n         bool regex_search(const basic_string\u003ccharT, ST, SA\u003e\u0026 s,\n                           const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                           regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass ST, class SA, class Allocator, class charT, class traits\u003e\n         bool regex_search(const basic_string\u003ccharT, ST, SA\u003e\u0026 s,\n                           match_results\u003ctypename basic_string\u003ccharT, ST, SA\u003e::const_iterator,\n                                   Allocator\u003e\u0026 m,\n                           const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                           regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass ST, class SA, class Allocator, class charT, class traits\u003e\n         bool regex_search(const basic_string\u003ccharT, ST, SA\u003e\u0026\u0026,\n                           match_results\u003ctypename basic_string\u003ccharT, ST, SA\u003e::const_iterator,\n                                   Allocator\u003e\u0026,\n                           const basic_regex\u003ccharT, traits\u003e\u0026,\n                           regex_constants::match_flag_type\n                           = regex_constants::match_default) = delete;\n// 32.10.4, function template regex_replace\n         template\u003cclass OutputIterator, class BidirectionalIterator,\n                  class traits, class charT, class ST, class SA\u003e\n         OutputIterator\n         regex_replace(OutputIterator out,\n                       BidirectionalIterator first, BidirectionalIterator last,\n                       const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                       const basic_string\u003ccharT, ST, SA\u003e\u0026 fmt,\n                       regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass OutputIterator, class BidirectionalIterator, class traits, class charT\u003e\n         OutputIterator\n         regex_replace(OutputIterator out,\n                       BidirectionalIterator first, BidirectionalIterator last,\n                       const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                       const charT* fmt,\n                       regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass traits, class charT, class ST, class SA, class FST, class FSA\u003e\n         basic_string\u003ccharT, ST, SA\u003e\n         regex_replace(const basic_string\u003ccharT, ST, SA\u003e\u0026 s,\n                       const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                       const basic_string\u003ccharT, FST, FSA\u003e\u0026 fmt,\n                       regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass traits, class charT, class ST, class SA\u003e\n         basic_string\u003ccharT, ST, SA\u003e\n         regex_replace(const basic_string\u003ccharT, ST, SA\u003e\u0026 s,\n                       const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                       const charT* fmt,\n                       regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass traits, class charT, class ST, class SA\u003e\n         basic_string\u003ccharT\u003e\n         regex_replace(const charT* s,\n                       const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                       const basic_string\u003ccharT, ST, SA\u003e\u0026 fmt,\n                       regex_constants::match_flag_type flags = regex_constants::match_default);\n         template\u003cclass traits, class charT\u003e\n         basic_string\u003ccharT\u003e\n         regex_replace(const charT* s,\n                       const basic_regex\u003ccharT, traits\u003e\u0026 e,\n                       const charT* fmt,\n                       regex_constants::match_flag_type flags = regex_constants::match_default);\n// 32.11.1, class template regex_iterator\n         template\u003cclass BidirectionalIterator,\n                  class charT = typename iterator_traits\u003cBidirectionalIterator\u003e::value_type,\n                  class traits = regex_traits\u003ccharT\u003e\u003e\n         class regex_iterator;\n         using cregex_iterator  = regex_iterator\u003cconst char*\u003e;\n         using wcregex_iterator = regex_iterator\u003cconst wchar_t*\u003e;\n         using sregex_iterator  = regex_iterator\u003cstring::const_iterator\u003e;\n         using wsregex_iterator = regex_iterator\u003cwstring::const_iterator\u003e;\n// 32.11.2, class template regex_token_iterator\n         template\u003cclass BidirectionalIterator,\n                  class charT = typename iterator_traits\u003cBidirectionalIterator\u003e::value_type,\n                  class traits = regex_traits\u003ccharT\u003e\u003e\n         class regex_token_iterator;\n         using cregex_token_iterator  = regex_token_iterator\u003cconst char*\u003e;\n         using wcregex_token_iterator = regex_token_iterator\u003cconst wchar_t*\u003e;\n         using sregex_token_iterator  = regex_token_iterator\u003cstring::const_iterator\u003e;\n         using wsregex_token_iterator = regex_token_iterator\u003cwstring::const_iterator\u003e;\n         namespace pmr {\ntemplate\u003cclass BidirectionalIterator\u003e\nusing match_results =\nstd::match_results\u003cBidirectionalIterator,\n                   polymorphic_allocator\u003csub_match\u003cBidirectionalIterator\u003e\u003e\u003e;\n                   using cmatch  = match_results\u003cconst char*\u003e;\n                   using wcmatch = match_results\u003cconst wchar_t*\u003e;\n                   using smatch  = match_results\u003cstring::const_iterator\u003e;\n                   using wsmatch = match_results\u003cwstring::const_iterator\u003e;\n}\n}\nint main() {\n    cout  \u003c\u003c  n4910 \u003c\u003c endl;\n          return EXIT_SUCCESS;\n}\n```\n\n## 編纂・実行結果(compile and go)\n\n```ubuntu:bash\n$ clang++ p1628.cpp -std=03 -o p1628l -I. -Wall\nIn file included from p1628.cpp:10:\nIn file included from ./N4910.h:11:\nIn file included from /usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/atomic:38:\n/usr/bin/../lib/gcc/x86_64-linux-gnu/10/../../../../include/c++/10/bits/c++0x_warning.h:32:2: error: This file requires compiler and library support for the ISO C++ 2011 standard. This support must be enabled with the -std=c++11 or -std=gnu++11 compiler options.\n#error This file requires compiler and library support \\\n ^\np1628.cpp:20:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing syntax_option_type = T1; \n                           ^\np1628.cpp:20:28: error: unknown type name 'T1'\np1628.cpp:21:25: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing match_flag_type = T2; \n                        ^\np1628.cpp:21:25: error: unknown type name 'T2'\np1628.cpp:22:20: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing error_type = T3;\n                   ^\np1628.cpp:22:20: error: unknown type name 'T3'\np1628.cpp:29:56: error: a space is required between consecutive right angle brackets (use '\u003e \u003e')\ntemplate\u003cclass charT, class traits = regex_traits\u003ccharT\u003e\u003e class basic_regex;\n                                                       ^~\n                                                       \u003e \u003e\np1628.cpp:30:23: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using regex  = basic_regex\u003cchar\u003e;\n                      ^\np1628.cpp:31:23: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using wregex = basic_regex\u003cwchar_t\u003e;\n                      ^\np1628.cpp:38:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using csub_match  = sub_match\u003cconst char*\u003e;\n                           ^\np1628.cpp:39:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using wcsub_match = sub_match\u003cconst wchar_t*\u003e;\n                           ^\np1628.cpp:40:28: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\n       using ssub_match  = sub_match\u003cstring::const_iterator\u003e;\n                           ^\np1628.cpp:41:21: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing wssub_match = sub_match\u003cwstring::const_iterator\u003e;\n                    ^\np1628.cpp:46:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\n  ^\np1628.cpp:46:16: warning: '\u003c=\u003e' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\n               ^\n                  \np1628.cpp:46:8: error: 'operator\u003c=' cannot be the name of a variable or data member\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\n       ^\np1628.cpp:46:18: error: expected ';' at end of declaration\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\n                 ^\n                 ;\np1628.cpp:46:18: error: expected unqualified-id\np1628.cpp:52:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u003c=\u003e(\n  ^\np1628.cpp:52:16: warning: '\u003c=\u003e' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u003c=\u003e(\n               ^\n                  \np1628.cpp:52:8: error: 'operator\u003c=' cannot be the name of a variable or data member\n  auto operator\u003c=\u003e(\n       ^\np1628.cpp:52:18: error: expected ';' at end of declaration\n  auto operator\u003c=\u003e(\n                 ^\n                 ;\np1628.cpp:52:18: error: expected unqualified-id\np1628.cpp:59:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n  ^\np1628.cpp:59:16: warning: '\u003c=\u003e' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n               ^\n                  \np1628.cpp:59:8: error: 'operator\u003c=' cannot be the name of a variable or data member\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n       ^\np1628.cpp:59:18: error: expected ';' at end of declaration\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n                 ^\n                 ;\np1628.cpp:59:18: error: expected unqualified-id\np1628.cpp:65:3: warning: 'auto' type specifier is a C++11 extension [-Wc++11-extensions]\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n  ^\np1628.cpp:65:16: warning: '\u003c=\u003e' is a single token in C++20; add a space to avoid a change in behavior [-Wc++20-compat]\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n               ^\n                  \np1628.cpp:65:8: error: 'operator\u003c=' cannot be the name of a variable or data member\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n       ^\np1628.cpp:65:18: error: expected ';' at end of declaration\n  auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n                 ^\n                 ;\np1628.cpp:65:18: error: expected unqualified-id\np1628.cpp:72:69: error: a space is required between consecutive right angle brackets (use '\u003e \u003e')\n         class Allocator = allocator\u003csub_match\u003cBidirectionalIterator\u003e\u003e\u003e\n                                                                    ^~\n                                                                    \u003e \u003e \np1628.cpp:74:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing cmatch  = match_results\u003cconst char*\u003e;\n                ^\np1628.cpp:75:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing wcmatch = match_results\u003cconst wchar_t*\u003e;\n                ^\np1628.cpp:76:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing smatch  = match_results\u003cstring::const_iterator\u003e;\n                ^\np1628.cpp:77:17: warning: alias declarations are a C++11 extension [-Wc++11-extensions]\nusing wsmatch = match_results\u003cwstring::const_iterator\u003e;\n                ^\np1628.cpp:91:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n21 warnings and 20 errors generated.\n$ clang++ p1628.cpp -std=2b -o p1628l -I. -Wall\np1628.cpp:20:28: error: unknown type name 'T1'\nusing syntax_option_type = T1; \n                           ^\np1628.cpp:21:25: error: unknown type name 'T2'\nusing match_flag_type = T2; \n                        ^\np1628.cpp:22:20: error: unknown type name 'T3'\nusing error_type = T3;\n                   ^\np1628.cpp:91:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:91:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:95:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:95:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:99:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:99:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:105:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:105:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:111:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type = regex_constants::match_default) = delete;\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:111:72: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type = regex_constants::match_default) = delete;\n                                                      ~~~~~~~~~~~~~~~~~^\np1628.cpp:115:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:115:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:119:37: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                   ~~~~~~~~~~~~~~~~~^\np1628.cpp:119:78: error: no member named 'match_default' in namespace 'std::regex_constants'\n                   regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                            ~~~~~~~~~~~~~~~~~^\np1628.cpp:125:38: error: no type named 'match_flag_type' in namespace 'std::regex_constants'\n                    regex_constants::match_flag_type flags = regex_constants::match_default);\n                    ~~~~~~~~~~~~~~~~~^\np1628.cpp:125:79: error: no member named 'match_default' in namespace 'std::regex_constants'\n                    regex_constants::match_flag_type flags = regex_constants::match_default);\n                                                             ~~~~~~~~~~~~~~~~~^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n20 errors generated.\n\n$ g++ p1628.cpp -std=03 -o p1628g -I. -Wall\nIn file included from /usr/local/include/c++/12.1.0/atomic:38,\n                 from N4910.h:11,\n                 from p1628.cpp:10:\n/usr/local/include/c++/12.1.0/bits/c++0x_warning.h:32:2: error: #error This file requires compiler and library support for the ISO C++ 2011 standard. This support must be enabled with the -std=c++11 or -std=gnu++11 compiler options.\n   32 | #error This file requires compiler and library support \\\n      |  ^~~~~\np1628.cpp:20:7: error: expected nested-name-specifier before 'syntax_option_type'\n   20 | using syntax_option_type = T1;\n      |       ^~~~~~~~~~~~~~~~~~\np1628.cpp:21:7: error: expected nested-name-specifier before 'match_flag_type'\n   21 | using match_flag_type = T2;\n      |       ^~~~~~~~~~~~~~~\np1628.cpp:22:7: error: expected nested-name-specifier before 'error_type'\n   22 | using error_type = T3;\n      |       ^~~~~~~~~~\np1628.cpp:29:56: error: spurious '\u003e\u003e', use '\u003e' to terminate a template argument list\n   29 | template\u003cclass charT, class traits = regex_traits\u003ccharT\u003e\u003e class basic_regex;\n      |                                                        ^~\np1628.cpp:29:38: error: two or more data types in declaration of 'type name'\n   29 | template\u003cclass charT, class traits = regex_traits\u003ccharT\u003e\u003e class basic_regex;\n      |                                      ^~~~~~~~~~~~~~~~~~~~\np1628.cpp:29:76: error: expected '\u003e' before ';' token\n   29 | template\u003cclass charT, class traits = regex_traits\u003ccharT\u003e\u003e class basic_regex;\n      |                                                                            ^\np1628.cpp:29:76: error: expected unqualified-id before ';' token\np1628.cpp:30:14: error: expected nested-name-specifier before 'regex'\n   30 |        using regex  = basic_regex\u003cchar\u003e;\n      |              ^~~~~\np1628.cpp:31:14: error: expected nested-name-specifier before 'wregex'\n   31 |        using wregex = basic_regex\u003cwchar_t\u003e;\n      |              ^~~~~~\np1628.cpp:34:20: error: 'std::basic_regex' is not a template\n   34 |          void swap(basic_regex\u003ccharT, traits\u003e\u0026 e1, basic_regex\u003ccharT, traits\u003e\u0026 e2);\n      |                    ^~~~~~~~~~~\np1628.cpp:34:52: error: 'std::basic_regex' is not a template\n   34 |          void swap(basic_regex\u003ccharT, traits\u003e\u0026 e1, basic_regex\u003ccharT, traits\u003e\u0026 e2);\n      |                                                    ^~~~~~~~~~~\np1628.cpp:38:14: error: expected nested-name-specifier before 'csub_match'\n   38 |        using csub_match  = sub_match\u003cconst char*\u003e;\n      |              ^~~~~~~~~~\np1628.cpp:39:14: error: expected nested-name-specifier before 'wcsub_match'\n   39 |        using wcsub_match = sub_match\u003cconst wchar_t*\u003e;\n      |              ^~~~~~~~~~~\np1628.cpp:40:14: error: expected nested-name-specifier before 'ssub_match'\n   40 |        using ssub_match  = sub_match\u003cstring::const_iterator\u003e;\n      |              ^~~~~~~~~~\np1628.cpp:41:7: error: expected nested-name-specifier before 'wssub_match'\n   41 | using wssub_match = sub_match\u003cwstring::const_iterator\u003e;\n      |       ^~~~~~~~~~~\np1628.cpp:46:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   46 |   auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\n      |   ^~~~\n      |   ----\np1628.cpp:46:8: error: 'operator\u003c=' does not name a type; did you mean 'iterator'?\n   46 |   auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs, const sub_match\u003cBiIter\u003e\u0026 rhs);\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:52:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   52 |   auto operator\u003c=\u003e(\n      |   ^~~~\n      |   ----\np1628.cpp:52:8: error: 'operator\u003c=' does not name a type; did you mean 'iterator'?\n   52 |   auto operator\u003c=\u003e(\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:59:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   59 |   auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n      |   ^~~~\n      |   ----\np1628.cpp:59:8: error: 'operator\u003c=' does not name a type; did you mean 'iterator'?\n   59 |   auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:65:3: warning: 'auto' changes meaning in C++11; please remove it [-Wc++11-compat]\n   65 |   auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n      |   ^~~~\n      |   ----\np1628.cpp:65:8: error: 'operator\u003c=' does not name a type; did you mean 'iterator'?\n   65 |   auto operator\u003c=\u003e(const sub_match\u003cBiIter\u003e\u0026 lhs,\n      |        ^~~~~~~~\n      |        iterator\np1628.cpp:72:69: error: '\u003e\u003e' should be '\u003e \u003e' within a nested template argument list\n   72 |          class Allocator = allocator\u003csub_match\u003cBidirectionalIterator\u003e\u003e\u003e\n      |                                                                     ^~\n      |                                                                     \u003e \u003e\np1628.cpp:74:7: error: expected nested-name-specifier before 'cmatch'\n   74 | using cmatch  = match_results\u003cconst char*\u003e;\n      |       ^~~~~~\np1628.cpp:75:7: error: expected nested-name-specifier before 'wcmatch'\n   75 | using wcmatch = match_results\u003cconst wchar_t*\u003e;\n      |       ^~~~~~~\np1628.cpp:76:7: error: expected nested-name-specifier before 'smatch'\n   76 | using smatch  = match_results\u003cstring::const_iterator\u003e;\n      |       ^~~~~~\np1628.cpp:77:7: error: expected nested-name-specifier before 'wsmatch'\n   77 | using wsmatch = match_results\u003cwstring::const_iterator\u003e;\n      |       ^~~~~~~\np1628.cpp:90:26: error: 'std::basic_regex' is not a template\n   90 |                    const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                          ^~~~~~~~~~~\np1628.cpp:91:37: error: 'std::regex_constants::match_flag_type' has not been declared\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:91:78: error: 'match_default' is not a member of 'std::regex_constants'\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:94:26: error: 'std::basic_regex' is not a template\n   94 |                    const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                          ^~~~~~~~~~~\np1628.cpp:95:37: error: 'std::regex_constants::match_flag_type' has not been declared\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:95:78: error: 'match_default' is not a member of 'std::regex_constants'\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:98:26: error: 'std::basic_regex' is not a template\n   98 |                    const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                          ^~~~~~~~~~~\np1628.cpp:99:37: error: 'std::regex_constants::match_flag_type' has not been declared\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:99:78: error: 'match_default' is not a member of 'std::regex_constants'\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:104:26: error: 'std::basic_regex' is not a template\n  104 |                    const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                          ^~~~~~~~~~~\np1628.cpp:105:37: error: 'std::regex_constants::match_flag_type' has not been declared\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:105:78: error: 'match_default' is not a member of 'std::regex_constants'\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:107:53: error: expected ',' or '...' before '\u0026\u0026' token\n  107 |   bool regex_match(const basic_string\u003ccharT, ST, SA\u003e\u0026\u0026,\n      |                                                     ^~\np1628.cpp:111:89: warning: defaulted and deleted functions only available with '-std=c++11' or '-std=gnu++11' [-Wc++11-extensions]\n  111 |                    regex_constants::match_flag_type = regex_constants::match_default) = delete;\n      |                                                                                         ^~~~~~\np1628.cpp:114:26: error: 'std::basic_regex' is not a template\n  114 |                    const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                          ^~~~~~~~~~~\np1628.cpp:115:37: error: 'std::regex_constants::match_flag_type' has not been declared\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:115:78: error: 'match_default' is not a member of 'std::regex_constants'\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:118:26: error: 'std::basic_regex' is not a template\n  118 |                    const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                          ^~~~~~~~~~~\np1628.cpp:119:37: error: 'std::regex_constants::match_flag_type' has not been declared\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                     ^~~~~~~~~~~~~~~\np1628.cpp:119:78: error: 'match_default' is not a member of 'std::regex_constants'\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:124:27: error: 'std::basic_regex' is not a template\n  124 |                     const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                           ^~~~~~~~~~~\np1628.cpp:125:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:125:79: error: 'match_default' is not a member of 'std::regex_constants'\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:128:27: error: 'std::basic_regex' is not a template\n  128 |                     const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                           ^~~~~~~~~~~\np1628.cpp:129:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:129:79: error: 'match_default' is not a member of 'std::regex_constants'\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:133:27: error: 'std::basic_regex' is not a template\n  133 |                     const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                           ^~~~~~~~~~~\np1628.cpp:134:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:134:79: error: 'match_default' is not a member of 'std::regex_constants'\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:137:27: error: 'std::basic_regex' is not a template\n  137 |                     const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                           ^~~~~~~~~~~\np1628.cpp:138:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:138:79: error: 'match_default' is not a member of 'std::regex_constants'\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:141:27: error: 'std::basic_regex' is not a template\n  141 |                     const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                           ^~~~~~~~~~~\np1628.cpp:142:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:142:79: error: 'match_default' is not a member of 'std::regex_constants'\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:147:27: error: 'std::basic_regex' is not a template\n  147 |                     const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                           ^~~~~~~~~~~\np1628.cpp:148:38: error: 'std::regex_constants::match_flag_type' has not been declared\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                      ^~~~~~~~~~~~~~~\np1628.cpp:148:79: error: 'match_default' is not a member of 'std::regex_constants'\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:150:54: error: expected ',' or '...' before '\u0026\u0026' token\n  150 |   bool regex_search(const basic_string\u003ccharT, ST, SA\u003e\u0026\u0026,\n      |                                                      ^~\np1628.cpp:155:59: warning: defaulted and deleted functions only available with '-std=c++11' or '-std=gnu++11' [-Wc++11-extensions]\n  155 |                       = regex_constants::match_default) = delete;\n      |                                                           ^~~~~~\np1628.cpp:162:25: error: 'std::basic_regex' is not a template\n  162 |                   const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                         ^~~~~~~~~~~\np1628.cpp:164:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:164:77: error: 'match_default' is not a member of 'std::regex_constants'\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:169:25: error: 'std::basic_regex' is not a template\n  169 |                   const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                         ^~~~~~~~~~~\np1628.cpp:171:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:171:77: error: 'match_default' is not a member of 'std::regex_constants'\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:175:25: error: 'std::basic_regex' is not a template\n  175 |                   const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                         ^~~~~~~~~~~\np1628.cpp:177:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:177:77: error: 'match_default' is not a member of 'std::regex_constants'\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:181:25: error: 'std::basic_regex' is not a template\n  181 |                   const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                         ^~~~~~~~~~~\np1628.cpp:183:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:183:77: error: 'match_default' is not a member of 'std::regex_constants'\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:187:25: error: 'std::basic_regex' is not a template\n  187 |                   const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                         ^~~~~~~~~~~\np1628.cpp:189:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:189:77: error: 'match_default' is not a member of 'std::regex_constants'\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:193:25: error: 'std::basic_regex' is not a template\n  193 |                   const basic_regex\u003ccharT, traits\u003e\u0026 e,\n      |                         ^~~~~~~~~~~\np1628.cpp:195:36: error: 'std::regex_constants::match_flag_type' has not been declared\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                    ^~~~~~~~~~~~~~~\np1628.cpp:195:77: error: 'match_default' is not a member of 'std::regex_constants'\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:199:44: error: spurious '\u003e\u003e', use '\u003e' to terminate a template argument list\n  199 |           class traits = regex_traits\u003ccharT\u003e\u003e\n      |                                            ^~\np1628.cpp:199:26: error: two or more data types in declaration of 'type name'\n  199 |           class traits = regex_traits\u003ccharT\u003e\u003e\n      |                          ^~~~~~~~~~~~~~~~~~~~\np1628.cpp:200:23: error: expected '\u003e' before ';' token\n  200 |   class regex_iterator;\n      |                       ^\np1628.cpp:200:23: error: expected unqualified-id before ';' token\np1628.cpp:201:7: error: expected nested-name-specifier before 'cregex_iterator'\n  201 | using cregex_iterator  = regex_iterator\u003cconst char*\u003e;\n      |       ^~~~~~~~~~~~~~~\np1628.cpp:202:7: error: expected nested-name-specifier before 'wcregex_iterator'\n  202 | using wcregex_iterator = regex_iterator\u003cconst wchar_t*\u003e;\n      |       ^~~~~~~~~~~~~~~~\np1628.cpp:203:7: error: expected nested-name-specifier before 'sregex_iterator'\n  203 | using sregex_iterator  = regex_iterator\u003cstring::const_iterator\u003e;\n      |       ^~~~~~~~~~~~~~~\np1628.cpp:204:7: error: expected nested-name-specifier before 'wsregex_iterator'\n  204 | using wsregex_iterator = regex_iterator\u003cwstring::const_iterator\u003e;\n      |       ^~~~~~~~~~~~~~~~\np1628.cpp:208:44: error: spurious '\u003e\u003e', use '\u003e' to terminate a template argument list\n  208 |           class traits = regex_traits\u003ccharT\u003e\u003e\n      |                                            ^~\np1628.cpp:208:26: error: two or more data types in declaration of 'type name'\n  208 |           class traits = regex_traits\u003ccharT\u003e\u003e\n      |                          ^~~~~~~~~~~~~~~~~~~~\np1628.cpp:209:29: error: expected '\u003e' before ';' token\n  209 |   class regex_token_iterator;\n      |                             ^\np1628.cpp:209:29: error: expected unqualified-id before ';' token\np1628.cpp:210:7: error: expected nested-name-specifier before 'cregex_token_iterator'\n  210 | using cregex_token_iterator  = regex_token_iterator\u003cconst char*\u003e;\n      |       ^~~~~~~~~~~~~~~~~~~~~\np1628.cpp:211:7: error: expected nested-name-specifier before 'wcregex_token_iterator'\n  211 | using wcregex_token_iterator = regex_token_iterator\u003cconst wchar_t*\u003e;\n      |       ^~~~~~~~~~~~~~~~~~~~~~\np1628.cpp:212:7: error: expected nested-name-specifier before 'sregex_token_iterator'\n  212 | using sregex_token_iterator  = regex_token_iterator\u003cstring::const_iterator\u003e;\n      |       ^~~~~~~~~~~~~~~~~~~~~\np1628.cpp:213:7: error: expected nested-name-specifier before 'wsregex_token_iterator'\n  213 | using wsregex_token_iterator = regex_token_iterator\u003cwstring::const_iterator\u003e;\n      |       ^~~~~~~~~~~~~~~~~~~~~~\np1628.cpp:216:7: error: expected unqualified-id before 'using'\n  216 |       using match_results =\n      |       ^~~~~\np1628.cpp:219:11: error: expected nested-name-specifier before 'cmatch'\n  219 |     using cmatch  = match_results\u003cconst char*\u003e;\n      |           ^~~~~~\np1628.cpp:220:11: error: expected nested-name-specifier before 'wcmatch'\n  220 |     using wcmatch = match_results\u003cconst wchar_t*\u003e;\n      |           ^~~~~~~\np1628.cpp:221:11: error: expected nested-name-specifier before 'smatch'\n  221 |     using smatch  = match_results\u003cstring::const_iterator\u003e;\n      |           ^~~~~~\np1628.cpp:222:11: error: expected nested-name-specifier before 'wsmatch'\n  222 |     using wsmatch = match_results\u003cwstring::const_iterator\u003e;\n      |           ^~~~~~~\n\n$ g++ p1628.cpp -std=2b -o p1628g -I. -Wall\np1628.cpp:20:28: error: 'T1' does not name a type\n   20 | using syntax_option_type = T1;\n      |                            ^~\np1628.cpp:21:25: error: 'T2' does not name a type\n   21 | using match_flag_type = T2;\n      |                         ^~\np1628.cpp:22:20: error: 'T3' does not name a type\n   22 | using error_type = T3;\n      |                    ^~\np1628.cpp:91:20: error: 'std::regex_constants::match_flag_type' has not been declared\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:91:78: error: 'match_default' is not a member of 'std::regex_constants'\n   91 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:95:20: error: 'std::regex_constants::match_flag_type' has not been declared\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:95:78: error: 'match_default' is not a member of 'std::regex_constants'\n   95 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:99:20: error: 'std::regex_constants::match_flag_type' has not been declared\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:99:78: error: 'match_default' is not a member of 'std::regex_constants'\n   99 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:105:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:105:78: error: 'match_default' is not a member of 'std::regex_constants'\n  105 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:111:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  111 |                    regex_constants::match_flag_type = regex_constants::match_default) = delete;\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:111:72: error: 'match_default' is not a member of 'std::regex_constants'\n  111 |                    regex_constants::match_flag_type = regex_constants::match_default) = delete;\n      |                                                                        ^~~~~~~~~~~~~\np1628.cpp:115:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:115:78: error: 'match_default' is not a member of 'std::regex_constants'\n  115 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:119:20: error: 'std::regex_constants::match_flag_type' has not been declared\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                    ^~~~~~~~~~~~~~~\np1628.cpp:119:78: error: 'match_default' is not a member of 'std::regex_constants'\n  119 |                    regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                              ^~~~~~~~~~~~~\np1628.cpp:125:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:125:79: error: 'match_default' is not a member of 'std::regex_constants'\n  125 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:129:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:129:79: error: 'match_default' is not a member of 'std::regex_constants'\n  129 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:134:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:134:79: error: 'match_default' is not a member of 'std::regex_constants'\n  134 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:138:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:138:79: error: 'match_default' is not a member of 'std::regex_constants'\n  138 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:142:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:142:79: error: 'match_default' is not a member of 'std::regex_constants'\n  142 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:148:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:148:79: error: 'match_default' is not a member of 'std::regex_constants'\n  148 |                     regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                               ^~~~~~~~~~~~~\np1628.cpp:154:21: error: 'std::regex_constants::match_flag_type' has not been declared\n  154 |                     regex_constants::match_flag_type\n      |                     ^~~~~~~~~~~~~~~\np1628.cpp:155:42: error: 'match_default' is not a member of 'std::regex_constants'\n  155 |                       = regex_constants::match_default) = delete;\n      |                                          ^~~~~~~~~~~~~\np1628.cpp:164:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:164:77: error: 'match_default' is not a member of 'std::regex_constants'\n  164 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:171:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:171:77: error: 'match_default' is not a member of 'std::regex_constants'\n  171 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:177:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:177:77: error: 'match_default' is not a member of 'std::regex_constants'\n  177 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:183:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:183:77: error: 'match_default' is not a member of 'std::regex_constants'\n  183 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:189:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:189:77: error: 'match_default' is not a member of 'std::regex_constants'\n  189 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\np1628.cpp:195:19: error: 'std::regex_constants::match_flag_type' has not been declared\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                   ^~~~~~~~~~~~~~~\np1628.cpp:195:77: error: 'match_default' is not a member of 'std::regex_constants'\n  195 |                   regex_constants::match_flag_type flags = regex_constants::match_default);\n      |                                                                             ^~~~~~~~~~~~~\nIn file included from /usr/local/include/c++/12.1.0/string:53,\n                 from /usr/local/include/c++/12.1.0/bits/locale_classes.h:40,\n                 from /usr/local/include/c++/12.1.0/bits/ios_base.h:41,\n                 from /usr/local/include/c++/12.1.0/ios:42,\n                 from /usr/local/include/c++/12.1.0/ostream:38,\n                 from /usr/local/include/c++/12.1.0/iostream:39,\n                 from N4910.h:2,\n                 from p1628.cpp:10:\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e':\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:89:31: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u003cchar\u003e'\n   89 |         rebind\u003c_CharT\u003e::other _Char_alloc_type;\n      |                               ^~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u003cchar\u003e'\n   61 |     template\u003ctypename _Tp\u003e class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:50:   required from 'class std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e'\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:113:16: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u003cchar\u003e'\n  113 |         struct _Alloc_traits_impl\u003cchar_traits\u003c_CharT\u003e, _Dummy_for_PR85282\u003e\n      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u003cchar\u003e'\n   61 |     template\u003ctypename _Tp\u003e class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e':\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:57: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  127 |       typedef typename _Alloc_traits::size_type         size_type;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:128:57: error: no type named 'difference_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  128 |       typedef typename _Alloc_traits::difference_type   difference_type;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:129:57: error: no type named 'reference' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  129 |       typedef typename _Alloc_traits::reference         reference;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:130:57: error: no type named 'const_reference' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  130 |       typedef typename _Alloc_traits::const_reference   const_reference;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:131:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  131 |       typedef typename _Alloc_traits::pointer           pointer;\n      |                                                         ^~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:132:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  132 |       typedef typename _Alloc_traits::const_pointer     const_pointer;\n      |                                                         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:133:68: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  133 |       typedef __gnu_cxx::__normal_iterator\u003cpointer, basic_string\u003e  iterator;\n      |                                                                    ^~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:135:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  135 |                                                         const_iterator;\n      |                                                         ^~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:136:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  136 |       typedef std::reverse_iterator\u003cconst_iterator\u003e     const_reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:137:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n  137 |       typedef std::reverse_iterator\u003citerator\u003e           reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~\nIn file included from /usr/local/include/c++/12.1.0/ext/alloc_traits.h:34,\n                 from /usr/local/include/c++/12.1.0/bits/basic_string.h:40:\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h: In substitution of 'template\u003cclass _Alloc\u003e using _RequireAllocator = typename std::enable_if\u003cstd::__is_allocator\u003c_Alloc\u003e::value, _Alloc\u003e::type [with _Alloc = std::pmr::polymorphic_allocator\u003cchar\u003e]':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:634:7:   required from 'class std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e'\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h:807:11: error: no type named 'type' in 'struct std::enable_if\u003cfalse, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e'\n  807 |     using _RequireAllocator\n      |           ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e':\np1628.cpp:221:41:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2634:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n 2634 |         find(const _Tp\u0026 __svt, size_type __pos = 0) const\n      |         ^~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2700:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n 2700 |         rfind(const _Tp\u0026 __svt, size_type __pos = npos) const\n      |         ^~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2785:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n 2785 |         find_first_of(const _Tp\u0026 __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2874:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n 2874 |         find_last_of(const _Tp\u0026 __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2962:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n 2962 |         find_first_not_of(const _Tp\u0026 __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:3049:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cchar, std::char_traits\u003cchar\u003e, std::pmr::polymorphic_allocator\u003cchar\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cchar\u003e, void\u003e'\n 3049 |         find_last_not_of(const _Tp\u0026 __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~~~~~\np1628.cpp:221:57: error: template argument 1 is invalid\n  221 |     using smatch  = match_results\u003cstring::const_iterator\u003e;\n      |                                                         ^\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e':\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:89:31: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u003cwchar_t\u003e'\n   89 |         rebind\u003c_CharT\u003e::other _Char_alloc_type;\n      |                               ^~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u003cwchar_t\u003e'\n   61 |     template\u003ctypename _Tp\u003e class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:50:   required from 'class std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e'\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:113:16: error: invalid use of incomplete type 'class std::pmr::polymorphic_allocator\u003cwchar_t\u003e'\n  113 |         struct _Alloc_traits_impl\u003cchar_traits\u003c_CharT\u003e, _Dummy_for_PR85282\u003e\n      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/string:61:34: note: declaration of 'class std::pmr::polymorphic_allocator\u003cwchar_t\u003e'\n   61 |     template\u003ctypename _Tp\u003e class polymorphic_allocator;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e':\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:127:57: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  127 |       typedef typename _Alloc_traits::size_type         size_type;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:128:57: error: no type named 'difference_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  128 |       typedef typename _Alloc_traits::difference_type   difference_type;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:129:57: error: no type named 'reference' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  129 |       typedef typename _Alloc_traits::reference         reference;\n      |                                                         ^~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:130:57: error: no type named 'const_reference' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  130 |       typedef typename _Alloc_traits::const_reference   const_reference;\n      |                                                         ^~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:131:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  131 |       typedef typename _Alloc_traits::pointer           pointer;\n      |                                                         ^~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:132:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  132 |       typedef typename _Alloc_traits::const_pointer     const_pointer;\n      |                                                         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:133:68: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  133 |       typedef __gnu_cxx::__normal_iterator\u003cpointer, basic_string\u003e  iterator;\n      |                                                                    ^~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:135:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  135 |                                                         const_iterator;\n      |                                                         ^~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:136:57: error: no type named 'const_pointer' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  136 |       typedef std::reverse_iterator\u003cconst_iterator\u003e     const_reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:137:57: error: no type named 'pointer' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n  137 |       typedef std::reverse_iterator\u003citerator\u003e           reverse_iterator;\n      |                                                         ^~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h: In substitution of 'template\u003cclass _Alloc\u003e using _RequireAllocator = typename std::enable_if\u003cstd::__is_allocator\u003c_Alloc\u003e::value, _Alloc\u003e::type [with _Alloc = std::pmr::polymorphic_allocator\u003cwchar_t\u003e]':\n/usr/local/include/c++/12.1.0/bits/basic_string.h:634:7:   required from 'class std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e'\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/alloc_traits.h:807:11: error: no type named 'type' in 'struct std::enable_if\u003cfalse, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e'\n  807 |     using _RequireAllocator\n      |           ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h: In instantiation of 'class std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e':\np1628.cpp:222:42:   required from here\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2634:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n 2634 |         find(const _Tp\u0026 __svt, size_type __pos = 0) const\n      |         ^~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2700:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n 2700 |         rfind(const _Tp\u0026 __svt, size_type __pos = npos) const\n      |         ^~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2785:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n 2785 |         find_first_of(const _Tp\u0026 __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2874:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n 2874 |         find_last_of(const _Tp\u0026 __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:2962:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n 2962 |         find_first_not_of(const _Tp\u0026 __svt, size_type __pos = 0) const\n      |         ^~~~~~~~~~~~~~~~~\n/usr/local/include/c++/12.1.0/bits/basic_string.h:3049:9: error: no type named 'size_type' in 'struct std::__cxx11::basic_string\u003cwchar_t, std::char_traits\u003cwchar_t\u003e, std::pmr::polymorphic_allocator\u003cwchar_t\u003e \u003e::_Alloc_traits_impl\u003cstd::char_traits\u003cwchar_t\u003e, void\u003e'\n 3049 |         find_last_not_of(const _Tp\u0026 __svt, size_type __pos = npos) const\n      |         ^~~~~~~~~~~~~~~~\np1628.cpp:222:58: error: template argument 1 is invalid\n  222 |     using wsmatch = match_results\u003cwstring::const_iterator\u003e;\n      |     \n```\n\n# 検討事項(agenda)\nコンパイルエラーを取るか、コンパイルエラーの理由を解説する。\n\n\u003c!-- リンクエラーの解説をする。clang++とg++の比較。意味のある出力。\nコンパイルエラーを取るか、コンパイルエラーの理由を解説する。--\u003e\n\n## 応用例1　AUTOSAR C++\n\nAUTOSARでC++のコーディング標準を作っている。　\nMISRA-C++コーディング標準の改訂をまたずに、C++14に対応したかったためかもしれない。　\n\nAutosar Guidelines C++14 example code compile list\n\nhttps://qiita.com/kaizen_nagoya/items/8ccbf6675c3494d57a76\n\nMISRA C++, AUTOSAR C++について\n\nhttps://qiita.com/kaizen_nagoya/items/3436fbd49865e0da7d35\n\n## 応用例2　MISRA C/C++\n\nMISRA C まとめ #include \u003cmisra_c.h\u003e\n\nhttps://qiita.com/kaizen_nagoya/items/f1a79a7cbd281607c7c9\n\nMISRA C++ 5-0-16\n\nhttps://qiita.com/kaizen_nagoya/items/7df2d4e05db724752a74\n\n## 応用例3 CERT C/C++\n\nSEI CERT C++ Coding Standard AA. Bibliography 確認中。\n\nhttps://qiita.com/kaizen_nagoya/items/fe06719aef10f3f985ae\n\nMISRA C/C++, AUTOSAR C++, CERT C/C++とC/C++工業標準をコンパイルする\n\nhttps://qiita.com/kaizen_nagoya/items/8dff19511e42b2593db1\n\n## 応用例4 箱庭　\n 箱庭もくもく会 \n\nhttps://hakoniwa.connpass.com\n\n第11回 未定\n\n箱庭ではUnityをはじめC++を使っているらしい。　\n\nここでコンパイルしたコードと同じようなコードを使っているか、\nここで出たコンパイルエラーと同じようなエラーがでたかを\nいろいろな版のコンパイラでコンパイルして確認していく。\n\nこの項目は、箱庭プロジェクトを市場分析の対象として、原則的には、箱庭プロジェクトの外部から分析し、外部から箱庭の広告宣伝のための戦略会議を仮想した結果、仮想「箱庭もくもく会」を開催してみることを企画するものである。　\n一切の内容は、箱庭プロジェクト、Athrill, TOPPERSとは無関係である。　\n一(いち)参加データアナリストの、個人的なつぶやきです。\n\n仮想戦略会議「箱庭」\n\nhttps://qiita.com/kaizen_nagoya/items/73cb132707653176a461\n\nお盆には「箱庭」記事を書きましょう「もくもく会」の題材になる（１）\n\nhttps://qiita.com/kaizen_nagoya/items/a22bf2b1dab0ad3258d4\n\nお盆には「箱庭」記事を書きましょう「もくもく会」の題材になる（2）\n\nhttps://qiita.com/kaizen_nagoya/items/e3c0ceb2dcc9cf3f3fac\n\n\n## 自己参考資料(self reference)\n\n関連する自己参照以外は、こちらの先頭に移転。\n\nC言語（C++)に対する誤解、曲解、無理解、爽快。\n\nhttps://qiita.com/kaizen_nagoya/items/3f3992c9722c1cee2e3a\n\n#include \"N4910.h\"\n\nhttps://qiita.com/kaizen_nagoya/items/163a47cef7d6bb1c33a8\n\nC++N4910資料の改善点\n\nhttps://qiita.com/kaizen_nagoya/items/fb4ceb5d117a54641af3\n\ndockerにclang\n\nhttps://qiita.com/kaizen_nagoya/items/8829ffeee397eda50e80\n\ndocker gnu(gcc/g++) and llvm(clang/clang++)\n\nhttps://qiita.com/kaizen_nagoya/items/059874ea39c4de64c0f7\n\nコンパイル用shell script C版(clangとgcc)とC++版(clang++とg++)\n\nhttps://qiita.com/kaizen_nagoya/items/74220c0577a512c2d7da\n\nC++N4910:2022 tag follower 300人超えました。ありがとうございます。\n\nhttps://qiita.com/kaizen_nagoya/items/a63fb96d351ac5c16ff7\n\nastyle 使ってみた\n\nhttps://qiita.com/kaizen_nagoya/items/3c9a87a781d53a1a23f3\n\n ＜この記事は個人の過去の経験に基づく個人の感想です。現在所属する組織、業務とは関係がありません。＞\n\n# 文書履歴(document history)\nver. 0.01 初稿 　20220918\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:38:07+09:00","group":null,"id":"22b45cac71dd2834e619","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"読書感想文","versions":[]},{"name":"個人開発","versions":[]},{"name":"AdventCalendar2022","versions":[]},{"name":"小川メソッド","versions":[]},{"name":"C++N4910","versions":[]}],"title":"32.3 Header \u003cregex\u003e synopsis [re.syn] C++N4910:2022 (698) p1628.cpp","updated_at":"2022-09-18T20:38:07+09:00","url":"https://qiita.com/kaizen_nagoya/items/22b45cac71dd2834e619","user":{"description":"I'm a network designer.I work on TOPPERS SmallestSetProfile Kernel,MISRA-C/C++, STARC RTL Design StyleGuide (Verilog-HDL), and HAZOP.I was an editor of ISO/IEC 15504.","facebook_id":"kaizen.nagoya","followees_count":72457,"followers_count":5166,"github_login_name":"kaizen-nagoya","id":"kaizen_nagoya","items_count":4593,"linkedin_id":"kiyoshi-ogawa","location":"Aichi, Japan","name":"Dr. Kiyoshi Ogawa","organization":"某企業","permanent_id":51423,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/51423/profile-images/1535439333","team_only":false,"twitter_screen_name":"naokiakutagawa","website_url":"https://researchmap.jp/blogs/blog_entries/view/81777/f691323917cc4ea12caf0b03b34c8ea0?frame_id=442673"},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:26\"\u003e\n\u003cspan id=\"この記事について\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの記事について\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-3:126\"\u003e下記の構成でCloud Runを利用してWebサーバーを構築するにあたり、考えたことや情報リソースを備忘録として記載していきます。\u003cbr\u003e\nできるだけ公式ドキュメントのリンクを添えて正確な情報を残していきたいと思っています。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"5:1-8:3\" class=\"note alert\"\u003e\n\u003cspan class=\"fa fa-fw fa-times-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"6:1-6:37\"\u003e\u003cstrong\u003eこの記事に記載ないこと\u003c/strong\u003e\u003c/p\u003e\n\u003cul data-sourcepos=\"7:1-7:35\"\u003e\n\u003cli data-sourcepos=\"7:1-7:35\"\u003e細かい設定値や手順など\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"10:1-10:8\"\u003e\n\u003cspan id=\"構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構成\u003c/h1\u003e\n\u003cp data-sourcepos=\"11:1-13:143\"\u003e実際に構築したインフラの構成はこちらです。\u003cbr\u003e\nここには記載していないところで\u003cstrong\u003eログの保存\u003c/strong\u003eや\u003cstrong\u003e死活監視\u003c/strong\u003eなども構成しているので、そちらについても記載していきます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c4fbd26e710aca827394742c849a71726980fe48/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3238343235312f31666164646161612d633535622d396434302d323939382d6166613331613364336432622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F284251%2F1faddaaa-c55b-9d40-2998-afa31a3d3d2b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0f2b48bbab957c15fc589f6273ca784e\" alt=\"Cloud Run Web Server.drawio.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/284251/1faddaaa-c55b-9d40-2998-afa31a3d3d2b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F284251%2F1faddaaa-c55b-9d40-2998-afa31a3d3d2b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=060b2be2e5ee42fab6c68466ee95cf61 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"15:1-15:12\"\u003e\n\u003cspan id=\"可用性\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%AF%E7%94%A8%E6%80%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e可用性\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"16:1-16:13\"\u003e\n\u003cspan id=\"cloud-run\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloud-run\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCloud Run\u003c/h3\u003e\n\u003cul data-sourcepos=\"17:1-30:0\"\u003e\n\u003cli data-sourcepos=\"17:1-21:342\"\u003e冗長性\n\u003cul data-sourcepos=\"18:5-21:342\"\u003e\n\u003cli data-sourcepos=\"18:5-18:178\"\u003e自動冗長化 - Cloud Run には自動冗長性が備わっているため、高可用性のために複数のインスタンスを作成する必要がありません。\u003c/li\u003e\n\u003cli data-sourcepos=\"19:5-19:121\"\u003eCloud Run サービスはリージョン単位で、複数のゾーンにわたり自動的に複製されます。\u003c/li\u003e\n\u003cli data-sourcepos=\"20:5-20:120\"\u003eゾーンに障害が発生した場合、トラフィックは他のゾーンに自動的に転送されます。\u003c/li\u003e\n\u003cli data-sourcepos=\"21:5-21:342\"\u003eデータがリージョン間で複製されることはありません。お客様のトラフィックは、Cloud Run によって別のリージョンにルーティングされることはありません。リージョンに障害が発生した場合、障害が解決するとすぐに Cloud Run は使用可能になります。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"22:1-23:200\"\u003eスケーリング\n\u003cul data-sourcepos=\"23:5-23:200\"\u003e\n\u003cli data-sourcepos=\"23:5-23:200\"\u003eCloud Run は、トラフィックに応じてゼロから N まで自動的にスケーリングし、コンテナ イメージのストリーミングを利用して高速に起動します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"24:1-25:774\"\u003e負荷分散\n\u003cul data-sourcepos=\"25:5-25:774\"\u003e\n\u003cli data-sourcepos=\"25:5-25:774\"\u003eCloud Run はリージョナル サービスです。つまり、お客様はリージョンを選択できますが、リージョンを構成するゾーンは選択できません。データとトラフィックは、リージョン内のゾーン間で自動的に負荷分散されます。コンテナ インスタンスは、受信トラフィックに合わせて自動的にスケーリングされ、必要に応じてゾーン間で負荷分散されます。このようにゾーンごとに自動スケーリングを行うスケジューラが各ゾーンで維持されています。また、他のゾーンが受けている負荷を認識し、ゾーン障害に対応するためにゾーン内の追加容量をプロビジョニングします。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"26:1-30:0\"\u003e参考\n\u003cul data-sourcepos=\"27:5-30:0\"\u003e\n\u003cli data-sourcepos=\"27:5-27:53\"\u003e\u003ca href=\"https://cloud.google.com/run?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud Run\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"28:5-28:160\"\u003e\u003ca href=\"https://cloud.google.com/blog/ja/topics/developers-practitioners/cloud-run-story-serverless-containers\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud Run: サーバーレス コンテナの話\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"29:5-30:0\"\u003e\u003ca href=\"https://cloud.google.com/architecture/disaster-recovery?hl=ja#cloud-run\" rel=\"nofollow noopener\" target=\"_blank\"\u003eクラウド インフラストラクチャの停止に対する障害復旧の設計\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 data-sourcepos=\"31:1-31:24\"\u003e\n\u003cspan id=\"cloud-load-balancing\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloud-load-balancing\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCloud Load Balancing\u003c/h3\u003e\n\u003cul data-sourcepos=\"32:1-36:0\"\u003e\n\u003cli data-sourcepos=\"32:1-33:489\"\u003eスケーリング\n\u003cul data-sourcepos=\"33:5-33:489\"\u003e\n\u003cli data-sourcepos=\"33:5-33:489\"\u003eCloud Load Balancing は、ユーザーやトラフィックの増加に応じてスケールできます。トラフィックの予期せぬ急増が発生した場合も、世界中の各リージョンにトラフィックを転送して容易に対応できます。この自動スケーリングにプレウォーミングは必要なく、トラフィックがゼロの状態からフル稼働の状態までスケールするのに、わずか数秒しかかかりません。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"34:1-36:0\"\u003e参考\n\u003cul data-sourcepos=\"35:5-36:0\"\u003e\n\u003cli data-sourcepos=\"35:5-36:0\"\u003e\u003ca href=\"https://cloud.google.com/load-balancing/docs/load-balancing-overview?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud Load Balancing の概要\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"37:1-37:20\"\u003e\n\u003cspan id=\"デプロイ周り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E5%91%A8%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデプロイ周り\u003c/h1\u003e\n\u003cp data-sourcepos=\"38:1-39:261\"\u003eCloud Buildではコンテナイメージ（Dockerfile）をビルドしてGitHubから継続的なデプロイが行えるようにしました。\u003cbr\u003e\nGitHubリポジトリの指定したブランチにCommitがPushされると、自動的にCloud BuildでコンテナイメージをビルドしてContainer Registryにビルドイメージを保存し、そのイメージをCloud Runにデプロイします。\u003c/p\u003e\n\u003cp data-sourcepos=\"41:1-42:351\"\u003e設定についてはCloud Runサービスを作成するときに設定を行えます。\u003cbr\u003e\n構成方法の詳細は「\u003ca href=\"https://cloud.google.com/run/docs/continuous-deployment-with-cloud-build?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud Build を使用した Git からの継続的なデプロイ\u003c/a\u003e」や「\u003ca href=\"https://cloud.google.com/build/docs/deploying-builds/deploy-cloud-run?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud Build を使用した Cloud Run へのデプロイ\u003c/a\u003e」を参照してください。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"44:1-48:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"45:1-45:33\"\u003eデプロイに失敗したら...\u003c/p\u003e\n\u003cul data-sourcepos=\"46:1-47:199\"\u003e\n\u003cli data-sourcepos=\"46:1-46:233\"\u003eGitHubのリポジトリ名に大文字が含まれているとデプロイすらできずにビルドに失敗するので小文字やハイフン等GCPの命名規則に合わせてリポジトリ名を設定してください。\u003c/li\u003e\n\u003cli data-sourcepos=\"47:1-47:199\"\u003eIAMにてCloud Buildのサービスアカウントに「Cloud Run 管理者（もしくはデベロッパー）」と「サービス アカウント ユーザー」のロールを付与します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch1 data-sourcepos=\"51:1-51:11\"\u003e\n\u003cspan id=\"cloud-run-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cloud-run-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCloud Run\u003c/h1\u003e\n\u003cp data-sourcepos=\"52:1-52:266\"\u003e今回はPHPの動くApacheを利用したWebサーバを構築したかったかつ、インフラの管理コストを削減したいと考えていたため\u003ca href=\"https://cloud.google.com/run/docs/overview/what-is-cloud-run?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003eCloud Run\u003c/strong\u003e\u003c/a\u003eを利用しました。\u003c/p\u003e\n\u003cp data-sourcepos=\"54:1-54:162\"\u003eCloud Runはフルマネージドのサーバーレスプラットフォームであり、スケーラブルなコンテナ型アプリを構築を行えます。\u003c/p\u003e\n\u003cp data-sourcepos=\"56:1-56:322\"\u003eCloud Runにはサービスとジョブがあり、ウェブリクエストまたはイベントに応答するコードの実行をする「\u003cstrong\u003eCloud Run サービス\u003c/strong\u003e」と、作業（ジョブ）を実行し、作業の完了後に終了するコードの実行をする「\u003cstrong\u003eCloud Run のジョブ\u003c/strong\u003e」があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"58:1-58:66\"\u003eCloud Runでは主に下記のプロパティを設定します。\u003c/p\u003e\n\u003cul data-sourcepos=\"59:1-85:0\"\u003e\n\u003cli data-sourcepos=\"59:1-59:20\"\u003eデプロイ方法\u003c/li\u003e\n\u003cli data-sourcepos=\"60:1-60:17\"\u003eリージョン\u003c/li\u003e\n\u003cli data-sourcepos=\"61:1-62:363\"\u003e\n\u003ca href=\"https://cloud.google.com/run/docs/configuring/cpu-allocation?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCPUの割り当て\u003c/a\u003e\n\u003cul data-sourcepos=\"62:5-62:363\"\u003e\n\u003cli data-sourcepos=\"62:5-62:363\"\u003e「\u003cstrong\u003eリクエストの処理中にのみ CPU を割り当てる\u003c/strong\u003e」か「\u003cstrong\u003eCPU を常に割り当てる\u003c/strong\u003e」からCPUの割り当てを設定します。\u003cbr\u003e割り当ての方法により料金が変わってくるので、\u003ca href=\"https://cloud.google.com/products/calculator?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e料金計算ツール\u003c/a\u003eで見積もりを行うことをおすすめします。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"63:1-64:224\"\u003e自動スケーリング\n\u003cul data-sourcepos=\"64:5-64:224\"\u003e\n\u003cli data-sourcepos=\"64:5-64:224\"\u003e\n\u003ca href=\"https://cloud.google.com/run/docs/configuring/min-instances?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003e最小インスタンス\u003c/strong\u003e\u003c/a\u003eと\u003ca href=\"https://cloud.google.com/run/docs/configuring/max-instances?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003e最大インスタンス\u003c/strong\u003e\u003c/a\u003eを指定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"65:1-67:120\"\u003e\n\u003ca href=\"https://cloud.google.com/run/docs/securing/ingress?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eIngress\u003c/a\u003e\n\u003cul data-sourcepos=\"66:5-67:120\"\u003e\n\u003cli data-sourcepos=\"66:5-66:144\"\u003eCloud Runへのアクセスの制限を「\u003cstrong\u003e内部\u003c/strong\u003e」「\u003cstrong\u003e内部と Cloud Load Balancing\u003c/strong\u003e」「\u003cstrong\u003eすべて\u003c/strong\u003e」から設定します。\u003c/li\u003e\n\u003cli data-sourcepos=\"67:5-67:120\"\u003e今回はCloud Load Balancingを利用するので「\u003cstrong\u003e内部と Cloud Load Balancing\u003c/strong\u003e」を選択しました。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"68:1-70:136\"\u003e認証\n\u003cul data-sourcepos=\"69:5-70:136\"\u003e\n\u003cli data-sourcepos=\"69:5-69:386\"\u003e「\u003cstrong\u003e認証されていない呼び出しを許可する\u003c/strong\u003e」か「\u003cstrong\u003e認証が必要\u003c/strong\u003e」から認証の有無を指定します。\u003cbr\u003e公開APIまたはウェブサイトを作成する場合は、「\u003cstrong\u003e認証されていない呼び出しを許可する\u003c/strong\u003e」を、認証で保護された安全なサービスが必要な場合は、「\u003cstrong\u003e認証が必要\u003c/strong\u003e」を選択します。\u003c/li\u003e\n\u003cli data-sourcepos=\"70:5-70:136\"\u003e今回は公開するWebサーバーなので「\u003cstrong\u003e認証されていない呼び出しを許可する\u003c/strong\u003e」を設定しました。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"71:1-71:138\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/concurrency?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eインスタンスあたりの最大同時リクエスト数の設定\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"72:1-73:27\"\u003e\n\u003ca href=\"https://cloud.google.com/run/docs/configuring/containers?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eコンテナ構成\u003c/a\u003e\n\u003cul data-sourcepos=\"73:5-73:27\"\u003e\n\u003cli data-sourcepos=\"73:5-73:27\"\u003eコンテナポート\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"74:1-74:71\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/cpu?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCPU 制限\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"75:1-75:86\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/memory-limits?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eメモリ制限\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"76:1-76:107\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/request-timeout?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eリクエスト タイムアウト\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"77:1-77:83\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/secrets?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eシークレット\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"78:1-78:91\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/environment-variables?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e環境変数\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"79:1-79:92\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/execution-environments?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e実行環境\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"80:1-80:69\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/http2?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHTTP/2\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"81:1-81:73\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/labels?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eラベル\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"82:1-82:102\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/service-accounts?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eサービス アカウント\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"83:1-83:79\"\u003e\u003ca href=\"https://cloud.google.com/sql/docs/mysql/connect-run?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud SQL 接続\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"84:1-85:0\"\u003e\u003ca href=\"https://cloud.google.com/run/docs/configuring/connecting-vpc?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVPC 接続\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"86:1-86:23\"\u003e\n\u003cspan id=\"ロードバランサ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%83%BC%E3%83%89%E3%83%90%E3%83%A9%E3%83%B3%E3%82%B5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eロードバランサ\u003c/h1\u003e\n\u003cp data-sourcepos=\"87:1-87:245\"\u003e今回はWebサイトとして公開するWebサーバーをつくりたかったので、\u003ca href=\"https://cloud.google.com/load-balancing?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003eCloud Load Balancing\u003c/strong\u003e\u003c/a\u003eの\u003cstrong\u003eグローバル外部 HTTP(S) ロードバランサ\u003c/strong\u003eを利用しました。\u003c/p\u003e\n\u003cp data-sourcepos=\"89:1-89:316\"\u003e実際の構築手順や各種設定値については「\u003ca href=\"https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCloud Run、App Engine、または Cloud Functions でグローバル外部 HTTP(S) ロードバランサを設定する\u003c/a\u003e」を参照するとよいと思います。\u003c/p\u003e\n\u003cp data-sourcepos=\"91:1-91:69\"\u003e大きくこちらの項目について対応していきました。\u003c/p\u003e\n\u003cul data-sourcepos=\"92:1-110:0\"\u003e\n\u003cli data-sourcepos=\"92:1-93:126\"\u003e\n\u003ca href=\"https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#ip-address\" rel=\"nofollow noopener\" target=\"_blank\"\u003e外部 IP アドレスを予約する\u003c/a\u003e\n\u003cul data-sourcepos=\"93:5-93:126\"\u003e\n\u003cli data-sourcepos=\"93:5-93:126\"\u003eここで取得したIPアドレスをロードバランサに紐づけして、DNSのAレコードに設定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"94:1-94:161\"\u003e\u003ca href=\"https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#ssl_certificate_resource\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSSL 証明書リソースを作成する\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"95:1-107:121\"\u003e\n\u003ca href=\"https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#creating_the_load_balancer\" rel=\"nofollow noopener\" target=\"_blank\"\u003eロードバランサを作成する\u003c/a\u003e\n\u003cul data-sourcepos=\"96:5-107:121\"\u003e\n\u003cli data-sourcepos=\"96:5-103:56\"\u003eフロントエンドの構成\n\u003cul data-sourcepos=\"97:9-103:56\"\u003e\n\u003cli data-sourcepos=\"97:9-103:56\"\u003e下記のプロパティを設定してロードバランサのフロントエンドを構成します。\n\u003cul data-sourcepos=\"98:13-103:56\"\u003e\n\u003cli data-sourcepos=\"98:13-98:29\"\u003eプロトコル\u003c/li\u003e\n\u003cli data-sourcepos=\"99:13-99:28\"\u003eIPアドレス\u003c/li\u003e\n\u003cli data-sourcepos=\"100:13-100:23\"\u003eポート\u003c/li\u003e\n\u003cli data-sourcepos=\"101:13-101:26\"\u003eSSL証明書\u003c/li\u003e\n\u003cli data-sourcepos=\"102:13-102:53\"\u003eSSLポリシー（TLS 1.〇以上等）\u003c/li\u003e\n\u003cli data-sourcepos=\"103:13-103:56\"\u003eHTTP から HTTPS へのリダイレクト\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"104:5-105:97\"\u003eバックエンド サービスの構成\n\u003cul data-sourcepos=\"105:9-105:97\"\u003e\n\u003cli data-sourcepos=\"105:9-105:97\"\u003eロードバランサとバックエンド（Cloud Run）の紐づけを行います。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"106:5-107:121\"\u003eホストルールとパスマッチャーの構成\n\u003cul data-sourcepos=\"107:9-107:121\"\u003e\n\u003cli data-sourcepos=\"107:9-107:121\"\u003eロードバランサで複数のバックエンドサービスと紐づけをするときに設定します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"108:1-110:0\"\u003e\n\u003ca href=\"https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#enable-armor\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogle Cloud Armor を有効にする\u003c/a\u003e\n\u003cul data-sourcepos=\"109:5-110:0\"\u003e\n\u003cli data-sourcepos=\"109:5-110:0\"\u003e分散型サービス拒否（DDoS）攻撃からロードバランサを保護したり、IP制限を設定することができるWAFサービスです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"111:1-111:17\"\u003e\n\u003cspan id=\"ログの保存\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%82%B0%E3%81%AE%E4%BF%9D%E5%AD%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eログの保存\u003c/h1\u003e\n\u003cp data-sourcepos=\"112:1-112:202\"\u003e\u003ca href=\"https://cloud.google.com/logging?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003eCloud Logging\u003c/strong\u003e\u003c/a\u003eを利用してログのルーティングを行い、\u003ca href=\"https://cloud.google.com/storage?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003eCloud Storage\u003c/strong\u003e\u003c/a\u003eに保存を行いました。\u003c/p\u003e\n\u003cp data-sourcepos=\"114:1-114:677\"\u003eCloud Loggingの\u003ca href=\"https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eログエクスプローラ\u003c/a\u003eを利用することでログデータを取得、表示、分析等ができますが、デフォルトでは\u003ca href=\"https://cloud.google.com/logging/docs/routing/overview#required-bucket\" rel=\"nofollow noopener\" target=\"_blank\"\u003e_Required ログバケット\u003c/a\u003eにて「管理アクティビティ監査ログ」「システムイベント監査ログ」「アクセスの透明性ログ」を400日間保持し、\u003ca href=\"https://cloud.google.com/logging/docs/routing/overview#default-bucket\" rel=\"nofollow noopener\" target=\"_blank\"\u003e_Default ログバケット\u003c/a\u003eにて_Requiredバケットに取り込まれなかったログを30日間保持します。\u003c/p\u003e\n\u003cp data-sourcepos=\"116:1-117:224\"\u003eログを長期保管しておく必要がある場合は別途ログをルーティングし保管する必要があります。\u003cbr\u003e\nログのルーティング（転送）先については「\u003ca href=\"https://cloud.google.com/logging/docs/export/using_exported_logs?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eシンクのエクスポート先のログを表示する\u003c/a\u003e」を参照してください。\u003c/p\u003e\n\u003cp data-sourcepos=\"119:1-120:166\"\u003e今回はCloud Storageにログをルーティングし保管することにしました。\u003cbr\u003e\nログをルーティングするには\u003ca href=\"https://cloud.google.com/logging/docs/export/configure_export_v2?hl=ja#creating_sink\" rel=\"nofollow noopener\" target=\"_blank\"\u003eシンクを構成\u003c/a\u003eし制御します。\u003c/p\u003e\n\u003cp data-sourcepos=\"122:1-122:75\"\u003eシンクの構成には主に以下のプロパティを設定します。\u003c/p\u003e\n\u003cul data-sourcepos=\"123:1-133:0\"\u003e\n\u003cli data-sourcepos=\"123:1-129:35\"\u003eシンクのエクスポート先\n\u003cul data-sourcepos=\"124:5-129:35\"\u003e\n\u003cli data-sourcepos=\"124:5-124:31\"\u003eCloud Loggingバケット\u003c/li\u003e\n\u003cli data-sourcepos=\"125:5-125:26\"\u003eBigQueryテーブル\u003c/li\u003e\n\u003cli data-sourcepos=\"126:5-126:31\"\u003eCloud Storageバケット\u003c/li\u003e\n\u003cli data-sourcepos=\"127:5-127:25\"\u003ePub/Subトピック\u003c/li\u003e\n\u003cli data-sourcepos=\"128:5-128:12\"\u003eSplunk\u003c/li\u003e\n\u003cli data-sourcepos=\"129:5-129:35\"\u003e他のCloudプロジェクト\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"130:1-131:166\"\u003eシンクに含めるログの選択\n\u003cul data-sourcepos=\"131:5-131:166\"\u003e\n\u003cli data-sourcepos=\"131:5-131:166\"\u003e\n\u003ca href=\"https://cloud.google.com/logging/docs/view/logging-query-language?hl=ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLoggingのクエリ言語\u003c/a\u003eを利用してログのフィルタ式を記述します。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"132:1-133:0\"\u003e（省略可）シンクに含めないログの選択\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"134:1-134:14\"\u003e\n\u003cspan id=\"死活監視\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AD%BB%E6%B4%BB%E7%9B%A3%E8%A6%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e死活監視\u003c/h1\u003e\n\u003cp data-sourcepos=\"135:1-135:192\"\u003eCloud Monitoringの\u003ca href=\"https://cloud.google.com/python/monitor-and-debug/uptime-alert?hl=JA#creating_an_uptime_check\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cstrong\u003e稼働時間チェック\u003c/strong\u003e\u003c/a\u003eを利用して死活監視を行いました。\u003c/p\u003e\n\u003cp data-sourcepos=\"137:1-137:300\"\u003e今回は指定したURLに対して定期的にアクセスを行い、期待通りのステータスコードでレスポンスが返ってくることを検証し、検証に失敗した場合に指定のメールアドレスにアラート（通知）を送信するように設定しました。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"139:1-139:14\"\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h1\u003e\n\u003cp data-sourcepos=\"140:1-140:180\"\u003e今回はすべてコンソールにて構築を行いましたが、次回はTerraformなんかを使ってデプロイする方法を学んでいきたいと思っています。\u003c/p\u003e\n","body":"# この記事について\n下記の構成でCloud Runを利用してWebサーバーを構築するにあたり、考えたことや情報リソースを備忘録として記載していきます。\nできるだけ公式ドキュメントのリンクを添えて正確な情報を残していきたいと思っています。\n\n:::note alert\n**この記事に記載ないこと**\n- 細かい設定値や手順など\n:::\n\n# 構成\n実際に構築したインフラの構成はこちらです。\nここには記載していないところで**ログの保存**や**死活監視**なども構成しているので、そちらについても記載していきます。\n![Cloud Run Web Server.drawio.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/284251/1faddaaa-c55b-9d40-2998-afa31a3d3d2b.png)\n\n## 可用性\n### Cloud Run\n- 冗長性\n    - 自動冗長化 - Cloud Run には自動冗長性が備わっているため、高可用性のために複数のインスタンスを作成する必要がありません。\n    - Cloud Run サービスはリージョン単位で、複数のゾーンにわたり自動的に複製されます。\n    - ゾーンに障害が発生した場合、トラフィックは他のゾーンに自動的に転送されます。\n    - データがリージョン間で複製されることはありません。お客様のトラフィックは、Cloud Run によって別のリージョンにルーティングされることはありません。リージョンに障害が発生した場合、障害が解決するとすぐに Cloud Run は使用可能になります。\n- スケーリング\n    - Cloud Run は、トラフィックに応じてゼロから N まで自動的にスケーリングし、コンテナ イメージのストリーミングを利用して高速に起動します。\n- 負荷分散\n    - Cloud Run はリージョナル サービスです。つまり、お客様はリージョンを選択できますが、リージョンを構成するゾーンは選択できません。データとトラフィックは、リージョン内のゾーン間で自動的に負荷分散されます。コンテナ インスタンスは、受信トラフィックに合わせて自動的にスケーリングされ、必要に応じてゾーン間で負荷分散されます。このようにゾーンごとに自動スケーリングを行うスケジューラが各ゾーンで維持されています。また、他のゾーンが受けている負荷を認識し、ゾーン障害に対応するためにゾーン内の追加容量をプロビジョニングします。\n- 参考\n    - [Cloud Run](https://cloud.google.com/run?hl=ja)\n    - [Cloud Run: サーバーレス コンテナの話](https://cloud.google.com/blog/ja/topics/developers-practitioners/cloud-run-story-serverless-containers)\n    - [クラウド インフラストラクチャの停止に対する障害復旧の設計](https://cloud.google.com/architecture/disaster-recovery?hl=ja#cloud-run)\n\n### Cloud Load Balancing\n- スケーリング\n    - Cloud Load Balancing は、ユーザーやトラフィックの増加に応じてスケールできます。トラフィックの予期せぬ急増が発生した場合も、世界中の各リージョンにトラフィックを転送して容易に対応できます。この自動スケーリングにプレウォーミングは必要なく、トラフィックがゼロの状態からフル稼働の状態までスケールするのに、わずか数秒しかかかりません。\n- 参考\n    - [Cloud Load Balancing の概要](https://cloud.google.com/load-balancing/docs/load-balancing-overview?hl=ja)\n\n# デプロイ周り\nCloud Buildではコンテナイメージ（Dockerfile）をビルドしてGitHubから継続的なデプロイが行えるようにしました。\nGitHubリポジトリの指定したブランチにCommitがPushされると、自動的にCloud BuildでコンテナイメージをビルドしてContainer Registryにビルドイメージを保存し、そのイメージをCloud Runにデプロイします。\n\n設定についてはCloud Runサービスを作成するときに設定を行えます。\n構成方法の詳細は「[Cloud Build を使用した Git からの継続的なデプロイ](https://cloud.google.com/run/docs/continuous-deployment-with-cloud-build?hl=ja)」や「[Cloud Build を使用した Cloud Run へのデプロイ](https://cloud.google.com/build/docs/deploying-builds/deploy-cloud-run?hl=ja)」を参照してください。\n\n:::note warn\nデプロイに失敗したら...\n- GitHubのリポジトリ名に大文字が含まれているとデプロイすらできずにビルドに失敗するので小文字やハイフン等GCPの命名規則に合わせてリポジトリ名を設定してください。\n- IAMにてCloud Buildのサービスアカウントに「Cloud Run 管理者（もしくはデベロッパー）」と「サービス アカウント ユーザー」のロールを付与します。\n:::\n\n\n# Cloud Run\n今回はPHPの動くApacheを利用したWebサーバを構築したかったかつ、インフラの管理コストを削減したいと考えていたため[**Cloud Run**](https://cloud.google.com/run/docs/overview/what-is-cloud-run?hl=ja)を利用しました。\n\nCloud Runはフルマネージドのサーバーレスプラットフォームであり、スケーラブルなコンテナ型アプリを構築を行えます。\n\nCloud Runにはサービスとジョブがあり、ウェブリクエストまたはイベントに応答するコードの実行をする「**Cloud Run サービス**」と、作業（ジョブ）を実行し、作業の完了後に終了するコードの実行をする「**Cloud Run のジョブ**」があります。\n\nCloud Runでは主に下記のプロパティを設定します。\n- デプロイ方法\n- リージョン\n- [CPUの割り当て](https://cloud.google.com/run/docs/configuring/cpu-allocation?hl=ja)\n    - 「**リクエストの処理中にのみ CPU を割り当てる**」か「**CPU を常に割り当てる**」からCPUの割り当てを設定します。\u003cbr\u003e割り当ての方法により料金が変わってくるので、[料金計算ツール](https://cloud.google.com/products/calculator?hl=ja)で見積もりを行うことをおすすめします。\n- 自動スケーリング\n    - [**最小インスタンス**](https://cloud.google.com/run/docs/configuring/min-instances?hl=ja)と[**最大インスタンス**](https://cloud.google.com/run/docs/configuring/max-instances?hl=ja)を指定します。\n- [Ingress](https://cloud.google.com/run/docs/securing/ingress?hl=ja)\n    - Cloud Runへのアクセスの制限を「**内部**」「**内部と Cloud Load Balancing**」「**すべて**」から設定します。\n    - 今回はCloud Load Balancingを利用するので「**内部と Cloud Load Balancing**」を選択しました。\n- 認証\n    - 「**認証されていない呼び出しを許可する**」か「**認証が必要**」から認証の有無を指定します。\u003cbr\u003e公開APIまたはウェブサイトを作成する場合は、「**認証されていない呼び出しを許可する**」を、認証で保護された安全なサービスが必要な場合は、「**認証が必要**」を選択します。\n    - 今回は公開するWebサーバーなので「**認証されていない呼び出しを許可する**」を設定しました。\n- [インスタンスあたりの最大同時リクエスト数の設定](https://cloud.google.com/run/docs/configuring/concurrency?hl=ja)\n- [コンテナ構成](https://cloud.google.com/run/docs/configuring/containers?hl=ja)\n    - コンテナポート\n- [CPU 制限](https://cloud.google.com/run/docs/configuring/cpu?hl=ja)\n- [メモリ制限](https://cloud.google.com/run/docs/configuring/memory-limits?hl=ja)\n- [リクエスト タイムアウト](https://cloud.google.com/run/docs/configuring/request-timeout?hl=ja)\n- [シークレット](https://cloud.google.com/run/docs/configuring/secrets?hl=ja)\n- [環境変数](https://cloud.google.com/run/docs/configuring/environment-variables?hl=ja)\n- [実行環境](https://cloud.google.com/run/docs/configuring/execution-environments?hl=ja)\n- [HTTP/2](https://cloud.google.com/run/docs/configuring/http2?hl=ja)\n- [ラベル](https://cloud.google.com/run/docs/configuring/labels?hl=ja)\n- [サービス アカウント](https://cloud.google.com/run/docs/configuring/service-accounts?hl=ja)\n- [Cloud SQL 接続](https://cloud.google.com/sql/docs/mysql/connect-run?hl=ja)\n- [VPC 接続](https://cloud.google.com/run/docs/configuring/connecting-vpc?hl=ja)\n\n# ロードバランサ\n今回はWebサイトとして公開するWebサーバーをつくりたかったので、[**Cloud Load Balancing**](https://cloud.google.com/load-balancing?hl=ja)の**グローバル外部 HTTP(S) ロードバランサ**を利用しました。\n\n実際の構築手順や各種設定値については「[Cloud Run、App Engine、または Cloud Functions でグローバル外部 HTTP(S) ロードバランサを設定する](https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja)」を参照するとよいと思います。\n\n大きくこちらの項目について対応していきました。\n- [外部 IP アドレスを予約する](https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#ip-address)\n    - ここで取得したIPアドレスをロードバランサに紐づけして、DNSのAレコードに設定します。\n- [SSL 証明書リソースを作成する](https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#ssl_certificate_resource)\n- [ロードバランサを作成する](https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#creating_the_load_balancer)\n    - フロントエンドの構成\n        - 下記のプロパティを設定してロードバランサのフロントエンドを構成します。\n            - プロトコル\n            - IPアドレス\n            - ポート\n            - SSL証明書\n            - SSLポリシー（TLS 1.〇以上等）\n            - HTTP から HTTPS へのリダイレクト\n    - バックエンド サービスの構成\n        - ロードバランサとバックエンド（Cloud Run）の紐づけを行います。\n    - ホストルールとパスマッチャーの構成\n        - ロードバランサで複数のバックエンドサービスと紐づけをするときに設定します。\n- [Google Cloud Armor を有効にする](https://cloud.google.com/load-balancing/docs/https/setup-global-ext-https-serverless?hl=ja#enable-armor)\n    - 分散型サービス拒否（DDoS）攻撃からロードバランサを保護したり、IP制限を設定することができるWAFサービスです。\n\n# ログの保存\n[**Cloud Logging**](https://cloud.google.com/logging?hl=ja)を利用してログのルーティングを行い、[**Cloud Storage**](https://cloud.google.com/storage?hl=ja)に保存を行いました。\n\nCloud Loggingの[ログエクスプローラ](https://cloud.google.com/logging/docs/view/logs-explorer-interface?hl=ja)を利用することでログデータを取得、表示、分析等ができますが、デフォルトでは[_Required ログバケット](https://cloud.google.com/logging/docs/routing/overview#required-bucket)にて「管理アクティビティ監査ログ」「システムイベント監査ログ」「アクセスの透明性ログ」を400日間保持し、[_Default ログバケット](https://cloud.google.com/logging/docs/routing/overview#default-bucket)にて_Requiredバケットに取り込まれなかったログを30日間保持します。\n\nログを長期保管しておく必要がある場合は別途ログをルーティングし保管する必要があります。\nログのルーティング（転送）先については「[シンクのエクスポート先のログを表示する](https://cloud.google.com/logging/docs/export/using_exported_logs?hl=ja)」を参照してください。\n\n今回はCloud Storageにログをルーティングし保管することにしました。\nログをルーティングするには[シンクを構成](https://cloud.google.com/logging/docs/export/configure_export_v2?hl=ja#creating_sink)し制御します。\n\nシンクの構成には主に以下のプロパティを設定します。\n- シンクのエクスポート先\n    - Cloud Loggingバケット\n    - BigQueryテーブル\n    - Cloud Storageバケット\n    - Pub/Subトピック\n    - Splunk\n    - 他のCloudプロジェクト\n- シンクに含めるログの選択\n    - [Loggingのクエリ言語](https://cloud.google.com/logging/docs/view/logging-query-language?hl=ja)を利用してログのフィルタ式を記述します。\n- （省略可）シンクに含めないログの選択\n\n# 死活監視\nCloud Monitoringの[**稼働時間チェック**](https://cloud.google.com/python/monitor-and-debug/uptime-alert?hl=JA#creating_an_uptime_check)を利用して死活監視を行いました。\n\n今回は指定したURLに対して定期的にアクセスを行い、期待通りのステータスコードでレスポンスが返ってくることを検証し、検証に失敗した場合に指定のメールアドレスにアラート（通知）を送信するように設定しました。\n\n# 終わりに\n今回はすべてコンソールにて構築を行いましたが、次回はTerraformなんかを使ってデプロイする方法を学んでいきたいと思っています。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:36:53+09:00","group":null,"id":"d1b208b3ee7415f6d7da","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"gcp","versions":[]},{"name":"WEBサーバ","versions":[]},{"name":"CloudRun","versions":[]}],"title":"Cloud Runでインフラを構成したときのメモ","updated_at":"2022-09-18T20:36:53+09:00","url":"https://qiita.com/BiwaYamada/items/d1b208b3ee7415f6d7da","user":{"description":"なんとかエンジニアやってます。\r\nWeb制作やフロントエンド周りを担当することが多く、最近はディレクションとインフラ構築もやったりします。\r\n\r\nずっとリモートワークがしたい。\r\n情シス的な立場で社員のサポートとかしてみたい。\r\nゲームを作ってみたい。\r\n将来はドックラン経営か喫茶店を開きたい。","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"BiwaYamada","items_count":2,"linkedin_id":"","location":"","name":"やまだ びわ","organization":"","permanent_id":284251,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/284251/34dd0a9f4dd3745b5763aa16c72afe84fc2b4751/x_large.png?1657373858","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:418\"\u003e最近、PowerQueryの処理の関係上、同じフォルダに保存した大量のエクセルファイルを連結していく状況が多いのですが、連結後のデータを確認した際に、ノイズが入っている場合は、元のフォルダに戻って該当ファイルを確認、ノイズを補正するような手動によるデータクレンジングする状況が増えてきました。\u003c/p\u003e\n\u003cp data-sourcepos=\"3:1-3:232\"\u003eこのため、PowerQueryで参照するフォルダ名を書いておいて、そのフォルダをエクスプローラで開くマクロの使用頻度が秒で増えており、特に今年に入ってからは大人気です。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"5:1-5:15\"\u003e\n\u003cspan id=\"vbaコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vba%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVBAコード\u003c/h2\u003e\n\u003cp data-sourcepos=\"6:1-6:69\"\u003e下記VBAコードを標準モジュールの中に仕込みます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"vb\" data-sourcepos=\"7:1-22:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e標準モジュール内\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e' in mUtils module\u003c/span\u003e\n\u003cspan class=\"k\"\u003eOption\u003c/span\u003e \u003cspan class=\"n\"\u003eExplicit\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003ePublic\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003eopenWithExplorer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003erow\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eDim\u003c/span\u003e \u003cspan class=\"nv\"\u003ecol\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"kt\"\u003eInteger\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e' フォルダのパスが書いてあるセルの参照となる情報は、\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e' 各自の環境に置き換えてください。\u003c/span\u003e\n    \u003cspan class=\"n\"\u003erow\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \n    \u003cspan class=\"n\"\u003ecol\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eShell\u003c/span\u003e \u003cspan class=\"s\"\u003e\"C:\\Windows\\explorer.exe \"\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eSheet1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCells\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCol\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003evbNormalFocus\u003c/span\u003e\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"24:1-24:135\"\u003e下記はシートのオブジェクト名を wsCONFとしたうえで、3行目、2列目にある場合のマクロの画像です。\u003c/p\u003e\n\u003cp data-sourcepos=\"26:1-26:120\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/1f011e78d322f274d81f17cdc2439ae1443781b8/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f34313232332f36343965316564622d383633652d363666612d613334652d3565643861326166383964302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F41223%2F649e1edb-863e-66fa-a34e-5ed8a2af89d0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0e303ff11dd2256c5c2fe1d70a5a5cb7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/41223/649e1edb-863e-66fa-a34e-5ed8a2af89d0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F41223%2F649e1edb-863e-66fa-a34e-5ed8a2af89d0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=223a8cccc4a1f4a3b38662a357409cb3 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"28:1-28:75\"\u003eそれこそ秒で仕込めるので覚えておいて損はないです。\u003c/p\u003e\n","body":"最近、PowerQueryの処理の関係上、同じフォルダに保存した大量のエクセルファイルを連結していく状況が多いのですが、連結後のデータを確認した際に、ノイズが入っている場合は、元のフォルダに戻って該当ファイルを確認、ノイズを補正するような手動によるデータクレンジングする状況が増えてきました。\n\nこのため、PowerQueryで参照するフォルダ名を書いておいて、そのフォルダをエクスプローラで開くマクロの使用頻度が秒で増えており、特に今年に入ってからは大人気です。\n\n## VBAコード\n下記VBAコードを標準モジュールの中に仕込みます。\n```vb:標準モジュール内\n' in mUtils module\nOption Explicit\n\nPublic Sub openWithExplorer()\n\n    Dim row as Integer\n    Dim col as Integer\n\n    ' フォルダのパスが書いてあるセルの参照となる情報は、\n    ' 各自の環境に置き換えてください。\n    row = 3 \n    col = 2\n    Shell \"C:\\Windows\\explorer.exe \" \u0026 Sheet1.Cells(Row, Col), vbNormalFocus\nEnd Sub\n```\n\n下記はシートのオブジェクト名を wsCONFとしたうえで、3行目、2列目にある場合のマクロの画像です。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/41223/649e1edb-863e-66fa-a34e-5ed8a2af89d0.png)\n\nそれこそ秒で仕込めるので覚えておいて損はないです。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:36:40+09:00","group":null,"id":"0e4c975e1518481891ca","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Excel","versions":[]},{"name":"VBA","versions":[]},{"name":"エクセル","versions":[]}],"title":"VBA : セルに記載したパスをエクスプローラで開く","updated_at":"2022-09-18T20:47:18+09:00","url":"https://qiita.com/rcsv/items/0e4c975e1518481891ca","user":{"description":"愛知県にある、それほど大きくない製造業の会社の中で IT とは殆ど関係ない仕事をしています","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"rcsv","id":"rcsv","items_count":6,"linkedin_id":"","location":"愛知県","name":"Thomas","organization":"","permanent_id":41223,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/41223/fa6d751ad224b775a7f7d895d8eedcd4a9eb2426/x_large.png?1640746538","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:9\"\u003e\n\u003cspan id=\"背景\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%83%8C%E6%99%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e背景\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-5:123\"\u003e1年前くらいから、近所のティップネスに通っている。\u003cbr\u003e\n体形はそこまで変わっていないが、前よりもご飯を美味しく食べられるようになったと思う。\u003cbr\u003e\n今回は、ティップネスを参考にスポーツクラブのシステム化を想定して、事業分析を行う。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"7:1-7:34\"\u003e\n\u003cspan id=\"システムコンテキスト1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%881\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシステムコンテキスト1\u003c/h2\u003e\n\u003cp data-sourcepos=\"9:1-9:78\"\u003eまずは、登場人物とシステム、外部システムを洗い出す。\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNDA2cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDozOTdweDtoZWlnaHQ6NDA2cHg7YmFja2dyb3VuZDojRjVGNUY1OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMzk3IDQwNiIgd2lkdGg9IjM5N3B4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcy8+PGc+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiNGNUY1RjU7c3Ryb2tlLXdpZHRoOjEwLjA7IiB3aWR0aD0iMTU2IiB4PSIxMTMuNSIgeT0iMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MCIgeD0iMTIxLjUiIHk9IjE5Ljk5NTEiPuOCt+OCueODhuODoOOCs+ODs+ODhuOCreOCueODiDwvdGV4dD48IS0tTUQ1PVtkMWFjMTU1ZDFiYzc1NzgxNTExZGYxMTQ4ZjkyMWYxZF0KY2x1c3RlciDjg6bjg7zjgrbjg7wtLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjM0NSIgcng9IjM1IiByeT0iMzUiIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDMuMDsiIHdpZHRoPSIxMjgiIHg9IjciIHk9IjM4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjQ5IiB5PSI1NS41MDczIj7jg6bjg7zjgrbjg7w8L3RleHQ+PCEtLU1ENT1bOGFlNzdhZGE2MTY5ODIyNDM1YzNkM2JjYjAxYjY3MjddCmNsdXN0ZXIgc3lzdGVtLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIyNDciIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIyOCIgeD0iMTYzIiB5PSI0Ni4yOTY5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjM3MSIgeT0iNTEuMjk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMzY5IiB5PSI1My4yOTY5Ii8+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSIzNjkiIHk9IjU3LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjI1NSIgeT0iNjkuNTA3MyI+44K344K544OG44OgPC90ZXh0PjwhLS1NRDU9Wzk2NDY0ZTQ4NWE0MDVkOTRlOWJkNmFjMzYwMWI3YjAxXQplbnRpdHkgbWVtYmVyLS0+PGVsbGlwc2UgY3g9IjcxIiBjeT0iNzguNzk2OSIgZmlsbD0iI0ZFRkVDRSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNNzEsODYuNzk2OSBMNzEsMTEzLjc5NjkgTTU4LDk0Ljc5NjkgTDg0LDk0Ljc5NjkgTTcxLDExMy43OTY5IEw1OCwxMjguNzk2OSBNNzEsMTEzLjc5NjkgTDg0LDEyOC43OTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9IjU5IiB5PSIxNDIuNDM1NSI+5Lya5ZOhPC90ZXh0PjwhLS1NRDU9WzdhY2JjNDhiMDhhNjExNWQ2YzllYzdhZDRkM2IzMGNjXQplbnRpdHkgZW1wbG95ZWUtLT48ZWxsaXBzZSBjeD0iNzEiIGN5PSIxODkuNzk2OSIgZmlsbD0iI0ZFRkVDRSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNNzEsMTk3Ljc5NjkgTDcxLDIyNC43OTY5IE01OCwyMDUuNzk2OSBMODQsMjA1Ljc5NjkgTTcxLDIyNC43OTY5IEw1OCwyMzkuNzk2OSBNNzEsMjI0Ljc5NjkgTDg0LDIzOS43OTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzYiIHg9IjUzIiB5PSIyNTMuNDM1NSI+5b6T5qWt5ZOhPC90ZXh0PjwhLS1NRDU9W2M4ODA4MjRiMWE0ZTU4ZjE2NGQ1MWZmMzk3MDkzZTBmXQplbnRpdHkgaW5zdHJ1Y3Rvci0tPjxlbGxpcHNlIGN4PSI3MSIgY3k9IjMwMC43OTY5IiBmaWxsPSIjRkVGRUNFIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjxwYXRoIGQ9Ik03MSwzMDguNzk2OSBMNzEsMzM1Ljc5NjkgTTU4LDMxNi43OTY5IEw4NCwzMTYuNzk2OSBNNzEsMzM1Ljc5NjkgTDU4LDM1MC43OTY5IE03MSwzMzUuNzk2OSBMODQsMzUwLjc5NjkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NiIgeD0iMjMiIHk9IjM2NC40MzU1Ij7jgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7w8L3RleHQ+PCEtLU1ENT1bNzNlMDYzZTFjNDJjZTFiZTAzZTFlNjZlZTc1MDlmYzhdCmVudGl0eSBhcHBseV9zeXN0ZW0tLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjQyLjgwNDciIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg0IiB4PSIxODQuNSIgeT0iNzcuNzk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTAiIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1IiB4PSIyNDguNSIgeT0iODIuNzk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjQ2LjUiIHk9Ijg0Ljc5NjkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjIiIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjQiIHg9IjI0Ni41IiB5PSI4OC43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjE5OS41IiB5PSIxMDguMDA3MyI+5YWl5Lya55Sz6KuLPC90ZXh0PjwhLS1NRDU9Wzk5MDA5Njg5NGFlNDE3N2FlYjA3NmI5MWQxZGI1ZmRmXQplbnRpdHkgbWVtYmVyX3N5c3RlbS0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNDIuODA0NyIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTUiIHg9IjE3OSIgeT0iMTU1Ljc5NjkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjU0IiB5PSIxNjAuNzk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjUyIiB5PSIxNjIuNzk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjUyIiB5PSIxNjYuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1IiB4PSIxOTQiIHk9IjE4Ni4wMDczIj7kvJrlk6HjgrXjgqTjg4g8L3RleHQ+PCEtLU1ENT1bYjEyZDJjZTZlOTlmYThkZjVmY2Q3MTRlMjdhYTgwNGZdCmVudGl0eSBtYW5hZ2VtZW50X3N5c3RlbS0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iNDIuODA0NyIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iOTUiIHg9IjE3OSIgeT0iMjMzLjc5NjkiLz48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjEwIiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNSIgeD0iMjU0IiB5PSIyMzguNzk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjUyIiB5PSIyNDAuNzk2OSIvPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iMjUyIiB5PSIyNDQuNzk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1IiB4PSIxOTQiIHk9IjI2NC4wMDczIj7nrqHnkIbjgrXjgqTjg4g8L3RleHQ+PCEtLU1ENT1bNzQ2ODQ2N2YzYjZiMzkyZjFkMTc2ZDgyOGM3NTNiNzddCmVudGl0eSBkYi0tPjxwYXRoIGQ9Ik0zMzQsMTY0Ljc5NjkgQzMzNCwxNTQuNzk2OSAzNTQuNSwxNTQuNzk2OSAzNTQuNSwxNTQuNzk2OSBDMzU0LjUsMTU0Ljc5NjkgMzc1LDE1NC43OTY5IDM3NSwxNjQuNzk2OSBMMzc1LDE5MC4wOTM4IEMzNzUsMjAwLjA5MzggMzU0LjUsMjAwLjA5MzggMzU0LjUsMjAwLjA5MzggQzM1NC41LDIwMC4wOTM4IDMzNCwyMDAuMDkzOCAzMzQsMTkwLjA5MzggTDMzNCwxNjQuNzk2OSAiIGZpbGw9IiNGRUZFQ0UiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxwYXRoIGQ9Ik0zMzQsMTY0Ljc5NjkgQzMzNCwxNzQuNzk2OSAzNTQuNSwxNzQuNzk2OSAzNTQuNSwxNzQuNzk2OSBDMzU0LjUsMTc0Ljc5NjkgMzc1LDE3NC43OTY5IDM3NSwxNjQuNzk2OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxIiB4PSIzNDQiIHk9IjE5MS43OTIiPkRCPC90ZXh0PjwhLS1NRDU9WzNiMjI2YmFjMDNiYTRhNTNjZjk1NDBmMDE4MTcwMDI1XQpsaW5rIGFwcGx5X3N5c3RlbSB0byBkYi0tPjxwYXRoIGQ9Ik0yNjIuMjYsMTIwLjgxNjkgQzI4NS4yOCwxMzUuMDY2OSAzMTQuNjQsMTUzLjIzNjkgMzMzLjc1LDE2NS4wNjY5ICIgZmlsbD0ibm9uZSIgaWQ9ImFwcGx5X3N5c3RlbS1kYiIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bOGFkNTQ1NzczOGVkZDM4NWQ5ZmRhNDViZTYwZjhkMDZdCmxpbmsgbWFuYWdlbWVudF9zeXN0ZW0gdG8gZGItLT48cGF0aCBkPSJNMjYyLjI2LDIzMy43NzY5IEMyODUuMjgsMjE5LjUyNjkgMzE0LjY0LDIwMS4zNTY5IDMzMy43NSwxODkuNTI2OSAiIGZpbGw9Im5vbmUiIGlkPSJtYW5hZ2VtZW50X3N5c3RlbS1kYiIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bMjE1Y2RjNDNmZjM1YzI4ODU3OWYwM2JjNzQ4MjQ0ZTRdCmxpbmsgbWVtYmVyX3N5c3RlbSB0byBkYi0tPjxwYXRoIGQ9Ik0yNzQuMDYsMTc3LjI5NjkgQzI5NC42NywxNzcuMjk2OSAzMTcuOCwxNzcuMjk2OSAzMzMuNzcsMTc3LjI5NjkgIiBmaWxsPSJub25lIiBpZD0ibWVtYmVyX3N5c3RlbS1kYiIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bNzY3YzU2OTIzMTA2NGE0MTg4MmJmNzcwNTIwN2E3OWRdCmxpbmsgbWVtYmVyIHRvIGFwcGx5X3N5c3RlbS0tPjxwYXRoIGQ9Ik04NS42MiwxMDYuNTg2OSBDMTA3LjU2LDEwNS40NDY5IDE1MS41OCwxMDMuMTQ2OSAxODQuNDEsMTAxLjQzNjkgIiBmaWxsPSJub25lIiBpZD0ibWVtYmVyLWFwcGx5X3N5c3RlbSIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bMjk2ZTA1MWVmOGYwMDMyYmExY2UwOTFiZGE2N2I2OGRdCmxpbmsgbWVtYmVyIHRvIG1lbWJlcl9zeXN0ZW0tLT48cGF0aCBkPSJNODUuNjIsMTEzLjUwNjkgQzEwNi4zMSwxMjIuOTQ2OSAxNDYuNjUsMTQxLjMzNjkgMTc4LjcxLDE1NS45NTY5ICIgZmlsbD0ibm9uZSIgaWQ9Im1lbWJlci1tZW1iZXJfc3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVs0NWNmMDM3NjM4ODhmNjM5Y2RkMjNmODYwZmE4MzFlOV0KbGluayBlbXBsb3llZSB0byBtYW5hZ2VtZW50X3N5c3RlbS0tPjxwYXRoIGQ9Ik04OS4wMSwyMjIuMzk2OSBDMTEwLjU2LDIyNy41ODY5IDE0OC41NCwyMzYuNzQ2OSAxNzguOTcsMjQ0LjA3NjkgIiBmaWxsPSJub25lIiBpZD0iZW1wbG95ZWUtbWFuYWdlbWVudF9zeXN0ZW0iIHN0eWxlPSJzdHJva2U6I0NENUM1QztzdHJva2Utd2lkdGg6MC44OyIvPjwhLS1NRDU9WzkyOTVlODlkYjY4YzlkYTQ3YjQ2MzM2OWIyN2IzMmE4XQpsaW5rIGluc3RydWN0b3IgdG8gbWFuYWdlbWVudF9zeXN0ZW0tLT48cGF0aCBkPSJNMTE5LjMxLDMwNi40ODY5IEMxMzguODYsMjk3LjA2NjkgMTYxLjQzLDI4Ni4xODY5IDE4MC43MSwyNzYuODg2OSAiIGZpbGw9Im5vbmUiIGlkPSJpbnN0cnVjdG9yLW1hbmFnZW1lbnRfc3lzdGVtIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48dGV4dCBmaWxsPSIjODg4ODg4IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MiIgeD0iMzMyIiB5PSIzOTcuNTc5MSI+cy5pbWFtdXJhPC90ZXh0PjwhLS1NRDU9WzQ1YjRhYjI5ZTY4ZTFiNDkzZWExZjE1NmYyYTA4OTAwXQpAc3RhcnR1bWwNCicgPT09IOODieOCreODpeODoeODs+ODiOioreWumiA9PT0NCnJpZ2h0IGZvb3RlciBzLmltYW11cmENCicgbWFpbmZyYW1lIG1haW5mcmFtZQ0KdGl0bGUg44K344K544OG44Og44Kz44Oz44OG44Kt44K544OIDQpsZWZ0IHRvIHJpZ2h0IGRpcmVjdGlvbg0Kc2NhbGUgbWF4IDIwNDggd2lkdGgNCg0KJyA9PT0g44K544K/44Kk44OrID09PQ0Kc2tpbnBhcmFtIHsNCiAgICAnID09PSDlhbHpgJroqK3lrpogPT09DQogICAgc2hhZG93aW5nIGZhbHNlDQogICAgJyBsaW5ldHlwZSBvcnRobw0KICAgIGJhY2tncm91bmRDb2xvciB3aGl0ZXNtb2tlDQogICAgYXJyb3cgew0KICAgICAgICBjb2xvciBpbmRpYW5SZWQNCiAgICAgICAgdGhpY2tuZXNzIDAuOA0KICAgICAgICBmb250U2l6ZSAxMA0KICAgIH0NCiAgICB0aXRsZSB7DQogICAgICAgIEZvbnRTaXplIDE0DQogICAgICAgICcgRm9udENvbG9yIGJsdWUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDEwDQogICAgICAgIEJvcmRlckNvbG9yIHRyYW5zcGFyZW50DQogICAgfQ0KDQogICAgJyA9PT0g6KaB57Sg5Yil6Kit5a6aID09PQ0KICAgIHJlY3RhbmdsZSB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciBidXNpbmVzcw0KICAgICAgICBCb3JkZXJDb2xvciAjMDAwDQogICAgICAgIFJvdW5kQ29ybmVyIDI1DQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDE0DQogICAgfQ0KICAgIGFjdG9yIHsNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIG5vZGUgew0KICAgICAgICBCb3JkZXJDb2xvciAjOTk5OTk5DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMg0KICAgIH0NCiAgICBjb21wb25lbnQgew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCiAgICBzdG9yYWdlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIHdoaXRlDQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjUNCiAgICAgICAgQm9yZGVyQ29sb3IgIzY2NjY2Ng0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTENCiAgICB9DQp9DQoNCnN0b3JhZ2UgIuODpuODvOOCtuODvCIgI2xpbmUuZG90dGVkIHsNCiAgICBhY3RvciAi5Lya5ZOhIiBhcyBtZW1iZXINCiAgICBhY3RvciAi5b6T5qWt5ZOhIiBhcyBlbXBsb3llZQ0KICAgIGFjdG9yICLjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7wiIGFzIGluc3RydWN0b3INCn0NCg0KY29tcG9uZW50ICLjgrfjgrnjg4bjg6AiIGFzIHN5c3RlbSB7DQogICAgY29tcG9uZW50ICLlhaXkvJrnlLPoq4siIGFzIGFwcGx5X3N5c3RlbQ0KICAgIGNvbXBvbmVudCAi5Lya5ZOh44K144Kk44OIIiBhcyBtZW1iZXJfc3lzdGVtDQogICAgY29tcG9uZW50ICLnrqHnkIbjgrXjgqTjg4giIGFzIG1hbmFnZW1lbnRfc3lzdGVtDQogICAgZGF0YWJhc2UgIkRCIiBhcyBkYg0KDQogICAgYXBwbHlfc3lzdGVtIC0gLSBkYg0KICAgIG1hbmFnZW1lbnRfc3lzdGVtIC0gLSBkYg0KICAgIG1lbWJlcl9zeXN0ZW0gLSAtIGRiDQp9DQoNCg0KJyDplqLpgKMNCm1lbWJlciAtIC0gYXBwbHlfc3lzdGVtDQptZW1iZXIgLSAtIG1lbWJlcl9zeXN0ZW0NCmVtcGxveWVlIC0gLSBtYW5hZ2VtZW50X3N5c3RlbQ0KaW5zdHJ1Y3RvciAtIC0gbWFuYWdlbWVudF9zeXN0ZW0NCkBlbmR1bWwNCgpAc3RhcnR1bWwNCnJpZ2h0IGZvb3RlciBzLmltYW11cmENCnRpdGxlIOOCt+OCueODhuODoOOCs+ODs+ODhuOCreOCueODiA0KbGVmdCB0byByaWdodCBkaXJlY3Rpb24NCnNjYWxlIG1heCAyMDQ4IHdpZHRoDQoNCnNraW5wYXJhbSB7DQogICAgc2hhZG93aW5nIGZhbHNlDQogICAgYmFja2dyb3VuZENvbG9yIHdoaXRlc21va2UNCiAgICBhcnJvdyB7DQogICAgICAgIGNvbG9yIGluZGlhblJlZA0KICAgICAgICB0aGlja25lc3MgMC44DQogICAgICAgIGZvbnRTaXplIDEwDQogICAgfQ0KICAgIHRpdGxlIHsNCiAgICAgICAgRm9udFNpemUgMTQNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDEwDQogICAgICAgIEJvcmRlckNvbG9yIHRyYW5zcGFyZW50DQogICAgfQ0KDQogICAgcmVjdGFuZ2xlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIGJ1c2luZXNzDQogICAgICAgIEJvcmRlckNvbG9yICMwMDANCiAgICAgICAgUm91bmRDb3JuZXIgMjUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNg0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTQNCiAgICB9DQogICAgYWN0b3Igew0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTINCiAgICB9DQogICAgbm9kZSB7DQogICAgICAgIEJvcmRlckNvbG9yICM5OTk5OTkNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIGNvbXBvbmVudCB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciB3aGl0ZQ0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMC41DQogICAgICAgIEJvcmRlckNvbG9yICM2NjY2NjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDExDQogICAgfQ0KICAgIHN0b3JhZ2Ugew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCn0NCg0Kc3RvcmFnZSAi44Om44O844K244O8IiAjbGluZS5kb3R0ZWQgew0KICAgIGFjdG9yICLkvJrlk6EiIGFzIG1lbWJlcg0KICAgIGFjdG9yICLlvpPmpa3lk6EiIGFzIGVtcGxveWVlDQogICAgYWN0b3IgIuOCpOODs+OCueODiOODqeOCr+OCv+ODvCIgYXMgaW5zdHJ1Y3Rvcg0KfQ0KDQpjb21wb25lbnQgIuOCt+OCueODhuODoCIgYXMgc3lzdGVtIHsNCiAgICBjb21wb25lbnQgIuWFpeS8mueUs+iriyIgYXMgYXBwbHlfc3lzdGVtDQogICAgY29tcG9uZW50ICLkvJrlk6HjgrXjgqTjg4giIGFzIG1lbWJlcl9zeXN0ZW0NCiAgICBjb21wb25lbnQgIueuoeeQhuOCteOCpOODiCIgYXMgbWFuYWdlbWVudF9zeXN0ZW0NCiAgICBkYXRhYmFzZSAiREIiIGFzIGRiDQoNCiAgICBhcHBseV9zeXN0ZW0gLSAtIGRiDQogICAgbWFuYWdlbWVudF9zeXN0ZW0gLSAtIGRiDQogICAgbWVtYmVyX3N5c3RlbSAtIC0gZGINCn0NCg0KDQptZW1iZXIgLSAtIGFwcGx5X3N5c3RlbQ0KbWVtYmVyIC0gLSBtZW1iZXJfc3lzdGVtDQplbXBsb3llZSAtIC0gbWFuYWdlbWVudF9zeXN0ZW0NCmluc3RydWN0b3IgLSAtIG1hbmFnZW1lbnRfc3lzdGVtDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjEuMTYoV2VkIERlYyAwOCAxNzoyNToyMiBVVEMgMjAyMSkKKEdQTCBzb3VyY2UgZGlzdHJpYnV0aW9uKQpKYXZhIFJ1bnRpbWU6IE9wZW5KREsgUnVudGltZSBFbnZpcm9ubWVudApKVk06IE9wZW5KREsgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogbnVsbAotLT48L2c+PC9zdmc+\" loading=\"lazy\"\u003e\n\u003cp data-sourcepos=\"100:1-102:78\"\u003e使ったことは無いが、おそらく店舗側の管理サイトがあるだろう。\u003cbr\u003e\n一般会員向けには契約時の申し込みサイトと、会員用のサイトがある。\u003cbr\u003e\nシステム構築の目的については、整理した後で記述する。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"104:1-104:22\"\u003e\n\u003cspan id=\"システム要求1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E8%A6%81%E6%B1%821\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシステム要求1\u003c/h2\u003e\n\u003cp data-sourcepos=\"106:1-106:69\"\u003eシステムへの要求事項を以下にリストアップした。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"108:1-108:16\"\u003e\n\u003cspan id=\"要求一覧\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%81%E6%B1%82%E4%B8%80%E8%A6%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e要求一覧\u003c/h3\u003e\n\u003cul data-sourcepos=\"110:1-113:0\"\u003e\n\u003cli data-sourcepos=\"110:1-110:26\"\u003e事前web申込したい\u003c/li\u003e\n\u003cli data-sourcepos=\"111:1-111:50\"\u003e会員サイトから、ポイント貯めたい\u003c/li\u003e\n\u003cli data-sourcepos=\"112:1-113:0\"\u003e会員にカードを発行し、入退館の際はカードのバーコードをシステムで読み取らせる\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"114:1-115:24\"\u003e一旦このままにしておく。\u003cbr\u003e\nあとで図示する。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"117:1-117:34\"\u003e\n\u003cspan id=\"ビジネスコンテキスト1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%881\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビジネスコンテキスト1\u003c/h2\u003e\n\u003cp data-sourcepos=\"119:1-119:33\"\u003e主要な業務を洗い出す。\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMjE5cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo2NTBweDtoZWlnaHQ6MjE5cHg7YmFja2dyb3VuZDojRjVGNUY1OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNjUwIDIxOSIgd2lkdGg9IjY1MHB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcy8+PGc+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiNGNUY1RjU7c3Ryb2tlLXdpZHRoOjEwLjA7IiB3aWR0aD0iMTU2IiB4PSIyNDAuMjUiIHk9IjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDAiIHg9IjI0OC4yNSIgeT0iMTkuOTk1MSI+44OT44K444ON44K544Kz44Oz44OG44Kt44K544OIPC90ZXh0PjwhLS1NRDU9Wzk2NDY0ZTQ4NWE0MDVkOTRlOWJkNmFjMzYwMWI3YjAxXQplbnRpdHkgbWVtYmVyLS0+PGVsbGlwc2UgY3g9IjE5IiBjeT0iODQuMjk2OSIgZmlsbD0iI0ZFRkVDRSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNMTksOTIuMjk2OSBMMTksMTE5LjI5NjkgTTYsMTAwLjI5NjkgTDMyLDEwMC4yOTY5IE0xOSwxMTkuMjk2OSBMNiwxMzQuMjk2OSBNMTksMTE5LjI5NjkgTDMyLDEzNC4yOTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9IjciIHk9IjE0Ny45MzU1Ij7kvJrlk6E8L3RleHQ+PCEtLU1ENT1bN2FjYmM0OGIwOGE2MTE1ZDZjOWVjN2FkNGQzYjMwY2NdCmVudGl0eSBlbXBsb3llZS0tPjxlbGxpcHNlIGN4PSI2MjUuNSIgY3k9IjgzLjI5NjkiIGZpbGw9IiNGRUZFQ0UiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHBhdGggZD0iTTYyNS41LDkxLjI5NjkgTDYyNS41LDExOC4yOTY5IE02MTIuNSw5OS4yOTY5IEw2MzguNSw5OS4yOTY5IE02MjUuNSwxMTguMjk2OSBMNjEyLjUsMTMzLjI5NjkgTTYyNS41LDExOC4yOTY5IEw2MzguNSwxMzMuMjk2OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM2IiB4PSI2MDcuNSIgeT0iMTQ2LjkzNTUiPuW+k+alreWToTwvdGV4dD48IS0tTUQ1PVtjODgwODI0YjFhNGU1OGYxNjRkNTFmZjM5NzA5M2UwZl0KZW50aXR5IGluc3RydWN0b3ItLT48ZWxsaXBzZSBjeD0iMzA5LjUiIGN5PSIxMjguMjk2OSIgZmlsbD0iI0ZFRkVDRSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNMzA5LjUsMTM2LjI5NjkgTDMwOS41LDE2My4yOTY5IE0yOTYuNSwxNDQuMjk2OSBMMzIyLjUsMTQ0LjI5NjkgTTMwOS41LDE2My4yOTY5IEwyOTYuNSwxNzguMjk2OSBNMzA5LjUsMTYzLjI5NjkgTDMyMi41LDE3OC4yOTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTYiIHg9IjI2MS41IiB5PSIxOTEuOTM1NSI+44Kk44Oz44K544OI44Op44Kv44K/44O8PC90ZXh0PjwhLS1NRDU9W2VlOWNiOTM1ZTQ5OTI4NzdiNDI2YjkzZGY1ZmM1ZjIxXQplbnRpdHkg5Lya5ZOh55m76YyyLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIzMi44MDQ3IiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjQiIHg9IjI3Ny41IiB5PSIzOC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjI4Ny41IiB5PSI1OC41MDczIj7kvJrlk6HnmbvpjLI8L3RleHQ+PCEtLU1ENT1bNzk0NWZlNmYwOThhNDBlOWIxMmEyODIyMzc4ZmRlOTBdCmVudGl0eSDlhaXpgIDppKgtLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjgwNDciIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI1MyIgeD0iMTIxIiB5PSI5Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMiIHg9IjEzMSIgeT0iMTE2LjUwNzMiPuWFpemAgOmkqDwvdGV4dD48IS0tTUQ1PVtkZmY5NWIyNjA3MTYxNzAxNmZiZjYxNmFmMjEzZDk5OF0KZW50aXR5IOOCueOCv+OCuOOCquODrOODg+OCueODsy0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuODA0NyIgcng9IjM1IiByeT0iMzUiIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEwOCIgeD0iOTMuNSIgeT0iMTY0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OCIgeD0iMTAzLjUiIHk9IjE4NC41MDczIj7jgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7M8L3RleHQ+PCEtLU1ENT1bZGJjZWRkZTFmMDkzZTRmMjg0MmQ3NDJhOTE5NWUwYzVdCmVudGl0eSDjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7znrqHnkIYtLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjgwNDciIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMzAiIHg9IjQxNy41IiB5PSIxMzAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMCIgeD0iNDI3LjUiIHk9IjE1MC41MDczIj7jgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7znrqHnkIY8L3RleHQ+PCEtLU1ENT1bMjBlMTJlZDY2NzM5ZTZhNWI3NDczYzQ1OWYyOTcyODFdCmxpbmsgbWVtYmVyIHRvIOS8muWToeeZu+mMsi0tPjxwYXRoIGQ9Ik0zMy41OCwxMDQuODg2OSBDNDcuOTYsOTYuOTA2OSA3MS41Niw4NC45MTY5IDkzLjUsNzguNzk2OSBDMTU3LjE3LDYxLjAyNjkgMjM0LjkxLDU2LjM0NjkgMjc3LjI5LDU1LjE1NjkgIiBmaWxsPSJub25lIiBpZD0ibWVtYmVyLeS8muWToeeZu+mMsiIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bNzk3ZjJhMDZmNWMxNTE4MzdmMzNiNThhMGM3ZmM0MmNdCmxpbmsgbWVtYmVyIHRvIOWFpemAgOmkqC0tPjxwYXRoIGQ9Ik0zMy41NCwxMTIuNzk2OSBDNTQuMzIsMTEyLjc5NjkgOTQuNDMsMTEyLjc5NjkgMTIwLjgzLDExMi43OTY5ICIgZmlsbD0ibm9uZSIgaWQ9Im1lbWJlci3lhaXpgIDppKgiIHN0eWxlPSJzdHJva2U6I0NENUM1QztzdHJva2Utd2lkdGg6MC44OyIvPjwhLS1NRDU9WzFlMjQ1ZDMyYTk5N2NkMjJhZDc2OGY0ZWJiZWVhMDM0XQpsaW5rIG1lbWJlciB0byDjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MtLT48cGF0aCBkPSJNMzMuNTQsMTIwLjA3NjkgQzUyLjk4LDEzMC41MjY5IDg5LjM0LDE1MC4wNzY5IDExNS41NywxNjQuMTY2OSAiIGZpbGw9Im5vbmUiIGlkPSJtZW1iZXIt44K544K/44K444Kq44Os44OD44K544OzIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVtiOGZmYWNkNTcxNDEzODEzN2UwZDMyNWU1ODc4YTMzYV0KbGluayDjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MgdG8gaW5zdHJ1Y3Rvci0tPjxwYXRoIGQ9Ik0yMDEuNzgsMTcyLjgwNjkgQzIyMS4wNSwxNjkuOTE2OSAyNDIuNjYsMTY2LjY3NjkgMjYxLjM3LDE2My44NjY5ICIgZmlsbD0ibm9uZSIgaWQ9IuOCueOCv+OCuOOCquODrOODg+OCueODsy1pbnN0cnVjdG9yIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVs3OTgzZDc3OTE3MjlmNTQzZjQ5ZjYxYWExNjRmNWEyZV0KbGluayBpbnN0cnVjdG9yIHRvIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhi0tPjxwYXRoIGQ9Ik0zNTcuNjgsMTU0LjAzNjkgQzM3Ni4wNywxNTIuOTY2OSAzOTcuNDQsMTUxLjcxNjkgNDE3LjE5LDE1MC41NTY5ICIgZmlsbD0ibm9uZSIgaWQ9Imluc3RydWN0b3It44Kk44Oz44K544OI44Op44Kv44K/44O8566h55CGIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVszMzM2MjU5NjUzOGE3ODIwZWRlMjE5Y2IwNTUwYTE1NV0KbGluayDkvJrlk6HnmbvpjLIgdG8gZW1wbG95ZWUtLT48cGF0aCBkPSJNMzQxLjc2LDYwLjQ2NjkgQzQwNy4yMiw3Mi4zNTY5IDU1Ni44NSw5OS41MTY5IDYwNy40MywxMDguNjk2OSAiIGZpbGw9Im5vbmUiIGlkPSLkvJrlk6HnmbvpjLItZW1wbG95ZWUiIHN0eWxlPSJzdHJva2U6I0NENUM1QztzdHJva2Utd2lkdGg6MC44OyIvPjwhLS1NRDU9W2UzM2UyYzMyMWU0NDliOGE4YWI2ZWEzNzk2MzBmOWRhXQpsaW5rIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhiB0byBlbXBsb3llZS0tPjxwYXRoIGQ9Ik01NDcuODEsMTMwLjgzNjkgQzU2OS43NSwxMjUuMzg2OSA1OTIuNDksMTE5Ljc0NjkgNjA3LjQ1LDExNi4wMjY5ICIgZmlsbD0ibm9uZSIgaWQ9IuOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhi1lbXBsb3llZSIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PHRleHQgZmlsbD0iIzg4ODg4OCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTAiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIiIHg9IjU4NS41IiB5PSIyMTEuMzgzOCI+cy5pbWFtdXJhPC90ZXh0PjwhLS1NRDU9WzNkMTcyYzNhODEwZjAwZDY5Y2E4YjQ0OWIwM2ViOWZkXQpAc3RhcnR1bWwNCicgPT09IOODieOCreODpeODoeODs+ODiOioreWumiA9PT0NCnJpZ2h0IGZvb3RlciBzLmltYW11cmENCicgbWFpbmZyYW1lIG1haW5mcmFtZQ0KdGl0bGUg44OT44K444ON44K544Kz44Oz44OG44Kt44K544OIDQpsZWZ0IHRvIHJpZ2h0IGRpcmVjdGlvbg0Kc2NhbGUgbWF4IDIwNDggd2lkdGgNCg0KJyA9PT0g44K544K/44Kk44OrID09PQ0Kc2tpbnBhcmFtIHsNCiAgICAnID09PSDlhbHpgJroqK3lrpogPT09DQogICAgc2hhZG93aW5nIGZhbHNlDQogICAgJyBsaW5ldHlwZSBvcnRobw0KICAgIGJhY2tncm91bmRDb2xvciB3aGl0ZXNtb2tlDQogICAgYXJyb3cgew0KICAgICAgICBjb2xvciBpbmRpYW5SZWQNCiAgICAgICAgdGhpY2tuZXNzIDAuOA0KICAgICAgICBmb250U2l6ZSAxMA0KICAgIH0NCiAgICB0aXRsZSB7DQogICAgICAgIEZvbnRTaXplIDE0DQogICAgICAgICcgRm9udENvbG9yIGJsdWUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDEwDQogICAgICAgIEJvcmRlckNvbG9yIHRyYW5zcGFyZW50DQogICAgfQ0KDQogICAgJyA9PT0g6KaB57Sg5Yil6Kit5a6aID09PQ0KICAgIHJlY3RhbmdsZSB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciBidXNpbmVzcw0KICAgICAgICBCb3JkZXJDb2xvciAjMDAwDQogICAgICAgIFJvdW5kQ29ybmVyIDI1DQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDE0DQogICAgfQ0KICAgIGFjdG9yIHsNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIG5vZGUgew0KICAgICAgICBCb3JkZXJDb2xvciAjOTk5OTk5DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMg0KICAgIH0NCiAgICBjb21wb25lbnQgew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCiAgICBzdG9yYWdlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIHdoaXRlDQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjUNCiAgICAgICAgQm9yZGVyQ29sb3IgIzY2NjY2Ng0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTENCiAgICB9DQp9DQoNCg0KJyDjgqLjgq/jgr/jg7wNCmFjdG9yIOS8muWToSBhcyBtZW1iZXINCmFjdG9yIOW+k+alreWToSBhcyBlbXBsb3llZQ0KYWN0b3Ig44Kk44Oz44K544OI44Op44Kv44K/44O8IGFzIGluc3RydWN0b3INCg0KJyDmpa3li5kNCnN0b3JhZ2Ug5Lya5ZOh55m76YyyDQpzdG9yYWdlIOWFpemAgOmkqA0Kc3RvcmFnZSDjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MNCnN0b3JhZ2Ug44Kk44Oz44K544OI44Op44Kv44K/44O8566h55CGDQoNCicg44KC44GuDQoNCg0KJyDplqLpgKMNCm1lbWJlciAtIC0g5Lya5ZOh55m76YyyDQptZW1iZXIgLSAtIOWFpemAgOmkqA0KbWVtYmVyIC0gLSDjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MNCg0KDQrjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MgLSAtIGluc3RydWN0b3INCmluc3RydWN0b3IgLSAtIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhg0KDQrkvJrlk6HnmbvpjLIgLSAtIGVtcGxveWVlDQrjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7znrqHnkIYgLSAtIGVtcGxveWVlDQpAZW5kdW1sDQoKQHN0YXJ0dW1sDQpyaWdodCBmb290ZXIgcy5pbWFtdXJhDQp0aXRsZSDjg5Pjgrjjg43jgrnjgrPjg7Pjg4bjgq3jgrnjg4gNCmxlZnQgdG8gcmlnaHQgZGlyZWN0aW9uDQpzY2FsZSBtYXggMjA0OCB3aWR0aA0KDQpza2lucGFyYW0gew0KICAgIHNoYWRvd2luZyBmYWxzZQ0KICAgIGJhY2tncm91bmRDb2xvciB3aGl0ZXNtb2tlDQogICAgYXJyb3cgew0KICAgICAgICBjb2xvciBpbmRpYW5SZWQNCiAgICAgICAgdGhpY2tuZXNzIDAuOA0KICAgICAgICBmb250U2l6ZSAxMA0KICAgIH0NCiAgICB0aXRsZSB7DQogICAgICAgIEZvbnRTaXplIDE0DQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAxMA0KICAgICAgICBCb3JkZXJDb2xvciB0cmFuc3BhcmVudA0KICAgIH0NCg0KICAgIHJlY3RhbmdsZSB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciBidXNpbmVzcw0KICAgICAgICBCb3JkZXJDb2xvciAjMDAwDQogICAgICAgIFJvdW5kQ29ybmVyIDI1DQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDE0DQogICAgfQ0KICAgIGFjdG9yIHsNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIG5vZGUgew0KICAgICAgICBCb3JkZXJDb2xvciAjOTk5OTk5DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMg0KICAgIH0NCiAgICBjb21wb25lbnQgew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCiAgICBzdG9yYWdlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIHdoaXRlDQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjUNCiAgICAgICAgQm9yZGVyQ29sb3IgIzY2NjY2Ng0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTENCiAgICB9DQp9DQoNCg0KYWN0b3Ig5Lya5ZOhIGFzIG1lbWJlcg0KYWN0b3Ig5b6T5qWt5ZOhIGFzIGVtcGxveWVlDQphY3RvciDjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7wgYXMgaW5zdHJ1Y3Rvcg0KDQpzdG9yYWdlIOS8muWToeeZu+mMsg0Kc3RvcmFnZSDlhaXpgIDppKgNCnN0b3JhZ2Ug44K544K/44K444Kq44Os44OD44K544OzDQpzdG9yYWdlIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhg0KDQoNCg0KbWVtYmVyIC0gLSDkvJrlk6HnmbvpjLINCm1lbWJlciAtIC0g5YWl6YCA6aSoDQptZW1iZXIgLSAtIOOCueOCv+OCuOOCquODrOODg+OCueODsw0KDQoNCuOCueOCv+OCuOOCquODrOODg+OCueODsyAtIC0gaW5zdHJ1Y3Rvcg0KaW5zdHJ1Y3RvciAtIC0g44Kk44Oz44K544OI44Op44Kv44K/44O8566h55CGDQoNCuS8muWToeeZu+mMsiAtIC0gZW1wbG95ZWUNCuOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhiAtIC0gZW1wbG95ZWUNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS4xNihXZWQgRGVjIDA4IDE3OjI1OjIyIFVUQyAyMDIxKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogT3BlbkpESyBSdW50aW1lIEVudmlyb25tZW50CkpWTTogT3BlbkpESyA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBudWxsCi0tPjwvZz48L3N2Zz4=\" loading=\"lazy\"\u003e\n\u003cp data-sourcepos=\"212:1-212:54\"\u003eとりあえず、最初に思いついたものだけ\u003c/p\u003e\n\u003ch2 data-sourcepos=\"215:1-215:19\"\u003e\n\u003cspan id=\"情報モデル1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%83%85%E5%A0%B1%E3%83%A2%E3%83%87%E3%83%AB1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e情報モデル1\u003c/h2\u003e\n\u003cp data-sourcepos=\"217:1-220:41\"\u003eシステムの中で使われていそうな用語（概念）を関連づける。\u003cbr\u003e\nとりあえず最初のモデルとして、用語の洗い出しと関連付けをしてみた。\u003cbr\u003e\n用語は、会則から抜き出した\u003cbr\u003e\n\u003ca href=\"https://i.tipness.co.jp/i/pdf/kaisoku.pdf\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://i.tipness.co.jp/i/pdf/kaisoku.pdf\u003c/a\u003e\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNzc3cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo5MjlweDtoZWlnaHQ6Nzc3cHg7YmFja2dyb3VuZDojRjVGNUY1OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgOTI5IDc3NyIgd2lkdGg9IjkyOXB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcy8+PGc+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiNGNUY1RjU7c3Ryb2tlLXdpZHRoOjEwLjA7IiB3aWR0aD0iMTE0IiB4PSI0MDAuNSIgeT0iMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSI0MDguNSIgeT0iMTkuOTk1MSI+44OJ44Oh44Kk44Oz44Oi44OH44OrPC90ZXh0PjwhLS1NRDU9Wzg0ZjcxZmYwM2NjNjU3MDU0NDE1ZDAwMzQ4OTQzODExXQpjbHVzdGVyIOS8muWToemWoumAoy0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMjQwIiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDc4IiB4PSI3IiB5PSIyNDUuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iMjI0IiB5PSIyNjIuNTA3MyI+5Lya5ZOh6Zai6YCjPC90ZXh0PjwhLS1NRDU9WzUwYmJmYjA3OGE3MjMwZTU3ZTZmYzhmZmE4NWRlYTI4XQpjbHVzdGVyIOS8muiyu+mWoumAoy0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMTgzIiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDU3IiB4PSIxNCIgeT0iMzguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iMjIwLjUiIHk9IjU1LjUwNzMiPuS8muiyu+mWoumAozwvdGV4dD48IS0tTUQ1PVs1OWY5NjJiZGNiNDRmN2Q0YTMwMjAyMmNjMjliY2M3ZF0KZW50aXR5IOS8muWToS0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDgiIHg9IjM3IiB5PSI0NDcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0NyIgeT0iNDYzLjI5MiI+5Lya5ZOhPC90ZXh0PjwhLS1NRDU9WzU3YjcxMTI1Y2ZhNzNhOWVlMjhiNzAzYjA1NWY3N2M5XQplbnRpdHkg6Kaq5qip6ICFLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2MiIgeD0iMzAiIHk9IjM5MC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjQwIiB5PSI0MDYuMjkyIj7opqrmqKnogIU8L3RleHQ+PCEtLU1ENT1bMWM0MGUxYmIxZjE1MTZkNWQwMmUyNmI1ODg0NWJmYjhdCmVudGl0eSDpmaTlkI3lh6bliIYtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9Ijc2IiB4PSIyMyIgeT0iMzMzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iMzMiIHk9IjM0OS4yOTIiPumZpOWQjeWHpuWIhjwvdGV4dD48IS0tTUQ1PVs2MWZmMTRjMGQ0Y2FmYzU5ZmUwOTI2MjY2YWYyNWZlY10KZW50aXR5IOawj+WQjS0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDgiIHg9IjM3IiB5PSIyNzYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0NyIgeT0iMjkyLjI5MiI+5rCP5ZCNPC90ZXh0PjwhLS1NRDU9WzA0MGE3MzgyMzQ2ZDJlZDZjNmE3MzgwMGQzN2M2MDc3XQplbnRpdHkg5Lya5ZOh55Wq5Y+3LS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3NiIgeD0iMTk0IiB5PSI0NDcuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIyMDQiIHk9IjQ2My4yOTIiPuS8muWToeeVquWPtzwvdGV4dD48IS0tTUQ1PVtjZjBkMDA5NGNmMmIwYjgyNWZkNDA0Mzc0ZTc1MGNlYV0KZW50aXR5IOODkeOCueODr+ODvOODiS0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iOTAiIHg9IjE4NyIgeT0iMzkwLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MCIgeD0iMTk3IiB5PSI0MDYuMjkyIj7jg5Hjgrnjg6/jg7zjg4k8L3RleHQ+PCEtLU1ENT1bMmNjYWZmZmI0OTg3ZjA2NGEwOWY0NTQ1MDI5ZmQ5YWJdCmVudGl0eSDjg6Hjg7zjg6vjgqLjg4njg6zjgrktLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjExOCIgeD0iMTczIiB5PSIzMzMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk4IiB4PSIxODMiIHk9IjM0OS4yOTIiPuODoeODvOODq+OCouODieODrOOCuTwvdGV4dD48IS0tTUQ1PVtiOGRhNTUwNWRhM2JjYzY2YWVmODM0MDc4ZDE1M2MzN10KZW50aXR5IOmhlOWGmeecny0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjIiIHg9IjIwMSIgeT0iMjc2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MiIgeD0iMjExIiB5PSIyOTIuMjkyIj7poZTlhpnnnJ88L3RleHQ+PCEtLU1ENT1bMWRlMzFhNmNhYzBhMzg5N2ZhNTI3NTcxMTVlYjk2NmZdCmVudGl0eSDkvJrlk6HoqLwtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjYyIiB4PSI0MDAiIHk9IjQ0Ny4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjQxMCIgeT0iNDYzLjI5MiI+5Lya5ZOh6Ki8PC90ZXh0PjwhLS1NRDU9W2E3OTdmOGEyNjcwYzZhMDI1OTMzYTgyNTAzYmM3NTJlXQplbnRpdHkg5Lya5ZOh56iu6aGeLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3NiIgeD0iMzkzIiB5PSIzOTAuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSI0MDMiIHk9IjQwNi4yOTIiPuS8muWToeeorumhnjwvdGV4dD48IS0tTUQ1PVsxZDk1N2UwYjYyZDZjOGQ2MTM3YTM2MDA1Zjg5MjgwOV0KZW50aXR5IOS8muiyuy0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDgiIHg9IjM3IiB5PSIxODMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0NyIgeT0iMTk5LjI5MiI+5Lya6LK7PC90ZXh0PjwhLS1NRDU9Wzc5MDI3Zjc2YTM3NzY5ZmFlMmI4ZWJjODc1ODc4Y2ExXQplbnRpdHkg5YWl5Lya6YeRLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2MiIgeD0iMzAiIHk9IjEyNi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjQwIiB5PSIxNDIuMjkyIj7lhaXkvJrph5E8L3RleHQ+PCEtLU1ENT1bNmVjYTVkOTg5Y2Q4NTFhY2Q1NjkwNWQxOTEzZDA2ODNdCmVudGl0eSDlibLlvJUtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQ4IiB4PSIzNyIgeT0iNjkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0NyIgeT0iODUuMjkyIj7libLlvJU8L3RleHQ+PCEtLU1ENT1bNTE2YzFkYmIzZmUwNTQxMmRhZGZjYzJkZGY0NDVkMDhdCmVudGl0eSDmtojosrvnqI4tLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjYyIiB4PSIyMDEiIHk9IjE4My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDIiIHg9IjIxMSIgeT0iMTk5LjI5MiI+5raI6LK756iOPC90ZXh0PjwhLS1NRDU9W2UwYzJiNjI4MDg4NDRkYTc2ZWJhOGQyZWY5NmU0MGE4XQplbnRpdHkg5pSv5omV5pa55rOVLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3NiIgeD0iMTk0IiB5PSIxMjYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIyMDQiIHk9IjE0Mi4yOTIiPuaUr+aJleaWueazlTwvdGV4dD48IS0tTUQ1PVtjOTZiZGY5ZDU0Y2ExNDA3NjVhNmVkYjJkMTAyYjA4MF0KZW50aXR5IOaUr+aJleaZguacny0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNzYiIHg9IjE5NCIgeT0iNjkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSIyMDQiIHk9Ijg1LjI5MiI+5pSv5omV5pmC5pyfPC90ZXh0PjwhLS1NRDU9W2VmZWVjOWE1OGRiYzM2MDJjNzk3OTgyNmU3OGE2NzJmXQplbnRpdHkg5rue57SNLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0OCIgeD0iNDA3IiB5PSIxODMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0MTciIHk9IjE5OS4yOTIiPua7nue0jTwvdGV4dD48IS0tTUQ1PVtjMGMxZWE4ZGZiY2YwYTg5ZGViMTY0YWM1NGU3MjdjMl0KZW50aXR5IOWQjOS8tOODk+OCuOOCv+ODvC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTA0IiB4PSI5IiB5PSI1MDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0IiB4PSIxOSIgeT0iNTIwLjI5MiI+5ZCM5Ly044OT44K444K/44O8PC90ZXh0PjwhLS1NRDU9W2RjYWFiMTNiNWVjNDQyYjVmNmQ1NDRkYjk1NjFjZTFkXQplbnRpdHkg5YWl5LyaLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0OCIgeD0iMzciIHk9IjU2MS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjQ3IiB5PSI1NzcuMjkyIj7lhaXkvJo8L3RleHQ+PCEtLU1ENT1bMjA2MDc0YWU2ZTUzOTkzMWZlNGUxMmM0OWE0N2EyNTVdCmVudGl0eSDlpZHntITmnJ/plpMtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9Ijc2IiB4PSIyMyIgeT0iNjE4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iMzMiIHk9IjYzNC4yOTIiPuWlkee0hOacn+mWkzwvdGV4dD48IS0tTUQ1PVs4MjZiZDBkNWFhMTM1OTcyNDZkMmM3MmZiYzE0YjQ5YV0KZW50aXR5IOmAgOS8mi0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDgiIHg9IjM3IiB5PSI2NzUuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0NyIgeT0iNjkxLjI5MiI+6YCA5LyaPC90ZXh0PjwhLS1NRDU9WzQ1ZmFmYWM2NjlkZDFkYWJjMzA2NjY2MDM1MzZmNWU0XQplbnRpdHkg6YCA5Lya5biM5pyb5pyILS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI5MCIgeD0iMTYiIHk9IjczMi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjI2IiB5PSI3NDguMjkyIj7pgIDkvJrluIzmnJvmnIg8L3RleHQ+PCEtLU1ENT1bZTZmZGE5ZWYyMTJiZmZlMWU2NTgyNTc4M2VhNWNjYTZdCmVudGl0eSDkvJHkvJotLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQ4IiB4PSIyMDgiIHk9IjUwNC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjIxOCIgeT0iNTIwLjI5MiI+5LyR5LyaPC90ZXh0PjwhLS1NRDU9WzUzNTg5MTU0NDAxNDZlYjNlNmZjZjRhNmU2ZWM2OThlXQplbnRpdHkg5LyR5Lya5pyI5Lya6LK7LS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI5MCIgeD0iMTg3IiB5PSI1NjEuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcwIiB4PSIxOTciIHk9IjU3Ny4yOTIiPuS8keS8muaciOS8muiyuzwvdGV4dD48IS0tTUQ1PVswY2RiM2Y4YWVmNjljZjEwNGFjYjRhYzcxNDNjN2I2NF0KZW50aXR5IOS8keS8muacn+mWky0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNzYiIHg9IjE5NCIgeT0iNjE4LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iMjA0IiB5PSI2MzQuMjkyIj7kvJHkvJrmnJ/plpM8L3RleHQ+PCEtLU1ENT1bNWM5ODkyYjVkMDQwY2M3YmJlYzYxNmQwYzk3OTJjM2JdCmVudGl0eSDkvJHkvJrluIzmnJvmnIgtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjkwIiB4PSIxODciIHk9IjY3NS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjE5NyIgeT0iNjkxLjI5MiI+5LyR5Lya5biM5pyb5pyIPC90ZXh0PjwhLS1NRDU9WzI4ZTNiZjJjYmVjOWFjYTc1Nzg1YWQ0OTNjMWE1NGViXQplbnRpdHkg5LyR5Lya5omL57aa5pyf6ZmQLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMDQiIHg9IjE4MCIgeT0iNzMyLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NCIgeD0iMTkwIiB5PSI3NDguMjkyIj7kvJHkvJrmiYvntprmnJ/pmZA8L3RleHQ+PCEtLU1ENT1bNDAxMzc5ZWU5OWZiMTAyYjNkNzk2OThhY2FmYWY3YWJdCmVudGl0eSDjg5fjg6njgqTjg5njg7zjg4jjg63jg4Pjgqvjg7wtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE2MCIgeD0iMzUxIiB5PSI1MDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MCIgeD0iMzYxIiB5PSI1MjAuMjkyIj7jg5fjg6njgqTjg5njg7zjg4jjg63jg4Pjgqvjg7w8L3RleHQ+PCEtLU1ENT1bZTc5YTdjZmI4NDlkNjg0MmQyMjk3YTNkNjM0NDRlNDhdCmVudGl0eSDlpInmm7TmiYvntprjgY0tLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjkwIiB4PSIzODYiIHk9IjU2MS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzAiIHg9IjM5NiIgeT0iNTc3LjI5MiI+5aSJ5pu05omL57aa44GNPC90ZXh0PjwhLS1NRDU9WzU4NmQ0MWY2MDFkOWFkYjI1MGE0YTQxOGQ1N2MxZWI2XQplbnRpdHkg5pa96KitLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0OCIgeD0iNDA3IiB5PSI2MTguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI4IiB4PSI0MTciIHk9IjYzNC4yOTIiPuaWveiorTwvdGV4dD48IS0tTUQ1PVs4YWFlZTY0M2E2NTEyNDlhNGVkMWE2YWYzOGE2YzRlN10KZW50aXR5IOS8kemkqOaXpS0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNjIiIHg9IjQwMCIgeT0iNjc1LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MiIgeD0iNDEwIiB5PSI2OTEuMjkyIj7kvJHppKjml6U8L3RleHQ+PCEtLU1ENT1bMmY2NzEwYzRjYjQ2M2Q4Yjk3ZDRhNDE2YzcyYTRiZTddCmVudGl0eSDlubTmrKHkvJHppKgtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9Ijc2IiB4PSIzOTMiIHk9IjczMi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTYiIHg9IjQwMyIgeT0iNzQ4LjI5MiI+5bm05qyh5LyR6aSoPC90ZXh0PjwhLS1NRDU9WzQ4ODNjMmIyY2MyMGUyNDZhMTk3OTZhMWE4NjU3ZWNmXQplbnRpdHkg5a6a5pyf5LyR6aSoLS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3NiIgeD0iNjI3IiB5PSI1MDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU2IiB4PSI2MzciIHk9IjUyMC4yOTIiPuWumuacn+S8kemkqDwvdGV4dD48IS0tTUQ1PVsyMjAyYmU1NjA2ZjZmOTU4YmNkMjc2OTY0OThmZWQ1Nl0KZW50aXR5IOS8muiyu+i/lOmHkS0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNzYiIHg9IjYyNyIgeT0iNTYxLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iNjM3IiB5PSI1NzcuMjkyIj7kvJrosrvov5Tph5E8L3RleHQ+PCEtLU1ENT1bMjNlMmYyMDhiYzk3ZGI2NzdiNmYzZDA1YzdhMWYxNjFdCmVudGl0eSDlupfoiJctLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQ4IiB4PSI2NDEiIHk9IjYxOC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjgiIHg9IjY1MSIgeT0iNjM0LjI5MiI+5bqX6IiXPC90ZXh0PjwhLS1NRDU9WzM1ZjZkMzM0M2EwMzBmMWJkZDA2ZGU4MzFmMzYyODI0XQplbnRpdHkg44Kv44Op44OW44K144O844OT44K5LS0+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgaGVpZ2h0PSIyMi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMTgiIHg9IjYwNiIgeT0iNjc1LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5OCIgeD0iNjE2IiB5PSI2OTEuMjkyIj7jgq/jg6njg5bjgrXjg7zjg5Pjgrk8L3RleHQ+PCEtLU1ENT1bNGY2M2YwNmNhMjkwNGYwMzcxMWZhYTFjNThiNDA4OGZdCmVudGl0eSDmj5DmkLrjgq/jg6zjgrjjg4Pjg4jjgqvjg7zjg4nkvJrnpL4tLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE4OCIgeD0iNTcxIiB5PSI3MzIuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2OCIgeD0iNTgxIiB5PSI3NDguMjkyIj7mj5DmkLrjgq/jg6zjgrjjg4Pjg4jjgqvjg7zjg4nkvJrnpL48L3RleHQ+PCEtLU1ENT1bMWUwZjdhY2ViOWQ4MWIyNDRhMDdlYWQ5MWVjNDAwOGFdCmVudGl0eSDkvJrlk6Hos4fmoLzllqrlpLEtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEwNCIgeD0iODE5IiB5PSI1MDQuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0IiB4PSI4MjkiIHk9IjUyMC4yOTIiPuS8muWToeizh+agvOWWquWksTwvdGV4dD48IS0tTUQ1PVs2OTBiYTIzYjAwYTA2ZDZjYjY5NDQzYmFiYjMxZWEyM10KZW50aXR5IOWRiuefpS0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDgiIHg9Ijg0NyIgeT0iNTYxLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyOCIgeD0iODU3IiB5PSI1NzcuMjkyIj7lkYrnn6U8L3RleHQ+PCEtLU1ENT1bYWQ5MmJlOTY3ODY0OGFjODczMWFhN2NjMTRkMTQ2NGNdCmVudGl0eSDms5XkurrnmbvpjLLkvJrlk6EtLT48cmVjdCBmaWxsPSIjRkVGRUNFIiBoZWlnaHQ9IjIyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEwNCIgeD0iODE5IiB5PSI2MTguMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0IiB4PSI4MjkiIHk9IjYzNC4yOTIiPuazleS6uueZu+mMsuS8muWToTwvdGV4dD48IS0tTUQ1PVs2ZTJlZWY3M2VlMzUyZGVlMDJmNjY3MjczMzYzYTgxOV0KZW50aXR5IOWlkee0hOazleS6ui0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGhlaWdodD0iMjIuMjk2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNzYiIHg9IjgzMyIgeT0iNjc1LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NiIgeD0iODQzIiB5PSI2OTEuMjkyIj7lpZHntITms5Xkuro8L3RleHQ+PCEtLU1ENT1bNmNmMzRlMzA0ZWQ5N2U4YzVmNDdmNmJkZDVmZWQwMWZdCmxpbmsg5ZCM5Ly044OT44K444K/44O8IHRvIOWFpeS8mi0tPjwhLS1NRDU9W2VjODFjNTRkZTRhYzA5NWJhYmViNTY4ZDM5MjM3Y2JlXQpsaW5rIOWFpeS8miB0byDlpZHntITmnJ/plpMtLT48IS0tTUQ1PVs3NGU4NDU3MTI5NTkwOGI0MGJiZWE4ZGRlMGI3NWZjZl0KbGluayDlpZHntITmnJ/plpMgdG8g6YCA5LyaLS0+PCEtLU1ENT1bYWE1ZTU3OWU0YmMzNzhhOTI2MjM5ZmRjZjA3NDYwZDVdCmxpbmsg6YCA5LyaIHRvIOmAgOS8muW4jOacm+aciC0tPjwhLS1NRDU9W2ZmNGJkYzU5OTQ0YTE1NmFjNjc4NzZmNzcwODYwMTMyXQpsaW5rIOWQjOS8tOODk+OCuOOCv+ODvCB0byDkvJHkvJotLT48IS0tTUQ1PVs4OTMzZGQwMWNkY2QzZWQ4YjBlYWY5N2E4NjQ4ZTJlZl0KbGluayDkvJHkvJogdG8g5LyR5Lya5pyI5Lya6LK7LS0+PCEtLU1ENT1bZGYyYjRlYWMxNzgzOWQ0NjkwMzAxN2ZlMDFmMzliNDddCmxpbmsg5LyR5Lya5pyI5Lya6LK7IHRvIOS8keS8muacn+mWky0tPjwhLS1NRDU9W2VjMDMyZmY0NzY5MjhhMmIyZjFlZWU0NDIyNTU4OTUwXQpsaW5rIOS8keS8muacn+mWkyB0byDkvJHkvJrluIzmnJvmnIgtLT48IS0tTUQ1PVtlY2I2NjIwNTExNWU3MDYwOGU1ODg3YTA4ODU5NjE1YV0KbGluayDkvJHkvJrluIzmnJvmnIggdG8g5LyR5Lya5omL57aa5pyf6ZmQLS0+PCEtLU1ENT1bODZkY2E4YmM0ZDJhMzIwMzNjYWU3ZTJjZjhiN2VjMThdCmxpbmsg5LyR5LyaIHRvIOODl+ODqeOCpOODmeODvOODiOODreODg+OCq+ODvC0tPjwhLS1NRDU9WzUyZGY4M2I1NTUwYzk0Y2FjNWU3NDcyYmQ5ZTA3MGZjXQpsaW5rIOODl+ODqeOCpOODmeODvOODiOODreODg+OCq+ODvCB0byDlpInmm7TmiYvntprjgY0tLT48IS0tTUQ1PVtmNDZhMjkzYTc2YzlkOTRkMGRiNjg4ODRjODliMTk2MF0KbGluayDlpInmm7TmiYvntprjgY0gdG8g5pa96KitLS0+PCEtLU1ENT1bZDlhZTZmYTMzZDc5NzQ3ZDAzNTUwMDkzOTgyNDU4NmNdCmxpbmsg5pa96KitIHRvIOS8kemkqOaXpS0tPjwhLS1NRDU9W2FlOWNjYWM4MzUyMDU4OTUxMDY0OTIwNTQzYjNjZTFiXQpsaW5rIOS8kemkqOaXpSB0byDlubTmrKHkvJHppKgtLT48IS0tTUQ1PVs4MmQ4N2Y2ZDUwNTk4MDgxNDJhMTc1YjJmOTFkN2YyMl0KbGluayDjg5fjg6njgqTjg5njg7zjg4jjg63jg4Pjgqvjg7wgdG8g5a6a5pyf5LyR6aSoLS0+PCEtLU1ENT1bZWQzNzgxMDFkMTk5ZmJiZGJhY2U3ZWU5OTU3MDgzZTRdCmxpbmsg5a6a5pyf5LyR6aSoIHRvIOS8muiyu+i/lOmHkS0tPjwhLS1NRDU9WzRjOWY5ZjY5ZDJlZmE4NmVjMTQwZGRkNzc1MTFiM2RlXQpsaW5rIOS8muiyu+i/lOmHkSB0byDlupfoiJctLT48IS0tTUQ1PVthNWM1Nzc3MTI2NWRmNzRhMDllZGU0ZmEyOGFjYzU0ZF0KbGluayDlupfoiJcgdG8g44Kv44Op44OW44K144O844OT44K5LS0+PCEtLU1ENT1bN2M5ZTNiNjgyYzZmYzZlMDlhYzJkZDRmNzY5MDMwZDldCmxpbmsg44Kv44Op44OW44K144O844OT44K5IHRvIOaPkOaQuuOCr+ODrOOCuOODg+ODiOOCq+ODvOODieS8muekvi0tPjwhLS1NRDU9WzNlNmM4ZWIxNzk2YjUwNzNlYjVmZTUyZTY3NjMwZTMyXQpsaW5rIOWumuacn+S8kemkqCB0byDkvJrlk6Hos4fmoLzllqrlpLEtLT48IS0tTUQ1PVtkOTI0NGFiZTE0YzQ1NmY1ZTY0MzBhMTg1MDRiZTk2OV0KbGluayDkvJrlk6Hos4fmoLzllqrlpLEgdG8g5ZGK55+lLS0+PCEtLU1ENT1bMzE1NjhlOGZmNmZjZjRlOWYxYzgzM2JlNDgyNjRlMDVdCmxpbmsg5ZGK55+lIHRvIOazleS6uueZu+mMsuS8muWToS0tPjwhLS1NRDU9WzQwYzEzYzY3MTM0MDBjY2IwNzYwZTA5ZDRlYjI5YjFlXQpsaW5rIOazleS6uueZu+mMsuS8muWToSB0byDlpZHntITms5XkurotLT48IS0tTUQ1PVtjZDFiY2Q3ZTJkYjAxMzk0ZjU0OTQ3YzYwMTUyNTUyY10KbGluayDkvJrlk6EgdG8g6Kaq5qip6ICFLS0+PCEtLU1ENT1bYzkyYmZkZmM1OWMzNDc0MTMxMjRiODFmNjNkZjVmYWZdCmxpbmsg6Kaq5qip6ICFIHRvIOmZpOWQjeWHpuWIhi0tPjwhLS1NRDU9WzIyNGI5MDUzYWQ2YmYxNjU0MTkxYjUyNWNhMDcxNzQzXQpsaW5rIOmZpOWQjeWHpuWIhiB0byDmsI/lkI0tLT48IS0tTUQ1PVsyNmFiZDk2NjdkY2Y5ZDM3MmJkNDFhMGFjZWQ4NTQ0ZV0KbGluayDkvJrlk6EgdG8g5Lya5ZOh55Wq5Y+3LS0+PCEtLU1ENT1bMWIxY2VjMmNmYzJlODJhMzUwMzAxOWQzOTMzN2IxNDNdCmxpbmsg5Lya5ZOh55Wq5Y+3IHRvIOODkeOCueODr+ODvOODiS0tPjwhLS1NRDU9WzdjN2FlOTNlMjMxYzJlNjZkMTgxYmQwZDBkZjllOWY2XQpsaW5rIOODkeOCueODr+ODvOODiSB0byDjg6Hjg7zjg6vjgqLjg4njg6zjgrktLT48IS0tTUQ1PVszODE1YjM4OWJiODcwMmJiNTNhY2RiNjRhNDhiZDRjOV0KbGluayDjg6Hjg7zjg6vjgqLjg4njg6zjgrkgdG8g6aGU5YaZ55yfLS0+PCEtLU1ENT1bNWZmM2YwOWFkNDUyOWFjZmI3MmI1ZmM3ZTU0YWZhOThdCmxpbmsg5Lya5ZOh55Wq5Y+3IHRvIOS8muWToeiovC0tPjwhLS1NRDU9WzYxN2QzYjQ4MDk1YzgxZGE0ZmFhNGM0NjNjMjIzMzIxXQpsaW5rIOS8muWToeiovCB0byDkvJrlk6HnqK7poZ4tLT48IS0tTUQ1PVtiMDZkNGU3ZGEwMjBmN2RiZTc1NmZhZjFlYjQ3MTI3MF0KbGluayDkvJrosrsgdG8g5YWl5Lya6YeRLS0+PCEtLU1ENT1bN2QyMDBlZjcxMTQyMzk5MjQwZTAzM2YyODBlZTQwMTNdCmxpbmsg5YWl5Lya6YeRIHRvIOWJsuW8lS0tPjwhLS1NRDU9W2Y5MGRmZGUxNjRiYWExYzg0OTZkZWIwMzQyZDcyNTViXQpsaW5rIOS8muiyuyB0byDmtojosrvnqI4tLT48IS0tTUQ1PVtlZWI2OGU4N2U4YzczZWFiNDZiZmY1YjdhNTExODk2Nl0KbGluayDmtojosrvnqI4gdG8g5pSv5omV5pa55rOVLS0+PCEtLU1ENT1bY2RmZDdkY2RkZjdhNDkyYTdlMGJkOTYwM2I4ZjEwMDBdCmxpbmsg5pSv5omV5pa55rOVIHRvIOaUr+aJleaZguacny0tPjwhLS1NRDU9WzA2NmRiYTE2YTQzYTI4NDVmZmJiYTIyOTdiMjFmYzZmXQpsaW5rIOa2iOiyu+eojiB0byDmu57ntI0tLT48dGV4dCBmaWxsPSIjODg4ODg4IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MiIgeD0iODY0IiB5PSI3NjguODc2Ij5zLmltYW11cmE8L3RleHQ+PCEtLU1ENT1bMTg3N2YwMjRkMGM2NjcxNTU3YmZmZDYxMTBkM2E5MGZdCkBzdGFydHVtbA0KJyA9PT0g44OJ44Kt44Ol44Oh44Oz44OI6Kit5a6aID09PQ0KcmlnaHQgZm9vdGVyIHMuaW1hbXVyYQ0KJyBtYWluZnJhbWUgbWFpbmZyYW1lDQp0aXRsZSDjg4njg6HjgqTjg7Pjg6Ljg4fjg6sNCmxlZnQgdG8gcmlnaHQgZGlyZWN0aW9uDQpzY2FsZSBtYXggMjA0OCB3aWR0aA0KDQonID09PSDjgrnjgr/jgqTjg6sgPT09DQpza2lucGFyYW0gew0KICAgICcgPT09IOWFsemAmuioreWumiA9PT0NCiAgICBzaGFkb3dpbmcgZmFsc2UNCiAgICAnIGxpbmV0eXBlIG9ydGhvDQogICAgYmFja2dyb3VuZENvbG9yIHdoaXRlc21va2UNCiAgICBhcnJvdyB7DQogICAgICAgIGNvbG9yIGluZGlhblJlZA0KICAgICAgICB0aGlja25lc3MgMC44DQogICAgICAgIGZvbnRTaXplIDEwDQogICAgfQ0KICAgIHRpdGxlIHsNCiAgICAgICAgRm9udFNpemUgMTQNCiAgICAgICAgJyBGb250Q29sb3IgYmx1ZQ0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMTANCiAgICAgICAgQm9yZGVyQ29sb3IgdHJhbnNwYXJlbnQNCiAgICB9DQoNCiAgICAnID09PSDopoHntKDliKXoqK3lrpogPT09DQogICAgcmVjdGFuZ2xlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIGJ1c2luZXNzDQogICAgICAgIEJvcmRlckNvbG9yICMwMDANCiAgICAgICAgUm91bmRDb3JuZXIgMjUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNg0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTQNCiAgICB9DQogICAgYWN0b3Igew0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTINCiAgICB9DQogICAgbm9kZSB7DQogICAgICAgIEJvcmRlckNvbG9yICM5OTk5OTkNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIGNvbXBvbmVudCB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciB3aGl0ZQ0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMC41DQogICAgICAgIEJvcmRlckNvbG9yICM2NjY2NjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDExDQogICAgfQ0KICAgIHN0b3JhZ2Ugew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCn0NCg0KDQonIOeUqOiqng0Kc3RvcmFnZSDkvJrlk6HplqLpgKMgew0KICAgIGNhcmQg5Lya5ZOhDQogICAgY2FyZCDopqrmqKnogIUNCiAgICBjYXJkIOmZpOWQjeWHpuWIhg0KICAgIGNhcmQg5rCP5ZCNDQogICAgY2FyZCDkvJrlk6Hnlarlj7cNCiAgICBjYXJkIOODkeOCueODr+ODvOODiQ0KICAgIGNhcmQg44Oh44O844Or44Ki44OJ44Os44K5DQogICAgY2FyZCDpoZTlhpnnnJ8NCiAgICBjYXJkIOS8muWToeiovA0KICAgIGNhcmQg5Lya5ZOh56iu6aGeDQp9DQpjYXJkIOWQjOS8tOODk+OCuOOCv+ODvA0KY2FyZCDlhaXkvJoNCmNhcmQg5aWR57SE5pyf6ZaTDQpjYXJkIOmAgOS8mg0KY2FyZCDpgIDkvJrluIzmnJvmnIgNCmNhcmQg5LyR5LyaDQpjYXJkIOS8keS8muaciOS8muiyuw0KY2FyZCDkvJHkvJrmnJ/plpMNCmNhcmQg5LyR5Lya5biM5pyb5pyIDQpjYXJkIOS8keS8muaJi+e2muacn+mZkA0KY2FyZCDjg5fjg6njgqTjg5njg7zjg4jjg63jg4Pjgqvjg7wNCmNhcmQg5aSJ5pu05omL57aa44GNDQoNCnN0b3JhZ2Ug5Lya6LK76Zai6YCjIHsNCiAgICBjYXJkIOS8muiyuw0KICAgIGNhcmQg5YWl5Lya6YeRDQogICAgY2FyZCDlibLlvJUNCiAgICBjYXJkIOa2iOiyu+eojg0KICAgIGNhcmQg5pSv5omV5pa55rOVDQogICAgY2FyZCDmlK/miZXmmYLmnJ8NCiAgICBjYXJkIOa7nue0jQ0KfQ0KY2FyZCDmlr3oqK0NCmNhcmQg5LyR6aSo5pelDQpjYXJkIOW5tOasoeS8kemkqA0KY2FyZCDlrprmnJ/kvJHppKgNCmNhcmQg5Lya6LK76L+U6YeRDQpjYXJkIOW6l+iIlw0KY2FyZCDjgq/jg6njg5bjgrXjg7zjg5PjgrkNCmNhcmQg5o+Q5pC644Kv44Os44K444OD44OI44Kr44O844OJ5Lya56S+DQpjYXJkIOS8muWToeizh+agvOWWquWksQ0KY2FyZCDlkYrnn6UNCmNhcmQg5rOV5Lq655m76Yyy5Lya5ZOhDQpjYXJkIOWlkee0hOazleS6ug0KDQonIOmWoumAow0KQGVuZHVtbA0KCkBzdGFydHVtbA0KcmlnaHQgZm9vdGVyIHMuaW1hbXVyYQ0KdGl0bGUg44OJ44Oh44Kk44Oz44Oi44OH44OrDQpsZWZ0IHRvIHJpZ2h0IGRpcmVjdGlvbg0Kc2NhbGUgbWF4IDIwNDggd2lkdGgNCg0Kc2tpbnBhcmFtIHsNCiAgICBzaGFkb3dpbmcgZmFsc2UNCiAgICBiYWNrZ3JvdW5kQ29sb3Igd2hpdGVzbW9rZQ0KICAgIGFycm93IHsNCiAgICAgICAgY29sb3IgaW5kaWFuUmVkDQogICAgICAgIHRoaWNrbmVzcyAwLjgNCiAgICAgICAgZm9udFNpemUgMTANCiAgICB9DQogICAgdGl0bGUgew0KICAgICAgICBGb250U2l6ZSAxNA0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMTANCiAgICAgICAgQm9yZGVyQ29sb3IgdHJhbnNwYXJlbnQNCiAgICB9DQoNCiAgICByZWN0YW5nbGUgew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3IgYnVzaW5lc3MNCiAgICAgICAgQm9yZGVyQ29sb3IgIzAwMA0KICAgICAgICBSb3VuZENvcm5lciAyNQ0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMC42DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxNA0KICAgIH0NCiAgICBhY3RvciB7DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMg0KICAgIH0NCiAgICBub2RlIHsNCiAgICAgICAgQm9yZGVyQ29sb3IgIzk5OTk5OQ0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTINCiAgICB9DQogICAgY29tcG9uZW50IHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIHdoaXRlDQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjUNCiAgICAgICAgQm9yZGVyQ29sb3IgIzY2NjY2Ng0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTENCiAgICB9DQogICAgc3RvcmFnZSB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciB3aGl0ZQ0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMC41DQogICAgICAgIEJvcmRlckNvbG9yICM2NjY2NjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDExDQogICAgfQ0KfQ0KDQoNCnN0b3JhZ2Ug5Lya5ZOh6Zai6YCjIHsNCiAgICBjYXJkIOS8muWToQ0KICAgIGNhcmQg6Kaq5qip6ICFDQogICAgY2FyZCDpmaTlkI3lh6bliIYNCiAgICBjYXJkIOawj+WQjQ0KICAgIGNhcmQg5Lya5ZOh55Wq5Y+3DQogICAgY2FyZCDjg5Hjgrnjg6/jg7zjg4kNCiAgICBjYXJkIOODoeODvOODq+OCouODieODrOOCuQ0KICAgIGNhcmQg6aGU5YaZ55yfDQogICAgY2FyZCDkvJrlk6HoqLwNCiAgICBjYXJkIOS8muWToeeorumhng0KfQ0KY2FyZCDlkIzkvLTjg5Pjgrjjgr/jg7wNCmNhcmQg5YWl5LyaDQpjYXJkIOWlkee0hOacn+mWkw0KY2FyZCDpgIDkvJoNCmNhcmQg6YCA5Lya5biM5pyb5pyIDQpjYXJkIOS8keS8mg0KY2FyZCDkvJHkvJrmnIjkvJrosrsNCmNhcmQg5LyR5Lya5pyf6ZaTDQpjYXJkIOS8keS8muW4jOacm+aciA0KY2FyZCDkvJHkvJrmiYvntprmnJ/pmZANCmNhcmQg44OX44Op44Kk44OZ44O844OI44Ot44OD44Kr44O8DQpjYXJkIOWkieabtOaJi+e2muOBjQ0KDQpzdG9yYWdlIOS8muiyu+mWoumAoyB7DQogICAgY2FyZCDkvJrosrsNCiAgICBjYXJkIOWFpeS8mumHkQ0KICAgIGNhcmQg5Ymy5byVDQogICAgY2FyZCDmtojosrvnqI4NCiAgICBjYXJkIOaUr+aJleaWueazlQ0KICAgIGNhcmQg5pSv5omV5pmC5pyfDQogICAgY2FyZCDmu57ntI0NCn0NCmNhcmQg5pa96KitDQpjYXJkIOS8kemkqOaXpQ0KY2FyZCDlubTmrKHkvJHppKgNCmNhcmQg5a6a5pyf5LyR6aSoDQpjYXJkIOS8muiyu+i/lOmHkQ0KY2FyZCDlupfoiJcNCmNhcmQg44Kv44Op44OW44K144O844OT44K5DQpjYXJkIOaPkOaQuuOCr+ODrOOCuOODg+ODiOOCq+ODvOODieS8muekvg0KY2FyZCDkvJrlk6Hos4fmoLzllqrlpLENCmNhcmQg5ZGK55+lDQpjYXJkIOazleS6uueZu+mMsuS8muWToQ0KY2FyZCDlpZHntITms5XkuroNCg0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjE2KFdlZCBEZWMgMDggMTc6MjU6MjIgVVRDIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IG51bGwKLS0+PC9nPjwvc3ZnPg==\" loading=\"lazy\"\u003e\n\u003cp data-sourcepos=\"339:1-340:105\"\u003e法人の契約とかあったんですね。。\u003cbr\u003e\n入会退会は想定してたけど、休会もあるんですね。しかも会費があるという。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"342:1-342:34\"\u003e\n\u003cspan id=\"ビジネスコンテキスト2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%882\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビジネスコンテキスト2\u003c/h2\u003e\n\u003cp data-sourcepos=\"343:1-343:87\"\u003eドメインモデルで発見された概念から、不足していた業務を補う\u003c/p\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iNTMycHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo5MjFweDtoZWlnaHQ6NTMycHg7YmFja2dyb3VuZDojRjVGNUY1OyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgOTIxIDUzMiIgd2lkdGg9IjkyMXB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcy8+PGc+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIyNi4yOTY5IiBzdHlsZT0ic3Ryb2tlOiNGNUY1RjU7c3Ryb2tlLXdpZHRoOjEwLjA7IiB3aWR0aD0iMTU2IiB4PSIzNzUuNSIgeT0iMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MCIgeD0iMzgzLjUiIHk9IjE5Ljk5NTEiPuODk+OCuOODjeOCueOCs+ODs+ODhuOCreOCueODiDwvdGV4dD48IS0tTUQ1PVszNzhkMmNmMTk0ZjI1NWY2OTYxNzZkYWIwMGVmYmI4Nl0KY2x1c3RlciDjgrnjg53jg7zjg4Tjgq/jg6njg5YtLT48cG9seWdvbiBmaWxsPSIjRjVGNUY1IiBwb2ludHM9IjYzNiwyMDQuNzk2OSw2NDYsMTk0Ljc5NjksNzk2LDE5NC43OTY5LDc5NiwzMTMuNzk2OSw3ODYsMzIzLjc5NjksNjM2LDMyMy43OTY5LDYzNiwyMDQuNzk2OSIgc3R5bGU9InN0cm9rZTojOTk5OTk5O3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojOTk5OTk5O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNzg2IiB4Mj0iNzk2IiB5MT0iMjA0Ljc5NjkiIHkyPSIxOTQuNzk2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6Izk5OTk5OTtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjYzNiIgeDI9Ijc4NiIgeTE9IjIwNC43OTY5IiB5Mj0iMjA0Ljc5NjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiM5OTk5OTk7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI3ODYiIHgyPSI3ODYiIHkxPSIyMDQuNzk2OSIgeTI9IjMyMy43OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg0IiB4PSI2NzAiIHk9IjIxOC45MzU1Ij7jgrnjg53jg7zjg4Tjgq/jg6njg5Y8L3RleHQ+PCEtLU1ENT1bN2FjYmM0OGIwOGE2MTE1ZDZjOWVjN2FkNGQzYjMwY2NdCmVudGl0eSBlbXBsb3llZS0tPjxlbGxpcHNlIGN4PSI3MTYiIGN5PSIyNDEuMjk2OSIgZmlsbD0iI0ZFRkVDRSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNNzE2LDI0OS4yOTY5IEw3MTYsMjc2LjI5NjkgTTcwMywyNTcuMjk2OSBMNzI5LDI1Ny4yOTY5IE03MTYsMjc2LjI5NjkgTDcwMywyOTEuMjk2OSBNNzE2LDI3Ni4yOTY5IEw3MjksMjkxLjI5NjkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNiIgeD0iNjk4IiB5PSIzMDQuOTM1NSI+5b6T5qWt5ZOhPC90ZXh0PjwhLS1NRDU9W2M4ODA4MjRiMWE0ZTU4ZjE2NGQ1MWZmMzk3MDkzZTBmXQplbnRpdHkgaW5zdHJ1Y3Rvci0tPjxlbGxpcHNlIGN4PSIzNDIiIGN5PSI0NDMuMjk2OSIgZmlsbD0iI0ZFRkVDRSIgcng9IjgiIHJ5PSI4IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48cGF0aCBkPSJNMzQyLDQ1MS4yOTY5IEwzNDIsNDc4LjI5NjkgTTMyOSw0NTkuMjk2OSBMMzU1LDQ1OS4yOTY5IE0zNDIsNDc4LjI5NjkgTDMyOSw0OTMuMjk2OSBNMzQyLDQ3OC4yOTY5IEwzNTUsNDkzLjI5NjkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NiIgeD0iMjk0IiB5PSI1MDYuOTM1NSI+44Kk44Oz44K544OI44Op44Kv44K/44O8PC90ZXh0PjwhLS1NRDU9Wzk2NDY0ZTQ4NWE0MDVkOTRlOWJkNmFjMzYwMWI3YjAxXQplbnRpdHkgbWVtYmVyLS0+PGVsbGlwc2UgY3g9IjMwIiBjeT0iMTcxLjI5NjkiIGZpbGw9IiNGRUZFQ0UiIHJ4PSI4IiByeT0iOCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHBhdGggZD0iTTMwLDE3OS4yOTY5IEwzMCwyMDYuMjk2OSBNMTcsMTg3LjI5NjkgTDQzLDE4Ny4yOTY5IE0zMCwyMDYuMjk2OSBMMTcsMjIxLjI5NjkgTTMwLDIwNi4yOTY5IEw0MywyMjEuMjk2OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0IiB4PSIxOCIgeT0iMjM0LjkzNTUiPuS8muWToTwvdGV4dD48IS0tTUQ1PVsyMTQ0ZmVhNDA2OTVkZmI5ZTZiZmVmYmE3NTJkMjNhOV0KZW50aXR5IGNvbnRyYWN0ZWRfY29ycG9yYXRpb24tLT48ZWxsaXBzZSBjeD0iMzAiIGN5PSI0NS4yOTY5IiBmaWxsPSIjRkVGRUNFIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjxwYXRoIGQ9Ik0zMCw1My4yOTY5IEwzMCw4MC4yOTY5IE0xNyw2MS4yOTY5IEw0Myw2MS4yOTY5IE0zMCw4MC4yOTY5IEwxNyw5NS4yOTY5IE0zMCw4MC4yOTY5IEw0Myw5NS4yOTY5ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDgiIHg9IjYiIHk9IjEwOC45MzU1Ij7lpZHntITms5Xkuro8L3RleHQ+PCEtLU1ENT1bNjQ1MjQyYjc2N2E1ZWExNmI1MzBjMTYwYzhhNzMxMWZdCmVudGl0eSBjcmVkaXRfY2FyZF9jb21wYW55LS0+PGVsbGlwc2UgY3g9IjM0MiIgY3k9IjMzMi4yOTY5IiBmaWxsPSIjRkVGRUNFIiByeD0iOCIgcnk9IjgiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjxwYXRoIGQ9Ik0zNDIsMzQwLjI5NjkgTDM0MiwzNjcuMjk2OSBNMzI5LDM0OC4yOTY5IEwzNTUsMzQ4LjI5NjkgTTM0MiwzNjcuMjk2OSBMMzI5LDM4Mi4yOTY5IE0zNDIsMzY3LjI5NjkgTDM1NSwzODIuMjk2OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyMCIgeD0iMjgyIiB5PSIzOTUuOTM1NSI+44Kv44Os44K444OD44OI44Kr44O844OJ5Lya56S+PC90ZXh0PjwhLS1NRDU9WzBlNWYyYjBjOTRiYTM4MjYyMzYxYTJkMGRmZjk2NzFhXQplbnRpdHkg5YWl5LyaX+mAgOS8ml/kvJHkvJotLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjgwNDciIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI5OCIgeD0iNDc4IiB5PSIxNDkuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4IiB4PSI0ODgiIHk9IjE2OS41MDczIj7lhaXkvJpf6YCA5LyaX+S8keS8mjwvdGV4dD48IS0tTUQ1PVs3OTQ1ZmU2ZjA5OGE0MGU5YjEyYTI4MjIzNzhmZGU5MF0KZW50aXR5IOWFpemAgOmkqC0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuODA0NyIgcng9IjM1IiByeT0iMzUiIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjUzIiB4PSIxNDEuNSIgeT0iMTgzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMyIgeD0iMTUxLjUiIHk9IjIwMy41MDczIj7lhaXpgIDppKg8L3RleHQ+PCEtLU1ENT1bY2I2ZWU4MTc3MmViMmFiZjkyMGQyODM0ODA5Y2M1Y2ZdCmVudGl0eSDkvJrosrvmlK/miZUtLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjgwNDciIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2NCIgeD0iNDk1IiB5PSIyNTMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSI1MDUiIHk9IjI3My41MDczIj7kvJrosrvmlK/miZU8L3RleHQ+PCEtLU1ENT1bNGJmOTVlZjZkYzg2MDFhYjg0ZjIyYjU2ZWJjMGY3NjBdCmVudGl0eSDms5XkurrlpZHntIQtLT48cmVjdCBmaWxsPSIjRkZGRkZGIiBoZWlnaHQ9IjMyLjgwNDciIHJ4PSIzNSIgcnk9IjM1IiBzdHlsZT0ic3Ryb2tlOiM2NjY2NjY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2NCIgeD0iNDk1IiB5PSI2Mi4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjUwNSIgeT0iODIuNTA3MyI+5rOV5Lq65aWR57SEPC90ZXh0PjwhLS1NRDU9W2RmZjk1YjI2MDcxNjE3MDE2ZmJmNjE2YWYyMTNkOTk4XQplbnRpdHkg44K544K/44K444Kq44Os44OD44K544OzLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIzMi44MDQ3IiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTA4IiB4PSIxMTQiIHk9IjM4OS4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODgiIHg9IjEyNCIgeT0iNDA5LjUwNzMiPuOCueOCv+OCuOOCquODrOODg+OCueODszwvdGV4dD48IS0tTUQ1PVtkYmNlZGRlMWYwOTNlNGYyODQyZDc0MmE5MTk1ZTBjNV0KZW50aXR5IOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhi0tPjxyZWN0IGZpbGw9IiNGRkZGRkYiIGhlaWdodD0iMzIuODA0NyIgcng9IjM1IiByeT0iMzUiIHN0eWxlPSJzdHJva2U6IzY2NjY2NjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjEzMCIgeD0iNDYyIiB5PSIzMjEuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMCIgeD0iNDcyIiB5PSIzNDEuNTA3MyI+44Kk44Oz44K544OI44Op44Kv44K/44O8566h55CGPC90ZXh0PjwhLS1NRDU9WzY5MGJhMjNiMDBhMDZkNmNiNjk0NDNiYWJiMzFlYTIzXQplbnRpdHkg5ZGK55+lLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIzMi44MDQ3IiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNDIiIHg9IjUwNiIgeT0iMzg5LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMiIgeD0iNTE2IiB5PSI0MDkuNTA3MyI+5ZGK55+lPC90ZXh0PjwhLS1NRDU9W2Q2YjZmZmJmOWQ2YWNhMmI1N2NhZTNmZTMxNTRiZTQ2XQplbnRpdHkg5LyR6aSo5pel566h55CGLS0+PHJlY3QgZmlsbD0iI0ZGRkZGRiIgaGVpZ2h0PSIzMi44MDQ3IiByeD0iMzUiIHJ5PSIzNSIgc3R5bGU9InN0cm9rZTojNjY2NjY2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iNzUiIHg9Ijg0MCIgeT0iMjUzLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NSIgeD0iODUwIiB5PSIyNzMuNTA3MyI+5LyR6aSo5pel566h55CGPC90ZXh0PjwhLS1NRDU9Wzk4YTU0MTc3NGQ4YWU3ZDEyZTc0NTUxYjc5ZTMyNjQ5XQpsaW5rIGNvbnRyYWN0ZWRfY29ycG9yYXRpb24gdG8gbWVtYmVyLS0+PHBhdGggZD0iTTMwLDExMi4xMjY5IEMzMCwxMjguNTU2OSAzMCwxNDQuOTc2OSAzMCwxNjEuNDA2OSAiIGZpbGw9Im5vbmUiIGlkPSJjb250cmFjdGVkX2NvcnBvcmF0aW9uLW1lbWJlciIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7c3Ryb2tlLWRhc2hhcnJheTo3LjAsNy4wOyIvPjwhLS1NRDU9WzczNzc1MmY1NTNmYTI2YTJmZjgwMWVjMTdiNDRiOWQxXQpsaW5rIGNvbnRyYWN0ZWRfY29ycG9yYXRpb24gdG8g5rOV5Lq65aWR57SELS0+PHBhdGggZD0iTTU0LjIxLDc0LjAyNjkgQzEzNC44Nyw3NC44NDY5IDQwMy4wNyw3Ny41NTY5IDQ5NC44Nyw3OC40ODY5ICIgZmlsbD0ibm9uZSIgaWQ9ImNvbnRyYWN0ZWRfY29ycG9yYXRpb24t5rOV5Lq65aWR57SEIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVswYzZjODE3NjMyYmNiOGI0MDkyMTVjNzE5MGFhN2M4OF0KbGluayBtZW1iZXIgdG8g5YWl5LyaX+mAgOS8ml/kvJHkvJotLT48cGF0aCBkPSJNNDQuNTgsMTkyLjI5NjkgQzYwLjYxLDE4My45MTY5IDg4LjMzLDE3MC44NDY5IDExNCwxNjUuNzk2OSBDMjQzLjQ4LDE0MC4zMDY5IDQwMC4zMywxNTEuNTU2OSA0NzcuODQsMTU5LjgyNjkgIiBmaWxsPSJub25lIiBpZD0ibWVtYmVyLeWFpeS8ml/pgIDkvJpf5LyR5LyaIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVtiMjAzZDIxZDU5NmU0MzEyNDU5YTA3NWE3ODBmMTYwZF0KbGluayBtZW1iZXIgdG8g5Lya6LK75pSv5omVLS0+PHBhdGggZD0iTTQ0LjY3LDIwNi44OTY5IEM2MC43OCwyMTQuOTE2OSA4OC41OCwyMjcuNjI2OSAxMTQsMjMzLjc5NjkgQzI1My4yLDI2Ny41NjY5IDQyNS42NSwyNzAuNTY2OSA0OTQuOTksMjcwLjI0NjkgIiBmaWxsPSJub25lIiBpZD0ibWVtYmVyLeS8muiyu+aUr+aJlSIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bNzk3ZjJhMDZmNWMxNTE4MzdmMzNiNThhMGM3ZmM0MmNdCmxpbmsgbWVtYmVyIHRvIOWFpemAgOmkqC0tPjxwYXRoIGQ9Ik00NC41NCwxOTkuNzk2OSBDNjcuMDQsMTk5Ljc5NjkgMTEyLjUzLDE5OS43OTY5IDE0MS4yOCwxOTkuNzk2OSAiIGZpbGw9Im5vbmUiIGlkPSJtZW1iZXIt5YWl6YCA6aSoIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVsxZTI0NWQzMmE5OTdjZDIyYWQ3NjhmNGViYmVlYTAzNF0KbGluayBtZW1iZXIgdG8g44K544K/44K444Kq44Os44OD44K544OzLS0+PHBhdGggZD0iTTQ0LjU0LDIyMC4zMDY5IEM3MS40OCwyNjEuMTA2OSAxMzEuMzQsMzUxLjc3NjkgMTU2LjAzLDM4OS4xNzY5ICIgZmlsbD0ibm9uZSIgaWQ9Im1lbWJlci3jgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MiIHN0eWxlPSJzdHJva2U6I0NENUM1QztzdHJva2Utd2lkdGg6MC44OyIvPjwhLS1NRDU9W2I4ZmZhY2Q1NzE0MTM4MTM3ZTBkMzI1ZTU4NzhhMzNhXQpsaW5rIOOCueOCv+OCuOOCquODrOODg+OCueODsyB0byBpbnN0cnVjdG9yLS0+PHBhdGggZD0iTTIxMi40LDQyMi40NDY5IEMyMzcuMjgsNDMxLjk5NjkgMjY4LjUzLDQ0My45ODY5IDI5My45OSw0NTMuNzU2OSAiIGZpbGw9Im5vbmUiIGlkPSLjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MtaW5zdHJ1Y3RvciIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bNzk4M2Q3NzkxNzI5ZjU0M2Y0OWY2MWFhMTY0ZjVhMmVdCmxpbmsgaW5zdHJ1Y3RvciB0byDjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7znrqHnkIYtLT48cGF0aCBkPSJNMzgzLjk4LDQzMy42NTY5IEM0MDYuMTcsNDEzLjk3NjkgNDM0LjYsMzkwLjI4NjkgNDYyLDM3MS43OTY5IEM0NzEuMjgsMzY1LjUzNjkgNDgxLjg1LDM1OS41MTY5IDQ5MS42OCwzNTQuMzI2OSAiIGZpbGw9Im5vbmUiIGlkPSJpbnN0cnVjdG9yLeOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhiIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bMDY5N2VlZjE4N2NjMWJkMWQwZTk0YzFiMDM0OTA5N2NdCmxpbmsg5Lya6LK75pSv5omVIHRvIGVtcGxveWVlLS0+PHBhdGggZD0iTTU1OS4zLDI2OS43OTY5IEM1OTkuMDIsMjY5Ljc5NjkgNjY2LjE0LDI2OS43OTY5IDY5Ny42NywyNjkuNzk2OSAiIGZpbGw9Im5vbmUiIGlkPSLkvJrosrvmlK/miZUtZW1wbG95ZWUiIHN0eWxlPSJzdHJva2U6I0NENUM1QztzdHJva2Utd2lkdGg6MC44OyIvPjwhLS1NRDU9WzQ5MWU2Y2ZiYjQ2YmUzNzc5ZjkxMzMzYWJhZjhlYTEwXQpsaW5rIOWFpeS8ml/pgIDkvJpf5LyR5LyaIHRvIGVtcGxveWVlLS0+PHBhdGggZD0iTTU1OC4wNCwxODIuNTA2OSBDNTk3LjY5LDIwNC41NTY5IDY2Ni4xNSwyNDIuNjI2OSA2OTcuOTEsMjYwLjI4NjkgIiBmaWxsPSJub25lIiBpZD0i5YWl5LyaX+mAgOS8ml/kvJHkvJotZW1wbG95ZWUiIHN0eWxlPSJzdHJva2U6I0NENUM1QztzdHJva2Utd2lkdGg6MC44OyIvPjwhLS1NRDU9W2UzM2UyYzMyMWU0NDliOGE4YWI2ZWEzNzk2MzBmOWRhXQpsaW5rIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhiB0byBlbXBsb3llZS0tPjxwYXRoIGQ9Ik01NzMuNzUsMzIxLjE2NjkgQzYxMy43NSwzMDYuNjE2OSA2NjkuNywyODYuMjY2OSA2OTcuNjYsMjc2LjA5NjkgIiBmaWxsPSJub25lIiBpZD0i44Kk44Oz44K544OI44Op44Kv44K/44O8566h55CGLWVtcGxveWVlIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVs1YjNmZDExMTcxNGNjODg3ZDgxODNiNjQ5MTA5YzExNF0KbGluayDlkYrnn6UgdG8gZW1wbG95ZWUtLT48cGF0aCBkPSJNNTQ4LjIxLDM5Ni4zODY5IEM1NjEuMTIsMzkwLjA1NjkgNTc3Ljk5LDM4MS4xNzY5IDU5MiwzNzEuNzk2OSBDNjMyLjMzLDM0NC43NzY5IDY3NSwzMDcuMDI2OSA2OTcuOTYsMjg1Ljg1NjkgIiBmaWxsPSJub25lIiBpZD0i5ZGK55+lLWVtcGxveWVlIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVsxZjk1OTczNTU0ZDZhMWI0NGNiMzFjODQ1MjE2ZTQwZF0KbGluayDms5XkurrlpZHntIQgdG8gZW1wbG95ZWUtLT48cGF0aCBkPSJNNTQ5LjczLDk1LjQ0NjkgQzU2Mi40NiwxMDUuNTE2OSA1NzguNiwxMTguODc2OSA1OTIsMTMxLjc5NjkgQzYzMi40MywxNzAuNzg2OSA2NzUuMDYsMjIwLjk1NjkgNjk3Ljk5LDI0OC43OTY5ICIgZmlsbD0ibm9uZSIgaWQ9IuazleS6uuWlkee0hC1lbXBsb3llZSIgc3R5bGU9InN0cm9rZTojQ0Q1QzVDO3N0cm9rZS13aWR0aDowLjg7Ii8+PCEtLU1ENT1bNzExOGFmNjYzOWRmNDAxZjkzY2NiMzY5ZWRkYzBmYjBdCmxpbmsgZW1wbG95ZWUgdG8g5LyR6aSo5pel566h55CGLS0+PHBhdGggZD0iTTczNC4wNywyNjkuNzk2OSBDNzU5LjE0LDI2OS43OTY5IDgwNi41NSwyNjkuNzk2OSA4MzkuNzYsMjY5Ljc5NjkgIiBmaWxsPSJub25lIiBpZD0iZW1wbG95ZWUt5LyR6aSo5pel566h55CGIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48IS0tTUQ1PVs5ZTUyZTZhY2YxZjM1MzY2YjYzZDFmOTAwZmFmYmM2N10KbGluayBjcmVkaXRfY2FyZF9jb21wYW55IHRvIOS8muiyu+aUr+aJlS0tPjxwYXRoIGQ9Ik00MDIuMTYsMzMxLjM3NjkgQzQzMy4wNywzMTYuMDA2OSA0NjkuNjMsMjk3LjgyNjkgNDk0Ljk4LDI4NS4yMjY5ICIgZmlsbD0ibm9uZSIgaWQ9ImNyZWRpdF9jYXJkX2NvbXBhbnkt5Lya6LK75pSv5omVIiBzdHlsZT0ic3Ryb2tlOiNDRDVDNUM7c3Ryb2tlLXdpZHRoOjAuODsiLz48dGV4dCBmaWxsPSIjODg4ODg4IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1MiIgeD0iODU2IiB5PSI1MjMuNzE3OCI+cy5pbWFtdXJhPC90ZXh0PjwhLS1NRDU9W2IwNzVkYTg1MWUxZGYwYjU3NzMxZjlhZDJkMjY2MDFlXQpAc3RhcnR1bWwNCicgPT09IOODieOCreODpeODoeODs+ODiOioreWumiA9PT0NCnJpZ2h0IGZvb3RlciBzLmltYW11cmENCicgbWFpbmZyYW1lIG1haW5mcmFtZQ0KdGl0bGUg44OT44K444ON44K544Kz44Oz44OG44Kt44K544OIDQpsZWZ0IHRvIHJpZ2h0IGRpcmVjdGlvbg0Kc2NhbGUgbWF4IDIwNDggd2lkdGgNCg0KJyA9PT0g44K544K/44Kk44OrID09PQ0Kc2tpbnBhcmFtIHsNCiAgICAnID09PSDlhbHpgJroqK3lrpogPT09DQogICAgc2hhZG93aW5nIGZhbHNlDQogICAgJyBsaW5ldHlwZSBvcnRobw0KICAgIGJhY2tncm91bmRDb2xvciB3aGl0ZXNtb2tlDQogICAgYXJyb3cgew0KICAgICAgICBjb2xvciBpbmRpYW5SZWQNCiAgICAgICAgdGhpY2tuZXNzIDAuOA0KICAgICAgICBmb250U2l6ZSAxMA0KICAgIH0NCiAgICB0aXRsZSB7DQogICAgICAgIEZvbnRTaXplIDE0DQogICAgICAgICcgRm9udENvbG9yIGJsdWUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDEwDQogICAgICAgIEJvcmRlckNvbG9yIHRyYW5zcGFyZW50DQogICAgfQ0KDQogICAgJyA9PT0g6KaB57Sg5Yil6Kit5a6aID09PQ0KICAgIHJlY3RhbmdsZSB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciBidXNpbmVzcw0KICAgICAgICBCb3JkZXJDb2xvciAjMDAwDQogICAgICAgIFJvdW5kQ29ybmVyIDI1DQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDE0DQogICAgfQ0KICAgIGFjdG9yIHsNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIG5vZGUgew0KICAgICAgICBCb3JkZXJDb2xvciAjOTk5OTk5DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMg0KICAgIH0NCiAgICBjb21wb25lbnQgew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCiAgICBzdG9yYWdlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIHdoaXRlDQogICAgICAgIEJvcmRlclRoaWNrbmVzcyAwLjUNCiAgICAgICAgQm9yZGVyQ29sb3IgIzY2NjY2Ng0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTENCiAgICB9DQp9DQoNCg0KJyDjgqLjgq/jgr/jg7wNCm5vZGUg44K544Od44O844OE44Kv44Op44OWIHsNCiAgICBhY3RvciDlvpPmpa3lk6EgYXMgZW1wbG95ZWUNCn0NCmFjdG9yIOOCpOODs+OCueODiOODqeOCr+OCv+ODvCBhcyBpbnN0cnVjdG9yDQphY3RvciDkvJrlk6EgYXMgbWVtYmVyDQphY3RvciDlpZHntITms5XkurogYXMgY29udHJhY3RlZF9jb3Jwb3JhdGlvbg0KYWN0b3Ig44Kv44Os44K444OD44OI44Kr44O844OJ5Lya56S+IGFzIGNyZWRpdF9jYXJkX2NvbXBhbnkNCmNvbnRyYWN0ZWRfY29ycG9yYXRpb24gLiBtZW1iZXINCg0KJyDmpa3li5kNCnN0b3JhZ2Ug5YWl5LyaX+mAgOS8ml/kvJHkvJoNCnN0b3JhZ2Ug5YWl6YCA6aSoDQpzdG9yYWdlIOS8muiyu+aUr+aJlQ0Kc3RvcmFnZSDms5XkurrlpZHntIQNCnN0b3JhZ2Ug44K544K/44K444Kq44Os44OD44K544OzDQpzdG9yYWdlIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhg0Kc3RvcmFnZSDlkYrnn6UNCnN0b3JhZ2Ug5LyR6aSo5pel566h55CGDQoNCicg44KC44GuDQoNCg0KJyDplqLpgKMNCmNvbnRyYWN0ZWRfY29ycG9yYXRpb24gLSAtIOazleS6uuWlkee0hA0KbWVtYmVyIC0gLSDlhaXkvJpf6YCA5LyaX+S8keS8mg0KbWVtYmVyIC0gLSDkvJrosrvmlK/miZUNCm1lbWJlciAtIC0g5YWl6YCA6aSoDQptZW1iZXIgLSAtIOOCueOCv+OCuOOCquODrOODg+OCueODsw0KDQrjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MgLSAtIGluc3RydWN0b3INCmluc3RydWN0b3IgLSAtIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhg0KDQrkvJrosrvmlK/miZUgLSAtIGVtcGxveWVlDQrlhaXkvJpf6YCA5LyaX+S8keS8miAtIC0gZW1wbG95ZWUNCuOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhiAtIC0gZW1wbG95ZWUNCuWRiuefpSAtIC0gZW1wbG95ZWUNCuazleS6uuWlkee0hCAtIC0gZW1wbG95ZWUNCmVtcGxveWVlIC0gLSDkvJHppKjml6XnrqHnkIYNCg0KDQpjcmVkaXRfY2FyZF9jb21wYW55IC0gLSDkvJrosrvmlK/miZUNCkBlbmR1bWwNCgpAc3RhcnR1bWwNCnJpZ2h0IGZvb3RlciBzLmltYW11cmENCnRpdGxlIOODk+OCuOODjeOCueOCs+ODs+ODhuOCreOCueODiA0KbGVmdCB0byByaWdodCBkaXJlY3Rpb24NCnNjYWxlIG1heCAyMDQ4IHdpZHRoDQoNCnNraW5wYXJhbSB7DQogICAgc2hhZG93aW5nIGZhbHNlDQogICAgYmFja2dyb3VuZENvbG9yIHdoaXRlc21va2UNCiAgICBhcnJvdyB7DQogICAgICAgIGNvbG9yIGluZGlhblJlZA0KICAgICAgICB0aGlja25lc3MgMC44DQogICAgICAgIGZvbnRTaXplIDEwDQogICAgfQ0KICAgIHRpdGxlIHsNCiAgICAgICAgRm9udFNpemUgMTQNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDEwDQogICAgICAgIEJvcmRlckNvbG9yIHRyYW5zcGFyZW50DQogICAgfQ0KDQogICAgcmVjdGFuZ2xlIHsNCiAgICAgICAgQmFja2dyb3VuZENvbG9yIGJ1c2luZXNzDQogICAgICAgIEJvcmRlckNvbG9yICMwMDANCiAgICAgICAgUm91bmRDb3JuZXIgMjUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNg0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTQNCiAgICB9DQogICAgYWN0b3Igew0KICAgICAgICBmb250Q29sb3IgYmxhY2sNCiAgICAgICAgZm9udFNpemUgMTINCiAgICB9DQogICAgbm9kZSB7DQogICAgICAgIEJvcmRlckNvbG9yICM5OTk5OTkNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDEyDQogICAgfQ0KICAgIGNvbXBvbmVudCB7DQogICAgICAgIEJhY2tncm91bmRDb2xvciB3aGl0ZQ0KICAgICAgICBCb3JkZXJUaGlja25lc3MgMC41DQogICAgICAgIEJvcmRlckNvbG9yICM2NjY2NjYNCiAgICAgICAgZm9udENvbG9yIGJsYWNrDQogICAgICAgIGZvbnRTaXplIDExDQogICAgfQ0KICAgIHN0b3JhZ2Ugew0KICAgICAgICBCYWNrZ3JvdW5kQ29sb3Igd2hpdGUNCiAgICAgICAgQm9yZGVyVGhpY2tuZXNzIDAuNQ0KICAgICAgICBCb3JkZXJDb2xvciAjNjY2NjY2DQogICAgICAgIGZvbnRDb2xvciBibGFjaw0KICAgICAgICBmb250U2l6ZSAxMQ0KICAgIH0NCn0NCg0KDQpub2RlIOOCueODneODvOODhOOCr+ODqeODliB7DQogICAgYWN0b3Ig5b6T5qWt5ZOhIGFzIGVtcGxveWVlDQp9DQphY3RvciDjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7wgYXMgaW5zdHJ1Y3Rvcg0KYWN0b3Ig5Lya5ZOhIGFzIG1lbWJlcg0KYWN0b3Ig5aWR57SE5rOV5Lq6IGFzIGNvbnRyYWN0ZWRfY29ycG9yYXRpb24NCmFjdG9yIOOCr+ODrOOCuOODg+ODiOOCq+ODvOODieS8muekviBhcyBjcmVkaXRfY2FyZF9jb21wYW55DQpjb250cmFjdGVkX2NvcnBvcmF0aW9uIC4gbWVtYmVyDQoNCnN0b3JhZ2Ug5YWl5LyaX+mAgOS8ml/kvJHkvJoNCnN0b3JhZ2Ug5YWl6YCA6aSoDQpzdG9yYWdlIOS8muiyu+aUr+aJlQ0Kc3RvcmFnZSDms5XkurrlpZHntIQNCnN0b3JhZ2Ug44K544K/44K444Kq44Os44OD44K544OzDQpzdG9yYWdlIOOCpOODs+OCueODiOODqeOCr+OCv+ODvOeuoeeQhg0Kc3RvcmFnZSDlkYrnn6UNCnN0b3JhZ2Ug5LyR6aSo5pel566h55CGDQoNCg0KDQpjb250cmFjdGVkX2NvcnBvcmF0aW9uIC0gLSDms5XkurrlpZHntIQNCm1lbWJlciAtIC0g5YWl5LyaX+mAgOS8ml/kvJHkvJoNCm1lbWJlciAtIC0g5Lya6LK75pSv5omVDQptZW1iZXIgLSAtIOWFpemAgOmkqA0KbWVtYmVyIC0gLSDjgrnjgr/jgrjjgqrjg6zjg4Pjgrnjg7MNCg0K44K544K/44K444Kq44Os44OD44K544OzIC0gLSBpbnN0cnVjdG9yDQppbnN0cnVjdG9yIC0gLSDjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7znrqHnkIYNCg0K5Lya6LK75pSv5omVIC0gLSBlbXBsb3llZQ0K5YWl5LyaX+mAgOS8ml/kvJHkvJogLSAtIGVtcGxveWVlDQrjgqTjg7Pjgrnjg4jjg6njgq/jgr/jg7znrqHnkIYgLSAtIGVtcGxveWVlDQrlkYrnn6UgLSAtIGVtcGxveWVlDQrms5XkurrlpZHntIQgLSAtIGVtcGxveWVlDQplbXBsb3llZSAtIC0g5LyR6aSo5pel566h55CGDQoNCg0KY3JlZGl0X2NhcmRfY29tcGFueSAtIC0g5Lya6LK75pSv5omVDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjEuMTYoV2VkIERlYyAwOCAxNzoyNToyMiBVVEMgMjAyMSkKKEdQTCBzb3VyY2UgZGlzdHJpYnV0aW9uKQpKYXZhIFJ1bnRpbWU6IE9wZW5KREsgUnVudGltZSBFbnZpcm9ubWVudApKVk06IE9wZW5KREsgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogbnVsbAotLT48L2c+PC9zdmc+\" loading=\"lazy\"\u003e\n\u003cp data-sourcepos=\"453:1-454:48\"\u003eアクターとして、クレジットカード会社、契約法人を追加\u003cbr\u003e\n業務として、会費支払、告知を追加\u003c/p\u003e\n","body":"## 背景\n\n1年前くらいから、近所のティップネスに通っている。\n体形はそこまで変わっていないが、前よりもご飯を美味しく食べられるようになったと思う。\n今回は、ティップネスを参考にスポーツクラブのシステム化を想定して、事業分析を行う。\n\n## システムコンテキスト1\n\nまずは、登場人物とシステム、外部システムを洗い出す。\n\n\n```plantuml\n@startuml\n' === ドキュメント設定 ===\nright footer s.imamura\n' mainframe mainframe\ntitle システムコンテキスト\nleft to right direction\nscale max 2048 width\n\n' === スタイル ===\nskinparam {\n    ' === 共通設定 ===\n    shadowing false\n    ' linetype ortho\n    backgroundColor whitesmoke\n    arrow {\n        color indianRed\n        thickness 0.8\n        fontSize 10\n    }\n    title {\n        FontSize 14\n        ' FontColor blue\n        BorderThickness 10\n        BorderColor transparent\n    }\n\n    ' === 要素別設定 ===\n    rectangle {\n        BackgroundColor business\n        BorderColor #000\n        RoundCorner 25\n        BorderThickness 0.6\n        fontColor black\n        fontSize 14\n    }\n    actor {\n        fontColor black\n        fontSize 12\n    }\n    node {\n        BorderColor #999999\n        fontColor black\n        fontSize 12\n    }\n    component {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n    storage {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n}\n\nstorage \"ユーザー\" #line.dotted {\n    actor \"会員\" as member\n    actor \"従業員\" as employee\n    actor \"インストラクター\" as instructor\n}\n\ncomponent \"システム\" as system {\n    component \"入会申請\" as apply_system\n    component \"会員サイト\" as member_system\n    component \"管理サイト\" as management_system\n    database \"DB\" as db\n\n    apply_system -- db\n    management_system -- db\n    member_system -- db\n}\n\n\n' 関連\nmember -- apply_system\nmember -- member_system\nemployee -- management_system\ninstructor -- management_system\n\n@enduml\n```\n\n使ったことは無いが、おそらく店舗側の管理サイトがあるだろう。\n一般会員向けには契約時の申し込みサイトと、会員用のサイトがある。\nシステム構築の目的については、整理した後で記述する。\n\n## システム要求1\n\nシステムへの要求事項を以下にリストアップした。\n\n### 要求一覧\n\n- 事前web申込したい\n- 会員サイトから、ポイント貯めたい\n- 会員にカードを発行し、入退館の際はカードのバーコードをシステムで読み取らせる\n\n一旦このままにしておく。\nあとで図示する。\n\n## ビジネスコンテキスト1\n\n主要な業務を洗い出す。\n\n\n```plantuml\n@startuml\n' === ドキュメント設定 ===\nright footer s.imamura\n' mainframe mainframe\ntitle ビジネスコンテキスト\nleft to right direction\nscale max 2048 width\n\n' === スタイル ===\nskinparam {\n    ' === 共通設定 ===\n    shadowing false\n    ' linetype ortho\n    backgroundColor whitesmoke\n    arrow {\n        color indianRed\n        thickness 0.8\n        fontSize 10\n    }\n    title {\n        FontSize 14\n        ' FontColor blue\n        BorderThickness 10\n        BorderColor transparent\n    }\n\n    ' === 要素別設定 ===\n    rectangle {\n        BackgroundColor business\n        BorderColor #000\n        RoundCorner 25\n        BorderThickness 0.6\n        fontColor black\n        fontSize 14\n    }\n    actor {\n        fontColor black\n        fontSize 12\n    }\n    node {\n        BorderColor #999999\n        fontColor black\n        fontSize 12\n    }\n    component {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n    storage {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n}\n\n\n' アクター\nactor 会員 as member\nactor 従業員 as employee\nactor インストラクター as instructor\n\n' 業務\nstorage 会員登録\nstorage 入退館\nstorage スタジオレッスン\nstorage インストラクター管理\n\n' もの\n\n\n' 関連\nmember -- 会員登録\nmember -- 入退館\nmember -- スタジオレッスン\n\n\nスタジオレッスン -- instructor\ninstructor -- インストラクター管理\n\n会員登録 -- employee\nインストラクター管理 -- employee\n@enduml\n```\n\nとりあえず、最初に思いついたものだけ\n\n\n## 情報モデル1\n\nシステムの中で使われていそうな用語（概念）を関連づける。\nとりあえず最初のモデルとして、用語の洗い出しと関連付けをしてみた。\n用語は、会則から抜き出した\nhttps://i.tipness.co.jp/i/pdf/kaisoku.pdf\n\n\n```plantuml\n@startuml\n' === ドキュメント設定 ===\nright footer s.imamura\n' mainframe mainframe\ntitle ドメインモデル\nleft to right direction\nscale max 2048 width\n\n' === スタイル ===\nskinparam {\n    ' === 共通設定 ===\n    shadowing false\n    ' linetype ortho\n    backgroundColor whitesmoke\n    arrow {\n        color indianRed\n        thickness 0.8\n        fontSize 10\n    }\n    title {\n        FontSize 14\n        ' FontColor blue\n        BorderThickness 10\n        BorderColor transparent\n    }\n\n    ' === 要素別設定 ===\n    rectangle {\n        BackgroundColor business\n        BorderColor #000\n        RoundCorner 25\n        BorderThickness 0.6\n        fontColor black\n        fontSize 14\n    }\n    actor {\n        fontColor black\n        fontSize 12\n    }\n    node {\n        BorderColor #999999\n        fontColor black\n        fontSize 12\n    }\n    component {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n    storage {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n}\n\n\n' 用語\nstorage 会員関連 {\n    card 会員\n    card 親権者\n    card 除名処分\n    card 氏名\n    card 会員番号\n    card パスワード\n    card メールアドレス\n    card 顔写真\n    card 会員証\n    card 会員種類\n}\ncard 同伴ビジター\ncard 入会\ncard 契約期間\ncard 退会\ncard 退会希望月\ncard 休会\ncard 休会月会費\ncard 休会期間\ncard 休会希望月\ncard 休会手続期限\ncard プライベートロッカー\ncard 変更手続き\n\nstorage 会費関連 {\n    card 会費\n    card 入会金\n    card 割引\n    card 消費税\n    card 支払方法\n    card 支払時期\n    card 滞納\n}\ncard 施設\ncard 休館日\ncard 年次休館\ncard 定期休館\ncard 会費返金\ncard 店舗\ncard クラブサービス\ncard 提携クレジットカード会社\ncard 会員資格喪失\ncard 告知\ncard 法人登録会員\ncard 契約法人\n\n' 関連\n\n\n@enduml\n```\n\n法人の契約とかあったんですね。。\n入会退会は想定してたけど、休会もあるんですね。しかも会費があるという。\n\n## ビジネスコンテキスト2\nドメインモデルで発見された概念から、不足していた業務を補う\n\n\n```plantuml\n@startuml\n' === ドキュメント設定 ===\nright footer s.imamura\n' mainframe mainframe\ntitle ビジネスコンテキスト\nleft to right direction\nscale max 2048 width\n\n' === スタイル ===\nskinparam {\n    ' === 共通設定 ===\n    shadowing false\n    ' linetype ortho\n    backgroundColor whitesmoke\n    arrow {\n        color indianRed\n        thickness 0.8\n        fontSize 10\n    }\n    title {\n        FontSize 14\n        ' FontColor blue\n        BorderThickness 10\n        BorderColor transparent\n    }\n\n    ' === 要素別設定 ===\n    rectangle {\n        BackgroundColor business\n        BorderColor #000\n        RoundCorner 25\n        BorderThickness 0.6\n        fontColor black\n        fontSize 14\n    }\n    actor {\n        fontColor black\n        fontSize 12\n    }\n    node {\n        BorderColor #999999\n        fontColor black\n        fontSize 12\n    }\n    component {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n    storage {\n        BackgroundColor white\n        BorderThickness 0.5\n        BorderColor #666666\n        fontColor black\n        fontSize 11\n    }\n}\n\n\n' アクター\nnode スポーツクラブ {\n    actor 従業員 as employee\n}\nactor インストラクター as instructor\nactor 会員 as member\nactor 契約法人 as contracted_corporation\nactor クレジットカード会社 as credit_card_company\ncontracted_corporation . member\n\n' 業務\nstorage 入会_退会_休会\nstorage 入退館\nstorage 会費支払\nstorage 法人契約\nstorage スタジオレッスン\nstorage インストラクター管理\nstorage 告知\nstorage 休館日管理\n\n' もの\n\n\n' 関連\ncontracted_corporation -- 法人契約\nmember -- 入会_退会_休会\nmember -- 会費支払\nmember -- 入退館\nmember -- スタジオレッスン\n\nスタジオレッスン -- instructor\ninstructor -- インストラクター管理\n\n会費支払 -- employee\n入会_退会_休会 -- employee\nインストラクター管理 -- employee\n告知 -- employee\n法人契約 -- employee\nemployee -- 休館日管理\n\n\ncredit_card_company -- 会費支払\n@enduml\n```\n\nアクターとして、クレジットカード会社、契約法人を追加\n業務として、会費支払、告知を追加\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:27:49+09:00","group":null,"id":"f83ca9d77d2b42d34d30","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"plantuml","versions":[]},{"name":"要件定義","versions":[]},{"name":"RDRA2.0","versions":[]},{"name":"事業分析","versions":[]}],"title":"スポーツクラブの事業分析","updated_at":"2022-09-18T20:27:49+09:00","url":"https://qiita.com/s3imamura/items/f83ca9d77d2b42d34d30","user":{"description":"SE 5年目。主に Web システムの要件定義。","facebook_id":"","followees_count":2,"followers_count":2,"github_login_name":null,"id":"s3imamura","items_count":5,"linkedin_id":"","location":"東京, 世田谷区","name":"Shohei Imamura","organization":"","permanent_id":259861,"profile_image_url":"https://lh4.googleusercontent.com/-eDUmtmaZLPc/AAAAAAAAAAI/AAAAAAAAAIs/nq7menU0Mjs/photo.jpg?sz=50","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:9\"\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-3:285\"\u003eある中国地方に展開している電力系光プロバイダが「光電話」というIP電話サービスを提供しています。このプロバイダからレンタルされるルータ Aterm WH832A を使って、FreePBX(Asterisk)からの発着信を可能にします。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:371\"\u003eこのルータにはFXOポートが付いており、通常はここにアナログ電話機を接続してIP電話を利用します。しかし、このルータの\u003ca href=\"https://www.aterm.jp/function/wh832a_ez/list/main/m01_m58.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eスマートフォン向けのIP電話機能\u003c/a\u003eを使うと、SIP端末やAsteriskのトランクから直接IP電話を利用できます。\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-8:118\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/fe72506cd71e4160b02b25dec267e0336515c243/68747470733a2f2f7777772e617465726d2e6a702f66756e6374696f6e2f7768383332615f657a2f6c6973742d696d6167652f636f6d2d616c6c2f697074656c2e676966\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.aterm.jp%2Ffunction%2Fwh832a_ez%2Flist-image%2Fcom-all%2Fiptel.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8bf8cfaac1fd79318c30855144523bf2\" alt=\"\" data-canonical-src=\"https://www.aterm.jp/function/wh832a_ez/list-image/com-all/iptel.gif\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.aterm.jp%2Ffunction%2Fwh832a_ez%2Flist-image%2Fcom-all%2Fiptel.gif?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=577d97620c2e063dda9670fe1384dbf7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n引用元：\u003ca href=\"https://www.aterm.jp/function/wh832a_ez/list/main/m01_m58.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNEC ATerm WH832Aのマニュアル\u003c/a\u003eより\u003c/p\u003e\n\u003cp data-sourcepos=\"10:1-10:140\"\u003eただしAsteriskのトランク先として使う場合、発信は問題ないのですが、そのままでは着信ができません。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"12:1-12:66\"\u003e\n\u003cspan id=\"telスキーマをサポートしていないpjsipドライバ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tel%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E3%82%92%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84pjsip%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etel:スキーマをサポートしていないPJSIPドライバ\u003c/h2\u003e\n\u003cp data-sourcepos=\"14:1-14:220\"\u003eATermルータから送られるTo:ヘッダに tel: URI が使用されるため、これをサポートしていないAsteriskのPJSIPドライバは \u003ccode\u003e416 Unsupported URI Scheme\u003c/code\u003e エラーを返してしまいます。\u003c/p\u003e\n\u003cp data-sourcepos=\"16:1-16:178\"\u003e具体的な着信時のSIPメッセージは次の通りです。ATermルータからの着信時、INVITEメッセージのTo:ヘッダにtel: URIが指定されています。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"18:1-26:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u0026lt;===\nINVITE sip:s@192.168.0.12:5060 SIP/2.0\nf: \"0123456789\" \u0026lt;sip:0123456789@1.2.3.4\u0026gt;;tag=160879891\nt: \u0026lt;tel:023456789;phone-context=1.2.3.4\u0026gt;\n\n===\u0026gt;\nSIP/2.0 416 Unsupported URI Scheme\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"28:1-28:72\"\u003eこの問題はすでにフォーラム等で報告されています：\u003c/p\u003e\n\u003cul data-sourcepos=\"30:1-33:0\"\u003e\n\u003cli data-sourcepos=\"30:1-30:160\"\u003e\n\u003ca href=\"https://community.asterisk.org/t/pjsip-issue-with-tel-rfc-3966/77225\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePJSIP issue with TEL (RFC 3966) - Asterisk / Asterisk SIP - Asterisk Community\u003c/a\u003e 2018.11\u003c/li\u003e\n\u003cli data-sourcepos=\"31:1-31:143\"\u003e\n\u003ca href=\"https://community.asterisk.org/t/handling-of-tel-uris/87573/15\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHandling of tel URIs - Asterisk / Asterisk SIP - Asterisk Community\u003c/a\u003e 2021.5-\u003c/li\u003e\n\u003cli data-sourcepos=\"32:1-33:0\"\u003e\n\u003ca href=\"https://issues.asterisk.org/jira/browse/ASTERISK-26894\" rel=\"nofollow noopener\" target=\"_blank\"\u003e[ASTERISK-26894] pjsip should support tel uri scheme - Digium/Asterisk JIRA\u003c/a\u003e 2018\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"34:1-34:432\"\u003ePJSIPドライバが利用するPJSIPライブラリ自体は tel: URI をサポートしていますが、Asteriskの側がサポートしていません。この点、Asteriskのコードの改造を試してみましたが、416エラーを出す部分をバイパスしてtel: URIを処理させようとすると、受信SIPメッセージを表す構造体におかしなポインタが格納されSEGVしてしまいます。\u003c/p\u003e\n\u003cp data-sourcepos=\"36:1-36:382\"\u003e現状のAsteriskの多くのコードがsip: URIを前提としているようで、tel: URIをサポートするには、各所のコードにかなり手を入れてテストをしないといけないのかもしれません。この点が、未だに開発側がtel: URIをサポートするつもりがない（orしようとしてもできない）理由と思われます。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"38:1-38:64\"\u003e\n\u003cspan id=\"tel-を-sip-へ変換するb2buaサーバを間に立てる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tel-%E3%82%92-sip-%E3%81%B8%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8Bb2bua%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E9%96%93%E3%81%AB%E7%AB%8B%E3%81%A6%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003etel: を sip: へ変換するB2BUAサーバを間に立てる\u003c/h2\u003e\n\u003cp data-sourcepos=\"40:1-40:227\"\u003eAsterisk側をどうにもできないのであれば、\u003cstrong\u003eATermルータとAsteriskの間にB2BUA(Back-to-Back User Agent)サーバを立て、これにtel: URIをsip: URIに変換させる\u003c/strong\u003eという手が考えられます。\u003c/p\u003e\n\u003cp data-sourcepos=\"42:1-42:163\"\u003e今回は、こうしたメッセージの書き換えを伴うB2BUAサーバをJavaScriptで容易に記述できる drachtio を用いることにしました。\u003c/p\u003e\n\u003cp data-sourcepos=\"44:1-44:21\"\u003e\u003cqiita-embed-ogp src=\"https://drachtio.org/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"46:1-46:18\"\u003e\n\u003cspan id=\"ノード構成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8E%E3%83%BC%E3%83%89%E6%A7%8B%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eノード構成\u003c/h2\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMzU1cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo1NjRweDtoZWlnaHQ6MzU1cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNTY0IDM1NSIgd2lkdGg9IjU2NHB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImYxd3doZXpqaWI2d3Y0IiB3aWR0aD0iMzAwJSIgeD0iLTEiIHk9Ii0xIj48ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyT3V0IiBzdGREZXZpYXRpb249IjIuMCIvPjxmZUNvbG9yTWF0cml4IGluPSJibHVyT3V0IiByZXN1bHQ9ImJsdXJPdXQyIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgLjQgMCIvPjxmZU9mZnNldCBkeD0iNC4wIiBkeT0iNC4wIiBpbj0iYmx1ck91dDIiIHJlc3VsdD0iYmx1ck91dDMiLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJibHVyT3V0MyIgbW9kZT0ibm9ybWFsIi8+PC9maWx0ZXI+PC9kZWZzPjxnPjwhLS1NRDU9WzRjZGFiMWU3MjE4NDAzNWU5MWUzNmM3MTBhYjJjMDFiXQplbnRpdHkgYXN0LS0+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2Yxd3doZXpqaWI2d3Y0KSIgcG9pbnRzPSIzNjIsMTYsMzcyLDYsNTI2LDYsNTI2LDU4LjU5MzgsNTE2LDY4LjU5MzgsMzYyLDY4LjU5MzgsMzYyLDE2IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI1MTYiIHgyPSI1MjYiIHkxPSIxNiIgeTI9IjYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzNjIiIHgyPSI1MTYiIHkxPSIxNiIgeTI9IjE2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTE2IiB4Mj0iNTE2IiB5MT0iMTYiIHkyPSI2OC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI0IiB4PSIzNzciIHk9IjM4Ljk5NTEiPkZyZWVQQlgoQXN0ZXJpc2spPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkzIiB4PSIzNzciIHk9IjU1LjI5MiI+MTkyLjE2OC4wLjEyPC90ZXh0PjwhLS1NRDU9WzcyN2MxMDQwYWY5YmUxODhhYjE3ZDE5YzQ5ZjlhYzEwXQplbnRpdHkgZHMtLT48cG9seWdvbiBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZjF3d2hlemppYjZ3djQpIiBwb2ludHM9IjM0MSwxNTYsMzUxLDE0Niw1NDcsMTQ2LDU0NywxOTguNTkzOCw1MzcsMjA4LjU5MzgsMzQxLDIwOC41OTM4LDM0MSwxNTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjUzNyIgeDI9IjU0NyIgeTE9IjE1NiIgeTI9IjE0NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjM0MSIgeDI9IjUzNyIgeTE9IjE1NiIgeTI9IjE1NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjUzNyIgeDI9IjUzNyIgeTE9IjE1NiIgeTI9IjIwOC41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY2IiB4PSIzNTYiIHk9IjE3OC45OTUxIj5kcmFjaHRpby1zZXJ2ZXIgKGRvY2tlcik8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTMiIHg9IjM1NiIgeT0iMTk1LjI5MiI+MTkyLjE2OC4wLjIzPC90ZXh0PjwhLS1NRDU9W2QwZWY1NWI3NDJhMThmNGE3ZTBlY2MxNjRmM2YwNWEyXQplbnRpdHkgZHNjLS0+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2Yxd3doZXpqaWI2d3Y0KSIgcG9pbnRzPSIxNiwxNTYsMjYsMTQ2LDI3OCwxNDYsMjc4LDE5OC41OTM4LDI2OCwyMDguNTkzOCwxNiwyMDguNTkzOCwxNiwxNTYiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjI2OCIgeDI9IjI3OCIgeTE9IjE1NiIgeTI9IjE0NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE2IiB4Mj0iMjY4IiB5MT0iMTU2IiB5Mj0iMTU2Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjY4IiB4Mj0iMjY4IiB5MT0iMTU2IiB5Mj0iMjA4LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjIiIHg9IjMxIiB5PSIxNzguOTk1MSI+ZHJhY2h0aW8tY29udHJvbGxlciAoTm9kZS5qcyBhcHApPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijk2IiB4PSIzMSIgeT0iMTk1LjI5MiI+MTkyLjE2OC4wLnh4eDwvdGV4dD48IS0tTUQ1PVtjYTVjZGViYTE2YWY3NzI2MzZkNzdkZWM4NTE3MzY1YV0KZW50aXR5IGF0ZXJtLS0+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2Yxd3doZXpqaWI2d3Y0KSIgcG9pbnRzPSIzODIsMjk2LDM5MiwyODYsNTA2LDI4Niw1MDYsMzM4LjU5MzgsNDk2LDM0OC41OTM4LDM4MiwzNDguNTkzOCwzODIsMjk2IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI0OTYiIHgyPSI1MDYiIHkxPSIyOTYiIHkyPSIyODYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzODIiIHgyPSI0OTYiIHkxPSIyOTYiIHkyPSIyOTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI0OTYiIHgyPSI0OTYiIHkxPSIyOTYiIHkyPSIzNDguNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzIiB4PSIzOTciIHk9IjMxOC45OTUxIj5BdGVybeODq+ODvOOCvzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NCIgeD0iMzk3IiB5PSIzMzUuMjkyIj4xOTIuMTY4LjAuMTwvdGV4dD48IS0tTUQ1PVthNjBmNzJjYzBlZjIzN2Q3OTA0Zjg1MmNlMDRhY2MyMF0KbGluayBhc3QgdG8gZHMtLT48cGF0aCBkPSJNNDQ0LDY5LjEzIEM0NDQsOTAuMyA0NDQsMTE4LjU0IDQ0NCwxNDAuNzQgIiBmaWxsPSJub25lIiBpZD0iYXN0LXRvLWRzIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjQ0NCwxNDUuOTYsNDQ4LDEzNi45Niw0NDQsMTQwLjk2LDQ0MCwxMzYuOTYsNDQ0LDE0NS45NiIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjEiIHg9IjQ0NSIgeT0iMTEyLjA2NjkiPlJFR0lTVEVSPC90ZXh0PjwhLS1NRDU9WzcxMzY1MTUyNThjM2RkY2FhYWNlODU2YjQyOGRiMTUyXQpsaW5rIGRzIHRvIGF0ZXJtLS0+PHBhdGggZD0iTTQ0NCwyMDkuMTMgQzQ0NCwyMzAuMyA0NDQsMjU4LjU0IDQ0NCwyODAuNzQgIiBmaWxsPSJub25lIiBpZD0iZHMtdG8tYXRlcm0iIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNDQ0LDI4NS45Niw0NDgsMjc2Ljk2LDQ0NCwyODAuOTYsNDQwLDI3Ni45Niw0NDQsMjg1Ljk2IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MSIgeD0iNDQ1IiB5PSIyNTIuMDY2OSI+UkVHSVNURVI8L3RleHQ+PCEtLU1ENT1bZTBlMWY2NThiZDU0ZDFiMWJhNmYwZGJlMTBmN2UxNWJdCmxpbmsgZHNjIHRvIGRzLS0+PHBhdGggZD0iTTI3OC4xMywxNzcuNSBDMjk3LjMxLDE3Ny41IDMxNi44OCwxNzcuNSAzMzUuNTMsMTc3LjUgIiBmaWxsPSJub25lIiBpZD0iZHNjLXRvLWRzIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjM0MC43NywxNzcuNSwzMzEuNzcsMTczLjUsMzM1Ljc3LDE3Ny41LDMzMS43NywxODEuNSwzNDAuNzcsMTc3LjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2IiB4PSIyOTYuNSIgeT0iMTcwLjU2NjkiPuWItuW+oTwvdGV4dD48IS0tTUQ1PVtjMWZmMTFlMjQyNWQxN2RjODg2NGExNjgyMDE3MzAzZl0KQHN0YXJ0dW1sDQpub2RlICJGcmVlUEJYKEFzdGVyaXNrKVxuMTkyLjE2OC4wLjEyIiBhcyBhc3QNCm5vZGUgImRyYWNodGlvLXNlcnZlciAoZG9ja2VyKVxuMTkyLjE2OC4wLjIzIiBhcyBkcyANCm5vZGUgImRyYWNodGlvLWNvbnRyb2xsZXIgKE5vZGUuanMgYXBwKVxuMTkyLjE2OC4wLnh4eCIgYXMgZHNjIA0Kbm9kZSAiQXRlcm3jg6vjg7zjgr9cbjE5Mi4xNjguMC4xIiBhcyBhdGVybQ0KDQphc3QgLSAtPiBkcyA6IFJFR0lTVEVSDQpkcyAtIC0+IGF0ZXJtIDogUkVHSVNURVINCmRzYyAtPiBkcyA6IOWItuW+oQ0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjE2KFdlZCBEZWMgMDggMTc6MjU6MjIgVVRDIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IG51bGwKLS0+PC9nPjwvc3ZnPg==\" loading=\"lazy\"\u003e\n\u003cp data-sourcepos=\"61:1-61:271\"\u003eノード構成は上の形を想定します。drachtioを利用するには、まずB2BUAサーバとなる drachtio-server を立ち上げます。これをNode.jsで作られた制御アプリケーション(上の図ではdrachtio-controller)から制御します。\u003c/p\u003e\n\u003cp data-sourcepos=\"63:1-63:187\"\u003eAsteriskのトランク先には drachtio-server を指定します。Asteriskが drachtio-server にREGISTERし、 drachtio-server がAtermルータにREGISTERする形となります。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"65:1-65:48\"\u003e\n\u003cspan id=\"処理する必要があるsipメッセージ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8Bsip%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e処理する必要があるSIPメッセージ\u003c/h2\u003e\n\u003cimg src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMzUwcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDoyMTJweDtoZWlnaHQ6MzUwcHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjEyIDM1MCIgd2lkdGg9IjIxMnB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImYzejBoMjJ2bzhhY2UiIHdpZHRoPSIzMDAlIiB4PSItMSIgeT0iLTEiPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIHN0ZERldmlhdGlvbj0iMi4wIi8+PGZlQ29sb3JNYXRyaXggaW49ImJsdXJPdXQiIHJlc3VsdD0iYmx1ck91dDIiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAuNCAwIi8+PGZlT2Zmc2V0IGR4PSI0LjAiIGR5PSI0LjAiIGluPSJibHVyT3V0MiIgcmVzdWx0PSJibHVyT3V0MyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImJsdXJPdXQzIiBtb2RlPSJub3JtYWwiLz48L2ZpbHRlcj48L2RlZnM+PGc+PCEtLU1ENT1bNGNkYWIxZTcyMTg0MDM1ZTkxZTM2YzcxMGFiMmMwMWJdCmVudGl0eSBhc3QtLT48cG9seWdvbiBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZjN6MGgyMnZvOGFjZSkiIHBvaW50cz0iMTYsMTYsMjYsNiwxODAsNiwxODAsNDIuMjk2OSwxNzAsNTIuMjk2OSwxNiw1Mi4yOTY5LDE2LDE2IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNzAiIHgyPSIxODAiIHkxPSIxNiIgeTI9IjYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNiIgeDI9IjE3MCIgeTE9IjE2IiB5Mj0iMTYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNzAiIHgyPSIxNzAiIHkxPSIxNiIgeTI9IjUyLjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjQiIHg9IjMxIiB5PSIzOC45OTUxIj5GcmVlUEJYKEFzdGVyaXNrKTwvdGV4dD48IS0tTUQ1PVs3MjdjMTA0MGFmOWJlMTg4YWIxN2QxOWM0OWY5YWMxMF0KZW50aXR5IGRzLS0+PHBvbHlnb24gZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2YzejBoMjJ2bzhhY2UpIiBwb2ludHM9IjI2LDE2OSwzNiwxNTksMTcwLDE1OSwxNzAsMTk1LjI5NjksMTYwLDIwNS4yOTY5LDI2LDIwNS4yOTY5LDI2LDE2OSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTYwIiB4Mj0iMTcwIiB5MT0iMTY5IiB5Mj0iMTU5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMjYiIHgyPSIxNjAiIHkxPSIxNjkiIHkyPSIxNjkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIxNjAiIHgyPSIxNjAiIHkxPSIxNjkiIHkyPSIyMDUuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNCIgeD0iNDEiIHk9IjE5MS45OTUxIj5kcmFjaHRpby1zZXJ2ZXI8L3RleHQ+PCEtLU1ENT1bY2E1Y2RlYmExNmFmNzcyNjM2ZDc3ZGVjODUxNzM2NWFdCmVudGl0eSBhdGVybS0tPjxwb2x5Z29uIGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmM3owaDIydm84YWNlKSIgcG9pbnRzPSIzNi41LDMwNyw0Ni41LDI5NywxNTkuNSwyOTcsMTU5LjUsMzMzLjI5NjksMTQ5LjUsMzQzLjI5NjksMzYuNSwzNDMuMjk2OSwzNi41LDMwNyIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iMTQ5LjUiIHgyPSIxNTkuNSIgeTE9IjMwNyIgeTI9IjI5NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjM2LjUiIHgyPSIxNDkuNSIgeTE9IjMwNyIgeTI9IjMwNyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIgeDE9IjE0OS41IiB4Mj0iMTQ5LjUiIHkxPSIzMDciIHkyPSIzNDMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgzIiB4PSI1MS41IiB5PSIzMjkuOTk1MSI+QXRlcm3jg6vjg7zjgr88L3RleHQ+PCEtLU1ENT1bYTYwZjcyY2MwZWYyMzdkNzkwNGY4NTJjZTA0YWNjMjBdCmxpbmsgYXN0IHRvIGRzLS0+PHBhdGggZD0iTTYwLjk5LDUyLjI2IEM1MS4wMSw2MC4yOCA0MS40Niw3MC4yOSAzNiw4MiBDMjcuMTcsMTAwLjkzIDI3LjE3LDExMC4wNyAzNiwxMjkgQzQwLjcsMTM5LjA3IDQ4LjQsMTQ3Ljg3IDU2LjgyLDE1NS4yNCAiIGZpbGw9Im5vbmUiIGlkPSJhc3QtdG8tZHMiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNjAuOTksMTU4Ljc0LDU2LjY2OTEsMTQ5Ljg4OTYsNTcuMTYwNiwxNTUuNTI1LDUxLjUyNTIsMTU2LjAxNjYsNjAuOTksMTU4Ljc0IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NSIgeD0iNDAuNSIgeT0iOTUuMDY2OSI+UkVHSVNURVIsPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjYxIiB4PSI0Mi41IiB5PSIxMTAuMTk5NyI+T1BUSU9OUyw8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzYiIHg9IjM3IiB5PSIxMjUuMzMyNSI+SU5WSVRFKOeZuuS/oSk8L3RleHQ+PCEtLU1ENT1bMzg5YWI0YzdjN2IwZGQyMjMwMDg2NWVmODE4NDhlYzRdCmxpbmsgZHMgdG8gYXN0LS0+PHBhdGggZD0iTTEwOC42MiwxNTguNzUgQzExMi4zOCwxNDkuNzMgMTE2LjEzLDEzOS4wOCAxMTgsMTI5IEMxMjEuODEsMTA4LjQ2IDEyMS44MSwxMDIuNTQgMTE4LDgyIEMxMTYuNDUsNzMuNjUgMTEzLjYxLDY0LjkyIDExMC41NSw1Ny4wNCAiIGZpbGw9Im5vbmUiIGlkPSJkcy10by1hc3QiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMTA4LjYyLDUyLjI1LDEwOC4yNzQ3LDYyLjA5MjgsMTEwLjQ4OTIsNTYuODg3NCwxMTUuNjk0Niw1OS4xMDIsMTA4LjYyLDUyLjI1IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NiIgeD0iMTIxIiB5PSIxMTAuMDY2OSI+SU5WSVRFKOedgOS/oSk8L3RleHQ+PCEtLU1ENT1bNzEzNjUxNTI1OGMzZGRjYWFhY2U4NTZiNDI4ZGIxNTJdCmxpbmsgZHMgdG8gYXRlcm0tLT48cGF0aCBkPSJNNjAuOTksMjA1LjI2IEM1MS4wMSwyMTMuMjggNDEuNDYsMjIzLjI5IDM2LDIzNSBDMjkuOTksMjQ3Ljg5IDI5Ljk5LDI1NC4xMSAzNiwyNjcgQzQwLjcsMjc3LjA3IDQ4LjQsMjg1Ljg3IDU2LjgyLDI5My4yNCAiIGZpbGw9Im5vbmUiIGlkPSJkcy10by1hdGVybSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iI0E4MDAzNiIgcG9pbnRzPSI2MC45OSwyOTYuNzQsNTYuNjY5MSwyODcuODg5Niw1Ny4xNjA2LDI5My41MjUsNTEuNTI1MiwyOTQuMDE2Niw2MC45OSwyOTYuNzQiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSI0MC41IiB5PSIyNDguMDY2OSI+UkVHSVNURVIsPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc2IiB4PSIzNyIgeT0iMjYzLjE5OTciPklOVklURSjnmbrkv6EpPC90ZXh0PjwhLS1NRDU9WzcyZWYxMzMyM2NhNzE3YjliYWIyYTBmMDVkZjQ3YmY3XQpsaW5rIGF0ZXJtIHRvIGRzLS0+PHBhdGggZD0iTTEwOC42MiwyOTYuNzUgQzExMi4zOCwyODcuNzMgMTE2LjEzLDI3Ny4wOCAxMTgsMjY3IEMxMjAuNiwyNTMuMDIgMTIwLjYsMjQ4Ljk4IDExOCwyMzUgQzExNi40NSwyMjYuNjUgMTEzLjYxLDIxNy45MiAxMTAuNTUsMjEwLjA0ICIgZmlsbD0ibm9uZSIgaWQ9ImF0ZXJtLXRvLWRzIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjQTgwMDM2IiBwb2ludHM9IjEwOC42MiwyMDUuMjUsMTA4LjI3NDcsMjE1LjA5MjgsMTEwLjQ4OTIsMjA5Ljg4NzQsMTE1LjY5NDYsMjEyLjEwMiwxMDguNjIsMjA1LjI1IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4MCIgeD0iMTIwIiB5PSIyNDguMDY2OSI+SU5WSVRFKOedgOS/oSksPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU3IiB4PSIxMzMuNSIgeT0iMjYzLjE5OTciPk9QVElPTlM8L3RleHQ+PCEtLU1ENT1bYWVkZWRlNGVkMzQxMDAzZTViMmYzZTlmYjM5YTA2NTldCkBzdGFydHVtbA0Kbm9kZSAiRnJlZVBCWChBc3RlcmlzaykiIGFzIGFzdA0Kbm9kZSAiZHJhY2h0aW8tc2VydmVyIiBhcyBkcyANCm5vZGUgIkF0ZXJt44Or44O844K/IiBhcyBhdGVybQ0KDQphc3QgLT4gZHMgOiBSRUdJU1RFUiwgXG5PUFRJT05TLCBcbklOVklURSjnmbrkv6EpDQpkcyAtPiBhdGVybSA6IFJFR0lTVEVSLCBcbklOVklURSjnmbrkv6EpDQphdGVybSAtIC0+IGRzIDogSU5WSVRFKOedgOS/oSksIFxuT1BUSU9OUw0KZHMgLSAtPiBhc3QgOiBJTlZJVEUo552A5L+hKQ0KQGVuZHVtbA0KClBsYW50VU1MIHZlcnNpb24gMS4yMDIxLjE2KFdlZCBEZWMgMDggMTc6MjU6MjIgVVRDIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IG51bGwKLS0+PC9nPjwvc3ZnPg==\" loading=\"lazy\"\u003e\n\u003cp data-sourcepos=\"80:1-80:211\"\u003e制御アプリケーションを通じて drachtio-server に処理させる必要のあるSIPメッセージは上の通りです。他のメッセージは drachtio-server がよしなにしてくれます。\u003c/p\u003e\n\u003cp data-sourcepos=\"82:1-82:185\"\u003e各々のIP電話システムの要件に応じて、他のメッセージも制御する必要が出てくるかと思いますが、私の利用ケースはこれで十分でした。\u003c/p\u003e\n\u003cp data-sourcepos=\"84:1-84:102\"\u003eRTPストリームには関与しません。各ピアから来たSDPをそのまま転送します。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"86:1-86:9\"\u003e\n\u003cspan id=\"手順\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%89%8B%E9%A0%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e手順\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"88:1-88:35\"\u003e\n\u003cspan id=\"drachtio-server-を構成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#drachtio-server-%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edrachtio-server を構成する\u003c/h3\u003e\n\u003cp data-sourcepos=\"90:1-90:152\"\u003eまずB2BUAサーバとなる drachtio-server を構成します。DockerホストとなるノードがFreePBXノードとは別に一つ必要です。\u003c/p\u003e\n\u003cp data-sourcepos=\"92:1-92:78\"\u003eDockerイメージが提供されているので、これを利用します。\u003c/p\u003e\n\u003cp data-sourcepos=\"94:1-94:50\"\u003e\u003cqiita-embed-ogp src=\"https://hub.docker.com/r/drachtio/drachtio-server/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"96:1-96:147\"\u003eネットワーク構成を単純にするために、Dockerのipvlanネットワークを使い、コンテナをLAN内に直接公開します。\u003c/p\u003e\n\u003cp data-sourcepos=\"98:1-98:175\"\u003e※標準のbridgeネットワークを使い、5060/udp(SIP)と9022/tcp(drachtioの制御ポート)を公開する形でも、多分問題なく動作すると思います。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"100:1-112:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c\"\u003e# ipvlanネットワーク \"my_lan\" を作成する\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# XX/YY にはコンテナにIPアドレスを自動割り当てする場合、その範囲を指定する\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# IFNAME にはコンテナのIPアドレスに割り当てられるホスト上のインターフェイス(e.g. eth0)を指定する\u003c/span\u003e\ndocker network create \u003cspan class=\"nt\"\u003e-d\u003c/span\u003e ipvlan \u003cspan class=\"nt\"\u003e--subnet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.0.0/24 \u003cspan class=\"nt\"\u003e--ip-range\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.0.XX/YY \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--gateway\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.0.1 \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e \u003cspan class=\"nv\"\u003eipvlan_mode\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003el2 \u003cspan class=\"nt\"\u003e-o\u003c/span\u003e \u003cspan class=\"nv\"\u003eparent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eIFNAME my_lan\n\n\u003cspan class=\"c\"\u003e# コンテナを起動（先に後述の手順で設定ファイルを用意すること）\u003c/span\u003e\ndocker run \u003cspan class=\"nt\"\u003e-v\u003c/span\u003e /data-drac-config:/config \u003cspan class=\"nt\"\u003e-it\u003c/span\u003e \u003cspan class=\"nt\"\u003e--name\u003c/span\u003e drac \u003cspan class=\"nt\"\u003e--rm\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  \u003cspan class=\"nt\"\u003e--net\u003c/span\u003e my_lan \u003cspan class=\"nt\"\u003e--ip\u003c/span\u003e 192.168.0.23 drachtio/drachtio-server:latest \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\n  drachtio \u003cspan class=\"nt\"\u003e-f\u003c/span\u003e /config/drachtio.conf.xml\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"114:1-114:284\"\u003e上のコマンドで起動した場合、設定はDockerホスト上に \u003ccode\u003e/data-drac-config/drachtio.conf.xml\u003c/code\u003e を作成して行います。\u003ca href=\"https://github.com/davehorton/docker-drachtio-server/blob/master/drachtio.conf.xml\" rel=\"nofollow noopener\" target=\"_blank\"\u003e開発リポジトリのひな型\u003c/a\u003eを書き換えます。\u003c/p\u003e\n\u003cp data-sourcepos=\"116:1-116:87\"\u003e次の通り、最低限の設定は\u003ccode\u003e\u0026lt;admin\u0026gt;\u003c/code\u003eタグだけで大丈夫なはずです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"xml\" data-sourcepos=\"118:1-124:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e/data-drac-config/drachtio.conf.xml\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;drachtio\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e\u0026lt;!-- 注： 0.0.0.0 の前後に空白・改行が入ると Invalid Argument エラーになるので注意 --\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;admin\u003c/span\u003e \u003cspan class=\"na\"\u003eport=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"9022\"\u003c/span\u003e \u003cspan class=\"na\"\u003esecret=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"MyPassword\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e0.0.0.0\u003cspan class=\"nt\"\u003e\u0026lt;/admin\u0026gt;\u003c/span\u003e\n    ...\n\u003cspan class=\"nt\"\u003e\u0026lt;/drachtio\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"126:1-126:85\"\u003e\n\u003cspan id=\"drachtio-controller-制御用のnodejsアプリケーション-を作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#drachtio-controller-%E5%88%B6%E5%BE%A1%E7%94%A8%E3%81%AEnodejs%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edrachtio-controller (制御用のNode.jsアプリケーション) を作成する\u003c/h3\u003e\n\u003cp data-sourcepos=\"128:1-128:93\"\u003e続いて drachtio-server を制御するNode.jsアプリケーションを作成します。\u003c/p\u003e\n\u003ch4 data-sourcepos=\"130:1-130:32\"\u003e\n\u003cspan id=\"プロジェクトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプロジェクトの作成\u003c/h4\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"132:1-136:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003emkdir \u003c/span\u003edrachtio-controller\n\u003cspan class=\"nb\"\u003ecd \u003c/span\u003edrachtio-controller\nnpm i drachtio-srf config pino rxjs ts-node @types/node  \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cul data-sourcepos=\"138:1-143:0\"\u003e\n\u003cli data-sourcepos=\"138:1-139:49\"\u003e\n\u003ccode\u003edrachtio-srf\u003c/code\u003e が drachtio を制御するクライアントライブラリです\n\u003cul data-sourcepos=\"139:3-139:49\"\u003e\n\u003cli data-sourcepos=\"139:3-139:49\"\u003e本質的に必須なのはこれだけです\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"140:1-140:197\"\u003e\n\u003ccode\u003econfig\u003c/code\u003e と \u003ccode\u003epino\u003c/code\u003e は\u003ca href=\"https://github.com/davehorton/generator-drachtio\" rel=\"nofollow noopener\" target=\"_blank\"\u003e公式のyeomanテンプレート\u003c/a\u003eでも用いられている、設定読み込みとログ出力のライブラリです\u003c/li\u003e\n\u003cli data-sourcepos=\"141:1-141:117\"\u003e\n\u003ccode\u003erxjs\u003c/code\u003e は定期的なREGISTERを行うために使用していますが、 setInterval を使うなら不要です\u003c/li\u003e\n\u003cli data-sourcepos=\"142:1-143:0\"\u003e\n\u003ccode\u003ets-node\u003c/code\u003e, \u003ccode\u003e@types/node\u003c/code\u003e はTypeScriptを使わず素のJavaScriptで書くなら必要ありません\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 data-sourcepos=\"144:1-144:32\"\u003e\n\u003cspan id=\"設定ファイルの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定ファイルの準備\u003c/h4\u003e\n\u003cp data-sourcepos=\"146:1-146:90\"\u003econfig npm で読み込ませる設定ファイル config/local.json を作成します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"js\" data-sourcepos=\"148:1-179:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003econfig/local.json\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// drachtio サーバへの接続情報\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003edrachtio\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehost\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e192.168.0.23\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eport\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e9022\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esecret\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eMyPassword\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// FreePBX(Asterisk)のホスト\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epbxHost\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e192.168.0.12\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// ATermルータへの接続情報\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003egateway\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehost\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e192.168.0.1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 内線番号\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003euser\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e___\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 認証ユーザ名とパスワード\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eauthUsername\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eATermの電話設定で指定したユーザ名\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eauthPassword\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eATermの電話設定で指定したパスワード\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// REGISTERを行う間隔\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eregisterIntervalSec\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e30\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elocalEndpoint\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// drachtio Proxy 自身の内線番号。何でも構わない。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 言い換えるとsip:XXX@192.168.0.23のXXXの部分になる番号。\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003euser\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// pino npm に渡されるログ設定\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elogging\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elevel\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003edebug\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch4 data-sourcepos=\"181:1-181:29\"\u003e\n\u003cspan id=\"本体maintsの実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E4%BD%93maints%E3%81%AE%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本体(main.ts)の実装\u003c/h4\u003e\n\u003cp data-sourcepos=\"183:1-183:69\"\u003eアプリケーション本体である main.ts を実装します：\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"ts\" data-sourcepos=\"185:1-397:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003emain.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eSrf\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edrachtio-srf\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003econfig\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003epino\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epino\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esrf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eSrf\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epino\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003elogging\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// config/local.json の gateway 部分のラッパ\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eGatewayConfig\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eauthUsername\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eauthPassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eregisterIntervalSec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\n\n    \u003cspan class=\"kd\"\u003eget\u003c/span\u003e \u003cspan class=\"nx\"\u003esipAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e`sip:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// config/local.json の drachtio 部分\u003c/span\u003e\n\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eDrachtioConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003esecret\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// SIPリクエストをログに出力するユーティリティ\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003elogRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`received \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e from \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esource_address\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esource_port\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// tel: URIを解析するユーティリティ\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparseTelUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ematch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/tel:\u003c/span\u003e\u003cspan class=\"se\"\u003e(\\d\u003c/span\u003e\u003cspan class=\"sr\"\u003e+\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"sr\"\u003e;phone-context=\u003c/span\u003e\u003cspan class=\"se\"\u003e([\u003c/span\u003e\u003cspan class=\"sr\"\u003e0-9\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.]\u003c/span\u003e\u003cspan class=\"sr\"\u003e+\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ephoneContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// sip: URIを解析するユーティリティ\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// ※drachtio-srfにSrf.parseUri という関数があるが、 \u0026lt;\u0026gt; 付きを処理してくれない\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eparseSipUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ematch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/sip:\u003c/span\u003e\u003cspan class=\"se\"\u003e(\\d\u003c/span\u003e\u003cspan class=\"sr\"\u003e+\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"sr\"\u003e@\u003c/span\u003e\u003cspan class=\"se\"\u003e([\u003c/span\u003e\u003cspan class=\"sr\"\u003e0-9\u003c/span\u003e\u003cspan class=\"se\"\u003e\\.]\u003c/span\u003e\u003cspan class=\"sr\"\u003e+\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// config/local.json の読み込み\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edrachtioConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edrachtio\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eDrachtioConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eassign\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eGatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egateway\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elocalEndpointAddress\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e`sip:s@\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003edrachtioConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epbxHost\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epbxHost\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// ATermルータへのREGISTERを行う\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// See Also: https://github.com/drachtio/drachtio-srf/blob/main/test/uac.js\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eregisterToGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eREGISTER to the gateway...\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`sip:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eREGISTER\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esipAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eFrom\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esipAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eContact\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003elocalEndpointAddress\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eusername\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eauthUsername\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eauthPassword\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eresponse\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esuccessfully registered\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`rejected after auth with \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estringify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`failed to retrieve a response: \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estringify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eregisterSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// drachtio-server へ接続する\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econnect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edrachtioConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 接続処理完了時の処理\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003econnect\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ehp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`connected to drachtio listening on \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ehp\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// 接続を完了したら、ATermルータへの定期的なREGSITERを開始する。\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 最初にすぐREGISTERし、その後registerIntervalSec秒ごとに繰り返す。\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eregisterSubscription\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregisterIntervalSec\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003enum_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eregisterToGateway\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// drachtio-server 制御中に生じたエラー発生時の処理\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eerror\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 定期REGISTER処理を停止\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eregisterSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// AsteriskからのREGISTERの処理\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eonRegisterFromPbx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// 無条件で成功させる\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eContact\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregistration\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econtact\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003euri\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// OPTIONSの処理\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eonOptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// ただの導通確認なので200 OKを返す\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// INVITE(発信と着信)の処理\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eonInvite\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esrf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esourceAddress\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esource_address\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 発信と着信を区別する\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esourceAddress\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// ATermルータからの着信の場合\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`handling the invite from the gateway (sourceAddress=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003esourceAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// To: ヘッダを解析\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003euriOfToHeader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eparseTelUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eto\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// AsteriskへINVITEを発行し、B2BUAセッションを開始する\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003euas\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euac\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateB2BUA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e`sip:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003euriOfToHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003epbxHost\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// このときTo:ヘッダをsip: URIに書き換える\u003c/span\u003e\n                    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eTo\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u0026lt;sip:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003euriOfToHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003euriOfToHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ephoneContext\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026gt;`\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecall connected successfully\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// どちらかが通話を切った時に、もう一方を終わらせる。\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003euas\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eother\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euac\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003euac\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eother\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euas\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003euas\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euac\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003edlg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003edlg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edestroy\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ecall ended\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n                    \u003cspan class=\"nx\"\u003edlg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eother\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edestroy\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esourceAddress\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003epbxHost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// Asterisk からの発信の場合\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`handling the invite from the PBX (sourceAddress=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003esourceAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003euriOfToHeader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eparseSipUri\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eto\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// ATermルータへINVITEを発行し、B2BUAセッションを開始する。\u003c/span\u003e\n            \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003euas\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euac\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateB2BUA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e`sip:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003euriOfToHeader\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"c1\"\u003e// INVITE時にも認証が必要\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eauth\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003eusername\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eauthUsername\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003egatewayConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eauthPassword\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 他のホストからINVITEは来ないはず\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`unknown INVITE issuer: \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003esourceAddress\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e501\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e`INVITE from host other than Gateway/PBX are not implemented.`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ereportUsualError\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`[from \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esource_address\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e] \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 通常生じる非成功ステータスを処理\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e487\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 呼び出しの中断\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003ereportUsualError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`487 Request Terminated (the caller hooked on)`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e503\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e// 着信拒否\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003ereportUsualError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`503 Service Unavailable (the callee rejected the call)`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eError in connecting call\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e// まだピアにレスポンスを返していなければ、500を返す\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efinalResponseSent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e`Internal Server Error (\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e@phula-drachtio-pbx-aterm-proxy)`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 以上の処理をミドルウェアとして登録する\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einvite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eonInvite\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eonRegisterFromPbx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eonOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// すべてのリクエストをログ出力\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esrf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euse\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003elogRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch4 data-sourcepos=\"399:1-399:11\"\u003e\n\u003cspan id=\"起動\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%B5%B7%E5%8B%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e起動\u003c/h4\u003e\n\u003cp data-sourcepos=\"401:1-401:72\"\u003e次のようにして制御アプリケーションを起動します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"403:1-405:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e./node_modules/.bin/ts-node main.ts\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch3 data-sourcepos=\"407:1-407:43\"\u003e\n\u003cspan id=\"freepbx側でのpjsipトランク作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#freepbx%E5%81%B4%E3%81%A7%E3%81%AEpjsip%E3%83%88%E3%83%A9%E3%83%B3%E3%82%AF%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFreePBX側でのPJSIPトランク作成\u003c/h3\u003e\n\u003cp data-sourcepos=\"409:1-409:48\"\u003eFreePBXでPJSIPトランクを作成します。\u003c/p\u003e\n\u003cul data-sourcepos=\"411:1-422:0\"\u003e\n\u003cli data-sourcepos=\"411:1-411:67\"\u003eUsername: 先の \u003ccode\u003elocalEndpoint.user\u003c/code\u003e 設定で指定したもの\u003c/li\u003e\n\u003cli data-sourcepos=\"412:1-412:25\"\u003eSecret: 何でもいい\u003c/li\u003e\n\u003cli data-sourcepos=\"413:1-413:26\"\u003eSIP Server: 192.168.0.23\u003c/li\u003e\n\u003cli data-sourcepos=\"414:1-422:0\"\u003e以下はうまくいかない場合にチェックしてみてください(必須なのかどうかを検証していません)\n\u003cul data-sourcepos=\"415:5-422:0\"\u003e\n\u003cli data-sourcepos=\"415:5-415:30\"\u003eAuthentication: Outbound\u003c/li\u003e\n\u003cli data-sourcepos=\"416:5-416:24\"\u003eRegistration: Send\u003c/li\u003e\n\u003cli data-sourcepos=\"417:5-417:23\"\u003eDTMF Mode: Inband\u003c/li\u003e\n\u003cli data-sourcepos=\"418:5-418:22\"\u003eUser = Phone: No\u003c/li\u003e\n\u003cli data-sourcepos=\"419:5-419:22\"\u003eDirect Media: No\u003c/li\u003e\n\u003cli data-sourcepos=\"420:5-420:24\"\u003eRTP Symmetric: Yes\u003c/li\u003e\n\u003cli data-sourcepos=\"421:5-422:0\"\u003eForce rport: Yes\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"423:1-423:51\"\u003eこれで発着信が可能になるはずです。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"425:1-425:15\"\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h2\u003e\n\u003cp data-sourcepos=\"427:1-427:147\"\u003e業務用の電話回線として一か月以上運用してみましたが、特にトラブルなく安定して発着信ができています。\u003c/p\u003e\n\u003cp data-sourcepos=\"429:1-429:373\"\u003edrachtio は今回のようなケースには大変ありがたいフレームワークでした。ほとんどの定型的なSIPメッセージの処理を担ってくれますので、書き換えたい部分だけを実装するだけでB2BUAサーバを作成することができます。今回のtel: URI対策に限らず、色々と応用が利くと思います。\u003c/p\u003e\n","body":"## 概要\n\nある中国地方に展開している電力系光プロバイダが「光電話」というIP電話サービスを提供しています。このプロバイダからレンタルされるルータ Aterm WH832A を使って、FreePBX(Asterisk)からの発着信を可能にします。\n\nこのルータにはFXOポートが付いており、通常はここにアナログ電話機を接続してIP電話を利用します。しかし、このルータの[スマートフォン向けのIP電話機能](https://www.aterm.jp/function/wh832a_ez/list/main/m01_m58.html)を使うと、SIP端末やAsteriskのトランクから直接IP電話を利用できます。\n\n![](https://www.aterm.jp/function/wh832a_ez/list-image/com-all/iptel.gif)\n引用元：[NEC ATerm WH832Aのマニュアル](https://www.aterm.jp/function/wh832a_ez/list/main/m01_m58.html)より\n\nただしAsteriskのトランク先として使う場合、発信は問題ないのですが、そのままでは着信ができません。\n\n## tel:スキーマをサポートしていないPJSIPドライバ\n\nATermルータから送られるTo:ヘッダに tel: URI が使用されるため、これをサポートしていないAsteriskのPJSIPドライバは `416 Unsupported URI Scheme` エラーを返してしまいます。\n\n具体的な着信時のSIPメッセージは次の通りです。ATermルータからの着信時、INVITEメッセージのTo:ヘッダにtel: URIが指定されています。\n\n```text\n\u003c===\nINVITE sip:s@192.168.0.12:5060 SIP/2.0\nf: \"0123456789\" \u003csip:0123456789@1.2.3.4\u003e;tag=160879891\nt: \u003ctel:023456789;phone-context=1.2.3.4\u003e\n\n===\u003e\nSIP/2.0 416 Unsupported URI Scheme\n```\n\nこの問題はすでにフォーラム等で報告されています：\n\n- [PJSIP issue with TEL (RFC 3966) - Asterisk / Asterisk SIP - Asterisk Community](https://community.asterisk.org/t/pjsip-issue-with-tel-rfc-3966/77225) 2018.11\n- [Handling of tel URIs - Asterisk / Asterisk SIP - Asterisk Community](https://community.asterisk.org/t/handling-of-tel-uris/87573/15) 2021.5-\n- [\\[ASTERISK-26894\\] pjsip should support tel uri scheme - Digium/Asterisk JIRA](https://issues.asterisk.org/jira/browse/ASTERISK-26894) 2018\n\nPJSIPドライバが利用するPJSIPライブラリ自体は tel: URI をサポートしていますが、Asteriskの側がサポートしていません。この点、Asteriskのコードの改造を試してみましたが、416エラーを出す部分をバイパスしてtel: URIを処理させようとすると、受信SIPメッセージを表す構造体におかしなポインタが格納されSEGVしてしまいます。\n\n現状のAsteriskの多くのコードがsip: URIを前提としているようで、tel: URIをサポートするには、各所のコードにかなり手を入れてテストをしないといけないのかもしれません。この点が、未だに開発側がtel: URIをサポートするつもりがない（orしようとしてもできない）理由と思われます。\n\n## tel: を sip: へ変換するB2BUAサーバを間に立てる\n\nAsterisk側をどうにもできないのであれば、**ATermルータとAsteriskの間にB2BUA(Back-to-Back User Agent)サーバを立て、これにtel: URIをsip: URIに変換させる**という手が考えられます。\n\n今回は、こうしたメッセージの書き換えを伴うB2BUAサーバをJavaScriptで容易に記述できる drachtio を用いることにしました。\n\nhttps://drachtio.org/\n\n## ノード構成\n\n```plantuml\n@startuml nodes\nnode \"FreePBX(Asterisk)\\n192.168.0.12\" as ast\nnode \"drachtio-server (docker)\\n192.168.0.23\" as ds \nnode \"drachtio-controller (Node.js app)\\n192.168.0.xxx\" as dsc \nnode \"Atermルータ\\n192.168.0.1\" as aterm\n\nast --\u003e ds : REGISTER\nds --\u003e aterm : REGISTER\ndsc -\u003e ds : 制御\n@enduml\n```\n\nノード構成は上の形を想定します。drachtioを利用するには、まずB2BUAサーバとなる drachtio-server を立ち上げます。これをNode.jsで作られた制御アプリケーション(上の図ではdrachtio-controller)から制御します。\n\nAsteriskのトランク先には drachtio-server を指定します。Asteriskが drachtio-server にREGISTERし、 drachtio-server がAtermルータにREGISTERする形となります。\n\n## 処理する必要があるSIPメッセージ\n\n```plantuml\n@startuml sipMsg\nnode \"FreePBX(Asterisk)\" as ast\nnode \"drachtio-server\" as ds \nnode \"Atermルータ\" as aterm\n\nast -\u003e ds : REGISTER, \\nOPTIONS, \\nINVITE(発信)\nds -\u003e aterm : REGISTER, \\nINVITE(発信)\naterm --\u003e ds : INVITE(着信), \\nOPTIONS\nds --\u003e ast : INVITE(着信)\n@enduml\n```\n\n制御アプリケーションを通じて drachtio-server に処理させる必要のあるSIPメッセージは上の通りです。他のメッセージは drachtio-server がよしなにしてくれます。\n\n各々のIP電話システムの要件に応じて、他のメッセージも制御する必要が出てくるかと思いますが、私の利用ケースはこれで十分でした。\n\nRTPストリームには関与しません。各ピアから来たSDPをそのまま転送します。\n\n## 手順\n\n### drachtio-server を構成する\n\nまずB2BUAサーバとなる drachtio-server を構成します。DockerホストとなるノードがFreePBXノードとは別に一つ必要です。\n\nDockerイメージが提供されているので、これを利用します。\n\nhttps://hub.docker.com/r/drachtio/drachtio-server/\n\nネットワーク構成を単純にするために、Dockerのipvlanネットワークを使い、コンテナをLAN内に直接公開します。\n\n※標準のbridgeネットワークを使い、5060/udp(SIP)と9022/tcp(drachtioの制御ポート)を公開する形でも、多分問題なく動作すると思います。\n\n```sh\n# ipvlanネットワーク \"my_lan\" を作成する\n#\n# XX/YY にはコンテナにIPアドレスを自動割り当てする場合、その範囲を指定する\n# IFNAME にはコンテナのIPアドレスに割り当てられるホスト上のインターフェイス(e.g. eth0)を指定する\ndocker network create -d ipvlan --subnet=192.168.0.0/24 --ip-range=192.168.0.XX/YY \\\n  --gateway=192.168.0.1 -o ipvlan_mode=l2 -o parent=IFNAME my_lan\n\n# コンテナを起動（先に後述の手順で設定ファイルを用意すること）\ndocker run -v /data-drac-config:/config -it --name drac --rm \\\n  --net my_lan --ip 192.168.0.23 drachtio/drachtio-server:latest \\\n  drachtio -f /config/drachtio.conf.xml\n```\n\n上のコマンドで起動した場合、設定はDockerホスト上に `/data-drac-config/drachtio.conf.xml` を作成して行います。[開発リポジトリのひな型](https://github.com/davehorton/docker-drachtio-server/blob/master/drachtio.conf.xml)を書き換えます。\n\n次の通り、最低限の設定は`\u003cadmin\u003e`タグだけで大丈夫なはずです。\n\n```xml:/data-drac-config/drachtio.conf.xml\n\u003cdrachtio\u003e\n    \u003c!-- 注： 0.0.0.0 の前後に空白・改行が入ると Invalid Argument エラーになるので注意 --\u003e\n    \u003cadmin port=\"9022\" secret=\"MyPassword\"\u003e0.0.0.0\u003c/admin\u003e\n    ...\n\u003c/drachtio\u003e\n```\n\n### drachtio-controller (制御用のNode.jsアプリケーション) を作成する\n\n続いて drachtio-server を制御するNode.jsアプリケーションを作成します。\n\n#### プロジェクトの作成\n\n```sh\nmkdir drachtio-controller\ncd drachtio-controller\nnpm i drachtio-srf config pino rxjs ts-node @types/node  \n```\n\n- `drachtio-srf` が drachtio を制御するクライアントライブラリです\n  - 本質的に必須なのはこれだけです\n- `config` と `pino` は[公式のyeomanテンプレート](https://github.com/davehorton/generator-drachtio)でも用いられている、設定読み込みとログ出力のライブラリです\n- `rxjs` は定期的なREGISTERを行うために使用していますが、 setInterval を使うなら不要です\n- `ts-node`, `@types/node` はTypeScriptを使わず素のJavaScriptで書くなら必要ありません\n\n#### 設定ファイルの準備\n\nconfig npm で読み込ませる設定ファイル config/local.json を作成します。\n\n```js:config/local.json\n{\n  // drachtio サーバへの接続情報\n  \"drachtio\": {\n    \"host\": \"192.168.0.23\",\n    \"port\": 9022,\n    \"secret\": \"MyPassword\"\n  },\n  // FreePBX(Asterisk)のホスト\n  \"pbxHost\": \"192.168.0.12\",\n  // ATermルータへの接続情報\n  \"gateway\": {\n    \"host\": \"192.168.0.1\",\n    // 内線番号\n    \"user\": \"___\",\n    // 認証ユーザ名とパスワード\n    \"authUsername\": \"ATermの電話設定で指定したユーザ名\",\n    \"authPassword\": \"ATermの電話設定で指定したパスワード\",\n    // REGISTERを行う間隔\n    \"registerIntervalSec\": 30\n  },\n  \"localEndpoint\": {\n    // drachtio Proxy 自身の内線番号。何でも構わない。\n    // 言い換えるとsip:XXX@192.168.0.23のXXXの部分になる番号。\n    \"user\": \"1\"\n  },\n  // pino npm に渡されるログ設定\n  \"logging\": {\n    \"level\": \"debug\"\n  }\n}\n```\n\n#### 本体(main.ts)の実装\n\nアプリケーション本体である main.ts を実装します：\n\n```ts:main.ts\nimport Srf from 'drachtio-srf'\nimport config from 'config'\nimport pino from 'pino'\nimport {concat, interval, of, Subscription} from 'rxjs'\n\nconst srf = new Srf()\nconst logger = pino(config.get('logging'))\n\n// config/local.json の gateway 部分のラッパ\nclass GatewayConfig {\n    host: string\n    user: string\n    authUsername: string\n    authPassword: string\n    registerIntervalSec: number\n\n    get sipAddress() {\n        return `sip:${this.user}@${this.host}`\n    }\n}\n\n// config/local.json の drachtio 部分\ntype DrachtioConfig = { host: string, port: number, secret: string }\n\n// SIPリクエストをログに出力するユーティリティ\nfunction logRequest(req: any): void {\n    logger.info(`received ${req.method} from ${req.protocol}/${req.source_address}:${req.source_port}`)\n}\n\n// tel: URIを解析するユーティリティ\nfunction parseTelUri(uri: string) {\n    const match = uri.match(/tel:(\\d+);phone-context=([0-9\\.]+)/)\n    return {\n        number: match[1],\n        phoneContext: match[2]\n    }\n}\n\n// sip: URIを解析するユーティリティ\n//\n// ※drachtio-srfにSrf.parseUri という関数があるが、 \u003c\u003e 付きを処理してくれない\nfunction parseSipUri(uri: string) {\n    const match = uri.match(/sip:(\\d+)@([0-9\\.]+)/)\n    return {\n        user: match[1],\n        host: match[2]\n    }\n}\n\n// config/local.json の読み込み\nconst drachtioConfig = config.get('drachtio') as DrachtioConfig;\nconst gatewayConfig = Object.assign(new GatewayConfig(), config.get('gateway'))\nconst localEndpointAddress = `sip:s@${drachtioConfig.host}`\nconst pbxHost = config.get('pbxHost') as string\n\n// ATermルータへのREGISTERを行う\n//\n// See Also: https://github.com/drachtio/drachtio-srf/blob/main/test/uac.js\nfunction registerToGateway() {\n    logger.info(\"REGISTER to the gateway...\")\n    srf.request(`sip:${gatewayConfig.host}`, {\n        method: 'REGISTER',\n        headers: {\n            To: gatewayConfig.sipAddress,\n            From: gatewayConfig.sipAddress,\n            Contact: localEndpointAddress\n        },\n        auth: {\n            username: gatewayConfig.authUsername,\n            password: gatewayConfig.authPassword\n        }\n    }).then((req) =\u003e {\n        req.on('response', (res) =\u003e {\n            if (res.status === 200) {\n                logger.info(\"successfully registered\")\n            } else {\n                logger.error(`rejected after auth with ${JSON.stringify(res)}`)\n            }\n        });\n    }).catch((err) =\u003e {\n        logger.error(`failed to retrieve a response: ${JSON.stringify(err)}`)\n    })\n}\n\nlet registerSubscription: Subscription\n\n// drachtio-server へ接続する\nsrf.connect(drachtioConfig);\n// 接続処理完了時の処理\nsrf.on('connect', (err, hp) =\u003e {\n    if (err) throw err;\n    logger.info(`connected to drachtio listening on ${hp}`)\n\n    // 接続を完了したら、ATermルータへの定期的なREGSITERを開始する。\n    // 最初にすぐREGISTERし、その後registerIntervalSec秒ごとに繰り返す。\n    registerSubscription = concat(of(0), interval(gatewayConfig.registerIntervalSec * 1000))\n        .subscribe((num_) =\u003e {\n        registerToGateway()\n    })\n})\n\n// drachtio-server 制御中に生じたエラー発生時の処理\nsrf.on('error', (err) =\u003e {\n    logger.error(err)\n    // 定期REGISTER処理を停止\n    registerSubscription?.unsubscribe()\n})\n\n// AsteriskからのREGISTERの処理\nconst onRegisterFromPbx = (req, res) =\u003e {\n    // 無条件で成功させる\n    res.send(200, {\n        headers: {\n            'Contact': req.registration.contact[0].uri\n        }\n    })\n};\n\n// OPTIONSの処理\nconst onOptions = (req, res) =\u003e {\n    // ただの導通確認なので200 OKを返す\n    res.send(200)\n};\n\n// INVITE(発信と着信)の処理\nconst onInvite = async (req, res) =\u003e {\n    const srf = req.srf\n    const sourceAddress = req.source_address as string\n\n    try {\n        // 発信と着信を区別する\n        if (sourceAddress == gatewayConfig.host) {\n            // ATermルータからの着信の場合\n            logger.info(`handling the invite from the gateway (sourceAddress=${sourceAddress})`)\n\n            // To: ヘッダを解析\n            const uriOfToHeader = parseTelUri(req.get('to'))\n\n            // AsteriskへINVITEを発行し、B2BUAセッションを開始する\n            const {uas, uac} = await srf.createB2BUA(req, res, `sip:${uriOfToHeader.number}@${pbxHost}`, {\n                headers: {\n                    // このときTo:ヘッダをsip: URIに書き換える\n                    \"To\": `\u003csip:${uriOfToHeader.number}@${uriOfToHeader.phoneContext}\u003e`\n                }\n            });\n\n            logger.info('call connected successfully');\n\n            // どちらかが通話を切った時に、もう一方を終わらせる。\n            {\n                uas.other = uac;\n                uac.other = uas;\n                [uas, uac].forEach((dlg) =\u003e dlg.on('destroy', () =\u003e {\n                    logger.info('call ended');\n                    dlg.other.destroy();\n                }));\n            }\n        } else if (sourceAddress == pbxHost) {\n            // Asterisk からの発信の場合\n            logger.info(`handling the invite from the PBX (sourceAddress=${sourceAddress})`)\n\n            const uriOfToHeader = parseSipUri(req.get('to'))\n\n            // ATermルータへINVITEを発行し、B2BUAセッションを開始する。\n            const {uas, uac} = await srf.createB2BUA(\n                req, res, `sip:${uriOfToHeader.user}@${gatewayConfig.host}`,\n                {\n                    // INVITE時にも認証が必要\n                    auth: {\n                        username: gatewayConfig.authUsername,\n                        password: gatewayConfig.authPassword\n                    },\n                    headers: {}\n                })\n        } else {\n            // 他のホストからINVITEは来ないはず\n            logger.error(`unknown INVITE issuer: ${sourceAddress}`)\n            res.send(501, `INVITE from host other than Gateway/PBX are not implemented.`)\n        }\n    } catch (err) {\n        const reportUsualError = (msg) =\u003e {\n            logger.info(`[from ${err.res.source_address}] ${msg}`)\n        }\n        // 通常生じる非成功ステータスを処理\n        if (err.status == 487) {\n            // 呼び出しの中断\n            reportUsualError(`487 Request Terminated (the caller hooked on)`)\n        } else if (err.status == 503) {\n            // 着信拒否\n            reportUsualError(`503 Service Unavailable (the callee rejected the call)`)\n        } else {\n            logger.error(err, 'Error in connecting call')\n\n            // まだピアにレスポンスを返していなければ、500を返す\n            if (!res.finalResponseSent) {\n                res.send(500, `Internal Server Error (${err.name}@phula-drachtio-pbx-aterm-proxy)`)\n            }\n        }\n    }\n};\n\n// 以上の処理をミドルウェアとして登録する\nsrf.invite(onInvite)\nsrf.register(onRegisterFromPbx)\nsrf.options(onOptions)\n\n// すべてのリクエストをログ出力\nsrf.use((req, res, next) =\u003e {\n    logRequest(req)\n    next()\n})\n```\n\n#### 起動\n\n次のようにして制御アプリケーションを起動します。\n\n```sh\n./node_modules/.bin/ts-node main.ts\n```\n\n### FreePBX側でのPJSIPトランク作成\n\nFreePBXでPJSIPトランクを作成します。\n\n- Username: 先の `localEndpoint.user` 設定で指定したもの\n- Secret: 何でもいい\n- SIP Server: 192.168.0.23\n- 以下はうまくいかない場合にチェックしてみてください(必須なのかどうかを検証していません)\n    - Authentication: Outbound\n    - Registration: Send\n    - DTMF Mode: Inband\n    - User = Phone: No\n    - Direct Media: No\n    - RTP Symmetric: Yes\n    - Force rport: Yes\n\nこれで発着信が可能になるはずです。\n\n## おわりに\n\n業務用の電話回線として一か月以上運用してみましたが、特にトラブルなく安定して発着信ができています。\n\ndrachtio は今回のようなケースには大変ありがたいフレームワークでした。ほとんどの定型的なSIPメッセージの処理を担ってくれますので、書き換えたい部分だけを実装するだけでB2BUAサーバを作成することができます。今回のtel: URI対策に限らず、色々と応用が利くと思います。\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:26:08+09:00","group":null,"id":"73c0ee03f4579feb37c6","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"asterisk","versions":[]},{"name":"sip","versions":[]},{"name":"freepbx","versions":[]},{"name":"drachtio","versions":[]}],"title":"ATerm WH832AルータをFreePBX(Asterisk)のトランク先として利用するために、drachtioでB2BUAサーバを作成する","updated_at":"2022-09-18T20:26:08+09:00","url":"https://qiita.com/kaorukobo/items/73c0ee03f4579feb37c6","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":0,"github_login_name":"kaorukobo","id":"kaorukobo","items_count":5,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":97143,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/97143/profile-images/1491916065","team_only":false,"twitter_screen_name":null,"website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:126\"\u003eMiniSearch という軽量な全文検索ライブラリがあったので、ソースコードを読んでみた まとめ。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"3:1-3:23\"\u003e\n\u003cspan id=\"minisearch-とは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#minisearch-%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMiniSearch とは？\u003c/h2\u003e\n\u003cp data-sourcepos=\"4:1-4:65\"\u003eJavascript で書かれた軽量の全文検索ライブラリ。\u003c/p\u003e\n\u003cp data-sourcepos=\"6:1-6:37\"\u003e\u003cqiita-embed-ogp src=\"https://github.com/lucaong/minisearch\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"8:1-9:74\"\u003e作者の \u003ca href=\"https://github.com/lucaong\" rel=\"nofollow noopener\" target=\"_blank\"\u003eLuca Ongaroさん\u003c/a\u003e が、サーバーサイドでの全文検索(N-gram など)で検索するとレイテンシーの関係でユーザービリティが良くないと思い、フロントエンドで全文検索(Radix木)してみたいと思って書いたライブラリ。\u003cbr\u003e\nデモは、\u003ca href=\"https://lucaong.github.io/minisearch/examples/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003e。\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-12:47\"\u003eMiniSearch には 全文検索のみならず 自動サジェスチョンなどの機能があります (日本語対応はしてないそうです) が、この記事では、全文検索部分のみに焦点を当てて説明します。\u003cbr\u003e\n(気が向いたら、続きも書きます。)\u003c/p\u003e\n\u003cp data-sourcepos=\"14:1-14:290\"\u003e※ もし内容が難しかったら、MiniSearch の \u003ca href=\"https://github.com/lucaong/minisearch/blob/b4bed02ac4e2849eee61fd1c46db80600e411750/src/SearchableMap/SearchableMap.js\" rel=\"nofollow noopener\" target=\"_blank\"\u003eバージョン1\u003c/a\u003e の方が読みやすいので、参考にしてもいいかもしれません。\u003c/p\u003e\n\u003chr data-sourcepos=\"18:1-19:0\"\u003e\n\u003cp data-sourcepos=\"20:1-21:87\"\u003e全文検索の実装部分は、主に SearchableMap という名前で実装されています（ソースコードは\u003ca href=\"https://github.com/lucaong/minisearch/tree/master/src/SearchableMap\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003e）。\u003cbr\u003e\nこの SearchableMap フォルダの SearchableMap.ts に実装が載っています。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"23:1-23:35\"\u003e\n\u003cspan id=\"早速コードへ--の前に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A9%E9%80%9F%E3%82%B3%E3%83%BC%E3%83%89%E3%81%B8--%E3%81%AE%E5%89%8D%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e早速コードへ ... の前に\u003c/h2\u003e\n\u003cp data-sourcepos=\"25:1-26:84\"\u003e早速コードに、の前に前提知識が必要になります。\u003cbr\u003e\nその前提知識が、Radix 木 と Levenshtein 距離 の２つになります。\u003c/p\u003e\n\u003ch5 data-sourcepos=\"28:1-28:14\"\u003e\n\u003cspan id=\"radix木\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#radix%E6%9C%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRadix木\u003c/h5\u003e\n\u003cp data-sourcepos=\"30:1-30:363\"\u003eRadix 木は Trie木 が 1文字ずつなのを、複数の単語でひとまとめにしたノードを持つように改良した木構造のことです。Trie木 とは、単語を1文字ずつにして、それを各ノードが1文字ずつ分かれ目になっている木構造のことです（下の図を見ると分かりやすいと思います）。\u003c/p\u003e\n\u003cp data-sourcepos=\"32:1-32:162\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/d373a0076f79d62188c7c833f8a63f9397db12db/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39323634372f35386165306433342d613465352d383838352d343961622d3665343761353739393036652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F92647%2F58ae0d34-a4e5-8885-49ab-6e47a579906e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9f696e757776598736bf562c1aa6a754\" alt=\"スクリーンショット 2022-09-18 19.16.45.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/92647/58ae0d34-a4e5-8885-49ab-6e47a579906e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F92647%2F58ae0d34-a4e5-8885-49ab-6e47a579906e.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1050e3b70d74f39657a295e5d3ee328a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"34:1-34:130\"\u003eRadix 木は、再度になりますが、単語が1文字分割ではなく複数の文字がノードを構成しています。\u003c/p\u003e\n\u003cp data-sourcepos=\"36:1-36:162\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/d2249854554816b2a614253c4301fdf369636b55/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f39323634372f39313331356237342d373865612d616639622d343665382d3566356362376234303137382e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F92647%2F91315b74-78ea-af9b-46e8-5f5cb7b40178.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=747675cc94addda5aeda4bd44fd05e3b\" alt=\"スクリーンショット 2022-09-18 19.18.35.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/92647/91315b74-78ea-af9b-46e8-5f5cb7b40178.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F92647%2F91315b74-78ea-af9b-46e8-5f5cb7b40178.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5551195a921209d828e938ab30e6b1aa 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"38:1-40:505\"\u003e他の記事を見れば分かりますが、全探索よりも早く単語を見つけることができます。\u003cbr\u003e\nTrie木の実装は、\u003ca href=\"https://rightcode.co.jp/blog/information-technology/trie-fast-dictionary-implementation-1\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003e などにあるように難しくないですが、\u003cbr\u003e\nRadix木 となると Insert の時に 中間ノードを作って分割する必要があったり(コードは\u003ca href=\"https://github.com/lucaong/minisearch/blob/2e2b3b791858abf665c842800069728c8e3666c1/src/SearchableMap/SearchableMap.ts#L362\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003e)、Delete の時にノードをマージさせる分岐が必要になる(コードは\u003ca href=\"https://github.com/lucaong/minisearch/blob/2e2b3b791858abf665c842800069728c8e3666c1/src/SearchableMap/SearchableMap.ts#L412\" rel=\"nofollow noopener\" target=\"_blank\"\u003eここ\u003c/a\u003e)ので、少し複雑になります。\u003c/p\u003e\n\u003ch5 data-sourcepos=\"42:1-42:24\"\u003e\n\u003cspan id=\"levenshtein-距離\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#levenshtein-%E8%B7%9D%E9%9B%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLevenshtein 距離\u003c/h5\u003e\n\u003cp data-sourcepos=\"44:1-49:147\"\u003eLevenshtein 距離とは 2つの文字列の違いを数字で表したものです。\u003cbr\u003e\n違いの計算方法は、\u003cbr\u003e\n　　１：単語A + 1 x 単語B + 1 の行列X を作ります。\u003cbr\u003e\n　　２：行列X の最初の行と最初の列を０からの昇順にします。\u003cbr\u003e\n　　３：行列X の数字が決まっていない １つ１つの要素を 上+1と横+1と斜め上(対応する単語Aと単語Bが同じ場合はそのまま、違う場合は +1)のうち一番大きいものにします。\u003cbr\u003e\n　　４：１つ１つの要素が全て３の計算を終えたら、右下の数字を見ます。それが単語間の距離になります。\u003c/p\u003e\n\u003cp data-sourcepos=\"51:1-51:76\"\u003ePython で実際に実装してみたのが、下の実装になります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"53:1-81:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003elevenshtein.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003elevenshtein\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ea_len\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003eb_len\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003emax_distance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003ea_len\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb_len\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\t\u003cspan class=\"n\"\u003ematrix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[[\u003c/span\u003e\u003cspan class=\"n\"\u003emax_distance\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb_len\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea_len\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei_index\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea_len\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ei_index\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei_index\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ej_index\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb_len\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej_index\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ej_index\u003c/span\u003e\n\t\u003cspan class=\"c1\"\u003e# \n\u003c/span\u003e\t\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea_len\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\t\t\u003cspan class=\"n\"\u003ea_c\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\t\t\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb_len\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003eb_c\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003em\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea_c\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003eb_c\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\t\t\t\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\t\t\t\t\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003emin_distance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\t\t\t\u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emin_distance\u003c/span\u003e\n\t\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ea_len\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003eb_len\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003elevenshtein\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"meilenstein\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"levenshtein\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"83:1-83:81\"\u003eでは、前提知識もついたので、コードを読んでみましょう！\u003c/p\u003e\n\u003ch2 data-sourcepos=\"85:1-85:30\"\u003e\n\u003cspan id=\"コードを読んでみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%AA%AD%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコードを読んでみる\u003c/h2\u003e\n\u003cp data-sourcepos=\"87:1-87:92\"\u003eまずは、SearchableMap の本体がありそうな SearchableMap.ts を見てみます。\u003c/p\u003e\n\u003cp data-sourcepos=\"89:1-89:84\"\u003e\u003cqiita-embed-ogp src=\"https://github.com/lucaong/minisearch/blob/master/src/SearchableMap/SearchableMap.ts\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"92:1-93:61\"\u003eすると、clear, delete, get, set など基本的な関数が意外と短い行で書いてあるのが分かります。\u003cbr\u003e\nset を例に取ったら、下の行のみになります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"95:1-103:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSearchableMap.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e  \u003cspan class=\"kd\"\u003eset\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eSearchableMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003estring\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ekey must be a string\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e_size\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreatePath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e_tree\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eLEAF\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"105:1-106:33\"\u003eこの createPath というのが何かしてそうですね。\u003cbr\u003e\n中身を見てみましょう。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"108:1-149:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSearchableMap.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreatePath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eRadixTree\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eRadixTree\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ekeyLength\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\n\n  \u003cspan class=\"na\"\u003eouter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ekeyLength\u003c/span\u003e\u003cspan class=\"p\"\u003e;)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ekeys\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// Check whether this key is a candidate: the first characters must match.\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003eLEAF\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekeyLength\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e// Advance offset to the point where key and k no longer match.\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e\n\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e// The existing key is shorter than the key we need to create.\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003enode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e// Partial match: we need to insert an intermediate node to contain\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e// both the existing subtree and the new node.\u003c/span\u003e\n          \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eintermediate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eMap\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003eintermediate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003eintermediate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003enode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eintermediate\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"nx\"\u003eoffset\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e \u003cspan class=\"nx\"\u003eouter\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// Create a final child node to contain the final suffix of the key.\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eMap\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003echild\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"151:1-152:42\"\u003eぱっと見た感じでは何をやっているのかよく分かりませんね。\u003cbr\u003e\nなので、少し説明を加えます。\u003c/p\u003e\n\u003cp data-sourcepos=\"154:1-154:33\"\u003eまず、このコードでは、\u003c/p\u003e\n\u003cp data-sourcepos=\"156:1-158:193\"\u003e入力された登録をする単語を、現在のノードの Radix木の子要素１つ１つと比較して、\u003cbr\u003e\n１：比較結果が 現在の単語が Radix木の子要素に含まれている場合は、含まれる分までの単語を位置情報として取得します (offset)。そして offset の大きさに応じて、木を分割する or そのまま で 次の node に分割されたかそのままのノード を渡しています。そして 登録をする単語のポインターを offset 分だけ増やして、次のループに入ります。\u003cbr\u003e\n２：比較結果が 現在の単語が Radix木の子要素に含まれていない場合（最後の場合）は、そのまま複数単語になりうる単語を node に格納します。\u003c/p\u003e\n\u003cp data-sourcepos=\"160:1-160:39\"\u003eのようなことをしています。\u003c/p\u003e\n\u003cp data-sourcepos=\"162:1-162:198\"\u003e要は単語を比較して、どちらにも含まれている分だけノード（分割する場合もある）を作るループを繰り返して、単語を木構造に登録しています。\u003c/p\u003e\n\u003chr data-sourcepos=\"164:1-165:0\"\u003e\n\u003cp data-sourcepos=\"166:1-168:68\"\u003e一番厄介な 登録部分は上のようになっていました。\u003cbr\u003e\nでは、参照はどうなっているのでしょうか？\u003cbr\u003e\n先ほどと同じく get という関数を見てみましょう。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"170:1-175:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSearchableMap.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e  \u003cspan class=\"kd\"\u003eget\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003elookup\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003e_tree\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eLEAF\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"177:1-177:52\"\u003eLookup という関数が何かしていますね。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"179:1-189:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eSearchableMap.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elookup\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etree\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eRadixTree\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eRadixTree\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003etree\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003etree\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ek\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003etree\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ekeys\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003eLEAF\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003elookup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etree\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"191:1-193:166\"\u003e再帰的なコードになっていて分かりづらいですね。\u003cbr\u003e\n紛らわしいのが、lookup にある \u003ccode\u003etree.get(k)\u003c/code\u003e というのが、createPath で登録した new Map の get であるということでしょうか。\u003cbr\u003e\ntree の keys に LEAF (単語が登録されたキー) が出てくるまで lookup を繰り返し、最終的に返された node の LEAF を返しています。\u003c/p\u003e\n\u003cp data-sourcepos=\"195:1-195:126\"\u003e他にも、削除(remove) などの関数もあります。興味があったら、見てみてはいかがでしょうか？\u003c/p\u003e\n\u003ch2 data-sourcepos=\"197:1-197:11\"\u003e\n\u003cspan id=\"fuzzyget\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fuzzyget\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFuzzyGet\u003c/h2\u003e\n\u003cp data-sourcepos=\"199:1-201:146\"\u003eここまでで、登録 (set) と 取得 (get) を見てみました。\u003cbr\u003e\nこの他にもこのライブラリには、近い単語を探す機能があります。それが FussyGet です。\u003cbr\u003e\nファイルとしては、\u003ca href=\"https://github.com/lucaong/minisearch/blob/master/src/SearchableMap/fuzzySearch.ts\" rel=\"nofollow noopener\" target=\"_blank\"\u003efussySearch.ts\u003c/a\u003e にあります。\u003c/p\u003e\n\u003cp data-sourcepos=\"203:1-203:77\"\u003eここで、前提知識で書いた Levenshtein 距離が 出てきます。\u003c/p\u003e\n\u003cp data-sourcepos=\"205:1-205:48\"\u003eでは、コードを読んでみましょう。\u003c/p\u003e\n\u003cp data-sourcepos=\"207:1-207:154\"\u003eまず Levenshtein 距離では、１列目・１行目が０からの昇順になったマトリックスを作ります。それが下の部分です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"209:1-219:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efuzzySearch.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Matching terms can never be longer than N + maxDistance.\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003emaxDistance\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Fill first matrix row and column with numbers: 0 1 2 3 ...\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eUint8Array\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003efill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emaxDistance\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"nx\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"221:1-221:92\"\u003eこの後で、この matrix などを使い recurse という関数を呼んでいます。\u003c/p\u003e\n\u003cp data-sourcepos=\"223:1-223:100\"\u003erecurse の中身は、LEAF の分岐以外は、Levenshtein 距離の実装そのままですね。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"225:1-241:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efuzzySearch.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e        \u003cspan class=\"c1\"\u003e// Iterate over remaining columns (characters in the query).\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ejmin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ejmax\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"nx\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edifferent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n          \u003cspan class=\"c1\"\u003e// It might make sense to only read the matrix positions used for\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e// deletion/insertion if the characters are different. But we want to\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e// avoid conditional reads for performance reasons.\u003c/span\u003e\n          \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003erpl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eprevRowOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"nx\"\u003edifferent\u003c/span\u003e\n          \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eprevRowOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n          \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eins\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ethisRowOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n          \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edist\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ethisRowOffset\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erpl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eins\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n          \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edist\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eminDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003eminDistance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edist\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"243:1-243:94\"\u003e3つの数字から最も小さいものを選択しているのが分かるでしょうか？\u003c/p\u003e\n\u003cp data-sourcepos=\"245:1-245:30\"\u003eこの後で面白いのが、\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"247:1-263:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003efuzzySearch.ts\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eminDistance\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003emaxDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"nx\"\u003erecurse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003emaxDistance\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eresults\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ematrix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eprefix\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"265:1-266:93\"\u003eで、距離が大きすぎる場合は、ループから脱出していることです。\u003cbr\u003e\n逆に言えば、距離が小さければ、再度再帰的に探索を続けています。\u003c/p\u003e\n\u003cp data-sourcepos=\"268:1-268:146\"\u003eこれで、root のいくつかのノードの計算とそこから深く探索するだけの計算量になっているのが分かります。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"270:1-270:9\"\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h2\u003e\n\u003cp data-sourcepos=\"272:1-273:57\"\u003e最初は難しかったけど、読んでみると理解できて良かった。\u003cbr\u003e\n別の全文検索ライブラリも読んでみたい。\u003c/p\u003e\n","body":"MiniSearch という軽量な全文検索ライブラリがあったので、ソースコードを読んでみた まとめ。\n\n## MiniSearch とは？\nJavascript で書かれた軽量の全文検索ライブラリ。\n\nhttps://github.com/lucaong/minisearch\n\n作者の [Luca Ongaroさん](https://github.com/lucaong) が、サーバーサイドでの全文検索(N-gram など)で検索するとレイテンシーの関係でユーザービリティが良くないと思い、フロントエンドで全文検索(Radix木)してみたいと思って書いたライブラリ。\nデモは、[こちら](https://lucaong.github.io/minisearch/examples/)。\n\nMiniSearch には 全文検索のみならず 自動サジェスチョンなどの機能があります (日本語対応はしてないそうです) が、この記事では、全文検索部分のみに焦点を当てて説明します。\n(気が向いたら、続きも書きます。)\n\n\u003csmall\u003e※ もし内容が難しかったら、MiniSearch の [バージョン1](https://github.com/lucaong/minisearch/blob/b4bed02ac4e2849eee61fd1c46db80600e411750/src/SearchableMap/SearchableMap.js) の方が読みやすいので、参考にしてもいいかもしれません。\u003c/small\u003e\n\n\n\n----\n\n全文検索の実装部分は、主に SearchableMap という名前で実装されています（ソースコードは[こちら](https://github.com/lucaong/minisearch/tree/master/src/SearchableMap)）。\nこの SearchableMap フォルダの SearchableMap.ts に実装が載っています。\n\n## 早速コードへ ... の前に\n\n早速コードに、の前に前提知識が必要になります。\nその前提知識が、Radix 木 と Levenshtein 距離 の２つになります。\n\n##### Radix木\n\nRadix 木は Trie木 が 1文字ずつなのを、複数の単語でひとまとめにしたノードを持つように改良した木構造のことです。Trie木 とは、単語を1文字ずつにして、それを各ノードが1文字ずつ分かれ目になっている木構造のことです（下の図を見ると分かりやすいと思います）。\n\n![スクリーンショット 2022-09-18 19.16.45.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/92647/58ae0d34-a4e5-8885-49ab-6e47a579906e.png)\n\nRadix 木は、再度になりますが、単語が1文字分割ではなく複数の文字がノードを構成しています。\n\n![スクリーンショット 2022-09-18 19.18.35.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/92647/91315b74-78ea-af9b-46e8-5f5cb7b40178.png)\n\n他の記事を見れば分かりますが、全探索よりも早く単語を見つけることができます。\nTrie木の実装は、[ここ](https://rightcode.co.jp/blog/information-technology/trie-fast-dictionary-implementation-1) などにあるように難しくないですが、\nRadix木 となると Insert の時に 中間ノードを作って分割する必要があったり(コードは[ここ](https://github.com/lucaong/minisearch/blob/2e2b3b791858abf665c842800069728c8e3666c1/src/SearchableMap/SearchableMap.ts#L362))、Delete の時にノードをマージさせる分岐が必要になる(コードは[ここ](https://github.com/lucaong/minisearch/blob/2e2b3b791858abf665c842800069728c8e3666c1/src/SearchableMap/SearchableMap.ts#L412))ので、少し複雑になります。\n\n##### Levenshtein 距離\n\nLevenshtein 距離とは 2つの文字列の違いを数字で表したものです。\n違いの計算方法は、\n　　１：単語A + 1 x 単語B + 1 の行列X を作ります。\n　　２：行列X の最初の行と最初の列を０からの昇順にします。\n　　３：行列X の数字が決まっていない １つ１つの要素を 上+1と横+1と斜め上(対応する単語Aと単語Bが同じ場合はそのまま、違う場合は +1)のうち一番大きいものにします。\n　　４：１つ１つの要素が全て３の計算を終えたら、右下の数字を見ます。それが単語間の距離になります。\n\nPython で実際に実装してみたのが、下の実装になります。\n\n```python:levenshtein.py\ndef levenshtein(a, b):\n\ta_len = len(a)\n\tb_len = len(b)\n\tmax_distance = max([a_len, b_len])\n\tmatrix = [[max_distance for i in range(b_len+1)] for j in range(a_len+1)]\n\tfor i_index, i in enumerate(range(a_len)):\n\t\tmatrix[0][i_index] = i_index\n\tfor j_index, j in enumerate(range(b_len)):\n\t\tmatrix[j_index][0] = j_index\n\t# \n\tfor i in range(1, a_len+1):\n\t\ta_c = a[i-1]\n\t\tfor j in range(1, b_len+1):\n\t\t\tb_c = b[j-1]\n\t\t\tm = matrix[i][j-1] + 1\n\t\t\tn = matrix[i-1][j] + 1\n\t\t\tl = 0\n\t\t\tif (a_c == b_c):\n\t\t\t\tl = matrix[i-1][j-1]\n\t\t\telse:\n\t\t\t\tl = matrix[i-1][j-1] + 1\n\t\t\tmin_distance = min([m, n, l])\n\t\t\tmatrix[i][j] = min_distance\n\tprint(matrix[a_len][b_len])\n\nlevenshtein(\"meilenstein\", \"levenshtein\")\n\n```\n\nでは、前提知識もついたので、コードを読んでみましょう！\n\n## コードを読んでみる\n\nまずは、SearchableMap の本体がありそうな SearchableMap.ts を見てみます。\n\nhttps://github.com/lucaong/minisearch/blob/master/src/SearchableMap/SearchableMap.ts\n\n\nすると、clear, delete, get, set など基本的な関数が意外と短い行で書いてあるのが分かります。\nset を例に取ったら、下の行のみになります。\n\n```typescript:SearchableMap.ts\n  set (key: string, value: T): SearchableMap\u003cT\u003e {\n    if (typeof key !== 'string') { throw new Error('key must be a string') }\n    this._size = undefined\n    const node = createPath(this._tree, key)\n    node.set(LEAF, value)\n    return this\n  }\n```\n\nこの createPath というのが何かしてそうですね。\n中身を見てみましょう。\n\n```typescript:SearchableMap.ts\nconst createPath = \u003cT = any\u003e(node: RadixTree\u003cT\u003e, key: string): RadixTree\u003cT\u003e =\u003e {\n  const keyLength = key.length\n\n  outer: for (let pos = 0; node \u0026\u0026 pos \u003c keyLength;) {\n    for (const k of node.keys()) {\n      // Check whether this key is a candidate: the first characters must match.\n      if (k !== LEAF \u0026\u0026 key[pos] === k[0]) {\n        const len = Math.min(keyLength - pos, k.length)\n\n        // Advance offset to the point where key and k no longer match.\n        let offset = 1\n        while (offset \u003c len \u0026\u0026 key[pos + offset] === k[offset]) ++offset\n\n        const child = node.get(k)!\n        if (offset === k.length) {\n          // The existing key is shorter than the key we need to create.\n          node = child\n        } else {\n          // Partial match: we need to insert an intermediate node to contain\n          // both the existing subtree and the new node.\n          const intermediate = new Map()\n          intermediate.set(k.slice(offset), child)\n          node.set(key.slice(pos, pos + offset), intermediate)\n          node.delete(k)\n          node = intermediate\n        }\n\n        pos += offset\n        continue outer\n      }\n    }\n\n    // Create a final child node to contain the final suffix of the key.\n    const child = new Map()\n    node.set(key.slice(pos), child)\n    return child\n  }\n\n  return node\n}\n```\n\nぱっと見た感じでは何をやっているのかよく分かりませんね。\nなので、少し説明を加えます。\n\nまず、このコードでは、\n\n入力された登録をする単語を、現在のノードの Radix木の子要素１つ１つと比較して、\n１：比較結果が 現在の単語が Radix木の子要素に含まれている場合は、含まれる分までの単語を位置情報として取得します (offset)。そして offset の大きさに応じて、木を分割する or そのまま で 次の node に分割されたかそのままのノード を渡しています。そして 登録をする単語のポインターを offset 分だけ増やして、次のループに入ります。\n２：比較結果が 現在の単語が Radix木の子要素に含まれていない場合（最後の場合）は、そのまま複数単語になりうる単語を node に格納します。\n\nのようなことをしています。\n\n要は単語を比較して、どちらにも含まれている分だけノード（分割する場合もある）を作るループを繰り返して、単語を木構造に登録しています。\n\n--- \n\n一番厄介な 登録部分は上のようになっていました。\nでは、参照はどうなっているのでしょうか？\n先ほどと同じく get という関数を見てみましょう。\n\n```typescript:SearchableMap.ts\n  get (key: string): T | undefined {\n    const node = lookup\u003cT\u003e(this._tree, key)\n    return node !== undefined ? node.get(LEAF) : undefined\n  }\n```\n\nLookup という関数が何かしていますね。\n\n```typescript:SearchableMap.ts\nconst lookup = \u003cT = any\u003e(tree: RadixTree\u003cT\u003e, key: string): RadixTree\u003cT\u003e | undefined =\u003e {\n  if (key.length === 0 || tree == null) { return tree }\n\n  for (const k of tree.keys()) {\n    if (k !== LEAF \u0026\u0026 key.startsWith(k)) {\n      return lookup(tree.get(k)!, key.slice(k.length))\n    }\n  }\n}\n```\n\n再帰的なコードになっていて分かりづらいですね。\n紛らわしいのが、lookup にある `tree.get(k)` というのが、createPath で登録した new Map の get であるということでしょうか。\ntree の keys に LEAF (単語が登録されたキー) が出てくるまで lookup を繰り返し、最終的に返された node の LEAF を返しています。\n\n他にも、削除(remove) などの関数もあります。興味があったら、見てみてはいかがでしょうか？\n\n## FuzzyGet\n\nここまでで、登録 (set) と 取得 (get) を見てみました。\nこの他にもこのライブラリには、近い単語を探す機能があります。それが FussyGet です。\nファイルとしては、[fussySearch.ts](https://github.com/lucaong/minisearch/blob/master/src/SearchableMap/fuzzySearch.ts) にあります。\n\nここで、前提知識で書いた Levenshtein 距離が 出てきます。\n\nでは、コードを読んでみましょう。\n\nまず Levenshtein 距離では、１列目・１行目が０からの昇順になったマトリックスを作ります。それが下の部分です。\n\n```typescript:fuzzySearch.ts\n  const n = query.length + 1\n\n  // Matching terms can never be longer than N + maxDistance.\n  const m = n + maxDistance\n\n  // Fill first matrix row and column with numbers: 0 1 2 3 ...\n  const matrix = new Uint8Array(m * n).fill(maxDistance + 1)\n  for (let j = 0; j \u003c n; ++j) matrix[j] = j\n  for (let i = 1; i \u003c m; ++i) matrix[i * n] = i\n```\n\nこの後で、この matrix などを使い recurse という関数を呼んでいます。\n\nrecurse の中身は、LEAF の分岐以外は、Levenshtein 距離の実装そのままですね。\n\n```typescript:fuzzySearch.ts\n        // Iterate over remaining columns (characters in the query).\n        for (let j = jmin; j \u003c jmax; ++j) {\n          const different = char !== query[j]\n\n          // It might make sense to only read the matrix positions used for\n          // deletion/insertion if the characters are different. But we want to\n          // avoid conditional reads for performance reasons.\n          const rpl = matrix[prevRowOffset + j] + +different\n          const del = matrix[prevRowOffset + j + 1] + 1\n          const ins = matrix[thisRowOffset + j] + 1\n\n          const dist = matrix[thisRowOffset + j + 1] = Math.min(rpl, del, ins)\n\n          if (dist \u003c minDistance) minDistance = dist\n        }\n```\n\n3つの数字から最も小さいものを選択しているのが分かるでしょうか？\n\nこの後で面白いのが、\n\n```typescript:fuzzySearch.ts\n        if (minDistance \u003e maxDistance) {\n          continue key\n        }\n      }\n\n      recurse(\n        node.get(key)!,\n        query,\n        maxDistance,\n        results,\n        matrix,\n        i,\n        n,\n        prefix + key\n      )\n```\n\nで、距離が大きすぎる場合は、ループから脱出していることです。\n逆に言えば、距離が小さければ、再度再帰的に探索を続けています。\n\nこれで、root のいくつかのノードの計算とそこから深く探索するだけの計算量になっているのが分かります。\n\n## 感想\n\n最初は難しかったけど、読んでみると理解できて良かった。\n別の全文検索ライブラリも読んでみたい。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:25:17+09:00","group":null,"id":"e6a68852237ad56d7a25","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"JavaScript","versions":[]},{"name":"TypeScript","versions":[]},{"name":"全文検索","versions":[]},{"name":"Search","versions":[]}],"title":"MiniSearch を読んでみる ①","updated_at":"2022-09-18T20:25:17+09:00","url":"https://qiita.com/YmBIgo/items/e6a68852237ad56d7a25","user":{"description":null,"facebook_id":null,"followees_count":0,"followers_count":2,"github_login_name":"YmBIgo","id":"YmBIgo","items_count":22,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":92647,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/92647/profile-images/1473705693","team_only":false,"twitter_screen_name":null,"website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-3:111\"\u003eRockyLinux8 vps環境設定7) コマンドのインストール\u003cbr\u003e\n\u003ca href=\"https://qiita.com/naga_kt/items/50c50e298946d5acf558\" class=\"autolink\" id=\"reference-cbf16fabc4a01e127f8d\"\u003ehttps://qiita.com/naga_kt/items/50c50e298946d5acf558\u003c/a\u003e\u003cbr\u003e\nの続き。WebArena Indigo(RockyLinux8.4)及びKagoya(RockyLinux8.5)での環境設定について述べる。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-6:153\"\u003e　ここまでの設定でWebArena Indigoのvpsはhttpdの設定でSELinuxを無効化したので、そのままでは不安がある。\u003cbr\u003e\n　Kagoyaのvpsではファイアウォールの設定がされているので使用するポート番号を開ける設定をしないといけない。\u003c/p\u003e\n\u003cp data-sourcepos=\"8:1-8:81\"\u003e　ここではファイアウォールのポート設定について述べる。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"10:1-10:126\"\u003e\n\u003cspan id=\"コントロールパネルからのファイアウォールのポート設定webarena-indigorockylinux84の場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB%E3%83%91%E3%83%8D%E3%83%AB%E3%81%8B%E3%82%89%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%AD%E5%AE%9Awebarena-indigorockylinux84%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコントロールパネルからのファイアウォールのポート設定【WebArena Indigo(RockyLinux8.4)の場合】\u003c/h2\u003e\n\u003cp data-sourcepos=\"12:1-17:138\"\u003e　WebAreana Indigoの場合はコントロールパネルからポートの設定を行う。\u003cbr\u003e\n　「ネットワーク管理」－「ファイアーウォール」－「＋ファイアウォールの作成」をクリックすると、「ファイアウォールの作成」画面が開く。「ファイアウォール名」を入力する。\u003cbr\u003e\n　「インバウンドルール」で「新規ルール」をクリックして「Custom」を選択する。「プロトコール」に「TCP」、ポートに開けたいポート番号、連番の時はハイフンでつないだもの例えば「12345-54321」を、IPアドレスに「0.0.0.0」を入力する。\u003cbr\u003e\n　「新規ルール」をクリックして「Custom」を選択する。「プロトコール」に「TCP」、ポートにssh接続で用いる番号、IPアドレスに「0.0.0.0」を入力する。\u003cbr\u003e\n　「新規ルール」をクリックして「HTTP」を選択する。IPアドレスに「0.0.0.0」を入力する。\u003cbr\u003e\n「インスタンスの適用」にそのルールを適用したいインスタンスを選択して「更新」をクリックする。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"19:1-19:111\"\u003e\n\u003cspan id=\"firewall-cmdコマンドでのファイアウォールのポート設定kagoyarockylinux85の場合\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#firewall-cmd%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E3%81%AE%E3%83%9D%E3%83%BC%E3%83%88%E8%A8%AD%E5%AE%9Akagoyarockylinux85%E3%81%AE%E5%A0%B4%E5%90%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efirewall-cmdコマンドでのファイアウォールのポート設定【Kagoya(RockyLinux8.5)の場合】\u003c/h2\u003e\n\u003cp data-sourcepos=\"21:1-22:108\"\u003e　Kagoyaの場合はfirewall-cmdコマンドでのファイアウォールのポート設定を行う。\u003cbr\u003e\n　設定を確認すると、先にssh接続のために設定した番号だけが設定されている。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"24:1-27:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ sudo firewall-cmd --list-ports --zone=public\nzzzzz/tcp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"29:1-29:109\"\u003e　以下のようにして例えば12345番から54321番までのポート番号を追加設定できる。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"linux\" data-sourcepos=\"31:1-38:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e$ sudo firewall-cmd --add-port=12345-54321/tcp --zone=public --permanent\nsuccess\n$ sudo firewall-cmd --reload\nsuccess\n$ sudo firewall-cmd --list-ports --zone=public\n12345-54321/tcp zzzzz/tcp\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003chr data-sourcepos=\"40:1-41:0\"\u003e\n\u003cp data-sourcepos=\"42:1-44:12\"\u003eRockyLinux8 vps環境設定9) サーバ再起動時の設定\u003cbr\u003e\n\u003ca href=\"https://qiita.com/naga_kt/items/11026238e56b134e93ad\" class=\"autolink\" id=\"reference-ac8d033c5ea7aac8c1e2\"\u003ehttps://qiita.com/naga_kt/items/11026238e56b134e93ad\u003c/a\u003e\u003cbr\u003e\nへ続く。\u003c/p\u003e\n\u003chr data-sourcepos=\"46:1-47:0\"\u003e\n\u003ch3 data-sourcepos=\"48:1-48:16\"\u003e\n\u003cspan id=\"参考記事\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%A8%98%E4%BA%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考記事\u003c/h3\u003e\n\u003cp data-sourcepos=\"50:1-51:223\"\u003eファイアウォールの設定方法を知りたい（Indigo）\u003cbr\u003e\n\u003ca href=\"https://help.arena.ne.jp/hc/ja/articles/360048915573-%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95%E3%82%92%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%84-Indigo-\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://help.arena.ne.jp/hc/ja/articles/360048915573-%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95%E3%82%92%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%84-Indigo-\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"53:1-54:58\"\u003e[Linux] firewalldでfirewallの設定をする\u003cbr\u003e\n\u003ca href=\"https://qiita.com/suzutsuki0220/items/4a62cc0e676a80ed79f1\" class=\"autolink\" id=\"reference-d91a0a975e2c5dad5db0\"\u003ehttps://qiita.com/suzutsuki0220/items/4a62cc0e676a80ed79f1\u003c/a\u003e\u003c/p\u003e\n","body":"RockyLinux8 vps環境設定7) コマンドのインストール\nhttps://qiita.com/naga_kt/items/50c50e298946d5acf558\nの続き。WebArena Indigo(RockyLinux8.4)及びKagoya(RockyLinux8.5)での環境設定について述べる。\n\n　ここまでの設定でWebArena Indigoのvpsはhttpdの設定でSELinuxを無効化したので、そのままでは不安がある。\n　Kagoyaのvpsではファイアウォールの設定がされているので使用するポート番号を開ける設定をしないといけない。\n\n　ここではファイアウォールのポート設定について述べる。\n\n## コントロールパネルからのファイアウォールのポート設定【WebArena Indigo(RockyLinux8.4)の場合】\n\n　WebAreana Indigoの場合はコントロールパネルからポートの設定を行う。\n　「ネットワーク管理」－「ファイアーウォール」－「＋ファイアウォールの作成」をクリックすると、「ファイアウォールの作成」画面が開く。「ファイアウォール名」を入力する。\n　「インバウンドルール」で「新規ルール」をクリックして「Custom」を選択する。「プロトコール」に「TCP」、ポートに開けたいポート番号、連番の時はハイフンでつないだもの例えば「12345-54321」を、IPアドレスに「0.0.0.0」を入力する。\n　「新規ルール」をクリックして「Custom」を選択する。「プロトコール」に「TCP」、ポートにssh接続で用いる番号、IPアドレスに「0.0.0.0」を入力する。\n　「新規ルール」をクリックして「HTTP」を選択する。IPアドレスに「0.0.0.0」を入力する。\n「インスタンスの適用」にそのルールを適用したいインスタンスを選択して「更新」をクリックする。\n\n## firewall-cmdコマンドでのファイアウォールのポート設定【Kagoya(RockyLinux8.5)の場合】\n\n　Kagoyaの場合はfirewall-cmdコマンドでのファイアウォールのポート設定を行う。\n　設定を確認すると、先にssh接続のために設定した番号だけが設定されている。\n\n~~~linux\n$ sudo firewall-cmd --list-ports --zone=public\nzzzzz/tcp\n~~~\n\n　以下のようにして例えば12345番から54321番までのポート番号を追加設定できる。\n\n~~~linux\n$ sudo firewall-cmd --add-port=12345-54321/tcp --zone=public --permanent\nsuccess\n$ sudo firewall-cmd --reload\nsuccess\n$ sudo firewall-cmd --list-ports --zone=public\n12345-54321/tcp zzzzz/tcp\n~~~\n\n---\n\nRockyLinux8 vps環境設定9) サーバ再起動時の設定\nhttps://qiita.com/naga_kt/items/11026238e56b134e93ad\nへ続く。\n\n---\n\n### 参考記事\n\nファイアウォールの設定方法を知りたい（Indigo）\nhttps://help.arena.ne.jp/hc/ja/articles/360048915573-%E3%83%95%E3%82%A1%E3%82%A4%E3%82%A2%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95%E3%82%92%E7%9F%A5%E3%82%8A%E3%81%9F%E3%81%84-Indigo-\n\n[Linux] firewalldでfirewallの設定をする\nhttps://qiita.com/suzutsuki0220/items/4a62cc0e676a80ed79f1\n\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:19:46+09:00","group":null,"id":"a93913d4c4aec4ff7eeb","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"port","versions":[]},{"name":"Firewall","versions":[]},{"name":"kagoya","versions":[]},{"name":"WebArena","versions":[]},{"name":"RockyLinux8","versions":[]}],"title":"RockyLinux8 vps環境設定8) ファイアウォールのポート設定","updated_at":"2022-09-18T21:18:51+09:00","url":"https://qiita.com/naga_kt/items/a93913d4c4aec4ff7eeb","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"naga_kt","items_count":21,"linkedin_id":"","location":"","name":"naga k","organization":"","permanent_id":2384942,"profile_image_url":"https://secure.gravatar.com/avatar/456061c656e1ad812e80e3ef1834b81b","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:15\"\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h2\u003e\n\u003cp data-sourcepos=\"2:1-3:91\"\u003e試験勉強した際のメモを自分用に記事化。\u003cbr\u003e\n内容は公式やBlack Beltの写経ですので目新しいことはありません\u003cimg alt=\":pray:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f64f.png\" title=\":pray:\" width=\"20\" loading=\"lazy\"\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"5:1-5:44\"\u003e\n\u003cspan id=\"elasticacheのmemchashedとredisの違い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#elasticache%E3%81%AEmemchashed%E3%81%A8redis%E3%81%AE%E9%81%95%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eElastiCacheのMemchashedとRedisの違い\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"6:1-6:14\"\u003e\n\u003cspan id=\"memchached\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#memchached\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMemchached\u003c/h3\u003e\n\u003cp data-sourcepos=\"7:1-9:80\"\u003e・マルチスレッドで動作する\u003cbr\u003e\n・CPUのコア数を上げるとパフォーマンスも上がる\u003cbr\u003e\n・キーとバリューをシンプルな1：1で組み合わせて保存する\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-11:99\"\u003eシンプルでメモリの使用効率というパフォーマンスの観点で優れている。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"13:1-13:9\"\u003e\n\u003cspan id=\"redis\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#redis\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eRedis\u003c/h3\u003e\n\u003cp data-sourcepos=\"14:1-17:85\"\u003e・シングルスレッドで動作する\u003cbr\u003e\n・snapshotベースでのバックアップ、リストアに対応\u003cbr\u003e\n・マスターと複数のスレーブのクラスター構成により、負荷分散が可能\u003cbr\u003e\n・クラスターモードについては、有効/無効を選ぶことができる\u003c/p\u003e\n\u003cp data-sourcepos=\"19:1-20:218\"\u003eメモリ上のデータをディスクに保存することで、データを消失せずに済む。\u003cbr\u003e\nMemchashedに比べて、pub/sub機能があったり、自動的なフェイルオーバーができたり、キーストアの永続性が必要であったりと、バックアップと復元性に優れている。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"22:1-22:15\"\u003e\n\u003cspan id=\"おわりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおわりに\u003c/h2\u003e\n\u003cp data-sourcepos=\"23:1-24:30\"\u003eElastic系使ったことが無いので難しい…！\u003cbr\u003e\n引き続き追記します。\u003c/p\u003e\n\u003cp data-sourcepos=\"26:1-26:30\"\u003e簡単ですが以上です。\u003c/p\u003e\n","body":"## はじめに\n試験勉強した際のメモを自分用に記事化。\n内容は公式やBlack Beltの写経ですので目新しいことはありません:pray:\n\n## ElastiCacheのMemchashedとRedisの違い\n### Memchached\n・マルチスレッドで動作する\n・CPUのコア数を上げるとパフォーマンスも上がる\n・キーとバリューをシンプルな1：1で組み合わせて保存する\n\nシンプルでメモリの使用効率というパフォーマンスの観点で優れている。\n\n### Redis\n・シングルスレッドで動作する\n・snapshotベースでのバックアップ、リストアに対応\n・マスターと複数のスレーブのクラスター構成により、負荷分散が可能\n・クラスターモードについては、有効/無効を選ぶことができる\n\nメモリ上のデータをディスクに保存することで、データを消失せずに済む。\nMemchashedに比べて、pub/sub機能があったり、自動的なフェイルオーバーができたり、キーストアの永続性が必要であったりと、バックアップと復元性に優れている。\n\n## おわりに\nElastic系使ったことが無いので難しい…！\n引き続き追記します。\n\n簡単ですが以上です。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:16:09+09:00","group":null,"id":"109e302841891fd2ed7a","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"AWS","versions":[]}],"title":"ソリューションアーキテクト対策_ElactiCache篇","updated_at":"2022-09-18T20:16:09+09:00","url":"https://qiita.com/sosat/items/109e302841891fd2ed7a","user":{"description":"流れのクラウドエンジニア。WebサービスのSREやDevOpsを生業にしています。\r\nインフラのコード化とCI/CD、特にTerraformが好き。\r\nどなたかのお役に立てますと幸いです！","facebook_id":"","followees_count":5,"followers_count":4,"github_login_name":null,"id":"sosat","items_count":61,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":278897,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/278897/profile-images/1648528125","team_only":false,"twitter_screen_name":"sosat117","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:326\"\u003e\u003ca href=\"\"\u003eGoogleの公式ドキュメント\u003c/a\u003eでは、\u003ccode\u003eactivityViewModels\u003c/code\u003eを使ってFragment間でViewModelを共有する方法が紹介されています。しかし、どうにか\u003ccode\u003eviewModels\u003c/code\u003eだけで済ませられないかと思い、\u003cstrong\u003e親子関係のあるFragment間\u003c/strong\u003eであれば実現できそうなので紹介します。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"3:1-3:9\"\u003e\n\u003cspan id=\"実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実装\u003c/h2\u003e\n\u003cp data-sourcepos=\"5:1-5:142\"\u003e早速見ていきましょう。ここでは子のDialogFragmentを親のFragmentで生成して呼び出す場合を想定しています。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"7:1-7:15\"\u003e\n\u003cspan id=\"親fragment\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A6%AAfragment\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e親Fragment\u003c/h3\u003e\n\u003cp data-sourcepos=\"9:1-9:138\"\u003eViewModelの生成には\u003ccode\u003eviewModels\u003c/code\u003eを使います。子Fragmentを生成する際には\u003ccode\u003echildFragmentManager\u003c/code\u003eを渡してあげます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"kotlin\" data-sourcepos=\"11:1-19:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eParentFragment.kt\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eParentFragment\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eFragment\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eshareViewModel\u003c/span\u003e \u003cspan class=\"k\"\u003eby\u003c/span\u003e \u003cspan class=\"n\"\u003eviewModels\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eSampleShareViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003efun\u003c/span\u003e \u003cspan class=\"nf\"\u003eshowDialog\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nc\"\u003eChildDialogFragment\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nf\"\u003eshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003echildFragmentManager\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"Tag\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"21:1-21:15\"\u003e\n\u003cspan id=\"子fragment\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%90fragment\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e子Fragment\u003c/h3\u003e\n\u003cp data-sourcepos=\"23:1-23:225\"\u003eこちらも\u003ccode\u003eviewModels\u003c/code\u003eを用いてViewModelを生成します。親Fragmentの場合と違うポイントは、下記コードのように\u003ccode\u003eviewModels\u003c/code\u003eで\u003ccode\u003eownerProducer\u003c/code\u003eに\u003ccode\u003erequireParentFragment()\u003c/code\u003eを指定する点です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"kotlin\" data-sourcepos=\"25:1-34:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003eChildDialogFragment.kt\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eChildDialogFragment\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nc\"\u003eDialogFragment\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eval\u003c/span\u003e \u003cspan class=\"py\"\u003eshareViewModel\u003c/span\u003e \u003cspan class=\"k\"\u003eby\u003c/span\u003e \u003cspan class=\"n\"\u003eviewModels\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eSampleShareViewModel\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;(\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// 今回のポイントとなる部分\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eownerProducer\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003erequireParentFragment\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"36:1-36:12\"\u003e\n\u003cspan id=\"利用例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%A9%E7%94%A8%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e利用例\u003c/h2\u003e\n\u003cul data-sourcepos=\"38:1-41:0\"\u003e\n\u003cli data-sourcepos=\"38:1-38:16\"\u003eDialogFragment\u003c/li\u003e\n\u003cli data-sourcepos=\"39:1-39:11\"\u003eViewPager\u003c/li\u003e\n\u003cli data-sourcepos=\"40:1-41:0\"\u003eその他いろいろ\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 data-sourcepos=\"42:1-42:15\"\u003e\n\u003cspan id=\"終わりに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e終わりに\u003c/h2\u003e\n\u003cp data-sourcepos=\"44:1-44:63\"\u003eコメントや質問指摘など随時歓迎しています。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"46:1-46:27\"\u003e\n\u003cspan id=\"参考にしたサイト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E3%81%AB%E3%81%97%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考にしたサイト\u003c/h2\u003e\n\u003cul data-sourcepos=\"48:1-49:217\"\u003e\n\u003cli data-sourcepos=\"48:1-48:189\"\u003e\u003ca href=\"https://stackoverflow.com/questions/63225618/android-share-viewmodel-between-fragment-and-dialog-fragment\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAndroid share ViewModel between fragment and dialog fragment? - Stack Overflow\u003c/a\u003e\u003c/li\u003e\n\u003cli data-sourcepos=\"49:1-49:217\"\u003e\u003ca href=\"https://developer.android.com/reference/kotlin/androidx/fragment/app/package-summary#(androidx.fragment.app.Fragment).viewModels(kotlin.Function0,kotlin.Function0,kotlin.Function0)\" rel=\"nofollow noopener\" target=\"_blank\"\u003eviewModels - Android Developers\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"[Googleの公式ドキュメント]()では、`activityViewModels`を使ってFragment間でViewModelを共有する方法が紹介されています。しかし、どうにか`viewModels`だけで済ませられないかと思い、**親子関係のあるFragment間**であれば実現できそうなので紹介します。\n\n## 実装\n\n早速見ていきましょう。ここでは子のDialogFragmentを親のFragmentで生成して呼び出す場合を想定しています。\n\n### 親Fragment\n\nViewModelの生成には`viewModels`を使います。子Fragmentを生成する際には`childFragmentManager`を渡してあげます。\n\n```kotlin:ParentFragment.kt\nclass ParentFragment: Fragment() {\n    val shareViewModel by viewModels\u003cSampleShareViewModel\u003e()\n\n    private fun showDialog() {\n        ChildDialogFragment().show(childFragmentManager, \"Tag\")\n    }\n}\n```\n\n### 子Fragment\n\nこちらも`viewModels`を用いてViewModelを生成します。親Fragmentの場合と違うポイントは、下記コードのように`viewModels`で`ownerProducer`に`requireParentFragment()`を指定する点です。\n\n```kotlin:ChildDialogFragment.kt\nclass ChildDialogFragment: DialogFragment() {\n    val shareViewModel by viewModels\u003cSampleShareViewModel\u003e(\n        // 今回のポイントとなる部分\n        ownerProducer = {\n            requireParentFragment()\n        }\n    )\n}\n```\n\n## 利用例\n\n- DialogFragment\n- ViewPager\n- その他いろいろ\n\n## 終わりに\n\nコメントや質問指摘など随時歓迎しています。\n\n## 参考にしたサイト\n\n- [Android share ViewModel between fragment and dialog fragment? - Stack Overflow](https://stackoverflow.com/questions/63225618/android-share-viewmodel-between-fragment-and-dialog-fragment)\n- [viewModels - Android Developers](https://developer.android.com/reference/kotlin/androidx/fragment/app/package-summary#(androidx.fragment.app.Fragment).viewModels(kotlin.Function0,kotlin.Function0,kotlin.Function0))\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:13:30+09:00","group":null,"id":"f62c0a3955dd14c95b4f","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Android","versions":[]},{"name":"Fragment","versions":[]},{"name":"android開発","versions":[]}],"title":"親子関係のあるFragment間でactivityViewModelsを使わずにviewModelsを使ってViewModelを共有する","updated_at":"2022-09-18T20:13:30+09:00","url":"https://qiita.com/netsugo/items/f62c0a3955dd14c95b4f","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":1,"github_login_name":"netsugo","id":"netsugo","items_count":2,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":227195,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/227195/profile-images/1584660366","team_only":false,"twitter_screen_name":"nekketsu_gohan","website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:81\"\u003e話題のお絵描きAI、Stable Diffusionを\u003cbr\u003e\nネット環境が全くない状態で動作させる方法を試みました。\u003c/p\u003e\n\u003cp data-sourcepos=\"4:1-9:81\"\u003e使用したPCは\u003cbr\u003e\nOS:Windows10 Home 64bit\u003cbr\u003e\nCPU:Intel(R) Core(TM) i7-10750H\u003cbr\u003e\nGPU:NVIDIA GeForce GTX 1650 Ti\u003cbr\u003e\nRAM:16GB\u003cbr\u003e\n上記スペックではいろいろな要因で動作しないようでした。\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-16:101\"\u003eついでに以下を目標とします。\u003cbr\u003e\n●　StableDiffusionPipelineを使わない。\u003cbr\u003e\n　　GTX 1650 Tiなどではパラメータ　precision=\"full\"の設定しないといけないとありますが、\u003cbr\u003e\n　　設定の仕方が分かりません。また、Pipelineを使用するとネット環境が必要のようです。\u003cbr\u003e\n●　使い慣れた　Jupyter Notebook　で実行したい。\u003cbr\u003e\n　　環境作成が終了してoptimizedSD内のoptimized_txt2imgを　jupyter Notebook　内から\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"17:2-19:4\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e!optimized _txt2img prompts=prompt H=512 W=512 seed=22 scale=7.5 dim_steps=50 precision='full'\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"20:1-20:129\"\u003e　　のように　Jupyter　Notebook　で実行することも可能ですが、変更したい点が多くありました。\u003c/p\u003e\n\u003cp data-sourcepos=\"22:1-22:24\"\u003eおおまかな手順は\u003c/p\u003e\n\u003ch4 data-sourcepos=\"23:1-23:136\"\u003e\n\u003cspan id=\"えっつさんの-stable-diffusion-をローカル環境で動かしたかった\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%88%E3%81%A3%E3%81%A4%E3%81%95%E3%82%93%E3%81%AE-stable-diffusion-%E3%82%92%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%97%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eえっつさんの \u003ca href=\"https://zenn.dev/ettsu/articles/6a1e68cea8864b\" rel=\"nofollow noopener\" target=\"_blank\"\u003eStable Diffusion をローカル環境で動かしたかった\u003c/a\u003e\n\u003c/h4\u003e\n\u003cp data-sourcepos=\"24:1-24:87\"\u003eをお借りしますが、説明中の一部を以下のように差し替えます。\u003c/p\u003e\n\u003ch4 data-sourcepos=\"25:1-25:49\"\u003e\n\u003cspan id=\"stable-diffusion-をフォークでは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stable-diffusion-%E3%82%92%E3%83%95%E3%82%A9%E3%83%BC%E3%82%AF%E3%81%A7%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「stable diffusion をフォーク」では\u003c/h4\u003e\n\u003cp data-sourcepos=\"26:1-28:72\"\u003eCompVis/stable-diffusion　の代わりに\u003cbr\u003e\n\u003ca href=\"https://github.com/basujindal/stable-diffusion\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebasujindal/stable-diffusion\u003c/a\u003e\u003cbr\u003e\nを使用し、stable-diffusion-main　フォルダを入手します。\u003c/p\u003e\n\u003ch4 data-sourcepos=\"29:1-29:35\"\u003e\n\u003cspan id=\"学習モデルの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%A6%E7%BF%92%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「学習モデルの取得」\u003c/h4\u003e\n\u003cp data-sourcepos=\"30:1-31:45\"\u003e\u003ca href=\"https://huggingface.co/CompVis/stable-diffusion-v-1-4-original\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://huggingface.co/CompVis/stable-diffusion-v-1-4-original\u003c/a\u003e\u003cbr\u003e\nより　sd-v1-4.ckpt　を入手します。\u003c/p\u003e\n\u003ch4 data-sourcepos=\"32:1-32:29\"\u003e\n\u003cspan id=\"実行環境作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「実行環境作成」\u003c/h4\u003e\n\u003cp data-sourcepos=\"33:1-33:73\"\u003eでは　environment.yaml　以下のように変更して使います。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"diff_python\" data-sourcepos=\"34:2-68:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eldm\u003c/span\u003e\n\u003cspan class=\"n\"\u003echannels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epytorch\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003edefaults\u003c/span\u003e\n\u003cspan class=\"n\"\u003edependencies\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003cspan class=\"hil\"\u003e\u003cspan class=\"o\"\u003e+ -\u003c/span\u003e \u003cspan class=\"n\"\u003egit\u003c/span\u003e\n\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epython\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e3.8\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epip\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e20.3\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecudatoolkit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e11.3\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epytorch\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.11\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etorchvision\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.12\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003enumpy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.19\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epip\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ealbumentations\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.4\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ediffusers\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eopencv\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003epython\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e4.1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mf\"\u003e2.30\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epudb\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e2019.2\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003einvisible\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ewatermark\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eimageio\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e2.9\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eimageio\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003effmpeg\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.4\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"hdl\"\u003e\u003cspan class=\"o\"\u003e- \u003c/span\u003e   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epytorch\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003elightning\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.4\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"hil\"\u003e\u003cspan class=\"o\"\u003e+ \u003c/span\u003e   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003epytorch\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003elightning\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.5\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eomegaconf\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e2.1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etest\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003etube\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.7\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003estreamlit\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.73\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003eeinops\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003efidelity\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etransformers\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e4.19\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etorchmetrics\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.6\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ekornia\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.6\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ehttps\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e//\u003c/span\u003e\u003cspan class=\"n\"\u003egithub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eCompVis\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etaming\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003etransformers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003emaster\u003c/span\u003e\u003cspan class=\"c1\"\u003e#egg=taming-transformers\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ehttps\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e//\u003c/span\u003e\u003cspan class=\"n\"\u003egithub\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eopenai\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eCLIP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egit\u003c/span\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"c1\"\u003e#egg=clip\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"69:1-78:85\"\u003eこれで\u003cbr\u003e\n●　Anacondaのインストール\u003cbr\u003e\n●　モデルファイルフォルダ　stable-diffusion-main　を入手\u003cbr\u003e\n●　パラメータファイル　sd-v1-4.ckpt　を入手（　model.ckpt　にリネームします）。\u003cbr\u003e\nできました。\u003cbr\u003e\nその後、\u003cbr\u003e\nディレクトリの位置は以下のようにしました。\u003cbr\u003e\njupyter notebook　実行時の作業フォルダーが　Python　になるので、\u003cbr\u003e\n同じフォルダにダウンロードした　stable-diffusion-main　全部を移動します。、\u003cbr\u003e\nstable-diffusion-main　model.ckpt　も以下のフォルダに配置しました。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"diff_python\" data-sourcepos=\"79:2-91:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\\\u003cspan class=\"n\"\u003eUsers\u003c/span\u003e\n \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003eXXXX\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003eDocuments\u003c/span\u003e\n     \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003eSource\u003c/span\u003e\n       \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e\n\u003cspan class=\"hil\"\u003e\u003cspan class=\"o\"\u003e+ \u003c/span\u003e     \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003estable\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ediffusion\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\n\u003c/span\u003e         \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003eenvironment\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eyaml\u003c/span\u003e\n         \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003emodels\u003c/span\u003e\n           \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003eldm\u003c/span\u003e\n             \u003cspan class=\"o\"\u003e+---\u003c/span\u003e\u003cspan class=\"n\"\u003estable\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ediffusion\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ev1\u003c/span\u003e\n\u003cspan class=\"hil\"\u003e\u003cspan class=\"o\"\u003e+ \u003c/span\u003e              \u003cspan class=\"o\"\u003e+----\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch4 data-sourcepos=\"92:1-92:51\"\u003e\n\u003cspan id=\"jupyter-notebookのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#jupyter-notebook%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「jupyter notebook　のインストール」\u003c/h4\u003e\n\u003cp data-sourcepos=\"93:1-101:21\"\u003eANACONDA.NAVIGATOR　から　jupyter notebook　をインストールします。\u003cbr\u003e\nスタートメニューから　Anacnda3（64ビット）→　Anaconda Navigater（Anaconda3）を起動。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/bc4cdac1d350c7740486a343ba77d5d29e8098ab/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834393135352f38346666653234382d633537312d616130652d383231652d6533363838643666666639622e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2F84ffe248-c571-aa0e-821e-e3688d6fff9b.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=13e54d6d8517e304340f870315799585\" alt=\"Anaconda_Navigator.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/84ffe248-c571-aa0e-821e-e3688d6fff9b.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2F84ffe248-c571-aa0e-821e-e3688d6fff9b.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=00233bd61313e3a4dd8260932be53123 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nApplications on　横のプルダウンメニューに　ldm　があるので選択します。\u003cbr\u003e\n下のリスト内に　jupyter Notebook　が表示され、ボタンが　Install となっているのでクリックして\u003cbr\u003e\nインストールします。\u003cbr\u003e\n（上図ではインストール後のため、　Launch　となっています）\u003cbr\u003e\nインストール後はスタートメニューから　Anacnda3（64ビット）→　Jupyter Notebook（ldm）が作成され、\u003cbr\u003e\n起動できます。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"103:1-103:62\"\u003e\n\u003cspan id=\"jupyter-notebook初期ディレクトリを変更\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#jupyter-notebook%E5%88%9D%E6%9C%9F%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E5%A4%89%E6%9B%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「jupyter notebook　初期ディレクトリを変更」\u003c/h3\u003e\n\u003ch3 data-sourcepos=\"104:1-104:135\"\u003e\n\u003cspan id=\"mitamaさんのjupyter-notebookの初期ディレクトリを変更する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mitama%E3%81%95%E3%82%93%E3%81%AEjupyter-notebook%E3%81%AE%E5%88%9D%E6%9C%9F%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003emitamaさんの　\u003ca href=\"https://qiita.com/mitama/items/a8129e50afcc462e02d6\" id=\"reference-0dff25dcce83f54751e8\"\u003eJupyter Notebookの初期ディレクトリを変更する\u003c/a\u003e\n\u003c/h3\u003e\n\u003cp data-sourcepos=\"105:1-105:24\"\u003eをお借りします。\u003c/p\u003e\n\u003cp data-sourcepos=\"107:1-107:75\"\u003e前述のフォルダ構成から以下の変更を行いないました。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"108:1-110:4\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ejupyter_notebook_config.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eNotebookApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enotebook_dir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'C:/Users/XXXX/Documents/Source/Python'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"112:1-112:33\"\u003e\n\u003cspan id=\"notebookを作成する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#notebook%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「Notebookを作成する」\u003c/h3\u003e\n\u003cp data-sourcepos=\"113:1-120:77\"\u003e一旦すべての　Window　を閉じ、スタートメニューから　Anacnda3（64ビット）→　Jupyter Notebook（ldm）\u003cbr\u003e\nを起動します。\u003cbr\u003e\n初めにコマンドプロンプトが起動し、既定のブラウザが開きます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/46e0dc59bcba786ae758a1cf370e9abf5104782e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834393135352f65666431623135382d313631322d303333622d303531632d3634316237363635336239332e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2Fefd1b158-1612-033b-051c-641b76653b93.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=06ee3e7f5f1db139a552359bbdab5b10\" alt=\"jupyter_cmd.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/efd1b158-1612-033b-051c-641b76653b93.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2Fefd1b158-1612-033b-051c-641b76653b93.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=41ce5edf9241a066cf95c5c1f70bd003 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/f602dc10bacb0aaf59c1cfa3b202b060272ac4b4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834393135352f61386430343236352d373766302d643136642d633633332d3265343964303763633535322e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2Fa8d04265-77f0-d16d-c633-2e49d07cc552.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=239c9a7a073bb4362fb7c32e515b46e8\" alt=\"jupyter_web.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/a8d04265-77f0-d16d-c633-2e49d07cc552.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2Fa8d04265-77f0-d16d-c633-2e49d07cc552.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aa65f400a8cbe1e3fd9fb44a9709400a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nダークモードを使用しているので見かけが違いますが気にしないでください。\u003cbr\u003e\n右上の　New　プルダウンから　Python 3(ipykernel)　を選択すると、空のNotebookが作成されます。\u003cbr\u003e\n名前はUntitledになりますが、保存後に　Rename　できます。\u003c/p\u003e\n\u003cp data-sourcepos=\"122:1-122:40\"\u003ejupyter notebookの操作については\u003c/p\u003e\n\u003ch3 data-sourcepos=\"123:1-123:119\"\u003e\n\u003cspan id=\"oyan29さんのjupyter-notebookの使い方初心者向け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#oyan29%E3%81%95%E3%82%93%E3%81%AEjupyter-notebook%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E5%88%9D%E5%BF%83%E8%80%85%E5%90%91%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eoyan29さんの\u003ca href=\"https://qiita.com/oyan29/items/8b18912fd816cebb285d\" id=\"reference-9cb58d13648682637553\"\u003eJupyter Notebookの使い方(初心者向け)\u003c/a\u003e\n\u003c/h3\u003e\n\u003cp data-sourcepos=\"124:1-124:24\"\u003eをお借りします。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"126:1-126:25\"\u003e\n\u003cspan id=\"環境の確認\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E3%81%AE%E7%A2%BA%E8%AA%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「環境の確認」\u003c/h3\u003e\n\u003cp data-sourcepos=\"127:1-127:89\"\u003eNotebookの初めのセルで以下のコードを入力し、動作を確認します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"128:2-141:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003esys\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Python = \"\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eversion\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Numpy = \"\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e__version__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003envcc\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eversion\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Pytorch = \"\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e__version__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Pytorch GPU =\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_available\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Pytorch GPU Name = \"\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_device_name\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ematplotlib\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Matplotlib = \"\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ematplotlib\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e__version__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"err\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003epwd\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"142:1-144:110\"\u003e結果は\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/fa59f12f1422757054361368ad6ac89ca3987629/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834393135352f39313039333637612d666664392d626437342d366635662d6137313561356263333436652e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2F9109367a-ffd9-bd74-6f5f-a715a5bc346e.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2e69e09e8aee23c352beec20b1ebf561\" alt=\"環境.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/9109367a-ffd9-bd74-6f5f-a715a5bc346e.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2F9109367a-ffd9-bd74-6f5f-a715a5bc346e.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f63d2995acb05f49f794acdd6d14685c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nとなりました。　Pytorch Cuda が動作し、 GPU　が認識されていることがわかります。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"146:1-146:45\"\u003e\n\u003cspan id=\"optimized_txt2imgを関数化する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#optimized_txt2img%E3%82%92%E9%96%A2%E6%95%B0%E5%8C%96%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「optimized_txt2imgを関数化する」\u003c/h3\u003e\n\u003cp data-sourcepos=\"147:1-152:81\"\u003e非力なリソースのため、一枚の画像生成に時間がかかるため、不要なループ処理を削除。\u003cbr\u003e\n出力もファイルではなく関数の出力とする。\u003cbr\u003e\n外部ファイルの関数を集めて一つのセルにまとめる。\u003cbr\u003e\n学習済みモデルを準備し、以降のセルでの実行時に繰り返し使えるようにする。\u003cbr\u003e\n（重みの読み込み時間を１回にまとめる）\u003cbr\u003e\n２番目のセルに以下のコードを入力し、動作を確認します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"153:1-358:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eargparse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003erandom\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003erandint\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eomegaconf\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eOmegaConf\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etqdm.auto\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003etqdm\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etrange\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eitertools\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eislice\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eeinops\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003erearrange\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorchvision.utils\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003emake_grid\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etime\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003epytorch_lightning\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eseed_everything\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eautocast\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003econtextlib\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003econtextmanager\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enullcontext\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eimportlib\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einstantiate_from_config\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"s\"\u003e\"target\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e'__is_first_stage__'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"__is_unconditional__\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"nb\"\u003eKeyError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Expected key `target` to instantiate.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eget_obj_from_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"target\"\u003c/span\u003e\u003cspan class=\"p\"\u003e])(\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"params\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003edict\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_obj_from_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003ereload\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecls\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ersplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\".\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003ereload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emodule_imp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimportlib\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimport_module\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eimportlib\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003ereload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodule_imp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003egetattr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimportlib\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimport_module\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epackage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esplit_weighted_subprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eremaining\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprompts\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eweights\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003eremaining\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"s\"\u003e\":\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eidx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\":\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n            \u003cspan class=\"n\"\u003eprompt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eremaining\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"s\"\u003e\" \"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eidx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n                \u003cspan class=\"n\"\u003eidx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eweight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Warning: '\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e' is not a value, are you missing a space?\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eweight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eweight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eremaining\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003eidx\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eidx\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:]\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eweights\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eweights\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eremaining\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eweights\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eload_model_from_config\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003everbose\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Loading model from \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epl_sd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emap_location\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"s\"\u003e\"global_step\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003epl_sd\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Global Step: \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003epl_sd\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'global_step'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epl_sd\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"state_dict\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esd\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"../stable-diffusion-main/optimizedSD/v1-inference.yaml\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"../stable-diffusion-main/models/ldm/stable-diffusion-v1/model.ckpt\"\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003esd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eload_model_from_config\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\".\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"model\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"s\"\u003e\"input_blocks\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"s\"\u003e\"middle_block\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelif\u003c/span\u003e \u003cspan class=\"s\"\u003e\"time_embed\"\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003esp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"model1.\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e:]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003elo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"model2.\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e:]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eOmegaConf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emodel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstantiate_from_config\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodelUNet\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload_state_dict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estrict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstantiate_from_config\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodelCondStage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload_state_dict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estrict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003emodelFS\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einstantiate_from_config\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodelFirstStage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodelFS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload_state_dict\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esd\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estrict\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edel\u003c/span\u003e \u003cspan class=\"n\"\u003esd\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etxt2img\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eW\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edim_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efixed_code\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eddim_eta\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003en_rows\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003escale\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e7.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'cuda'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eunet_bs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eprecision\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'full'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eformat_type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'png'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003esampler\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'plms'\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \n    \u003cspan class=\"n\"\u003etic\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eseed\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eseed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erandint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eseed_everything\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eunet_bs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eunet_bs\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecdevice\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eturbo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econd_stage_model\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003emodelFS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003eprecision\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"autocast\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehalf\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehalf\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003estart_code\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003efixed_code\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estart_code\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandn\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eH\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eW\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003en_rows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003en_rows\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003en_rows\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eprecision\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"autocast\"\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprecision_scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eautocast\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprecision_scope\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enullcontext\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eno_grad\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eall_samples\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003eprecision_scope\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cuda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003euc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003escale\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003euc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_learned_conditioning\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n                \u003cspan class=\"n\"\u003esubprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eweights\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esplit_weighted_subprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeros_like\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003etotalWeight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003esum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eweights\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e)):\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003eweight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eweights\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n                        \u003cspan class=\"c1\"\u003e# if not skip_normalize:\n\u003c/span\u003e                        \u003cspan class=\"n\"\u003eweight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eweight\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003etotalWeight\u003c/span\u003e\n                        \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_learned_conditioning\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esubprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e \u003cspan class=\"n\"\u003ealpha\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_learned_conditioning\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003eshape\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eH\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eW\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ememory_allocated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e1e6\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003emodelCS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ememory_allocated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e1e6\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003emem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                         \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003esamples_ddim\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003edim_steps\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003econditioning\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003everbose\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eunconditional_guidance_scale\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003escale\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eunconditional_conditioning\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003euc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003eeta\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eddim_eta\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003ex_T\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003estart_code\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003esampler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esampler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003emodelFS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003ex_samples_ddim\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emodelFS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edecode_first_stage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esamples_ddim\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eunsqueeze\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ex_sample\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclamp\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003ex_samples_ddim\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e2.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003emin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003emax\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ex_sample\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mf\"\u003e255.0\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erearrange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex_sample\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ecpu\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003enumpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"c h w -\u0026gt; h w c\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ex_sample\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eastype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euint8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ememory_allocated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e1e6\u003c/span\u003e\n                \u003cspan class=\"n\"\u003emodelFS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ememory_allocated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e1e6\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003emem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"k\"\u003edel\u003c/span\u003e \u003cspan class=\"n\"\u003esamples_ddim\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"memory_final = \"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecuda\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ememory_allocated\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e1e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etoc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etime_taken\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoc\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e60.0\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Samples finished in {0:.2f} minutes \"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eprompts\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003eSeeds used = {1:}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime_taken\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \n\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'txt2img defined !!'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"359:1-359:9\"\u003e中盤の\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"360:1-363:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"../stable-diffusion-main/optimizedSD/v1-inference.yaml\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003eckpt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"../stable-diffusion-main/models/ldm/stable-diffusion-v1/model.ckpt\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"364:1-368:84\"\u003eは構成したフォルダの配置で変わってきますので、適当に修正してください。\u003cbr\u003e\n実行結果は以下のようになりました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/068bb72235b1e0e6ba722e5abf8629f6e004a0ea/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834393135352f38306265633738332d613165632d366164642d373664322d6562336165306166643230372e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2F80bec783-a1ec-6add-76d2-eb3ae0afd207.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=019a373c2f24518802791f36b66cdfb8\" alt=\"model.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/80bec783-a1ec-6add-76d2-eb3ae0afd207.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2F80bec783-a1ec-6add-76d2-eb3ae0afd207.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5439c247feecb14a864213ce03f5970d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n使われていないパラメータがある？などのメッセージが出ますが、問題ありませんでした。\u003cbr\u003e\n最終的に　txt2img defined !!　が表示されて、処理が完了します。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"370:1-370:35\"\u003e\n\u003cspan id=\"txt2imgを使ってみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#txt2img%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「txt2imgを使ってみる」\u003c/h3\u003e\n\u003cp data-sourcepos=\"371:1-371:18\"\u003e関数の定義は\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"372:1-374:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etxt2img\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eW\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edim_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efixed_code\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eddim_eta\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003en_rows\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003escale\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e7.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'cuda'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eunet_bs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eprecision\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'full'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eformat_type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'png'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003esampler\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'plms'\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"375:1-376:81\"\u003eとなっているため、指定しなければデフォルト値が使われます。\u003cbr\u003e\n３番目のセルに以下のコードを入力し、動作を確認します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"377:1-388:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ematplotlib.pyplot\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\n\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003ematplotlib\u003c/span\u003e \u003cspan class=\"n\"\u003einline\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"A digital Illustration of the Babel tower, 4k, detailed, trending in artstation, fantasy vivid colors, 8k\"\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etxt2img\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eW\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003escale\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e7.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edim_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eprecision\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'full'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efigure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efigsize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003edpi\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e120\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'off'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"389:1-391:53\"\u003e実行結果は以下のようになりました。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/c274a3285f71cefe2cecc3344aef9c80697fc181/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f323834393135352f66343235323930312d303534622d633165392d643066352d3066316365316635616464652e6a706567\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2Ff4252901-054b-c1e9-d0f5-0f1ce1f5adde.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6b6ae9e8dbccfef5017e044f9ab25750\" alt=\"Result.jpg\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/f4252901-054b-c1e9-d0f5-0f1ce1f5adde.jpeg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F2849155%2Ff4252901-054b-c1e9-d0f5-0f1ce1f5adde.jpeg?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9858a68d16b2a5f7f02f188606c677f9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n50ステップで4分10秒という結果でした。\u003c/p\u003e\n\u003cp data-sourcepos=\"393:1-393:21\"\u003e以降のセルには\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"394:1-402:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Some text\"\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etxt2img\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompts\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eW\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eseed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003escale\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e7.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edim_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eprecision\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'full'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efigure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efigsize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003edpi\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e120\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'off'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"403:1-404:60\"\u003eで実行できます。\u003cbr\u003e\n（もちろん他のパラメータも指定できます）\u003c/p\u003e\n\u003ch3 data-sourcepos=\"406:1-406:19\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e「まとめ」\u003c/h3\u003e\n\u003cp data-sourcepos=\"407:1-409:121\"\u003eノートPC上の　jupyter notebook　で　Stable Diffusion　を動かすことができました。\u003cbr\u003e\nちなみにノートPCを機内モードにしても問題なく動作を確認できました。\u003cbr\u003e\n完全にローカル化できましたので、話題によく上がるNSFWフィルタも無効化されています。\u003c/p\u003e\n\u003cp data-sourcepos=\"411:1-413:15\"\u003e同様な仕組みを　Google Colaboratory　で実装してみましたが、\u003cbr\u003e\n強力な　GPU　と　RAM　で最適化されているためか、　StableDiffusionPipeline　の方が高速に動作\u003cbr\u003e\nしました。\u003c/p\u003e\n\u003cp data-sourcepos=\"415:1-416:84\"\u003e手間がかかる手順は他の方のリンクにお任せ記事になってしまいましたが。\u003cbr\u003e\n最後までお付き合いいただきましてありがとうございました。\u003c/p\u003e\n","body":"話題のお絵描きAI、Stable Diffusionを\nネット環境が全くない状態で動作させる方法を試みました。\n\n使用したPCは\nOS:Windows10 Home 64bit\nCPU:Intel(R) Core(TM) i7-10750H \nGPU:NVIDIA GeForce GTX 1650 Ti\nRAM:16GB\n上記スペックではいろいろな要因で動作しないようでした。\n\nついでに以下を目標とします。\n●　StableDiffusionPipelineを使わない。\n　　GTX 1650 Tiなどではパラメータ　precision=\"full\"の設定しないといけないとありますが、\n　　設定の仕方が分かりません。また、Pipelineを使用するとネット環境が必要のようです。\n●　使い慣れた　Jupyter Notebook　で実行したい。\n　　環境作成が終了してoptimizedSD内のoptimized_txt2imgを　jupyter Notebook　内から\n ```\n!optimized _txt2img prompts=prompt H=512 W=512 seed=22 scale=7.5 dim_steps=50 precision='full'\n ```\n　　のように　Jupyter　Notebook　で実行することも可能ですが、変更したい点が多くありました。\n\nおおまかな手順は\n#### えっつさんの [Stable Diffusion をローカル環境で動かしたかった](https://zenn.dev/ettsu/articles/6a1e68cea8864b)\nをお借りしますが、説明中の一部を以下のように差し替えます。\n#### 「stable diffusion をフォーク」では\nCompVis/stable-diffusion　の代わりに\n[basujindal/stable-diffusion](https://github.com/basujindal/stable-diffusion)\nを使用し、stable-diffusion-main　フォルダを入手します。\n#### 「学習モデルの取得」\nhttps://huggingface.co/CompVis/stable-diffusion-v-1-4-original\nより　sd-v1-4.ckpt　を入手します。\n#### 「実行環境作成」\nでは　environment.yaml　以下のように変更して使います。\n ```diff_python\nname: ldm\nchannels:\n  - pytorch\n  - defaults\ndependencies:\n+ - git\n  - python=3.8.5\n  - pip=20.3\n  - cudatoolkit=11.3\n  - pytorch=1.11.0\n  - torchvision=0.12.0\n  - numpy=1.19.2\n  - pip:\n    - albumentations==0.4.3\n    - diffusers\n    - opencv-python==4.1.2.30\n    - pudb==2019.2\n    - invisible-watermark\n    - imageio==2.9.0\n    - imageio-ffmpeg==0.4.2\n-    - pytorch-lightning==1.4.2\n+    - pytorch-lightning==1.5.0\n    - omegaconf==2.1.1\n    - test-tube\u003e=0.7.5\n    - streamlit\u003e=0.73.1\n    - einops==0.3.0\n    - torch-fidelity==0.3.0\n    - transformers==4.19.2\n    - torchmetrics==0.6.0\n    - kornia==0.6\n    - -e git+https://github.com/CompVis/taming-transformers.git@master#egg=taming-transformers\n    - -e git+https://github.com/openai/CLIP.git@main#egg=clip\n    - -e .\n```\nこれで\n●　Anacondaのインストール\n●　モデルファイルフォルダ　stable-diffusion-main　を入手\n●　パラメータファイル　sd-v1-4.ckpt　を入手（　model.ckpt　にリネームします）。\nできました。\nその後、\nディレクトリの位置は以下のようにしました。\njupyter notebook　実行時の作業フォルダーが　Python　になるので、\n同じフォルダにダウンロードした　stable-diffusion-main　全部を移動します。、\nstable-diffusion-main　model.ckpt　も以下のフォルダに配置しました。\n ```diff_python\nC:\\Users\n  +---XXXX\n    +---Documents\n      +---Source\n        +---Python\n+      +---stable-diffusion-main\n          +---environment.yaml\n          +---models\n            +---ldm\n              +---stable-diffusion-v1\n+               +----model.ckpt\n```\n#### 「jupyter notebook　のインストール」\nANACONDA.NAVIGATOR　から　jupyter notebook　をインストールします。\nスタートメニューから　Anacnda3（64ビット）→　Anaconda Navigater（Anaconda3）を起動。\n![Anaconda_Navigator.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/84ffe248-c571-aa0e-821e-e3688d6fff9b.jpeg)\nApplications on　横のプルダウンメニューに　ldm　があるので選択します。\n下のリスト内に　jupyter Notebook　が表示され、ボタンが　Install となっているのでクリックして\nインストールします。\n（上図ではインストール後のため、　Launch　となっています）\nインストール後はスタートメニューから　Anacnda3（64ビット）→　Jupyter Notebook（ldm）が作成され、\n起動できます。\n\n### 「jupyter notebook　初期ディレクトリを変更」\n### mitamaさんの　[Jupyter Notebookの初期ディレクトリを変更する](https://qiita.com/mitama/items/a8129e50afcc462e02d6)\nをお借りします。\n\n前述のフォルダ構成から以下の変更を行いないました。\n```jupyter_notebook_config.py\nc.NotebookApp.notebook_dir = 'C:/Users/XXXX/Documents/Source/Python'\n ```\n\n### 「Notebookを作成する」\n一旦すべての　Window　を閉じ、スタートメニューから　Anacnda3（64ビット）→　Jupyter Notebook（ldm）\nを起動します。\n初めにコマンドプロンプトが起動し、既定のブラウザが開きます。\n![jupyter_cmd.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/efd1b158-1612-033b-051c-641b76653b93.jpeg)\n![jupyter_web.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/a8d04265-77f0-d16d-c633-2e49d07cc552.jpeg)\nダークモードを使用しているので見かけが違いますが気にしないでください。\n右上の　New　プルダウンから　Python 3(ipykernel)　を選択すると、空のNotebookが作成されます。\n名前はUntitledになりますが、保存後に　Rename　できます。\n\njupyter notebookの操作については\n### oyan29さんの[Jupyter Notebookの使い方(初心者向け)](https://qiita.com/oyan29/items/8b18912fd816cebb285d)\nをお借りします。\n\n### 「環境の確認」\nNotebookの初めのセルで以下のコードを入力し、動作を確認します。\n ``` python\nimport sys\nprint(\"Python = \"+sys.version)\nimport numpy as np\nprint(\"Numpy = \"+np.__version__)\n!nvcc --version\nimport torch\nprint(\"Pytorch = \"+torch.__version__)\nprint(\"Pytorch GPU =\",torch.cuda.is_available())\nprint(\"Pytorch GPU Name = \"+torch.cuda.get_device_name())\nimport matplotlib\nprint(\"Matplotlib = \"+matplotlib.__version__)\n!pwd\n```\n結果は\n![環境.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/9109367a-ffd9-bd74-6f5f-a715a5bc346e.jpeg)\nとなりました。　Pytorch Cuda が動作し、 GPU　が認識されていることがわかります。\n\n### 「optimized_txt2imgを関数化する」\n非力なリソースのため、一枚の画像生成に時間がかかるため、不要なループ処理を削除。\n出力もファイルではなく関数の出力とする。\n外部ファイルの関数を集めて一つのセルにまとめる。\n学習済みモデルを準備し、以降のセルでの実行時に繰り返し使えるようにする。\n（重みの読み込み時間を１回にまとめる）\n２番目のセルに以下のコードを入力し、動作を確認します。\n``` python\nimport argparse, os, re\nimport torch\nimport numpy as np\nfrom random import randint\nfrom omegaconf import OmegaConf\nfrom PIL import Image\nfrom tqdm.auto import tqdm, trange\nfrom itertools import islice\nfrom einops import rearrange\nfrom torchvision.utils import make_grid\nimport time\nfrom pytorch_lightning import seed_everything\nfrom torch import autocast\nfrom contextlib import contextmanager, nullcontext\nimport importlib\n\ndef instantiate_from_config(config):\n    if not \"target\" in config:\n        if config == '__is_first_stage__':\n            return None\n        elif config == \"__is_unconditional__\":\n            return None\n        raise KeyError(\"Expected key `target` to instantiate.\")\n    return get_obj_from_str(config[\"target\"])(**config.get(\"params\", dict()))\n\ndef get_obj_from_str(string, reload=False):\n    module, cls = string.rsplit(\".\", 1)\n    if reload:\n        module_imp = importlib.import_module(module)\n        importlib.reload(module_imp)\n    return getattr(importlib.import_module(module, package=None), cls)\n\ndef split_weighted_subprompts(text):\n    remaining = len(text)\n    prompts = []\n    weights = []\n    while remaining \u003e 0:\n        if \":\" in text:\n            idx = text.index(\":\") \n            prompt = text[:idx]\n            remaining -= idx\n            text = text[idx+1:]\n            if \" \" in text:\n                idx = text.index(\" \")\n            else: \n                idx = len(text)\n            if idx != 0:\n                try:\n                    weight = float(text[:idx])\n                except:\n                    print(f\"Warning: '{text[:idx]}' is not a value, are you missing a space?\")\n                    weight = 1.0\n            else:\n                weight = 1.0\n            remaining -= idx\n            text = text[idx+1:]\n            prompts.append(prompt)\n            weights.append(weight)\n        else:\n            if len(text) \u003e 0:\n                prompts.append(text)\n                weights.append(1.0)\n            remaining = 0\n    return prompts, weights\n\ndef load_model_from_config(ckpt, verbose=False):\n    print(f\"Loading model from {ckpt}\")\n    pl_sd = torch.load(ckpt, map_location=\"cpu\")\n    if \"global_step\" in pl_sd:\n        print(f\"Global Step: {pl_sd['global_step']}\")\n    sd = pl_sd[\"state_dict\"]\n    return sd\n\nconfig = \"../stable-diffusion-main/optimizedSD/v1-inference.yaml\"\nckpt = \"../stable-diffusion-main/models/ldm/stable-diffusion-v1/model.ckpt\"\n\nsd = load_model_from_config(f\"{ckpt}\")\n\nli, lo = [], []\nfor key, value in sd.items():\n    sp = key.split(\".\")\n    if (sp[0]) == \"model\":\n        if \"input_blocks\" in sp:\n            li.append(key)\n        elif \"middle_block\" in sp:\n            li.append(key)\n        elif \"time_embed\" in sp:\n            li.append(key)\n        else:\n            lo.append(key)\nfor key in li:\n    sd[\"model1.\" + key[6:]] = sd.pop(key)\nfor key in lo:\n    sd[\"model2.\" + key[6:]] = sd.pop(key)\n\nconfig = OmegaConf.load(f\"{config}\")\n\nmodel = instantiate_from_config(config.modelUNet)\n_, _ = model.load_state_dict(sd, strict=False)\n\nmodelCS = instantiate_from_config(config.modelCondStage)\n_, _ = modelCS.load_state_dict(sd, strict=False)\n\nmodelFS = instantiate_from_config(config.modelFirstStage)\n_, _ = modelFS.load_state_dict(sd, strict=False)\n\ndel sd\n\ndef txt2img(prompts=\"\",H=512,W=512,C=4,f=8,dim_steps=50,fixed_code=50,ddim_eta=0.0,\n            n_rows=0,scale=7.5,device='cuda',seed=None,unet_bs=1,precision='full',format_type='png',sampler='plms'):\n    \n    tic = time.time()\n    if seed == None:\n        seed = randint(0, 1000000)\n        seed_everything(seed)\n\n    model.eval()\n    model.unet_bs = unet_bs\n    model.cdevice = device\n    model.turbo = False\n\n    modelCS.eval()\n    modelCS.cond_stage_model.device = device\n\n    modelFS.eval()\n\n    if device != \"cpu\" and precision == \"autocast\":\n        model.half()\n        modelCS.half()\n\n    start_code = None\n    if fixed_code:\n        start_code = torch.randn([1,C,H // f, W // f], device=device)\n\n    n_rows = n_rows if n_rows \u003e 0 else 1\n\n    if precision == \"autocast\" and device != \"cpu\":\n        precision_scope = autocast\n    else:\n        precision_scope = nullcontext\n\n    with torch.no_grad():\n\n        all_samples = list()\n        with precision_scope(\"cuda\"):\n            modelCS.to(device)\n            uc = None\n            if scale != 1.0:\n                uc = modelCS.get_learned_conditioning([\"\"])\n                subprompts, weights = split_weighted_subprompts(prompts)\n                if len(subprompts) \u003e 1:\n                    c = torch.zeros_like(uc)\n                    totalWeight = sum(weights)\n                    for i in range(len(subprompts)):\n                        weight = weights[i]\n                        # if not skip_normalize:\n                        weight = weight / totalWeight\n                        c = torch.add(c, modelCS.get_learned_conditioning(subprompts[i]), alpha=weight)\n                else:\n                    c = modelCS.get_learned_conditioning(prompts)\n\n                shape = [1, C, H // f, W // f]\n\n                if device != \"cpu\":\n                    mem = torch.cuda.memory_allocated() / 1e6\n                    modelCS.to(\"cpu\")\n                    while torch.cuda.memory_allocated() / 1e6 \u003e= mem:\n                         time.sleep(1)\n\n                samples_ddim = model.sample(\n                    S=dim_steps,\n                    conditioning=c,\n                    seed=seed,\n                    shape=shape,\n                    verbose=False,\n                    unconditional_guidance_scale=scale,\n                    unconditional_conditioning=uc,\n                    eta=ddim_eta,\n                    x_T=start_code,\n                    sampler = sampler,\n                )\n\n                modelFS.to(device)\n\n                x_samples_ddim = modelFS.decode_first_stage(samples_ddim[0].unsqueeze(0))\n                x_sample = torch.clamp((x_samples_ddim + 1.0) / 2.0, min=0.0, max=1.0)\n                x_sample = 255.0 * rearrange(x_sample[0].cpu().numpy(), \"c h w -\u003e h w c\")\n                image=x_sample.astype(np.uint8)\n                \n            if device != \"cpu\":\n                mem = torch.cuda.memory_allocated() / 1e6\n                modelFS.to(\"cpu\")\n                while torch.cuda.memory_allocated() / 1e6 \u003e= mem:\n                    time.sleep(1)\n            del samples_ddim\n            print(\"memory_final = \", torch.cuda.memory_allocated() / 1e6)\n\n    toc = time.time()\n    time_taken = (toc - tic) / 60.0\n\n    print((\"Samples finished in {0:.2f} minutes \" + prompts + \"\\nSeeds used = {1:}\").format(time_taken,seed))\n    return image \n\nprint('txt2img defined !!')\n```\n中盤の\n``` python\nconfig = \"../stable-diffusion-main/optimizedSD/v1-inference.yaml\"\nckpt = \"../stable-diffusion-main/models/ldm/stable-diffusion-v1/model.ckpt\"\n```\nは構成したフォルダの配置で変わってきますので、適当に修正してください。\n実行結果は以下のようになりました。\n![model.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/80bec783-a1ec-6add-76d2-eb3ae0afd207.jpeg)\n使われていないパラメータがある？などのメッセージが出ますが、問題ありませんでした。\n最終的に　txt2img defined !!　が表示されて、処理が完了します。\n\n### 「txt2imgを使ってみる」\n関数の定義は\n``` python\ndef txt2img(prompts=\"\",H=512,W=512,C=4,f=8,dim_steps=50,fixed_code=50,ddim_eta=0.0,n_rows=0,scale=7.5,device='cuda',seed=None,unet_bs=1,precision='full',format_type='png',sampler='plms'):\n```\nとなっているため、指定しなければデフォルト値が使われます。\n３番目のセルに以下のコードを入力し、動作を確認します。\n```python\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nprompt=\"A digital Illustration of the Babel tower, 4k, detailed, trending in artstation, fantasy vivid colors, 8k\"\n\nimage=txt2img(prompts=prompt,H=512,W=512,seed=2,scale=7.5,dim_steps=50,precision='full')\n\nplt.figure(figsize=(8, 8), dpi=120)\nplt.axis('off')\nplt.imshow(image)\n```\n実行結果は以下のようになりました。\n![Result.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2849155/f4252901-054b-c1e9-d0f5-0f1ce1f5adde.jpeg)\n50ステップで4分10秒という結果でした。\n\n以降のセルには\n```python\nprompt=\"Some text\"\n\nimage=txt2img(prompts=prompt,H=512,W=512,seed=2,scale=7.5,dim_steps=50,precision='full')\n\nplt.figure(figsize=(8, 8), dpi=120)\nplt.axis('off')\nplt.imshow(image)\n```\nで実行できます。\n（もちろん他のパラメータも指定できます）\n\n### 「まとめ」\nノートPC上の　jupyter notebook　で　Stable Diffusion　を動かすことができました。\nちなみにノートPCを機内モードにしても問題なく動作を確認できました。\n完全にローカル化できましたので、話題によく上がるNSFWフィルタも無効化されています。\n\n同様な仕組みを　Google Colaboratory　で実装してみましたが、\n強力な　GPU　と　RAM　で最適化されているためか、　StableDiffusionPipeline　の方が高速に動作\nしました。\n\n手間がかかる手順は他の方のリンクにお任せ記事になってしまいましたが。\n最後までお付き合いいただきましてありがとうございました。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:07:50+09:00","group":null,"id":"ef770060420a48054f19","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"StableDiffusion","versions":[]}],"title":"Stable DiffusionをノートPCで持ち歩きたい！","updated_at":"2022-09-18T20:07:50+09:00","url":"https://qiita.com/FrogInTheWell/items/ef770060420a48054f19","user":{"description":"「ゼロから作るdeep learning」に始まって、数冊のコードを写経。Pythonの基本は理解しているつもりですが、実用としてのコードはまだまだです。Deep Learning勉強用にGPU内蔵のノートPCを購入するも、メモリー不足などの壁に阻まれたり、期待した性能が出ず苦労しています。JDLA G検定も2019#1合格で古参になりますが、業務では関係ないためDIYプログラマーです。","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"FrogInTheWell","items_count":1,"linkedin_id":"","location":"","name":"井の中の蛙","organization":"","permanent_id":2849155,"profile_image_url":"https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/2849155/02417d84c0c3a49abf8b0e339ee38c49327712ac/large.png?1663505795","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:183\"\u003e自前の画像生成AI(ファインチューニングした自前のStableDiffusionなど)を公開できる簡単なWebアプリを作ってみました。\u003cbr\u003e\nここでは、今流行りのStable Diffusion をGoogle Colaboratoryでバックエンドで動かし、Webサイトで画像生成の結果を表示できるようにしました。\u003c/p\u003e\n\u003cp data-sourcepos=\"4:1-5:121\"\u003e今回作ったwebアプリはこちら\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/e980e9ee9da876ad554ce8c2df5740e6b092920c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3531333438322f32313964376234322d626632662d323233332d363563662d3336636338336362346161652e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2F219d7b42-bf2f-2233-65cf-36cc83cb4aae.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b1b1e34cb72d7ff455cde5878f7b3484\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/219d7b42-bf2f-2233-65cf-36cc83cb4aae.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2F219d7b42-bf2f-2233-65cf-36cc83cb4aae.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c3072aa059857c97140dbc9aac1f8e28 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-7:38\"\u003e\u003cqiita-embed-ogp src=\"https://tex2img-colab-atworks.web.app/\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"9:1-9:177\"\u003eYour Colab URI　にSDを実行するサーバのエンドポイントを入力して、生成したい画像のテキストを入力、そしてGenerateで生成できます。\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-11:183\"\u003eなお、画像生成AIを実行できるサーバー(バックエンド)があれば、Colabratoryでなくても、誰でもこのWebアプリを利用可能となっています。\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-16:108\"\u003eこの記事の流れ\u003cbr\u003e\n・Stable Diffutionのファインチューニングで自前の画像生成AIモデル作成\u003cbr\u003e\n・作成したモデルをWebAPIで呼び出せるようにFlaskサーバ(バックエンド)を立てる\u003cbr\u003e\n・サーバのエンドポイントを今回作成したwebアプリに入力して、画像生成をする\u003c/p\u003e\n\u003cp data-sourcepos=\"18:1-18:89\"\u003eなお、今回作成したnotebookとwebアプリはgithubにて公開しています。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"20:1-20:51\"\u003e\n\u003cspan id=\"stable-diffutionのファインチューニング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stable-diffution%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%B3%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStable Diffutionのファインチューニング\u003c/h1\u003e\n\u003cp data-sourcepos=\"21:1-22:54\"\u003eまずはオリジナル(っぽい)のStable Diffutionを作るため、ファインチューニングをします。\u003cbr\u003e\nこのサイトをすんごく参考にしました。\u003c/p\u003e\n\u003cp data-sourcepos=\"24:1-24:38\"\u003e\u003cqiita-embed-ogp src=\"https://note.com/npaka/n/n1af7249cf391\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"26:1-27:47\"\u003e今回は石川県の伝統工芸の九谷焼をStable Diffutionに学習させました。\u003cbr\u003e\n(なぜ九谷焼なのか。。。内緒です)\u003c/p\u003e\n\u003cblockquote data-sourcepos=\"29:1-29:136\"\u003e\n\u003cp data-sourcepos=\"29:2-29:136\"\u003e九谷焼（くたにやき）は、石川県南部の金沢市、小松市、加賀市、能美市で生産される色絵の磁器。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp data-sourcepos=\"31:1-31:57\"\u003e\u003cqiita-embed-ogp src=\"https://ja.wikipedia.org/wiki/%E4%B9%9D%E8%B0%B7%E7%84%BC\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"33:1-33:58\"\u003e\n\u003cspan id=\"ファインチューニングのための画像収集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%B3%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E7%94%BB%E5%83%8F%E5%8F%8E%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファインチューニングのための画像収集\u003c/h3\u003e\n\u003cp data-sourcepos=\"35:1-37:121\"\u003e訓練データとなる九谷焼の写真は、Googleの画像検索でヒットしたものを11枚用意。\u003cbr\u003e\nこんな感じの写真。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/1908695deb966192a0ccc2a4592512026f2102b4/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3531333438322f39663563353366322d396337642d383735632d333231342d6136306134343131356561612e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2F9f5c53f2-9c7d-875c-3214-a60a44115eaa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c91716665d5297ef776b4c63a341363e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/9f5c53f2-9c7d-875c-3214-a60a44115eaa.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2F9f5c53f2-9c7d-875c-3214-a60a44115eaa.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f210c241137a3344556a87ea3353f738 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"39:1-39:195\"\u003e画像が準備できたら、集めた画像はGoogle Driveの次のディレクトリにアップロードしておく。画像の名前は重複していなければなんでも良いです。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"41:1-50:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eMy Drive\n└─.SDworkspace\n　　　　└─.images\n     ├─ image1.png\n     ├─ image2.png\n     .\n     .\n     .\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch3 data-sourcepos=\"52:1-52:42\"\u003e\n\u003cspan id=\"画像の解像度を512512にする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%BB%E5%83%8F%E3%81%AE%E8%A7%A3%E5%83%8F%E5%BA%A6%E3%82%92512512%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e画像の解像度を512×512にする\u003c/h3\u003e\n\u003cp data-sourcepos=\"53:1-54:72\"\u003e先ほど作ったSDworkspaceに新しいColabratoryを作成します。\u003cbr\u003e\nはじめに、次のコードを実行しGoogle Driveにマウント。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"56:1-60:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003egoogle.colab\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003edrive\u003c/span\u003e\n\u003cspan class=\"n\"\u003edrive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'/content/drive'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e \u003cspan class=\"s\"\u003e'/content/drive/My Drive/SDworkspace'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv data-sourcepos=\"62:1-64:3\" class=\"note alert\"\u003e\n\u003cspan class=\"fa fa-fw fa-times-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"63:1-63:57\"\u003eランタイムタイプは必ずGPUを選択すること\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"66:1-67:105\"\u003eそして、次のコードを実行。\u003cbr\u003e\nすると、SDworkspace/my_conceptに解像度が512×512になった画像たちが保存されます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"68:1-94:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eimage_grid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimgs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecols\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eassert\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimgs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ecols\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimgs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egrid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'RGB'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecols\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egrid_w\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003egrid_h\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egrid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\n    \n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimgs\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egrid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epaste\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebox\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003ecols\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e//\u003c/span\u003e\u003cspan class=\"n\"\u003ecols\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003egrid\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003edir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'./images'\u003c/span\u003e\n\u003cspan class=\"n\"\u003esave_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"./my_concept\"\u003c/span\u003e\n\u003cspan class=\"n\"\u003efilenames\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elistdir\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edir\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eimages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003efilename\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003efilenames\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003edir\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e/\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003esave_path\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e/\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003efilename\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eimages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eimage_grid\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimages\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimages\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"96:1-96:24\"\u003eこれで準備完了。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"98:1-98:34\"\u003e\n\u003cspan id=\"ファインチューニング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%B3%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eファインチューニング\u003c/h3\u003e\n\u003cp data-sourcepos=\"99:1-99:63\"\u003e今回使うフレームワークをインストールする。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"101:1-104:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e!pip install -qq diffusers[\"training\"]==0.3.0 transformers ftfy\n!pip install -qq \"ipywidgets\u0026gt;=7,\u0026lt;8\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"105:1-106:90\"\u003eそしたら、このフレームワークを使うためのアクセストークンをHugging Faceで作成する。\u003cbr\u003e\n作成したら次のコードを実行して、アクセストークンを入力する。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"107:1-110:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ehuggingface_hub\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003enotebook_login\u003c/span\u003e\n\u003cspan class=\"n\"\u003enotebook_login\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"111:1-112:121\"\u003eこんな感じのが出れば成功。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/6cc753ba352f81738409d84f323898823d1a8577/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3531333438322f65376362666566362d653464652d633261342d636431652d3866623238356638333738392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2Fe7cbfef6-e4de-c2a4-cd1e-8fb285f83789.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4bdfc0da8a19dbe8af3890938f63727f\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/e7cbfef6-e4de-c2a4-cd1e-8fb285f83789.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2Fe7cbfef6-e4de-c2a4-cd1e-8fb285f83789.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dd70a42f21187a56e84e0502af266d23 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"114:1-114:51\"\u003e次に、必要なモジュールをimportする。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"115:1-140:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eargparse\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eitertools\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003emath\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erandom\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch.nn.functional\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eF\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch.utils.checkpoint\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch.utils.data\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eDataset\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eAccelerator\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate.logging\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eget_logger\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate.utils\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eset_seed\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eAutoencoderKL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDDPMScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePNDMScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStableDiffusionPipeline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUNet2DConditionModel\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers.hub_utils\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003einit_git_repo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epush_to_hub\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers.optimization\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eget_scheduler\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers.pipelines.stable_diffusion\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eStableDiffusionSafetyChecker\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorchvision\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003etransforms\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etqdm.auto\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003etqdm\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etransformers\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPFeatureExtractor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTextModel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTokenizer\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"142:1-142:45\"\u003eそして、次のコードを実行する。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"144:1-146:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"145:1-145:198\"\u003e「学習内容」「新しい概念を表す単語」「新しい概念が何であるかを要約する単語」この三つを各自のファインチューニングの対象に合わせて変更\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"148:1-212:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CompVis/stable-diffusion-v1-4\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 学習内容 (object or style)\n\u003c/span\u003e\u003cspan class=\"n\"\u003ewhat_to_teach\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"style\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 新しい概念を表す単語\n\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"\u0026lt;kutani-ware\u0026gt;\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 新しい概念が何であるかを要約する単語\n\u003c/span\u003e\u003cspan class=\"n\"\u003einitializer_token\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"art\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 学習用のプロンプトテンプレート\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimagenet_templates_small\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a rendering of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a cropped photo of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"the photo of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of a clean {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of a dirty {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a dark photo of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of my {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the cool {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a close-up photo of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a bright photo of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a cropped photo of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a good photo of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of one {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a close-up photo of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a rendition of the {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the clean {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a rendition of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of a nice {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a good photo of a {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the nice {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the small {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the weird {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of the large {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of a cool {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a photo of a small {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eimagenet_style_templates_small\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a rendering in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a cropped painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"the painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a clean painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a dirty painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a dark painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a picture in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a cool painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a close-up painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a bright painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a cropped painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a good painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a close-up painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a rendition in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a nice painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a small painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a weird painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"a large painting in the style of {}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"214:1-215:95\"\u003eあとは次のコードを実行してしばらくするとファインチューニングが開始。\u003cbr\u003e\n自分のランタイム環境(無料バージョン)だと3-4時間くらいで終わった。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"217:1-520:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# データセットの準備\n\u003c/span\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTextualInversionDataset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDataset\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata_root\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elearnable_property\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"style\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# [object, style]\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003erepeats\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einterpolation\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"bicubic\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eflip_p\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"train\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"*\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ecenter_crop\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata_root\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata_root\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elearnable_property\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elearnable_property\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecenter_crop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecenter_crop\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflip_p\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eflip_p\u003c/span\u003e\n\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_paths\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata_root\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efile_path\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003efile_path\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elistdir\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata_root\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_images\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_paths\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_length\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_images\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003eset\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"train\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_length\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_images\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003erepeats\u003c/span\u003e\n\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterpolation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\"linear\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePIL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLINEAR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\"bilinear\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePIL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBILINEAR\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\"bicubic\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePIL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBICUBIC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"s\"\u003e\"lanczos\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePIL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eLANCZOS\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}[\u003c/span\u003e\u003cspan class=\"n\"\u003einterpolation\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etemplates\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimagenet_style_templates_small\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003elearnable_property\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"style\"\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"n\"\u003eimagenet_templates_small\u003c/span\u003e\n        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflip_transform\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etransforms\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eRandomHorizontalFlip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflip_p\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__len__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e_length\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e__getitem__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eexample\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_paths\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_images\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\"RGB\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econvert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"RGB\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eplaceholder_string\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erandom\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echoice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etemplates\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_string\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"input_ids\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003epadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"max_length\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etruncation\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003emax_length\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodel_max_length\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ereturn_tensors\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pt\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003einput_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n        \u003cspan class=\"c1\"\u003e# default to score-sde preprocessing\n\u003c/span\u003e        \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eastype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euint8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecenter_crop\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ecrop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecrop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ecrop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003ecrop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ecrop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e//\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efromarray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eresample\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterpolation\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflip_transform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eastype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euint8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mf\"\u003e127.5\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eastype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efloat32\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pixel_values\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_numpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003epermute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# トークナイザーの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubfolder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"tokenizer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# トークナイザーにプレースホルダートークンを追加\n\u003c/span\u003e\u003cspan class=\"n\"\u003enum_added_tokens\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd_tokens\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum_added_tokens\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"nb\"\u003eValueError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"The tokenizer already contains the token \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e. Please pass a different\"\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\" `placeholder_token` that is not already in the tokenizer.\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# トークンIDの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003etoken_ids\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einitializer_token\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eadd_special_tokens\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 単一トークンと複数トークンのどちらであるか確認\n\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"nb\"\u003eValueError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"The initializer token must be a single token.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003einitializer_token_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etoken_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"n\"\u003eplaceholder_token_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econvert_tokens_to_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# Stable Diffusionモデルの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTextModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esubfolder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"text_encoder\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003evae\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAutoencoderKL\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esubfolder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"vae\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eunet\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUNet2DConditionModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esubfolder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"unet\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# トークンの特徴ベクトルのサイズ変更\n\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize_token_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# プレースホルダートークンの初期化\n\u003c/span\u003e\u003cspan class=\"n\"\u003etoken_embeds\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\n\u003cspan class=\"n\"\u003etoken_embeds\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token_id\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etoken_embeds\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003einitializer_token_id\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efreeze_params\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erequires_grad\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# vaeとunetをフリーズ\n\u003c/span\u003e\u003cspan class=\"n\"\u003efreeze_params\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"n\"\u003efreeze_params\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# テキストエンコーダのトークン特徴ベクトルを除くすべてのパラメータをフリーズ\n\u003c/span\u003e\u003cspan class=\"n\"\u003eparams_to_freeze\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eitertools\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext_model\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext_model\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efinal_layer_norm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext_model\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eembeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposition_embedding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003efreeze_params\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparams_to_freeze\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# データセットの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_dataset\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTextualInversionDataset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"n\"\u003edata_root\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003esave_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e512\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erepeats\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003elearnable_property\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ewhat_to_teach\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e# object or style\n\u003c/span\u003e      \u003cspan class=\"n\"\u003ecenter_crop\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"train\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# データローダーの準備\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate_dataloader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eutils\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDataLoader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_dataset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebatch_size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eshuffle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# noise_schedulerの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003enoise_scheduler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDDPMScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebeta_start\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.00085\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebeta_end\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.012\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebeta_schedule\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"scaled_linear\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum_train_timesteps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etensor_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pt\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# ハイパーパラメータの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"learning_rate\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e5e-04\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"scale_lr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"max_train_steps\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e3000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"train_batch_size\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"gradient_accumulation_steps\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"seed\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e42\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"output_dir\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"sd-concept-output\"\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 学習の実行\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etraining_function\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eget_logger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"train_batch_size\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"gradient_accumulation_steps\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"learning_rate\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emax_train_steps\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"max_train_steps\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eoutput_dir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"output_dir\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eAccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003etrain_dataloader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecreate_dataloader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ehyperparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"scale_lr\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_processes\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# optimizerの初期化\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoptim\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAdamW\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eparameters\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# only optimize the embeddings\n\u003c/span\u003e        \u003cspan class=\"n\"\u003elr\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003elearning_rate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n    \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etrain_dataloader\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprepare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etrain_dataloader\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# vaeとunetをデバイスに移動\n\u003c/span\u003e    \u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 学習しないためvaeとunetをevalモデルに保持\n\u003c/span\u003e    \u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# データローダーのサイズが変更された可能性があるため、学習ステップの合計を再計算する必要がある\n\u003c/span\u003e    \u003cspan class=\"n\"\u003enum_update_steps_per_epoch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eceil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_dataloader\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003enum_train_epochs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eceil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax_train_steps\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003enum_update_steps_per_epoch\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 学習\n\u003c/span\u003e    \u003cspan class=\"n\"\u003etotal_batch_size\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_processes\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"***** Running training *****\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"  Num examples = \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_dataset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"  Instantaneous batch size per device = \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_batch_size\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"  Total train batch size (w. parallel, distributed \u0026amp; accumulation) = \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etotal_batch_size\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"  Gradient Accumulation steps = \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003egradient_accumulation_steps\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003elogger\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"  Total optimization steps = \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003emax_train_steps\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 各マシンで1回だけプログレスバーを表示\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eprogress_bar\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etqdm\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emax_train_steps\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003edisable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_local_main_process\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprogress_bar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eset_description\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Steps\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eglobal_step\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eepoch\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum_train_epochs\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003estep\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebatch\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etrain_dataloader\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaccumulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e# 画像を潜在空間に変換\n\u003c/span\u003e                \u003cspan class=\"n\"\u003elatents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pixel_values\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003elatent_dist\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003edetach\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"n\"\u003elatents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elatents\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.18215\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e# 潜在変数に追加するサンプルノイズ\n\u003c/span\u003e                \u003cspan class=\"n\"\u003enoise\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elatents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elatents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebsz\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elatents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e# Sample a random timestep for each image\n\u003c/span\u003e                \u003cspan class=\"n\"\u003etimesteps\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enoise_scheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_train_timesteps\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebsz\u003c/span\u003e\u003cspan class=\"p\"\u003e,),\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003elatents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nb\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e# 各タイムステップでのノイズの大きさに応じて潜在変数にノイズを追加\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e# (これは前方拡散プロセス)\n\u003c/span\u003e                \u003cspan class=\"n\"\u003enoisy_latents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enoise_scheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd_noise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elatents\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enoise\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etimesteps\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e# 条件付け用のテキスト埋め込みを取得\n\u003c/span\u003e                \u003cspan class=\"n\"\u003eencoder_hidden_states\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebatch\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"input_ids\"\u003c/span\u003e\u003cspan class=\"p\"\u003e])[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e# ノイズの残差を予測\n\u003c/span\u003e                \u003cspan class=\"n\"\u003enoise_pred\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enoisy_latents\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etimesteps\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eencoder_hidden_states\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003esample\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003eloss\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eF\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emse_loss\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enoise_pred\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enoise\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ereduction\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"none\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emean\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003emean\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackward\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloss\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"c1\"\u003e# コンセプトの埋め込みのみを最適化したいので、\n\u003c/span\u003e                \u003cspan class=\"c1\"\u003e# 追加された埋め込みを除くすべてのトークン埋め込みの勾配をゼロにする\n\u003c/span\u003e                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enum_processes\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003egrads\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emodule\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egrad\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"n\"\u003egrads\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egrad\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e# gradsをゼロにしたいトークンのインデックスを取得\n\u003c/span\u003e                \u003cspan class=\"n\"\u003eindex_grads_to_zero\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eplaceholder_token_id\u003c/span\u003e\n                \u003cspan class=\"n\"\u003egrads\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_grads_to_zero\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e:]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egrads\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex_grads_to_zero\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e:].\u003c/span\u003e\u003cspan class=\"n\"\u003efill_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n                \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estep\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eoptimizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezero_grad\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e# アクセラレータがバックグラウンドで最適化ステップを実行したかどうかを確認\n\u003c/span\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esync_gradients\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eprogress_bar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eglobal_step\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\n            \u003cspan class=\"n\"\u003elogs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\"loss\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eloss\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edetach\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprogress_bar\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eset_postfix\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003elogs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eglobal_step\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003emax_train_steps\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\n\n        \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewait_for_everyone\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\n    \u003cspan class=\"c1\"\u003e# 学習済みモジュールを使用してパイプラインを作成し保存\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eis_main_process\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epipeline\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStableDiffusionPipeline\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eunwrap_model\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003escheduler\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ePNDMScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebeta_start\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.00085\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebeta_end\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.012\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebeta_schedule\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"scaled_linear\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eskip_prk_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003esafety_checker\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eStableDiffusionSafetyChecker\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"CompVis/stable-diffusion-safety-checker\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efeature_extractor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eCLIPFeatureExtractor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"openai/clip-vit-base-patch32\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003epipeline\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutput_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# 新しく学習された埋め込みも保存\n\u003c/span\u003e        \u003cspan class=\"n\"\u003elearned_embeds\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaccelerator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eunwrap_model\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token_id\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003elearned_embeds_dict\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eplaceholder_token\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003elearned_embeds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edetach\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003ecpu\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elearned_embeds_dict\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutput_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"learned_embeds.bin\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate\u003c/span\u003e\n\u003cspan class=\"n\"\u003eaccelerate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enotebook_launcher\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etraining_function\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evae\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eunet\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"522:1-523:104\"\u003eこれで、自前のオリジナルなStable Diffutionを準備できた。\u003cbr\u003e\n次の章では、このオリジナルなSDを実行するAPIサーバをColaboratoryで立てます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"525:1-525:90\"\u003e\n\u003cspan id=\"自前のオリジナルsdを実行するサーバーを立てるバックエンド側\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%87%AA%E5%89%8D%E3%81%AE%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%8A%E3%83%ABsd%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E5%81%B4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e自前のオリジナルSDを実行するサーバーを立てる(バックエンド側)\u003c/h1\u003e\n\u003cp data-sourcepos=\"526:1-527:53\"\u003e今回はFlaskでサーバを立てて、json形式で推論結果を返すWebAPIを作りました。\u003cbr\u003e\nさっきとは違うColabratoryを作成します。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"529:1-529:41\"\u003e\n\u003cspan id=\"stable-diffutionを実行する準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stable-diffution%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStable Diffutionを実行する準備\u003c/h3\u003e\n\u003cp data-sourcepos=\"530:1-530:173\"\u003eさっきと同じように、GoogleDriveにマウント→アクセストークン入力→ライブラリインポート→推論モデル準備が必要になります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"532:1-536:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003egoogle.colab\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003edrive\u003c/span\u003e\n\u003cspan class=\"n\"\u003edrive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emount\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'/content/drive'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e \u003cspan class=\"s\"\u003e'/content/drive/My Drive/SDworkspace'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"537:1-542:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003epip\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eqq\u003c/span\u003e \u003cspan class=\"n\"\u003ediffusers\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"training\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"n\"\u003etransformers\u003c/span\u003e \u003cspan class=\"n\"\u003eftfy\u003c/span\u003e\n\u003cspan class=\"err\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003epip\u003c/span\u003e \u003cspan class=\"n\"\u003einstall\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eqq\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ipywidgets\u0026gt;=7,\u0026lt;8\"\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ehuggingface_hub\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003enotebook_login\u003c/span\u003e\n\u003cspan class=\"n\"\u003enotebook_login\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"543:1-617:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# パッケージのインポート\n\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eargparse\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eitertools\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003emath\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erandom\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch.nn.functional\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eF\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch.utils.checkpoint\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch.utils.data\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eDataset\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eAccelerator\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate.logging\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eget_logger\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eaccelerate.utils\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eset_seed\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eAutoencoderKL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDDPMScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePNDMScheduler\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eStableDiffusionPipeline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUNet2DConditionModel\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers.hub_utils\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003einit_git_repo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epush_to_hub\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers.optimization\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eget_scheduler\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ediffusers.pipelines.stable_diffusion\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eStableDiffusionSafetyChecker\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorchvision\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003etransforms\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etqdm.auto\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003etqdm\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etransformers\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPFeatureExtractor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTextModel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTokenizer\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 事前学習モデルのパス\n\u003c/span\u003e\u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"CompVis/stable-diffusion-v1-4\"\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# トークナイザーとテキストエンコーダーの準備\n\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esubfolder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"tokenizer\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCLIPTextModel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esubfolder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"text_encoder\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# 学習した特徴ベクトルをCLIPに読み込み\n\u003c/span\u003e\u003cspan class=\"n\"\u003elearned_embeds_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"./sd-concept-output/learned_embeds.bin\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eload_learned_embed_in_clip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elearned_embeds_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eloaded_learned_embeds\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elearned_embeds_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emap_location\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cpu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e# 個別のトークンと特徴ベクトル\n\u003c/span\u003e  \u003cspan class=\"n\"\u003etrained_token\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eloaded_learned_embeds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ekeys\u003c/span\u003e\u003cspan class=\"p\"\u003e())[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eembeds\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eloaded_learned_embeds\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etrained_token\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# text_encoderのdtypeにキャスト\n\u003c/span\u003e  \u003cspan class=\"n\"\u003edtype\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edtype\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eembeds\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edtype\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# トークナイザーにトークンを追加\n\u003c/span\u003e  \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003etoken\u003c/span\u003e \u003cspan class=\"ow\"\u003eis\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"bp\"\u003eNone\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"n\"\u003etrained_token\u003c/span\u003e\n  \u003cspan class=\"n\"\u003enum_added_tokens\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd_tokens\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003enum_added_tokens\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"nb\"\u003eValueError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"The tokenizer already contains the token \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e. Please pass a different `token` that is not already in the tokenizer.\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e# トークンの特徴ベクトルのサイズ変更\n\u003c/span\u003e  \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize_token_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e# トークンのIDを取得し特徴ベクトルを割り当てる\n\u003c/span\u003e  \u003cspan class=\"n\"\u003etoken_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econvert_tokens_to_ids\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etoken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_input_embeddings\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eweight\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etoken_id\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eembeds\u003c/span\u003e\n\u003cspan class=\"n\"\u003eload_learned_embed_in_clip\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elearned_embeds_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e# Stable Diffusionパイプラインの準備\n\u003c/span\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etorch\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eautocast\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003epipe\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStableDiffusionPipeline\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_pretrained\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003epretrained_model_name_or_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etorch_dtype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efloat16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etext_encoder\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003euse_auth_token\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cuda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"618:1-618:105\"\u003eこれでStable Diffutionを実行する準備完了。あとは、Flaskでサーバを立てるだけ。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"620:1-620:33\"\u003e\n\u003cspan id=\"flaskでサーバを立てる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#flask%E3%81%A7%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFlaskでサーバを立てる\u003c/h3\u003e\n\u003cp data-sourcepos=\"621:1-622:47\"\u003eStable Diffutionを実行する準備をしたColabolatryの続きで、Flaskでサーバを立てます。\u003cbr\u003e\n今回はngrokでサーバを公開します。\u003c/p\u003e\n\u003cp data-sourcepos=\"624:1-624:48\"\u003e必要なパッケージをインストール。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"625:1-629:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e!pip install -U flask-cors\n!wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip\n!unzip ngrok-stable-linux-amd64.zip\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"630:1-630:57\"\u003eインストールできたら、次を実行します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"631:1-634:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eget_ipython().system_raw('./ngrok http 6006 \u0026amp;')\n!curl -s http://localhost:4040/api/tunnels | python3 -c \"import sys, json; print(json.load(sys.stdin)['tunnels'][0]['public_url'])\"\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"635:1-638:89\"\u003e実行すると以下のようにURLが出力されます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/47da85eddc00b1edb80c0af1ad833a1381261046/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3531333438322f61323035616430622d633264612d396430642d613661302d3862343061356334636534622e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2Fa205ad0b-c2da-9d0d-a6a0-8b40a5c4ce4b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7b992dfe4844c9edeba103d27f73ed83\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/a205ad0b-c2da-9d0d-a6a0-8b40a5c4ce4b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F513482%2Fa205ad0b-c2da-9d0d-a6a0-8b40a5c4ce4b.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f8c47d7b526f89cff71cea576cb72fb5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nこれが今回使うバックエンドのエンドポイントとなります。\u003cbr\u003e\n今回は \u003ca href=\"https://565b-35-223-175-181.ngrok.io\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://565b-35-223-175-181.ngrok.io\u003c/a\u003e がエンドポイントとなります。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"640:1-642:3\" class=\"note warn\"\u003e\n\u003cspan class=\"fa fa-fw fa-exclamation-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"641:1-641:69\"\u003eこのエンドポイントは実行するたびに変わります。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"644:1-644:92\"\u003eあとは、Flaskでサーバを立ち上るだけでバックエンド側は完了です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"646:1-693:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eflask\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eFlask\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erender_template\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonify\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erequest\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eflask_cors\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eCORS\u003c/span\u003e \n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ebase64\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ePIL\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eImage\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003euuid\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eapp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eFlask\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e__name__\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eCORS\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eimage_file_to_base64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_path\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"rb\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_file\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb64encode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_file\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# パラメータ\n\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"a birds in the style of kutaniyaki\"\u003c/span\u003e \u003cspan class=\"c1\"\u003e# プロンプト\n\u003c/span\u003e\u003cspan class=\"n\"\u003enum_samples\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 画像数\n\u003c/span\u003e\u003cspan class=\"n\"\u003enum_rows\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 行数\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eimage_file_to_base64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_path\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"rb\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eimage_file\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebase64\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eb64encode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_file\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"/\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emethods\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'GET'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'POST'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'prompt'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e#推論の実行\n\u003c/span\u003e  \u003cspan class=\"n\"\u003eall_images\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e \n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enum_rows\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003eautocast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"cuda\"\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n          \u003cspan class=\"n\"\u003eimages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003enum_samples\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enum_inference_steps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eguidance_scale\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e7.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sample\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n          \u003cspan class=\"n\"\u003eall_images\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eextend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimages\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eall_images\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euuid4\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"buf/\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e.png\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimage_file_to_base64\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"buf/\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e.png\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonify\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\u003cspan class=\"s\"\u003e\"image\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e'__main__'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e6006\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"695:1-696:71\"\u003eこのバックエンド側の処理は、GETでパラメータpromptを受け取り、promptを入力としてStable Diffutionで画像を生成、その後base64でエンコードしてjson形式でレスポンスを返します。\u003cbr\u003e\nこんな感じのjsonで、生成した4枚の画像を返します。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"698:1-705:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e{images:\n  [base64/image, \n   base64/image,\n   base64/image,\n   base64/image]\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"707:1-707:218\"\u003e最後に、先ほどのエンドポイントを今回私が作成したWebアプリのURIに貼り付けて、生成したい画像のテキストを入力しGenerateボタンを押すだけで、生成できます。\u003c/p\u003e\n\u003cp data-sourcepos=\"709:1-709:151\"\u003eGenerateボタンを押した後、Colabolatryに以下のようなプログレスバーが出力されていれば正常に実行されています。\u003c/p\u003e\n\u003cp data-sourcepos=\"711:1-711:72\"\u003e数分後にwebアプリの方に結果の画像が表示されます。\u003c/p\u003e\n\u003cp data-sourcepos=\"714:1-715:262\"\u003eなお、公開する際には、このエンドポイントをURLのパラメータに入れておけば、自動でURIが入力された状態になります。\u003cbr\u003e\n今回の場合、\u003ca href=\"https://565b-35-223-175-181.ngrok.io\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://565b-35-223-175-181.ngrok.io\u003c/a\u003e がエンドポイントでしたので、\u003ca href=\"https://tex2img-colab-atworks.web.app\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://tex2img-colab-atworks.web.app\u003c/a\u003e の後に/?uri=\u003ca href=\"https://565b-35-223-175-181.ngrok.io\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://565b-35-223-175-181.ngrok.io\u003c/a\u003e を加えてURLを公開します。つまり次のようになります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"717:1-719:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ehttps://tex2img-colab-atworks.web.app/?uri=https://565b-35-223-175-181.ngrok.io\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n","body":"自前の画像生成AI(ファインチューニングした自前のStableDiffusionなど)を公開できる簡単なWebアプリを作ってみました。\nここでは、今流行りのStable Diffusion をGoogle Colaboratoryでバックエンドで動かし、Webサイトで画像生成の結果を表示できるようにしました。\n\n今回作ったwebアプリはこちら\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/219d7b42-bf2f-2233-65cf-36cc83cb4aae.png)\n\nhttps://tex2img-colab-atworks.web.app/\n\nYour Colab URI　にSDを実行するサーバのエンドポイントを入力して、生成したい画像のテキストを入力、そしてGenerateで生成できます。\n\nなお、画像生成AIを実行できるサーバー(バックエンド)があれば、Colabratoryでなくても、誰でもこのWebアプリを利用可能となっています。\n\nこの記事の流れ\n・Stable Diffutionのファインチューニングで自前の画像生成AIモデル作成\n・作成したモデルをWebAPIで呼び出せるようにFlaskサーバ(バックエンド)を立てる\n・サーバのエンドポイントを今回作成したwebアプリに入力して、画像生成をする\n\nなお、今回作成したnotebookとwebアプリはgithubにて公開しています。\n\n# Stable Diffutionのファインチューニング\nまずはオリジナル(っぽい)のStable Diffutionを作るため、ファインチューニングをします。\nこのサイトをすんごく参考にしました。\n\nhttps://note.com/npaka/n/n1af7249cf391\n\n今回は石川県の伝統工芸の九谷焼をStable Diffutionに学習させました。\n(なぜ九谷焼なのか。。。内緒です)\n\n\u003e九谷焼（くたにやき）は、石川県南部の金沢市、小松市、加賀市、能美市で生産される色絵の磁器。\n\nhttps://ja.wikipedia.org/wiki/%E4%B9%9D%E8%B0%B7%E7%84%BC\n\n### ファインチューニングのための画像収集\n\n訓練データとなる九谷焼の写真は、Googleの画像検索でヒットしたものを11枚用意。\nこんな感じの写真。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/9f5c53f2-9c7d-875c-3214-a60a44115eaa.png)\n\n画像が準備できたら、集めた画像はGoogle Driveの次のディレクトリにアップロードしておく。画像の名前は重複していなければなんでも良いです。\n\n```\nMy Drive\n└─.SDworkspace\n　　　　└─.images\n     ├─ image1.png\n     ├─ image2.png\n     .\n     .\n     .\n```\n\n### 画像の解像度を512×512にする\n先ほど作ったSDworkspaceに新しいColabratoryを作成します。\nはじめに、次のコードを実行しGoogle Driveにマウント。\n\n```python\nfrom google.colab import drive\ndrive.mount('/content/drive')\n%cd '/content/drive/My Drive/SDworkspace'\n```\n\n:::note alert\nランタイムタイプは必ずGPUを選択すること\n:::\n\nそして、次のコードを実行。\nすると、SDworkspace/my_conceptに解像度が512×512になった画像たちが保存されます。\n```python\nimport os\nfrom PIL import Image\n\ndef image_grid(imgs, rows, cols):\n    assert len(imgs) == rows*cols\n\n    w, h = imgs[0].size\n    grid = Image.new('RGB', size=(cols*w, rows*h))\n    grid_w, grid_h = grid.size\n    \n    for i, img in enumerate(imgs):\n        grid.paste(img, box=(i%cols*w, i//cols*h))\n    return grid\n\ndir = './images'\nsave_path = \"./my_concept\"\nfilenames = os.listdir(dir)\nimages = []\nfor filename in filenames:\n  img = Image.open(f\"{dir}/{filename}\")\n  img= img.resize((512, 512))\n  img.save(f\"{save_path}/{filename}\")\n  images.append(img)\n\nimage_grid(images, 1, len(images))\n```\n\nこれで準備完了。\n\n### ファインチューニング\n今回使うフレームワークをインストールする。\n\n```\n!pip install -qq diffusers[\"training\"]==0.3.0 transformers ftfy\n!pip install -qq \"ipywidgets\u003e=7,\u003c8\"\n```\nそしたら、このフレームワークを使うためのアクセストークンをHugging Faceで作成する。\n作成したら次のコードを実行して、アクセストークンを入力する。\n```python\nfrom huggingface_hub import notebook_login\nnotebook_login()\n```\nこんな感じのが出れば成功。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/e7cbfef6-e4de-c2a4-cd1e-8fb285f83789.png)\n\n次に、必要なモジュールをimportする。\n```python\nimport argparse\nimport itertools\nimport math\nimport os\nimport random\n\nimport numpy as np\nimport torch\nimport torch.nn.functional as F\nimport torch.utils.checkpoint\nfrom torch.utils.data import Dataset\n\nimport PIL\nfrom accelerate import Accelerator\nfrom accelerate.logging import get_logger\nfrom accelerate.utils import set_seed\nfrom diffusers import AutoencoderKL, DDPMScheduler, PNDMScheduler, StableDiffusionPipeline, UNet2DConditionModel\nfrom diffusers.hub_utils import init_git_repo, push_to_hub\nfrom diffusers.optimization import get_scheduler\nfrom diffusers.pipelines.stable_diffusion import StableDiffusionSafetyChecker\nfrom PIL import Image\nfrom torchvision import transforms\nfrom tqdm.auto import tqdm\nfrom transformers import CLIPFeatureExtractor, CLIPTextModel, CLIPTokenizer\n```\n\nそして、次のコードを実行する。\n\n:::note warn\n「学習内容」「新しい概念を表す単語」「新しい概念が何であるかを要約する単語」この三つを各自のファインチューニングの対象に合わせて変更\n:::\n\n```python\npretrained_model_name_or_path = \"CompVis/stable-diffusion-v1-4\"\n\n# 学習内容 (object or style)\nwhat_to_teach = \"style\"\n\n# 新しい概念を表す単語\nplaceholder_token = \"\u003ckutani-ware\u003e\"\n\n# 新しい概念が何であるかを要約する単語\ninitializer_token = \"art\"\n\n# 学習用のプロンプトテンプレート\nimagenet_templates_small = [\n    \"a photo of a {}\",\n    \"a rendering of a {}\",\n    \"a cropped photo of the {}\",\n    \"the photo of a {}\",\n    \"a photo of a clean {}\",\n    \"a photo of a dirty {}\",\n    \"a dark photo of the {}\",\n    \"a photo of my {}\",\n    \"a photo of the cool {}\",\n    \"a close-up photo of a {}\",\n    \"a bright photo of the {}\",\n    \"a cropped photo of a {}\",\n    \"a photo of the {}\",\n    \"a good photo of the {}\",\n    \"a photo of one {}\",\n    \"a close-up photo of the {}\",\n    \"a rendition of the {}\",\n    \"a photo of the clean {}\",\n    \"a rendition of a {}\",\n    \"a photo of a nice {}\",\n    \"a good photo of a {}\",\n    \"a photo of the nice {}\",\n    \"a photo of the small {}\",\n    \"a photo of the weird {}\",\n    \"a photo of the large {}\",\n    \"a photo of a cool {}\",\n    \"a photo of a small {}\",\n]\n\nimagenet_style_templates_small = [\n    \"a painting in the style of {}\",\n    \"a rendering in the style of {}\",\n    \"a cropped painting in the style of {}\",\n    \"the painting in the style of {}\",\n    \"a clean painting in the style of {}\",\n    \"a dirty painting in the style of {}\",\n    \"a dark painting in the style of {}\",\n    \"a picture in the style of {}\",\n    \"a cool painting in the style of {}\",\n    \"a close-up painting in the style of {}\",\n    \"a bright painting in the style of {}\",\n    \"a cropped painting in the style of {}\",\n    \"a good painting in the style of {}\",\n    \"a close-up painting in the style of {}\",\n    \"a rendition in the style of {}\",\n    \"a nice painting in the style of {}\",\n    \"a small painting in the style of {}\",\n    \"a weird painting in the style of {}\",\n    \"a large painting in the style of {}\",\n]\n```\n\nあとは次のコードを実行してしばらくするとファインチューニングが開始。\n自分のランタイム環境(無料バージョン)だと3-4時間くらいで終わった。\n\n```python\n# データセットの準備\nclass TextualInversionDataset(Dataset):\n    def __init__(\n        self,\n        data_root,\n        tokenizer,\n        learnable_property=\"style\",  # [object, style]\n        size=512,\n        repeats=100,\n        interpolation=\"bicubic\",\n        flip_p=0.5,\n        set=\"train\",\n        placeholder_token=\"*\",\n        center_crop=False,\n    ):\n\n        self.data_root = data_root\n        self.tokenizer = tokenizer\n        self.learnable_property = learnable_property\n        self.size = size\n        self.placeholder_token = placeholder_token\n        self.center_crop = center_crop\n        self.flip_p = flip_p\n\n        self.image_paths = [os.path.join(self.data_root, file_path) for file_path in os.listdir(self.data_root)]\n\n        self.num_images = len(self.image_paths)\n        self._length = self.num_images\n\n        if set == \"train\":\n            self._length = self.num_images * repeats\n\n        self.interpolation = {\n            \"linear\": PIL.Image.LINEAR,\n            \"bilinear\": PIL.Image.BILINEAR,\n            \"bicubic\": PIL.Image.BICUBIC,\n            \"lanczos\": PIL.Image.LANCZOS,\n        }[interpolation]\n\n        self.templates = imagenet_style_templates_small if learnable_property == \"style\" else imagenet_templates_small\n        self.flip_transform = transforms.RandomHorizontalFlip(p=self.flip_p)\n\n    def __len__(self):\n        return self._length\n\n    def __getitem__(self, i):\n        example = {}\n        image = Image.open(self.image_paths[i % self.num_images])\n\n        if not image.mode == \"RGB\":\n            image = image.convert(\"RGB\")\n\n        placeholder_string = self.placeholder_token\n        text = random.choice(self.templates).format(placeholder_string)\n\n        example[\"input_ids\"] = self.tokenizer(\n            text,\n            padding=\"max_length\",\n            truncation=True,\n            max_length=self.tokenizer.model_max_length,\n            return_tensors=\"pt\",\n        ).input_ids[0]\n\n        # default to score-sde preprocessing\n        img = np.array(image).astype(np.uint8)\n\n        if self.center_crop:\n            crop = min(img.shape[0], img.shape[1])\n            h, w, = (\n                img.shape[0],\n                img.shape[1],\n            )\n            img = img[(h - crop) // 2 : (h + crop) // 2, (w - crop) // 2 : (w + crop) // 2]\n\n        image = Image.fromarray(img)\n        image = image.resize((self.size, self.size), resample=self.interpolation)\n\n        image = self.flip_transform(image)\n        image = np.array(image).astype(np.uint8)\n        image = (image / 127.5 - 1.0).astype(np.float32)\n\n        example[\"pixel_values\"] = torch.from_numpy(image).permute(2, 0, 1)\n        return example\n# トークナイザーの準備\ntokenizer = CLIPTokenizer.from_pretrained(\n    pretrained_model_name_or_path,\n    subfolder=\"tokenizer\",\n    use_auth_token=True,\n)\n\n# トークナイザーにプレースホルダートークンを追加\nnum_added_tokens = tokenizer.add_tokens(placeholder_token)\nif num_added_tokens == 0:\n    raise ValueError(\n        f\"The tokenizer already contains the token {placeholder_token}. Please pass a different\"\n        \" `placeholder_token` that is not already in the tokenizer.\"\n    )\n\n# トークンIDの準備\ntoken_ids = tokenizer.encode(initializer_token, add_special_tokens=False)\n\n# 単一トークンと複数トークンのどちらであるか確認\nif len(token_ids) \u003e 1:\n    raise ValueError(\"The initializer token must be a single token.\")\n\ninitializer_token_id = token_ids[0]\nplaceholder_token_id = tokenizer.convert_tokens_to_ids(placeholder_token)\n\n# Stable Diffusionモデルの準備\ntext_encoder = CLIPTextModel.from_pretrained(\n    pretrained_model_name_or_path, subfolder=\"text_encoder\", use_auth_token=True\n)\nvae = AutoencoderKL.from_pretrained(\n    pretrained_model_name_or_path, subfolder=\"vae\", use_auth_token=True\n)\nunet = UNet2DConditionModel.from_pretrained(\n    pretrained_model_name_or_path, subfolder=\"unet\", use_auth_token=True\n)\n# トークンの特徴ベクトルのサイズ変更\ntext_encoder.resize_token_embeddings(len(tokenizer))\n# プレースホルダートークンの初期化\ntoken_embeds = text_encoder.get_input_embeddings().weight.data\ntoken_embeds[placeholder_token_id] = token_embeds[initializer_token_id]\n\ndef freeze_params(params):\n    for param in params:\n        param.requires_grad = False\n\n# vaeとunetをフリーズ\nfreeze_params(vae.parameters())\nfreeze_params(unet.parameters())\n\n# テキストエンコーダのトークン特徴ベクトルを除くすべてのパラメータをフリーズ\nparams_to_freeze = itertools.chain(\n    text_encoder.text_model.encoder.parameters(),\n    text_encoder.text_model.final_layer_norm.parameters(),\n    text_encoder.text_model.embeddings.position_embedding.parameters(),\n)\nfreeze_params(params_to_freeze)\n\n# データセットの準備\ntrain_dataset = TextualInversionDataset(\n      data_root=save_path,\n      tokenizer=tokenizer,\n      size=512,\n      placeholder_token=placeholder_token,\n      repeats=100,\n      learnable_property=what_to_teach, # object or style\n      center_crop=False,\n      set=\"train\",\n)\n\n# データローダーの準備\ndef create_dataloader(train_batch_size=1):\n    return torch.utils.data.DataLoader(train_dataset, batch_size=train_batch_size, shuffle=True)\n\n# noise_schedulerの準備\nnoise_scheduler = DDPMScheduler(\n    beta_start=0.00085, beta_end=0.012, beta_schedule=\"scaled_linear\", num_train_timesteps=1000, tensor_format=\"pt\"\n)\n# ハイパーパラメータの準備\nhyperparameters = {\n    \"learning_rate\": 5e-04,\n    \"scale_lr\": True,\n    \"max_train_steps\": 3000,\n    \"train_batch_size\": 1,\n    \"gradient_accumulation_steps\": 4,\n    \"seed\": 42,\n    \"output_dir\": \"sd-concept-output\"\n}\n# 学習の実行\ndef training_function(text_encoder, vae, unet):\n    logger = get_logger(__name__)\n\n    train_batch_size = hyperparameters[\"train_batch_size\"]\n    gradient_accumulation_steps = hyperparameters[\"gradient_accumulation_steps\"]\n    learning_rate = hyperparameters[\"learning_rate\"]\n    max_train_steps = hyperparameters[\"max_train_steps\"]\n    output_dir = hyperparameters[\"output_dir\"]\n\n    accelerator = Accelerator(\n        gradient_accumulation_steps=gradient_accumulation_steps,\n    )\n\n    train_dataloader = create_dataloader(train_batch_size)\n\n    if hyperparameters[\"scale_lr\"]:\n        learning_rate = (\n            learning_rate * gradient_accumulation_steps * train_batch_size * accelerator.num_processes\n        )\n\n    # optimizerの初期化\n    optimizer = torch.optim.AdamW(\n        text_encoder.get_input_embeddings().parameters(),  # only optimize the embeddings\n        lr=learning_rate,\n    )\n\n\n    text_encoder, optimizer, train_dataloader = accelerator.prepare(\n        text_encoder, optimizer, train_dataloader\n    )\n\n    # vaeとunetをデバイスに移動\n    vae.to(accelerator.device)\n    unet.to(accelerator.device)\n\n    # 学習しないためvaeとunetをevalモデルに保持\n    vae.eval()\n    unet.eval()\n\n    # データローダーのサイズが変更された可能性があるため、学習ステップの合計を再計算する必要がある\n    num_update_steps_per_epoch = math.ceil(len(train_dataloader) / gradient_accumulation_steps)\n    num_train_epochs = math.ceil(max_train_steps / num_update_steps_per_epoch)\n\n    # 学習\n    total_batch_size = train_batch_size * accelerator.num_processes * gradient_accumulation_steps\n\n    logger.info(\"***** Running training *****\")\n    logger.info(f\"  Num examples = {len(train_dataset)}\")\n    logger.info(f\"  Instantaneous batch size per device = {train_batch_size}\")\n    logger.info(f\"  Total train batch size (w. parallel, distributed \u0026 accumulation) = {total_batch_size}\")\n    logger.info(f\"  Gradient Accumulation steps = {gradient_accumulation_steps}\")\n    logger.info(f\"  Total optimization steps = {max_train_steps}\")\n    # 各マシンで1回だけプログレスバーを表示\n    progress_bar = tqdm(range(max_train_steps), disable=not accelerator.is_local_main_process)\n    progress_bar.set_description(\"Steps\")\n    global_step = 0\n\n    for epoch in range(num_train_epochs):\n        text_encoder.train()\n        for step, batch in enumerate(train_dataloader):\n            with accelerator.accumulate(text_encoder):\n                # 画像を潜在空間に変換\n                latents = vae.encode(batch[\"pixel_values\"]).latent_dist.sample().detach()\n                latents = latents * 0.18215\n\n                # 潜在変数に追加するサンプルノイズ\n                noise = torch.randn(latents.shape).to(latents.device)\n                bsz = latents.shape[0]\n                # Sample a random timestep for each image\n                timesteps = torch.randint(0, noise_scheduler.num_train_timesteps, (bsz,), device=latents.device).long()\n\n                # 各タイムステップでのノイズの大きさに応じて潜在変数にノイズを追加\n                # (これは前方拡散プロセス)\n                noisy_latents = noise_scheduler.add_noise(latents, noise, timesteps)\n\n                # 条件付け用のテキスト埋め込みを取得\n                encoder_hidden_states = text_encoder(batch[\"input_ids\"])[0]\n\n                # ノイズの残差を予測\n                noise_pred = unet(noisy_latents, timesteps, encoder_hidden_states).sample\n\n                loss = F.mse_loss(noise_pred, noise, reduction=\"none\").mean([1, 2, 3]).mean()\n                accelerator.backward(loss)\n\n                # コンセプトの埋め込みのみを最適化したいので、\n                # 追加された埋め込みを除くすべてのトークン埋め込みの勾配をゼロにする\n                if accelerator.num_processes \u003e 1:\n                    grads = text_encoder.module.get_input_embeddings().weight.grad\n                else:\n                    grads = text_encoder.get_input_embeddings().weight.grad\n                # gradsをゼロにしたいトークンのインデックスを取得\n                index_grads_to_zero = torch.arange(len(tokenizer)) != placeholder_token_id\n                grads.data[index_grads_to_zero, :] = grads.data[index_grads_to_zero, :].fill_(0)\n\n                optimizer.step()\n                optimizer.zero_grad()\n\n            # アクセラレータがバックグラウンドで最適化ステップを実行したかどうかを確認\n            if accelerator.sync_gradients:\n                progress_bar.update(1)\n                global_step += 1\n\n            logs = {\"loss\": loss.detach().item()}\n            progress_bar.set_postfix(**logs)\n\n            if global_step \u003e= max_train_steps:\n                break\n\n        accelerator.wait_for_everyone()\n\n\n    # 学習済みモジュールを使用してパイプラインを作成し保存\n    if accelerator.is_main_process:\n        pipeline = StableDiffusionPipeline(\n            text_encoder=accelerator.unwrap_model(text_encoder),\n            vae=vae,\n            unet=unet,\n            tokenizer=tokenizer,\n            scheduler=PNDMScheduler(\n                beta_start=0.00085, beta_end=0.012, beta_schedule=\"scaled_linear\", skip_prk_steps=True\n            ),\n            safety_checker=StableDiffusionSafetyChecker.from_pretrained(\"CompVis/stable-diffusion-safety-checker\"),\n            feature_extractor=CLIPFeatureExtractor.from_pretrained(\"openai/clip-vit-base-patch32\"),\n        )\n        pipeline.save_pretrained(output_dir)\n        # 新しく学習された埋め込みも保存\n        learned_embeds = accelerator.unwrap_model(text_encoder).get_input_embeddings().weight[placeholder_token_id]\n        learned_embeds_dict = {placeholder_token: learned_embeds.detach().cpu()}\n        torch.save(learned_embeds_dict, os.path.join(output_dir, \"learned_embeds.bin\"))\nimport accelerate\naccelerate.notebook_launcher(training_function, args=(text_encoder, vae, unet))\n```\n\nこれで、自前のオリジナルなStable Diffutionを準備できた。\n次の章では、このオリジナルなSDを実行するAPIサーバをColaboratoryで立てます。\n\n# 自前のオリジナルSDを実行するサーバーを立てる(バックエンド側)\n今回はFlaskでサーバを立てて、json形式で推論結果を返すWebAPIを作りました。\nさっきとは違うColabratoryを作成します。\n\n### Stable Diffutionを実行する準備\nさっきと同じように、GoogleDriveにマウント→アクセストークン入力→ライブラリインポート→推論モデル準備が必要になります。\n\n```python\nfrom google.colab import drive\ndrive.mount('/content/drive')\n%cd '/content/drive/My Drive/SDworkspace'\n```\n```python\n!pip install -qq diffusers[\"training\"]==0.3.0 transformers ftfy\n!pip install -qq \"ipywidgets\u003e=7,\u003c8\"\nfrom huggingface_hub import notebook_login\nnotebook_login()\n```\n```python\n# パッケージのインポート\nimport argparse\nimport itertools\nimport math\nimport os\nimport random\n\nimport numpy as np\nimport torch\nimport torch.nn.functional as F\nimport torch.utils.checkpoint\nfrom torch.utils.data import Dataset\n\nimport PIL\nfrom accelerate import Accelerator\nfrom accelerate.logging import get_logger\nfrom accelerate.utils import set_seed\nfrom diffusers import AutoencoderKL, DDPMScheduler, PNDMScheduler, StableDiffusionPipeline, UNet2DConditionModel\nfrom diffusers.hub_utils import init_git_repo, push_to_hub\nfrom diffusers.optimization import get_scheduler\nfrom diffusers.pipelines.stable_diffusion import StableDiffusionSafetyChecker\nfrom PIL import Image\nfrom torchvision import transforms\nfrom tqdm.auto import tqdm\nfrom transformers import CLIPFeatureExtractor, CLIPTextModel, CLIPTokenizer\n# 事前学習モデルのパス\npretrained_model_name_or_path = \"CompVis/stable-diffusion-v1-4\"\n\n# トークナイザーとテキストエンコーダーの準備\ntokenizer = CLIPTokenizer.from_pretrained(\n    pretrained_model_name_or_path,\n    subfolder=\"tokenizer\",\n    use_auth_token=True,\n)\ntext_encoder = CLIPTextModel.from_pretrained(\n    pretrained_model_name_or_path, subfolder=\"text_encoder\", use_auth_token=True\n)\n# 学習した特徴ベクトルをCLIPに読み込み\nlearned_embeds_path = \"./sd-concept-output/learned_embeds.bin\"\ndef load_learned_embed_in_clip(learned_embeds_path, text_encoder, tokenizer, token=None):\n  loaded_learned_embeds = torch.load(learned_embeds_path, map_location=\"cpu\")\n  \n  # 個別のトークンと特徴ベクトル\n  trained_token = list(loaded_learned_embeds.keys())[0]\n  embeds = loaded_learned_embeds[trained_token]\n\n  # text_encoderのdtypeにキャスト\n  dtype = text_encoder.get_input_embeddings().weight.dtype\n  embeds.to(dtype)\n\n  # トークナイザーにトークンを追加\n  token = token if token is not None else trained_token\n  num_added_tokens = tokenizer.add_tokens(token)\n  if num_added_tokens == 0:\n    raise ValueError(f\"The tokenizer already contains the token {token}. Please pass a different `token` that is not already in the tokenizer.\")\n  \n  # トークンの特徴ベクトルのサイズ変更\n  text_encoder.resize_token_embeddings(len(tokenizer))\n  \n  # トークンのIDを取得し特徴ベクトルを割り当てる\n  token_id = tokenizer.convert_tokens_to_ids(token)\n  text_encoder.get_input_embeddings().weight.data[token_id] = embeds\nload_learned_embed_in_clip(learned_embeds_path, text_encoder, tokenizer)\n# Stable Diffusionパイプラインの準備\nfrom torch import autocast\n\npipe = StableDiffusionPipeline.from_pretrained(\n    pretrained_model_name_or_path,\n    torch_dtype=torch.float16,\n    text_encoder=text_encoder,\n    tokenizer=tokenizer,\n    use_auth_token=True,\n).to(\"cuda\")\n```\nこれでStable Diffutionを実行する準備完了。あとは、Flaskでサーバを立てるだけ。\n\n### Flaskでサーバを立てる\nStable Diffutionを実行する準備をしたColabolatryの続きで、Flaskでサーバを立てます。\n今回はngrokでサーバを公開します。\n\n必要なパッケージをインストール。\n```\n!pip install -U flask-cors\n!wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip\n!unzip ngrok-stable-linux-amd64.zip\n```\nインストールできたら、次を実行します。\n```\nget_ipython().system_raw('./ngrok http 6006 \u0026')\n!curl -s http://localhost:4040/api/tunnels | python3 -c \"import sys, json; print(json.load(sys.stdin)['tunnels'][0]['public_url'])\"\n```\n実行すると以下のようにURLが出力されます。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/a205ad0b-c2da-9d0d-a6a0-8b40a5c4ce4b.png)\nこれが今回使うバックエンドのエンドポイントとなります。\n今回は https://565b-35-223-175-181.ngrok.io がエンドポイントとなります。\n\n:::note warn\nこのエンドポイントは実行するたびに変わります。\n:::\n\nあとは、Flaskでサーバを立ち上るだけでバックエンド側は完了です。\n\n```python\nfrom flask import Flask, render_template,jsonify, request\nfrom flask_cors import CORS \n\nimport base64\nfrom PIL import Image\nimport uuid\n\napp = Flask(__name__)\nCORS(app)\n\n\ndef image_file_to_base64(file_path):\n    with open(file_path, \"rb\") as image_file:\n        data = base64.b64encode(image_file.read())\n    return data.decode('utf-8')\n\n# パラメータ\nprompt = \"a birds in the style of kutaniyaki\" # プロンプト\nnum_samples = 4 # 画像数\nnum_rows = 1 # 行数\n\ndef image_file_to_base64(file_path):\n    with open(file_path, \"rb\") as image_file:\n        data = base64.b64encode(image_file.read())\n    return data.decode('utf-8')\n\n@app.route(\"/\", methods=['GET','POST'])\ndef index():\n  prompt=request.args.get('prompt')\n  \n  #推論の実行\n  all_images = [] \n  for _ in range(num_rows):\n      with autocast(\"cuda\"):\n          images = pipe([prompt] * num_samples, num_inference_steps=50, guidance_scale=7.5)[\"sample\"]\n          all_images.extend(images)\n  res = []\n  for img in all_images:\n    id=str(uuid.uuid4())\n    img.save(f\"buf/{id}.png\")\n    res.append(image_file_to_base64(f\"buf/{id}.png\"))\n\n  return jsonify({\"image\":res})\n\nif __name__ == '__main__':\n    app.run(port=6006)\n```\n\nこのバックエンド側の処理は、GETでパラメータpromptを受け取り、promptを入力としてStable Diffutionで画像を生成、その後base64でエンコードしてjson形式でレスポンスを返します。\nこんな感じのjsonで、生成した4枚の画像を返します。\n\n```\n{images:\n  [base64/image, \n   base64/image,\n   base64/image,\n   base64/image]\n}\n```\n\n最後に、先ほどのエンドポイントを今回私が作成したWebアプリのURIに貼り付けて、生成したい画像のテキストを入力しGenerateボタンを押すだけで、生成できます。\n\nGenerateボタンを押した後、Colabolatryに以下のようなプログレスバーが出力されていれば正常に実行されています。\n\n数分後にwebアプリの方に結果の画像が表示されます。\n\n\nなお、公開する際には、このエンドポイントをURLのパラメータに入れておけば、自動でURIが入力された状態になります。\n今回の場合、https://565b-35-223-175-181.ngrok.io がエンドポイントでしたので、https://tex2img-colab-atworks.web.app の後に/?uri=https://565b-35-223-175-181.ngrok.io を加えてURLを公開します。つまり次のようになります。\n\n```\nhttps://tex2img-colab-atworks.web.app/?uri=https://565b-35-223-175-181.ngrok.io\n```\n\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:05:56+09:00","group":null,"id":"e9eee6cc82df6d7ea9fa","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"GoogleColaboratory","versions":[]},{"name":"StableDiffusion","versions":[]}],"title":"ファインチューニングした自前のStableDiffusionを公開するWebアプリを作ってみた","updated_at":"2022-09-18T20:54:15+09:00","url":"https://qiita.com/Atomin/items/e9eee6cc82df6d7ea9fa","user":{"description":"","facebook_id":"","followees_count":0,"followers_count":0,"github_login_name":"ATworks-np","id":"Atomin","items_count":3,"linkedin_id":"","location":"","name":"Kohta Koenuma","organization":"","permanent_id":513482,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/513482/profile-images/1662897887","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:32\"\u003e\n\u003cspan id=\"dosbox-xでmasmを実行する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#dosbox-x%E3%81%A7masm%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDOSBox-XでMASMを実行する\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-2:96\"\u003eこの記事ではDOSBox-Xを用いてMASMを実行する方法についてご紹介します。\u003c/p\u003e\n\u003cp data-sourcepos=\"4:1-6:87\"\u003e・Windowsの場合\u003cbr\u003e\n\u003ca href=\"https://dosbox-x.com\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDODBox-Xのダウンロードページ\u003c/a\u003eから、setup.exeをダウンロードしましょう。\u003cbr\u003e\nインストール手順は画面に沿って進めるだけなので割愛します。\u003c/p\u003e\n\u003cp data-sourcepos=\"8:1-15:83\"\u003e・Linuxの場合\u003cbr\u003e\n\u003ca href=\"https://snapcraft.io/dosbox-x\" rel=\"nofollow noopener\" target=\"_blank\"\u003esnapコマンドでインストール\u003c/a\u003eで、お使いのディストリビューションを選択し、適切なコマンドを入力してください。\u003cbr\u003e\nUbuntuの場合であれば、\u003cbr\u003e\n$\u003ccode\u003esudo apt update\u003c/code\u003e\u003cbr\u003e\n$\u003ccode\u003esudo apt install snapd\u003c/code\u003e\u003cbr\u003e\n$\u003ccode\u003esudo snap install dosbox-x\u003c/code\u003e\u003cbr\u003e\nという３つのコマンドをターミナルで入力し、\u003cbr\u003e\n\u003ccode\u003edosbox-x\u003c/code\u003eと入力することでアプリケーションが起動します。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"16:1-16:27\"\u003e\n\u003cspan id=\"masmのダウンロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#masm%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMASMのダウンロード\u003c/h1\u003e\n\u003cp data-sourcepos=\"17:1-21:30\"\u003e私が管理しているレンタルサーバーにアセンブラやリンケージエディタなどを準備しているので、それを使いましょう。\u003cbr\u003e\n\u003ca href=\"http://ikuchankai.html.xdomain.jp/MASM/Assembler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e私のサーバー\u003c/a\u003eからダウンロードしてください。\u003cbr\u003e\nダウンロードしたzipファイルを展開してできた「MP」というディレクトリをC:（Linuxの場合home）直下に保存します。\u003cbr\u003e\nMPというディレクトリが２つできるかと思いますが、EXEファイル等が保存されている方をC:に移動させてください。\u003cbr\u003e\nこれで準備完了です。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"22:1-22:29\"\u003e\n\u003cspan id=\"hello-worldを出力する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#hello-world%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHello World!を出力する\u003c/h1\u003e\n\u003cp data-sourcepos=\"23:1-29:30\"\u003eDOSBox-Xを起動してください。\u003cbr\u003e\n画面が開いて文字入力ができる状態になりましたら、\u003cbr\u003e\nWindowsの場合\u003cbr\u003e\n\u003ccode\u003emount c c:/MP\u003c/code\u003e\u003cbr\u003e\nLinuxの場合\u003cbr\u003e\n\u003ccode\u003emount c /home/MP\u003c/code\u003e\u003cbr\u003e\nを入力してください。\u003c/p\u003e\n\u003cp data-sourcepos=\"31:1-32:41\"\u003e\u003ccode\u003eｃ:\u003c/code\u003e\u003cbr\u003e\nと入力して、C:へ移動します。\u003c/p\u003e\n\u003cp data-sourcepos=\"34:1-46:81\"\u003e私が公開しているMPというディレクトリには最初からHW.ASMというアセンブリファイルが保存されています。\u003cbr\u003e\n中身を確認してみましょう。\u003cbr\u003e\n\u003ccode\u003eedit HW.ASM\u003c/code\u003e\u003cbr\u003e\nを入力すると、コードが表示されます。\u003cbr\u003e\nそのコードがMASMでHello World！を表示する内容になっています。\u003cbr\u003e\n本来であれば、そのファイルを\u003cbr\u003e\n\u003ccode\u003emasm HW.ASM\u003c/code\u003e\u003cbr\u003e\nと入力しアセンブルし、続いて\u003cbr\u003e\n\u003ccode\u003elink HW.OBJ\u003c/code\u003e\u003cbr\u003e\nと入力しリンクすることによってEXEファイルを作ることができます。\u003cbr\u003e\nしかし、今回準備したMPというディレクトリにはもとから「HW.ASM」「HW.OBJ」「HW.EXE」という３つのファイルが用意されているため、皆さんは\u003cbr\u003e\n\u003ccode\u003eHW.EXE\u003c/code\u003e\u003cbr\u003e\nと入力するだけでHello World!が画面に出力されると思います。\u003c/p\u003e\n\u003cp data-sourcepos=\"48:1-49:73\"\u003eこれでDOSBox-Xを用いてMASMでHello World!を出力することができました！\u003cbr\u003e\nこの記事を参考にしてMASMの勉強を頑張ってください。\u003c/p\u003e\n","body":"# DOSBox-XでMASMを実行する\nこの記事ではDOSBox-Xを用いてMASMを実行する方法についてご紹介します。\n\n・Windowsの場合\n[DODBox-Xのダウンロードページ](https://dosbox-x.com)から、setup.exeをダウンロードしましょう。\nインストール手順は画面に沿って進めるだけなので割愛します。\n\n・Linuxの場合\n[snapコマンドでインストール](https://snapcraft.io/dosbox-x)で、お使いのディストリビューションを選択し、適切なコマンドを入力してください。\nUbuntuの場合であれば、\n$```sudo apt update```\n$```sudo apt install snapd```\n$```sudo snap install dosbox-x```\nという３つのコマンドをターミナルで入力し、\n```dosbox-x```と入力することでアプリケーションが起動します。\n# MASMのダウンロード\n私が管理しているレンタルサーバーにアセンブラやリンケージエディタなどを準備しているので、それを使いましょう。\n[私のサーバー](http://ikuchankai.html.xdomain.jp/MASM/Assembler.html)からダウンロードしてください。\nダウンロードしたzipファイルを展開してできた「MP」というディレクトリをC:（Linuxの場合home）直下に保存します。\nMPというディレクトリが２つできるかと思いますが、EXEファイル等が保存されている方をC:に移動させてください。\nこれで準備完了です。\n# Hello World!を出力する\nDOSBox-Xを起動してください。\n画面が開いて文字入力ができる状態になりましたら、\nWindowsの場合\n```mount c c:/MP```\nLinuxの場合\n```mount c /home/MP```\nを入力してください。\n\n```ｃ:```\nと入力して、C:へ移動します。\n\n私が公開しているMPというディレクトリには最初からHW.ASMというアセンブリファイルが保存されています。\n中身を確認してみましょう。\n```edit HW.ASM```\nを入力すると、コードが表示されます。\nそのコードがMASMでHello World！を表示する内容になっています。\n本来であれば、そのファイルを\n```masm HW.ASM```\nと入力しアセンブルし、続いて\n```link HW.OBJ```\nと入力しリンクすることによってEXEファイルを作ることができます。\nしかし、今回準備したMPというディレクトリにはもとから「HW.ASM」「HW.OBJ」「HW.EXE」という３つのファイルが用意されているため、皆さんは\n```HW.EXE```\nと入力するだけでHello World!が画面に出力されると思います。\n\nこれでDOSBox-Xを用いてMASMでHello World!を出力することができました！\nこの記事を参考にしてMASMの勉強を頑張ってください。\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:04:23+09:00","group":null,"id":"7502683497aec8c4d45b","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"アセンブリ言語","versions":[]},{"name":"MASM","versions":[]},{"name":"DOSBox-X","versions":[]}],"title":"DOSBox-XでMASM","updated_at":"2022-09-18T20:21:58+09:00","url":"https://qiita.com/ikuchanAmou/items/7502683497aec8c4d45b","user":{"description":"中学生の頃からアセンブリ言語を勉強している高校生です。\r\nインラインアセンブラの環境を使用しているので必然的にC言語についても学ぶことになっています。\r\nHTMLも少しわかります。\r\nよろしくおねがいします。","facebook_id":"","followees_count":1,"followers_count":1,"github_login_name":null,"id":"ikuchanAmou","items_count":3,"linkedin_id":"","location":"熊本","name":"郁子 天羽","organization":"学校","permanent_id":2728100,"profile_image_url":"https://pbs.twimg.com/profile_images/1457246758397157376/S2f8Md7C_bigger.jpg","team_only":false,"twitter_screen_name":"ikuchanAmou","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:90\"\u003eこちらのソリューションアクセラレータをウォークスルーします。\u003c/p\u003e\n\u003cp data-sourcepos=\"3:1-3:55\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/taka_yayoi/items/6b064914642f022b9cc5\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:54\"\u003eアクセラレータの翻訳版はこちらです。\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-7:56\"\u003e\u003cqiita-embed-ogp src=\"https://github.com/taka-yayoi/public_repo/tree/main/OSRM\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"9:1-9:29\"\u003e\n\u003cspan id=\"イントロダクション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイントロダクション\u003c/h1\u003e\n\u003cp data-sourcepos=\"11:1-11:415\"\u003e多くの物流シナリオにおける共通のニーズは、2点間以上での移動距離と移動時間を推定することです。Euclidean、Haversine、Manhattanなど類似の距離計算手法はあるシナリオにおいては適切な値を算出しますが、その他のケースではポイント間を移動するために通過すべき経路や道路を考慮しなくてはなりません。\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-13:495\"\u003e\u003ca href=\"http://project-osrm.org/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eProject OSRM\u003c/a\u003eのゴールは、\u003ca href=\"https://wiki.osmfoundation.org/wiki/Main_Page\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOpenStreetMap Foundation\u003c/a\u003eによって提供される地図詳細を用いてルートの計算を行うためのソフトウェアを利用できるようにするというものです。OSRMバックエンドサーバーは、世界中のどこにおいても自動車や徒歩のルーティングに活用できる容易にデプロイできるソリューションを提供します。\u003c/p\u003e\n\u003cp data-sourcepos=\"15:1-15:824\"\u003eOSRMバックエンドサーバーは、シンプルかつ高速なREST APIを表現するウェブサービスをデプロイします。多くの企業において、このサーバーはさまざまな内部アプリケーションにアクセスできるコンテナ化されたサービスとしてデプロイされます。大規模な履歴データ、シミュレートされたデータに対してルートを生成する分析チームにとっては、多くの場合専用のデプロイメントが必要となります。このようなニーズを持つ分析を支援するために、OSRMバックエンドサーバーがDatabricksクラスターにどのようにデプロイできるのか、さまざまなデータ処理の取り組みの一部としてアクセスできるのかを説明します。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"17:1-17:33\"\u003e\n\u003cspan id=\"デプロイメントの要件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AE%E8%A6%81%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデプロイメントの要件\u003c/h2\u003e\n\u003cp data-sourcepos=\"19:1-19:209\"\u003eどのようにOSRMソフトウェアがデプロイされるのかをより理解するには、Databricksクラスターがどのように動作するのかに関して知識を持つことが重要です。\u003c/p\u003e\n\u003cp data-sourcepos=\"21:1-21:824\"\u003eDatabricksクラスターは、共有データ処理のワークロードを実行するために動作するサーバーコンピューターから構成されます。Sparkデータフレームにロードされたデータはクラスターのワーカーノードとして知られる複数台のコンピュータのリソースに分散されます。別のコンピューターであるドライバーノードは、ワーカーノードに割り当てられたデータ処理をコーディネートします。すべてのノードはさまざまなデータセットや他のアセットを読み書きする共有ストレージロケーションにアクセスできます。これは非常に単純化したDatabricksクラスターの説明ですが、我々のアプローチの説明には十分です。\u003c/p\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/3723a9311a793932221e3d44f23ecd8cb0f17ba6/68747470733a2f2f627279736d69776173622e626c6f622e636f72652e77696e646f77732e6e65742f64656d6f732f696d616765732f6f73726d5f636c75737465722e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_cluster.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d4b3b0712944b22b4b104355f7c8712f\" width=\"500\" data-canonical-src=\"https://brysmiwasb.blob.core.windows.net/demos/images/osrm_cluster.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_cluster.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=cd0bfd1184ae730feec64c06677aeafe 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003cp data-sourcepos=\"25:1-25:688\"\u003e大規模なルーティング情報を生成するために、クラスターのワーカーノードのそれぞれにOSRMバックエンドサーバーをデプロイします。これは、ノードが配備されるとそれぞれのノードで実行されるクラスターinitスクリプトを通じて処理されます。このスクリプトを通じて、OSRMバックエンドサーバーのローカルインスタンスがそれぞれのワーカーにデプロイされます。これらのOSRMソフトウェアのインスタンスによって、Sparkデータフレームでデータを処理する際にローカルにルートを生成できるようになります:\u003c/p\u003e\n\n\u003ca href=\"https://camo.qiitausercontent.com/2c372e7fd6037c121c17c877d6fe3ae0fd840909/68747470733a2f2f627279736d69776173622e626c6f622e636f72652e77696e646f77732e6e65742f64656d6f732f696d616765732f6f73726d5f7363616c65645f6465706c6f796d656e74322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_scaled_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9f610f6e6178ce200083554c40f14dc1\" width=\"500\" data-canonical-src=\"https://brysmiwasb.blob.core.windows.net/demos/images/osrm_scaled_deployment2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_scaled_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=02731a5e526230260be9f4caa182796b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003cp data-sourcepos=\"29:1-29:971\"\u003eOSRMバックエンドサーバーのそれぞれのインスタンスは、地図データへのアクセスを必要とします。それぞれのワーカーノードが共有され一貫性のあるロケーションから容易にアクセスできるように、このデータは共有ストレージに保存されます。このデータはOSRMソフトウェアが使用する前にダウンロードされ前処理される必要があります。このデータを使用できるように準備する(そして、OSRMバックエンドサーバーソフトウェア自体をコンパイルする)ために、ワーカーノードを持たない軽量クラスター、すなわちシングルノードクラスターを使用します。Databricksワークスペースの任意のクラスターからアクセスできる共有ストレージロケーションに処理済み地図データ(とコンパイル済みのソフトウェア)を格納します。\u003c/p\u003e\n\n\u003ca href=\"https://camo.qiitausercontent.com/bac9010879d86d0ed2031aa369399266be0b2b80/68747470733a2f2f627279736d69776173622e626c6f622e636f72652e77696e646f77732e6e65742f64656d6f732f696d616765732f6f73726d5f70726570726f63657373696e675f6465706c6f796d656e74322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_preprocessing_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=41e4962e3047a06d9c7d6f33f40eb842\" width=\"500\" data-canonical-src=\"https://brysmiwasb.blob.core.windows.net/demos/images/osrm_preprocessing_deployment2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_preprocessing_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d331e44ceffb09ad8e1d5717542a9645 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003cp data-sourcepos=\"33:1-33:873\"\u003eクラスターデプロイメントのトポロジーを計画する際、OSRMソフトウェアがメモリーに幾分大きな地図ファイルをロードすることに留意することが重要です。これは、ルート解決を高速にしますが、OSRMソフトウェアインスタンスをホストするそれぞれのコンピューターにある一定量のRAMを持つ必要があります。十分なメモリーがない場合、OSRMソフトウェアは多くの場合、明確なメッセージを出さずにシャットダウンしてしまいます。前処理のステップが成功した際に得られる地図ファイルによって必要なRAMの総量に注意してください。そして、必要に応じてルーティングのクラスターデプロイメントのワーカーノードのサイズを調整してください。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"35:1-35:66\"\u003e\n\u003cspan id=\"ソリューションアクセラレータのノートブック\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%BD%E3%83%AA%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%A2%E3%82%AF%E3%82%BB%E3%83%A9%E3%83%AC%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%88%E3%83%96%E3%83%83%E3%82%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eソリューションアクセラレータのノートブック\u003c/h2\u003e\n\u003cp data-sourcepos=\"37:1-37:272\"\u003eこのソリューションアクセラレータは3つのノートブックから構成されます。それぞれがOSRMがインテグレーションされたデプロイメントの固有の用途に取り組んでおり、順番に実行する必要があります。\u003c/p\u003e\n\n\u003cul data-sourcepos=\"40:1-43:0\"\u003e\n\u003cli data-sourcepos=\"40:1-40:99\"\u003eRT 00: Introduction - ソリューションアクセラレータのシナリオを紹介します\u003c/li\u003e\n\u003cli data-sourcepos=\"41:1-41:121\"\u003eRT 01: Setup OSRM Server - OSRMソフトウェアをコンパイルし、OpenStreetMapファイルを前処理します\u003c/li\u003e\n\u003cli data-sourcepos=\"42:1-43:0\"\u003eRT 02: Generate Routes - データ処理の一環としてルートを生成するためにOSRMソフトウェアを使用します\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 data-sourcepos=\"44:1-44:39\"\u003e\n\u003cspan id=\"osrmサーバーのセットアップ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#osrm%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOSRMサーバーのセットアップ\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"46:1-46:30\"\u003e\n\u003cspan id=\"イントロダクション-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイントロダクション\u003c/h2\u003e\n\u003cp data-sourcepos=\"48:1-48:376\"\u003eこのノートブックで行うステップは、DatabricksクラスターでOSRMバックエンドサーバーを実行するために必要なアセットをどのように準備するのかを説明します。これらのステップは頻繁には実行せず、OSRMを装備したDatabricksクラスターを起動する前に一度実行する場合が多いです。\u003c/p\u003e\n\u003cp data-sourcepos=\"50:1-50:819\"\u003eこの作業を行うためには、シングルノードクラスター、すなわち、ドライバーのみでワーカーノードを持たないクラスターを使用することをお勧めします。(シングルノードクラスターをデプロイするには\u003cem\u003eCreate Cluster\u003c/em\u003eページの\u003cem\u003eCluster Mode\u003c/em\u003eドロップダウンから\u003cem\u003esingle node\u003c/em\u003eを選択します) ドライバーノードには、処理する地図ファイルのサイズよりも遥かに大きいRAMを割り当てる必要があります。ドライバーノードのサイジングに関するガイドラインとしては、\u003ca href=\"https://download.geofabrik.de/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGeoFabrik website\u003c/a\u003eからダウンロードした11.5GBの北米の \u003cem\u003e.osm.pbf\u003c/em\u003e 地図ファイルの処理に128GBのRAMのドライバーノードが必要となりました。\u003c/p\u003e\n\n\u003ca href=\"https://camo.qiitausercontent.com/bac9010879d86d0ed2031aa369399266be0b2b80/68747470733a2f2f627279736d69776173622e626c6f622e636f72652e77696e646f77732e6e65742f64656d6f732f696d616765732f6f73726d5f70726570726f63657373696e675f6465706c6f796d656e74322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_preprocessing_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=41e4962e3047a06d9c7d6f33f40eb842\" width=\"500\" data-canonical-src=\"https://brysmiwasb.blob.core.windows.net/demos/images/osrm_preprocessing_deployment2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_preprocessing_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d331e44ceffb09ad8e1d5717542a9645 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003ch2 data-sourcepos=\"54:1-54:50\"\u003e\n\u003cspan id=\"step-1-サーバーソフトウェアの構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-1-%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 1: サーバーソフトウェアの構築\u003c/h2\u003e\n\u003cp data-sourcepos=\"56:1-56:591\"\u003eスタートするには、\u003ca href=\"https://github.com/Project-OSRM/osrm-backend\" rel=\"nofollow noopener\" target=\"_blank\"\u003eits GitHub repository\u003c/a\u003eから利用できる現在のソースコードからOSRMバックエンドサーバーを構築する必要があります。プロジェクトチームによって提供されている\u003ca href=\"https://github.com/Project-OSRM/osrm-backend#building-from-source\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003eBuild from Source\u003c/em\u003e instructions\u003c/a\u003eは、このための基本的なステップをカバーしています。以下のように我々の環境にパッケージの依存関係をインストールするところからスタートします。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"58:1-58:37\"\u003e\n\u003cspan id=\"依存関係のインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e依存関係のインストール\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"60:1-66:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003esudo \u003c/span\u003eapt \u003cspan class=\"nt\"\u003e-qq\u003c/span\u003e \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e build-essential git cmake pkg-config \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\nlibbz2-dev libxml2-dev libzip-dev libboost-all-dev \u003cspan class=\"se\"\u003e\\\u003c/span\u003e\nlua5.2 liblua5.2-dev libtbb-dev\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"68:1-68:121\"\u003e次に、我々のローカルシステムにOSRMバックエンドサーバーリポジトリをクローンします。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"70:1-80:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \n\n\u003cspan class=\"c\"\u003e# make directory for repo clone\u003c/span\u003e\n\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /srv/git\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /srv/git\n\n\u003cspan class=\"c\"\u003e# clone the osrm backend server repo\u003c/span\u003e\n\u003cspan class=\"nb\"\u003erm\u003c/span\u003e \u003cspan class=\"nt\"\u003e-rf\u003c/span\u003e osrm-backend\ngit clone \u003cspan class=\"nt\"\u003e--depth\u003c/span\u003e 1 \u003cspan class=\"nt\"\u003e-b\u003c/span\u003e v5.26.0 https://github.com/Project-OSRM/osrm-backend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"82:1-82:40\"\u003eそしてサーバーを構築します:\u003c/p\u003e\n\u003cdiv data-sourcepos=\"84:1-87:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"85:1-86:150\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nこのステップは、お使いのDatabrikcsクラスターのサイズに応じて完了するまでに20分以上かかることがあります。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"89:1-89:47\"\u003e\n\u003cspan id=\"osrmバックエンドサーバーの構築\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#osrm%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOSRMバックエンドサーバーの構築\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"91:1-102:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /srv/git/osrm-backend\n\n\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e build\n\u003cspan class=\"nb\"\u003ecd \u003c/span\u003ebuild\n\ncmake ..\ncmake \u003cspan class=\"nt\"\u003e--build\u003c/span\u003e \u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003cspan class=\"nb\"\u003esudo \u003c/span\u003ecmake \u003cspan class=\"nt\"\u003e--build\u003c/span\u003e \u003cspan class=\"nb\"\u003e.\u003c/span\u003e \u003cspan class=\"nt\"\u003e--target\u003c/span\u003e \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"104:1-104:38\"\u003e\n\u003cspan id=\"step-2-地図ファイルの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-2-%E5%9C%B0%E5%9B%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 2: 地図ファイルの準備\u003c/h2\u003e\n\u003cp data-sourcepos=\"106:1-106:385\"\u003eOSRMバックエンドサーバーは地図データを使ってルートを生成します。特定リージョンの地図は \u003cem\u003e.osm.pbf\u003c/em\u003e ファイルとして\u003ca href=\"https://download.geofabrik.de/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGeoFabrik download site\u003c/a\u003eから利用することができます。要件に応じて、特定の大陸、国、リージョンレベルの地図ファイルを活用しても構いません。\u003c/p\u003e\n\u003cp data-sourcepos=\"108:1-108:671\"\u003e使用するファイルはOSRMソフトウェアが利用する前にダウンロードして前処理する必要があります。前処理の過程では、2つの前処理のパスから選択し、ルーティングが車によるものなのか、徒歩や他の移動手段によるものなのかを選択する必要があります。これらのオプションの詳細に関しては、\u003ca href=\"https://github.com/Project-OSRM/osrm-backend/wiki/Running-OSRM\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eを参照ください。ここでは、前処理のパスとしては、車移動を選択する際にはOSRMドキュメントで好まれているMulti-Level Dijkstra (MLD)を選択しました。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"110:1-113:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"111:1-112:168\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\n地図ファイルのサイズによっては、ダウンロードと前処理ステップが完了するまである程度の時間を要する場合があります。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"115:1-115:82\"\u003e最初のステップは使用する地図ファイルのダウンロードです:\u003c/p\u003e\n\u003cdiv data-sourcepos=\"117:1-120:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"118:1-119:92\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nこのステップは北米の地図ファイルの場合は15分程度必要とします。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"122:1-122:43\"\u003e\n\u003cspan id=\"地図ファイルのダウンロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9C%B0%E5%9B%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e地図ファイルのダウンロード\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"124:1-137:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \n\n\u003cspan class=\"c\"\u003e# create clean folder to house downloaded map file\u003c/span\u003e\n\u003cspan class=\"nb\"\u003erm\u003c/span\u003e \u003cspan class=\"nt\"\u003e-rf\u003c/span\u003e /srv/git/osrm-backend/maps/north-america\n\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /srv/git/osrm-backend/maps/north-america\n\n\u003cspan class=\"c\"\u003e# download map file to appropriate folder\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /srv/git/osrm-backend/maps/north-america\nwget \u003cspan class=\"nt\"\u003e--quiet\u003c/span\u003e https://download.geofabrik.de/north-america-latest.osm.pbf\n\n\u003cspan class=\"c\"\u003e# list folder contents\u003c/span\u003e\n\u003cspan class=\"nb\"\u003els\u003c/span\u003e \u003cspan class=\"nt\"\u003e-l\u003c/span\u003e \u003cspan class=\"nb\"\u003e.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"139:1-139:430\"\u003e次に、我々が選択した移動手段を示すプロファイルを指定する地図ファイルアセットを抽出します。\u003cem\u003eosrm-extract\u003c/em\u003e コマンドの出力は非常に多いことに注意してください。セルの出力を溢れさせないために、ログファイルに標準出力をリダイレクトし、完了したことを検証するためにそのファイルの最後の数行を確認します:\u003c/p\u003e\n\u003cdiv data-sourcepos=\"141:1-144:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"142:1-143:88\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nこのステップは北米地図ファイルの場合1時間程度必要とします。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"146:1-146:49\"\u003e\n\u003cspan id=\"地図ファイルのコンテンツの抽出\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%9C%B0%E5%9B%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%81%AE%E6%8A%BD%E5%87%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e地図ファイルのコンテンツの抽出\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"148:1-163:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# setup location to house log files\u003c/span\u003e\n\u003cspan class=\"nb\"\u003emkdir\u003c/span\u003e \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /srv/git/osrm-backend/logs\n\n\u003cspan class=\"c\"\u003e# move to folder housing map file\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /srv/git/osrm-backend/maps/north-america\n\n\u003cspan class=\"c\"\u003e# extract map file contents\u003c/span\u003e\n/srv/git/osrm-backend/build/osrm-extract north-america-latest.osm.pbf \u003cspan class=\"nt\"\u003e-p\u003c/span\u003e /srv/git/osrm-backend/profiles/car.lua \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e /srv/git/osrm-backend/logs/extract_log.txt\n\n\u003cspan class=\"c\"\u003e# review output from extract command\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#echo '----------------------------------------'\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#tail /srv/git/osrm-backend/logs/extract_log.txt\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"165:1-165:499\"\u003e続ける前に、\u003cem\u003eosrm-extract\u003c/em\u003eコマンドの出力の最後の数行をチェックするようにしてください。\u003cem\u003e\u003cstrong\u003e[info] RAM: peak bytes used\u003c/strong\u003e\u003c/em\u003eで終わるメッセージを受け取らなかった場合、クラスターのドライバーノードに十分なメモリーがなかったことから抽出プロセスがクラッシュしている可能性が高いです。クラッシュした場合には、コマンド出力でエラーが確認できない場合があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"167:1-167:288\"\u003eRAM使用に関するメッセージを受け取ったとしても、 \u003cem\u003e.osm.pbf\u003c/em\u003e ファイルが保存されているフォルダーに大量のファイルが存在していることを確認することで、抽出が成功したことを検証することは良いアイデアです。\u003c/p\u003e\n\u003cp data-sourcepos=\"169:1-169:141\"\u003eMLD前処理パスの次のステップは抽出ファイルからコンテンツをパーティショニングすることとなります。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"171:1-174:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"172:1-173:85\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nこのステップは北米地図ファイルの場合、1時間程度要します。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"176:1-176:52\"\u003e\n\u003cspan id=\"抽出地図ファイルのパーティション\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8A%BD%E5%87%BA%E5%9C%B0%E5%9B%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e抽出地図ファイルのパーティション\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"178:1-184:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \n\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /srv/git/osrm-backend/maps/north-america\n\n/srv/git/osrm-backend/build/osrm-partition north-america-latest.osrm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"186:1-186:130\"\u003eそして、最後にこの前処理パスに関連づけられた指示に従ってコンテンツをカスタマイズします:\u003c/p\u003e\n\u003cdiv data-sourcepos=\"188:1-191:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"189:1-190:28\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\n5分程度かかります。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"193:1-193:49\"\u003e\n\u003cspan id=\"抽出地図ファイルのカスタマイズ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8A%BD%E5%87%BA%E5%9C%B0%E5%9B%B3%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e抽出地図ファイルのカスタマイズ\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"195:1-201:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e \n\n\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /srv/git/osrm-backend/maps/north-america\n\n/srv/git/osrm-backend/build/osrm-customize north-america-latest.osrm\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"203:1-203:39\"\u003e\n\u003cspan id=\"step-3-osrmアセットの永続化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-3-osrm%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E6%B0%B8%E7%B6%9A%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 3: OSRMアセットの永続化\u003c/h2\u003e\n\u003cp data-sourcepos=\"205:1-205:995\"\u003eOSRMバックエンドサーバーと関連する地図アセットは、クラスターのドライバーノードの \u003cem\u003e/srv/git\u003c/em\u003e フォルダーに作成されました。このフォルダーは一時的なものであり、ドライバーノードからしかアクセスすることができません。これは、クラスターが停止されると、これらすべてのアセットは失われることを意味します。クラスターが再起動しても再利用できる様に、これらのアセットを永続化するには、これらを永続化ロケーションにコピーする必要があります。Databricksでは、\u003ca href=\"https://docs.databricks.com/data/databricks-file-system.html#mount-object-storage-to-dbfs\" rel=\"nofollow noopener\" target=\"_blank\"\u003eクラウドストレージのマウント\u003c/a\u003eを利用することができます。また、シンプルにビルトインの\u003ca href=\"https://docs.databricks.com/data/filestore.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eFileStore\u003c/a\u003eストレージロケーションを使用することもできます。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"207:1-210:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"208:1-209:29\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\n15分程度かかります。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"212:1-212:62\"\u003e\n\u003cspan id=\"osrmアセットを永続化ロケーションにコピー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#osrm%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88%E3%82%92%E6%B0%B8%E7%B6%9A%E5%8C%96%E3%83%AD%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%82%B3%E3%83%94%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOSRMアセットを永続化ロケーションにコピー\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"sh\" data-sourcepos=\"214:1-219:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%sh \u003cspan class=\"nt\"\u003e-e\u003c/span\u003e\n\n\u003cspan class=\"nb\"\u003erm\u003c/span\u003e \u003cspan class=\"nt\"\u003e-rf\u003c/span\u003e /dbfs/FileStore/osrm-backend\n\u003cspan class=\"nb\"\u003ecp\u003c/span\u003e \u003cspan class=\"nt\"\u003e-L\u003c/span\u003e \u003cspan class=\"nt\"\u003e-R\u003c/span\u003e /srv/git/osrm-backend /dbfs/FileStore/osrm-backend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"221:1-221:39\"\u003e\n\u003cspan id=\"step-4-initスクリプトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-4-init%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 4: initスクリプトの作成\u003c/h2\u003e\n\u003cp data-sourcepos=\"223:1-223:410\"\u003eこの時点で、OSRMバックエンドサーバーを実行するために必要なすべての要素が揃いました。ここでは、Databricksクラスターのそれぞれのワーカーノードにサーバーがデプロイされる様に、\u003ca href=\"https://docs.databricks.com/clusters/init-scripts.html#cluster-scoped-init-scripts\" rel=\"nofollow noopener\" target=\"_blank\"\u003eクラスターinitスクリプト\u003c/a\u003eを定義する必要があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"225:1-225:242\"\u003eこのスクリプトのロジックは非常にわかりやすいものとなっています。パッケージの依存関係をインストール(すでに大部分は行いました)し、ルーティングサーバーを起動します。\u003c/p\u003e\n\u003cp data-sourcepos=\"227:1-227:638\"\u003eルーティングサーバーがルーティングのリクエストに反応するまでには少々の時間を要します。我々はサーバーをテストし、完全に起動するまで待つロジックを追加しました。このスクリプトを用いるクラスターにおいては、ジョブを完全に実行できるようになるまで数分の遅れが生じることになりますが、ワークフロー(ジョブ)の一部として実行されるロジックの様に、クラスターの起動後即座にロジックが実行され、成功することを保証することができる様になります。\u003c/p\u003e\n\u003cp data-sourcepos=\"229:1-229:296\"\u003einitスクリプトはDBFSファイルシステムの中のアクセス可能なロケーションに書き込む様にしてください。この様なロケーションは、クラスターのスタートアップの過程でスクリプトにアクセスするために必要となります。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"231:1-234:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"232:1-233:90\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\ninitスクリプトを設定したクラスターの起動には10分程度要します。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"236:1-236:32\"\u003e\n\u003cspan id=\"initスクリプトの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#init%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003einitスクリプトの作成\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"238:1-292:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# make folder to house init script\n\u003c/span\u003e\u003cspan class=\"n\"\u003edbutils\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emkdirs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'dbfs:/databricks/scripts'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# write init script\n\u003c/span\u003e\u003cspan class=\"n\"\u003edbutils\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eput\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e'/databricks/scripts/osrm-backend.sh'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"s\"\u003e'''\n#!/bin/bash\n\nif [[ $DB_IS_DRIVER != \"TRUE\" ]]; then  \n\n  echo \"installing osrm backend server dependencies\"\n  sudo apt -qq install -y build-essential git cmake pkg-config libbz2-dev libxml2-dev libzip-dev libboost-all-dev lua5.2 liblua5.2-dev libtbb-dev\n  \n  echo \"launching osrm backend server\"\n  /dbfs/FileStore/osrm-backend/build/osrm-routed --algorithm=MLD /dbfs/FileStore/osrm-backend/maps/north-america/north-america-latest.osrm \u0026amp;\n  \n  echo \"wait until osrm backend server becomes responsive\"\n  res=-1\n  i=1\n\n  # while no response\n  while [ $res -ne 0 ]\n  do\n\n    # test connectivity\n    curl --silent \"http://127.0.0.1:5000/route/v1/driving/-74.005310,40.708750;-73.978691,40.744850\"\n    res=$?\n    \n    # increment the loop counter\n    if [ $i -gt 40 ] \n    then \n      break\n    fi\n    i=$(( $i + 1 ))\n\n    # if no response, sleep\n    if [ $res -ne 0 ]\n    then\n      sleep 30\n    fi\n\n  done  \n  \nfi\n'''\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n  \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# show script content\n\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edbutils\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'dbfs:/databricks/scripts/osrm-backend.sh'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"294:1-294:302\"\u003einitスクリプトを定義すると、OSRMバックエンドサーバーが実行されるクラスターを設定することができます。このクラスターのワーカーノードのサイジングに関しては、ノートブック \u003cem\u003eRT 00\u003c/em\u003e のガイダンスを参照してください。\u003c/p\u003e\n\u003cp data-sourcepos=\"296:1-296:574\"\u003eこのアクセラレータのジョブとクラスターを作成するために、このフォルダーにあるRUNMEファイルを使用している場合、initスクリプトのセットアップステップが自動化されることに注意してください。手動でクラスターの設定を定義する場合は、上のセルで書き込まれるinitスクリプトのパスを指定してください。クラスターが起動すると、クラスターのそれぞれのノードは設定を反映するためにこのスクリプトを実行します。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"298:1-301:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"299:1-300:666\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nこのノートブックを実行する際に使用するクラスターにおいても十分なメモリーを搭載したインスタンスタイプ(128GBのRAM以上)を使用する様にしてください。そうしないと、initスクリプトでOSRMサーバーが起動しません。OSRMサーバーに接続できない場合には、\u003ca href=\"https://qiita.com/taka_yayoi/items/8d951b660cd87c6c5f18#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%AD%E3%82%B0%E3%83%87%E3%83%AA%E3%83%90%E3%83%AA%E3%83%BC\" id=\"reference-44a1e93ae661cae874bc\"\u003eクラスターログ\u003c/a\u003eや\u003ca href=\"https://qiita.com/taka_yayoi/items/b3be567839a6fcb84136\" id=\"reference-9faf2e371691aa0ba427\"\u003eWebターミナル\u003c/a\u003eでデバッグすることをお勧めします。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ca href=\"https://camo.qiitausercontent.com/7285e4f3012f7c999ff12497659b55aed66b7958/68747470733a2f2f627279736d69776173622e626c6f622e636f72652e77696e646f77732e6e65742f64656d6f732f696d616765732f6f73726d5f636c75737465725f636f6e6669672e504e47\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_cluster_config.PNG?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9f251963a7804400f0f049ce10b68ff9\" width=\"600\" data-canonical-src=\"https://brysmiwasb.blob.core.windows.net/demos/images/osrm_cluster_config.PNG\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_cluster_config.PNG?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=aab66fc33d36fd0b83573e4ab5d59d60 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\u003ch1 data-sourcepos=\"306:1-306:17\"\u003e\n\u003cspan id=\"ルート生成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E7%94%9F%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルート生成\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"308:1-308:30\"\u003e\n\u003cspan id=\"イントロダクション-2\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%B3%E3%83%88%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3-2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイントロダクション\u003c/h2\u003e\n\u003cp data-sourcepos=\"310:1-310:273\"\u003eソフトウェアと地図ファイルを準備することで、それぞれのワーカーにOSRMバックエンドサーバーのインスタンスがデプロイされた(複数のワーカーノードを持つ)クラスターを起動することができました。\u003c/p\u003e\n\n\u003ca href=\"https://camo.qiitausercontent.com/2c372e7fd6037c121c17c877d6fe3ae0fd840909/68747470733a2f2f627279736d69776173622e626c6f622e636f72652e77696e646f77732e6e65742f64656d6f732f696d616765732f6f73726d5f7363616c65645f6465706c6f796d656e74322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_scaled_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9f610f6e6178ce200083554c40f14dc1\" width=\"500\" data-canonical-src=\"https://brysmiwasb.blob.core.windows.net/demos/images/osrm_scaled_deployment2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbrysmiwasb.blob.core.windows.net%2Fdemos%2Fimages%2Fosrm_scaled_deployment2.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=02731a5e526230260be9f4caa182796b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\n\nデフォルトでワーカーノードに分散されるSparkデータフレームにあるポイントデータを用いることで、スケーラブルな方法でルーティングデータを生成するために、これらのサーバーインスタンスに対してローカルの呼び出しを行う一連の関数を定義することができます。\n\u003ch2 data-sourcepos=\"317:1-317:48\"\u003e\n\u003cspan id=\"必要なライブラリのインストール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必要なライブラリのインストール\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"319:1-321:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e%pip install tabulate databricks-mosaic\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"323:1-323:45\"\u003e\n\u003cspan id=\"必要なライブラリのインポート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e必要なライブラリのインポート\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"325:1-346:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erequests\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epandas\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ejson\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eitertools\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003esubprocess\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epyspark.sql.functions\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003epyspark.sql.types\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# mosaic import and configuration\n\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003emosaic\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003emos\u003c/span\u003e\n\u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'spark.databricks.labs.mosaic.geometry.api'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'ESRI'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'spark.databricks.labs.mosaic.index.system'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e'H3'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003emos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenable_mosaic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edbutils\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etabulate\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003etabulate\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2 data-sourcepos=\"348:1-348:74\"\u003e\n\u003cspan id=\"step-1-それぞれのワーカーで稼働するサーバーの検証\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-1-%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AB%E3%83%BC%E3%81%A7%E7%A8%BC%E5%83%8D%E3%81%99%E3%82%8B%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A4%9C%E8%A8%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 1: それぞれのワーカーで稼働するサーバーの検証\u003c/h2\u003e\n\u003cp data-sourcepos=\"350:1-350:444\"\u003e最初のステップは、それぞれのワーカーノードで実行されるOSRMバックエンドサーバーが期待通りに動作していることを確認することになります。このためには、クラスターのワーカーに対して小規模なデータセットの分散を強制するいにしえのSpark RDDを用いて、クラスターのそれぞれのIPアドレスを明らかにする必要があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"352:1-352:569\"\u003eさらにこれを理解するためには、それぞれのワーカーノードにおいて利用できるメモリーとプロセッサーのリソースが、Java Virtual Machines (JVM)でどのように分割されるのかを知ることが助けとなります。これらのJVMは \u003cem\u003eExecutors\u003c/em\u003e として参照され、Spark RDDやSparkデータフレームのデータのサブセットを保持します。多くの場合、エグゼキューターとワーカーノードには1対1の関係がありますが、常にそうと言う訳ではありません。\u003c/p\u003e\n\u003cp data-sourcepos=\"354:1-354:1056\"\u003e\u003ca href=\"https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.defaultParallelism.html#pyspark.SparkContext.defaultParallelism\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003esc.defaultParallelism\u003c/em\u003e\u003c/a\u003eプロパティは、クラスターのワーカーノードで利用できるプロセッサーの数をトラックし、この数に等しい値のレンジの並列度を用いてSpark RDDを用いることで、それぞれの仮想コアに1つの整数値を関連づけます。そして、\u003ca href=\"https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.runJob.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003esc.runJob\u003c/em\u003e\u003c/a\u003eメソッドが、RDDのそれぞれの値が存在するマシンのパブリックIPアドレスを収集する \u003cem\u003ehostname -I\u003c/em\u003e コマンドのローカルインスタンスを実行するPythonの\u003ca href=\"https://docs.python.org/3/library/subprocess.html#subprocess.run\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003esubprocess.run\u003c/em\u003e\u003c/a\u003eメソッドを強制します。出力はコマンドによって識別されるユニークなIPの値を返却するために、Pythonのsetに変換されるlistとして返却されます。\u003c/p\u003e\n\u003cp data-sourcepos=\"356:1-356:246\"\u003eこのようなシンプルなタスクに対して多くの説明があるように聞こえますが、このノートブックの後半で別の関数呼び出しを行う際に同じパターンを用いることに注意してください。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"358:1-358:51\"\u003e\n\u003cspan id=\"ワーカーノードのipアドレスの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AF%E3%83%BC%E3%82%AB%E3%83%BC%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AEip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eワーカーノードのIPアドレスの取得\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"360:1-373:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# generate RDD to span each executor on each worker\n\u003c/span\u003e\u003cspan class=\"n\"\u003emyRDD\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparallelize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefaultParallelism\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# get set of ip addresses\n\u003c/span\u003e\u003cspan class=\"n\"\u003eip_addresses\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"c1\"\u003e# conversion to set deduplicates output\n\u003c/span\u003e  \u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erunJob\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003emyRDD\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n    \u003cspan class=\"k\"\u003elambda\u003c/span\u003e \u003cspan class=\"n\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003esubprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"s\"\u003e'hostname'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'-I'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ecapture_output\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003estrip\u003c/span\u003e\u003cspan class=\"p\"\u003e()]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# run hostname -I on each executor\n\u003c/span\u003e    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eip_addresses\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"374:1-374:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/df0ba8c739a1cf30a9a37d977bff446d464ef1b0/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f66326538616334642d313463312d333833662d333633652d3035393532346431346566362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Ff2e8ac4d-14c1-383f-363e-059524d14ef6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0680f2f788862ac9ae4d24a53fcc7d99\" alt=\"Screen Shot 2022-09-18 at 19.48.52.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/f2e8ac4d-14c1-383f-363e-059524d14ef6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Ff2e8ac4d-14c1-383f-363e-059524d14ef6.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6db5e771cd1d36594664e8c4fa6c8a87 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"376:1-376:331\"\u003eワーカーノードのIPアドレスがわかったので、それぞれからルーティングのレスポンスをリクエストすることで、デフォルトポート5000でリッスンしているそれぞれのOSRMバックエンドサーバーのレスポンスをクイックにテストすることができます。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"378:1-378:88\"\u003e\n\u003cspan id=\"ルーティングレスポンスに対するそれぞれのワーカーのテスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8C%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AB%E3%83%BC%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルーティングレスポンスに対するそれぞれのワーカーのテスト\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"380:1-395:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003eresponses\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# for each worker ip address\n\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eip\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eip_addresses\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e# get a response from the osrm backend server\n\u003c/span\u003e  \u003cspan class=\"n\"\u003eresp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e'http://\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e:5000/route/v1/driving/-74.005310,40.708750;-73.978691,40.744850'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eresponses\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eresp\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e\n  \n\u003cspan class=\"c1\"\u003e# display responses generated by each worker\n\u003c/span\u003e\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDataFrame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresponses\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'ip'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'response'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"396:1-396:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/a749a07567c992ed6e175619bd08c6f04ad8844e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f39656663653039612d643938342d363961632d663131622d6131366163393165353865392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F9efce09a-d984-69ac-f11b-a16ac91e58e9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=59818c996f8e73bb018d0288e61624db\" alt=\"Screen Shot 2022-09-18 at 19.49.47.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/9efce09a-d984-69ac-f11b-a16ac91e58e9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F9efce09a-d984-69ac-f11b-a16ac91e58e9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ce469b3afe1c25c38dbb2d3f0296500e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch2 data-sourcepos=\"398:1-398:44\"\u003e\n\u003cspan id=\"step-2-ルート生成データの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-2-%E3%83%AB%E3%83%BC%E3%83%88%E7%94%9F%E6%88%90%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 2: ルート生成データの取得\u003c/h2\u003e\n\u003cp data-sourcepos=\"400:1-400:435\"\u003eどのようにクラスターでルーティング能力を活用できるのかをデモンストレーションするためには、ルートを生成するためのデータを取得する必要があります。それぞれのDatabricksワークスペースには、この様なデータへの容易なアクセスを提供する\u003ca href=\"https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003eNYC Taxi\u003c/em\u003e dataset\u003c/a\u003eがあります。\u003c/p\u003e\n\u003cp data-sourcepos=\"402:1-402:239\"\u003eNYC Taxi (\u003cem\u003eyellow cab\u003c/em\u003e)データセットは現時点で1.6億レコードから構成されています。この作業を管理できるようにするために、狭い範囲の期間のタクシーの乗車にフォーカスします。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"404:1-404:39\"\u003e\n\u003cspan id=\"nyc-taxiデータへのアクセス\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#nyc-taxi%E3%83%87%E3%83%BC%E3%82%BF%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eNYC Taxiデータへのアクセス\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"406:1-418:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003enyc_taxi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'delta'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'dbfs:/databricks-datasets/nyctaxi/tables/nyctaxi_yellow/'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"pickup_datetime \u0026lt; '2016-01-01 00:00:00' AND dropoff_datetime \u0026gt; '2016-01-01 00:00:00'\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e# stuck in cab at midnight on new years day\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_latitude is not null and dropoff_latitude is not null'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e# valid coordinates\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'trip_meters'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'trip_distance * 1609.34'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'trip_seconds'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'datediff(second, pickup_datetime, dropoff_datetime)'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enyc_taxi\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"419:1-419:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/fd9a521560bc29da597530907a901edffd3b945e/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f63323439643630652d653761662d303862662d363337372d3936363764373237393863302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fc249d60e-e7af-08bf-6377-9667d72798c0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=874810bc13a212d8056779ffacb07844\" alt=\"Screen Shot 2022-09-18 at 19.51.07.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/c249d60e-e7af-08bf-6377-9667d72798c0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fc249d60e-e7af-08bf-6377-9667d72798c0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9e1e07170366144993b7be2424945a57 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"421:1-421:168\"\u003eデータプロバイダーによって提供されるデータ辞書情報によると、このデータセットのフィールドは以下を表現しています。\u003c/p\u003e\n\n\u003cul data-sourcepos=\"424:1-456:0\"\u003e\n\u003cli data-sourcepos=\"424:1-426:26\"\u003e\n\u003cstrong\u003evendor_id\u003c/strong\u003e - レコードを提供したTPEPプロバイダーのコード:\n\u003cul data-sourcepos=\"425:5-426:26\"\u003e\n\u003cli data-sourcepos=\"425:5-425:43\"\u003e1= Creative Mobile Technologies, LLC.\u003c/li\u003e\n\u003cli data-sourcepos=\"426:5-426:26\"\u003e2= VeriFone Inc.\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"427:1-427:66\"\u003e\n\u003cstrong\u003epickup_datetime\u003c/strong\u003e - メーターが倒された日時です。\u003c/li\u003e\n\u003cli data-sourcepos=\"428:1-428:70\"\u003e\n\u003cstrong\u003edropoff_datetime\u003c/strong\u003e - メーターが解除された日時です。\u003c/li\u003e\n\u003cli data-sourcepos=\"429:1-429:76\"\u003e\n\u003cstrong\u003epassenger_count\u003c/strong\u003e 乗客数。ドライバーによる入力値です。\u003c/li\u003e\n\u003cli data-sourcepos=\"430:1-430:96\"\u003e\n\u003cstrong\u003etrip_distance\u003c/strong\u003e - タクシーメーターで報告された移動距離(マイル)です。\u003c/li\u003e\n\u003cli data-sourcepos=\"431:1-431:110\"\u003e\n\u003cstrong\u003epickup_longitude, pickup_latitude\u003c/strong\u003e - タクシーメーターが倒されたTLC Taxiのゾーンです。\u003c/li\u003e\n\u003cli data-sourcepos=\"432:1-438:24\"\u003e\n\u003cstrong\u003erate_code_id\u003c/strong\u003e - 移動後に入力された最終的なレートコード:\u003cbr\u003e\n\u003cul data-sourcepos=\"433:5-438:24\"\u003e\n\u003cli data-sourcepos=\"433:5-433:27\"\u003e1 = Standard rate\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"434:5-434:17\"\u003e2 = JFK\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"435:5-435:20\"\u003e3 = Newark\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"436:5-436:35\"\u003e4 = Nassau or Westchester\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"437:5-437:29\"\u003e5 = Negotiated fare\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"438:5-438:24\"\u003e6 = Group ride\u003cbr\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"439:1-441:38\"\u003e\n\u003cstrong\u003estore_and_fwd_flag\u003c/strong\u003e - このフラグはベンダーに送信する前に移動記録が車両のメモリーに登録されたかどうかを示します。自動車にサーバーに接続する能力がない場合にはメモリーに格納されます。「格納して転送」を意味します:\u003cbr\u003e\n\u003cul data-sourcepos=\"440:5-441:38\"\u003e\n\u003cli data-sourcepos=\"440:5-440:35\"\u003eY= store and forward trip\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"441:5-441:38\"\u003eN= not a store and forward trip.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"442:1-442:112\"\u003e\n\u003cstrong\u003edropoff_longitude, dropoff_latitude\u003c/strong\u003e - タクシーメーターが解除されたTLC Taxiゾーンです。\u003c/li\u003e\n\u003cli data-sourcepos=\"443:1-449:20\"\u003e\n\u003cstrong\u003epayment_type\u003c/strong\u003e 乗客が移動に対してどの様に支払いを示したのかを示す数値のコードです:\u003cbr\u003e\n\u003cul data-sourcepos=\"444:5-449:20\"\u003e\n\u003cli data-sourcepos=\"444:5-444:24\"\u003e1= Credit card\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"445:5-445:17\"\u003e2= Cash\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"446:5-446:22\"\u003e3= No charge\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"447:5-447:20\"\u003e4= Dispute\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"448:5-448:20\"\u003e5= Unknown\u003cbr\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"449:5-449:20\"\u003e6= Voided trip\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"450:1-450:95\"\u003e\n\u003cstrong\u003efare_amount\u003c/strong\u003e - メーターによって計算された、時間と距離の料金です。\u003c/li\u003e\n\u003cli data-sourcepos=\"451:1-451:154\"\u003e\n\u003cstrong\u003eextra\u003c/strong\u003e - 追加料金とサーチャージです。現在、これにラッシュアワーと深夜料金の\u003ccode\u003e$0.50\u003c/code\u003eと\u003ccode\u003e$1\u003c/code\u003eのみが含まれます。\u003c/li\u003e\n\u003cli data-sourcepos=\"452:1-452:110\"\u003e\n\u003cstrong\u003emta_tax\u003c/strong\u003e - 使用中のメーターレートに応じて\u003ccode\u003e$0.50\u003c/code\u003eのMTA税が自動で適用されます。\u003c/li\u003e\n\u003cli data-sourcepos=\"453:1-453:177\"\u003e\n\u003cstrong\u003etip_amount\u003c/strong\u003e – クレジットカードのチップがある場合に自動でこのフィールドが埋められます。現金のキャッシュは含まれません。\u003c/li\u003e\n\u003cli data-sourcepos=\"454:1-454:111\"\u003e\n\u003cstrong\u003etolls_amount\u003c/strong\u003e - 移動で支払われた通行料の総額です。Total amount of all tolls paid in trip.\u003c/li\u003e\n\u003cli data-sourcepos=\"455:1-456:0\"\u003e\n\u003cstrong\u003etotal_amount\u003c/strong\u003e - 乗客にチャージされた総額です。現金のチップは含まれません。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"457:1-457:258\"\u003eこれらのフィールドに加えて、OSRMバックエンドサーバーから受け取る内容と一貫性がある形で、距離と時間の情報を提供するために2つのフィールド\u003cstrong\u003etrip_meters\u003c/strong\u003eと\u003cstrong\u003etrip_seconds\u003c/strong\u003eを計算しました。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"460:1-460:35\"\u003e\n\u003cspan id=\"step-3-移動ルートの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#step-3-%E7%A7%BB%E5%8B%95%E3%83%AB%E3%83%BC%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStep 3: 移動ルートの取得\u003c/h2\u003e\n\u003cp data-sourcepos=\"462:1-462:731\"\u003eNYC Taxiデータセットにはそれぞれの移動の開始地点と終了地点が記録されています。我々は正確なルートを知らないので、本日移動する際にベストなルートを特定するために、OSRMバックエンドサーバーの\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#route-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003eroute\u003c/em\u003e メソッド\u003c/a\u003eを使用することができます。これを有効化するために、それぞれの移動のピックアップ地点、降車地点の緯度経度を引き渡す関数を記述します。この関数は、OSRMバックエンドサーバーからのルートをリクエストし、結果のJSONドキュメントを返却するためにこのデータを使用します。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"464:1-464:49\"\u003e\n\u003cspan id=\"ルートを取得すための関数の定義\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%81%9F%E3%82%81%E3%81%AE%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルートを取得すための関数の定義\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"466:1-488:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epandas_udf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_osrm_route\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003estart_longitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n  \u003cspan class=\"n\"\u003estart_latitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n  \u003cspan class=\"n\"\u003eend_longitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n  \u003cspan class=\"n\"\u003eend_latitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n   \n  \u003cspan class=\"c1\"\u003e# combine inputs to form dataframe\n\u003c/span\u003e  \u003cspan class=\"n\"\u003edf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003estart_longitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estart_latitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eend_longitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eend_latitudes\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecolumns\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'start_lon'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'start_lat'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'end_lon'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'end_lat'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# internal function to get route for a given row\n\u003c/span\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e_route\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e'http://127.0.0.1:5000/route/v1/driving/\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estart_lon\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e,\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estart_lat\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e;\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eend_lon\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e,\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eend_lat\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e?alternatives=true\u0026amp;steps=false\u0026amp;geometries=geojson\u0026amp;overview=simplified\u0026amp;annotations=false'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e# apply routing function row by row\n\u003c/span\u003e  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_route\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaxis\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"490:1-490:618\"\u003eこの関数を理解するためには、データフレームのデータがクラスターのワーカーノードの仮想コアに割り当てられたエグゼキューターに対して分散されるサブセット(パーティション)に分割されることに注意してください。(エグゼキューターの概念に関しては、IPアドレスを取得しているセクションの説明をご覧ください) この関数をSparkデータフレームに適用すると、データフレーム自身の並列性に基づき、それぞれのパーティションに並列で適用されます。\u003c/p\u003e\n\u003cp data-sourcepos=\"492:1-492:490\"\u003eこの関数に指定される引数を通じて、それぞれのパーティションから値を受け取ります。それぞれの引数はカラムにマッピングされ、それぞれのカラムから、値に対応する複数の行がそれぞれの引数のpandasのSeriesとして受け取ります。Seriesによって受け取られる値の数は、パーティションのサイズと設定 \u003cem\u003espark.databricks.execution.pandasUDF.maxBatchesToPrefetch\u003c/em\u003e に依存します。\u003c/p\u003e\n\u003cp data-sourcepos=\"494:1-494:757\"\u003eそれぞれのseriesの値は同じ順番でソートされます。これらのseriesを結合すると、パーティションにあるデータの行を際作成することができます。結果のpandasデータフレームのそれぞれの行に対して、OSRMバックエンドサーバーのローカルインスタンスにリクエストを行う内部で定義した関数を適用します。バックエンドサーバーはJSON文字列としてルーティング情報を返却します。このJSON文字列は、pandasデータフレームのそれぞれに対して返却され、返却された値の結果の文字列は、Sparkデータフレームに組み込むために外部関数からSparkエンジンに送信されます。\u003c/p\u003e\n\u003cp data-sourcepos=\"496:1-496:489\"\u003eユーザー定義関数(UDF)で定義されたそれぞれの引数に対するpandasのSeriesとして値のセットを受け取り、pandasのシリーズとして対応する結果セットを返却する、この全体的なパターンによって、この関数をpandasのSeries-to-Seriesユーザー定義関数にします。このタイプのpandas UDFに関しては\u003ca href=\"https://docs.databricks.com/spark/latest/spark-sql/udf-python-pandas.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eこちら\u003c/a\u003eを参照ください。\u003c/p\u003e\n\u003cp data-sourcepos=\"498:1-498:293\"\u003e我々のデータにpandas UDFを適用するには、以下の様にシンプルに\u003ca href=\"https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.withColumn.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003ewithColumn\u003c/em\u003e\u003c/a\u003eメソッド呼び出しのコンテキストでUDFを使用するだけです。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"500:1-500:22\"\u003e\n\u003cspan id=\"ルートの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルートの取得\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"502:1-522:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003enyc_taxi\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eget_osrm_route\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_longitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_latitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'dropoff_longitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'dropoff_latitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectExpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'pickup_datetime'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'dropoff_datetime'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'pickup_longitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'pickup_latitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'dropoff_longitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'dropoff_latitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'fare_amount'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'trip_meters'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'trip_seconds'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"523:1-523:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/d5825eff2979d3b123008d52cd29fbdfe027d1b2/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f32666262363337662d623437652d653237302d613231342d3562376361386439343833352e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F2fbb637f-b47e-e270-a214-5b7ca8d94835.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=60d59cba3650780a9e6973c9ae104c52\" alt=\"Screen Shot 2022-09-18 at 19.54.09.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/2fbb637f-b47e-e270-a214-5b7ca8d94835.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F2fbb637f-b47e-e270-a214-5b7ca8d94835.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=892df24202449fadb855113d04db7855 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"525:1-525:425\"\u003e関数呼び出しの結果はJSON文字列となります。pandas UDFはpandas UDFとSparkエンジンの間ですべての複雑な型をまとめる能力を持たないので、複雑なデータ型ではなく文字列を返却する様にしました。このため、文字列を複雑なデータ表現に変換する必要がある場合には、関数がこの処理を終えた後に行う必要があります。\u003c/p\u003e\n\u003cp data-sourcepos=\"527:1-527:347\"\u003e例えば、戻り値を希望の複雑な型に変換するために、文字列ベースのJSONスキーマの表現を指定し、このスキーマを引数として\u003ca href=\"https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.from_json.html#pyspark.sql.functions.from_json\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003efrom_json\u003c/em\u003e\u003c/a\u003eを適用します。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"529:1-532:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"530:1-531:184\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\n従来のPySparkデータ型表現を用いてスキーマを定義したいのであれば、同様に動作する様子をこのノートブックの後半で説明しています。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"534:1-534:59\"\u003e\n\u003cspan id=\"ルートのjsonを複雑なデータ型表現に変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E3%81%AEjson%E3%82%92%E8%A4%87%E9%9B%91%E3%81%AA%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B%E8%A1%A8%E7%8F%BE%E3%81%AB%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルートのJSONを複雑なデータ型表現に変換\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"536:1-598:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# schema for the json document\n\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse_schema\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'''\n  STRUCT\u0026lt;\n    code: STRING, \n    routes: \n      ARRAY\u0026lt;\n        STRUCT\u0026lt;\n          distance: DOUBLE, \n          duration: DOUBLE, \n          geometry: STRUCT\u0026lt;\n            coordinates: ARRAY\u0026lt;ARRAY\u0026lt;DOUBLE\u0026gt;\u0026gt;, \n            type: STRING\n            \u0026gt;, \n          legs: ARRAY\u0026lt;\n            STRUCT\u0026lt;\n              distance: DOUBLE, \n              duration: DOUBLE, \n              steps: ARRAY\u0026lt;STRING\u0026gt;, \n              summary: STRING, \n              weight: DOUBLE\n              \u0026gt;\n            \u0026gt;, \n          weight: DOUBLE, \n          weight_name: STRING\n          \u0026gt;\n        \u0026gt;,\n      waypoints: ARRAY\u0026lt;\n        STRUCT\u0026lt;\n          distance: DOUBLE, \n          hint: STRING, \n          location: ARRAY\u0026lt;DOUBLE\u0026gt;, \n          name: STRING\n          \u0026gt;\n        \u0026gt;\n      \u0026gt;\n  '''\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# retrieve routes and convert json to struct\n\u003c/span\u003e\u003cspan class=\"n\"\u003enyc_taxi_routes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003enyc_taxi\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eget_osrm_route\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_longitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_latitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'dropoff_longitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'dropoff_latitude'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_json\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse_schema\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectExpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'pickup_datetime'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'dropoff_datetime'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'trip_meters'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e'trip_seconds'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003enyc_taxi_routes\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"599:1-599:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/303e857d1a9f641af0fa5cc018b6e2c837e64bae/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f61323431336430302d323934652d313565322d643136312d3637326531336536616466302e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fa2413d00-294e-15e2-d161-672e13e6adf0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d366b55ce47329c4555cfe5d6ef71988\" alt=\"Screen Shot 2022-09-18 at 19.55.15.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/a2413d00-294e-15e2-d161-672e13e6adf0.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fa2413d00-294e-15e2-d161-672e13e6adf0.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=579d8085043d7bedcebedf221252d1dc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"601:1-601:197\"\u003eJSONドキュメントの構造はOSRMバックエンドサーバーによって定義されます。これらの要素はシンプルなドット表記参照で抽出することができます。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"603:1-606:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"604:1-605:561\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nJSONドキュメント内では、ドキュメントあたり一つのルートのみ存在したとしても、ルートは配列として表現されます。\u003ca href=\"https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.explode.html#pyspark.sql.functions.explode\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003eexplode\u003c/em\u003e\u003c/a\u003e関数は配列を展開し、配列のそれぞれの要素のフィールドの重複を発生させます。ルートの配列に1つのルートしかないので、この関数呼び出しはデータセットのサイズは増加しません。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"608:1-608:43\"\u003e\n\u003cspan id=\"ルートから距離と時間を取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E3%81%8B%E3%82%89%E8%B7%9D%E9%9B%A2%E3%81%A8%E6%99%82%E9%96%93%E3%82%92%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルートから距離と時間を取得\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"610:1-625:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"n\"\u003enyc_taxi_routes\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'osrm_route.routes'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route_meters'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route.distance'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route_seconds'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route.duration'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectExpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'pickup_datetime'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'dropoff_datetime'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'trip_meters'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'route_meters'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'trip_seconds'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e'route_seconds'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"626:1-626:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/7c68f27f01eb3b85bae92fddb355e649f9af7bfc/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f35323532356362622d653862322d613536322d393233382d6234376331323231396635322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F52525cbb-e8b2-a562-9238-b47c12219f52.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=baa91a4cb7adf60e2e8d288f424eabd9\" alt=\"Screen Shot 2022-09-18 at 19.56.08.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/52525cbb-e8b2-a562-9238-b47c12219f52.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F52525cbb-e8b2-a562-9238-b47c12219f52.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8cca403ac0a3fb44995a32b3cda19c67 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"628:1-628:672\"\u003e距離や時間のような属性に加え、OSRMバックエンドサーバーによって返却されるルート情報には\u003ca href=\"https://datatracker.ietf.org/doc/html/rfc7946\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGeoJSON format\u003c/a\u003eに準拠した\u003cem\u003egeometry\u003c/em\u003e要素が含まれています。\u003ca href=\"https://databricks.com/blog/2022/05/02/high-scale-geospatial-processing-with-mosaic.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDatabricks Mosaic\u003c/a\u003eライブラリの\u003ca href=\"https://databrickslabs.github.io/mosaic/api/geometry-constructors.html#st-geomfromgeojson\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003est_geomfromgeojson\u003c/em\u003e\u003c/a\u003e と\u003ca href=\"https://databrickslabs.github.io/mosaic/api/geometry-accessors.html#st-aswkb\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003est_aswkb\u003c/em\u003e\u003c/a\u003eメソッドを用いることで、この要素を標準的な表現に変換します。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"630:1-630:37\"\u003e\n\u003cspan id=\"ルートジオメトリの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E3%82%B8%E3%82%AA%E3%83%A1%E3%83%88%E3%83%AA%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルートジオメトリの取得\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"632:1-642:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003enyc_taxi_geometry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003enyc_taxi_routes\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexplode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'osrm_route.routes'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e# explode routes array\n\u003c/span\u003e    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'geojson'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eto_json\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'route.geometry'\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'geom'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003est_aswkb\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003est_geomfromgeojson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'geojson'\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edrop\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'osrm_route'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enyc_taxi_geometry\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"643:1-643:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/3afe95b508ad9c9c4bdaa10fd08e62e9ebce1e24/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f37653665366539622d343965302d343765362d303235652d6231356666316537613837322e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F7e6e6e9b-49e0-47e6-025e-b15ff1e7a872.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=288c193a7c2d17c7ef6fdb1102a4a9ae\" alt=\"Screen Shot 2022-09-18 at 19.56.59.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/7e6e6e9b-49e0-47e6-025e-b15ff1e7a872.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F7e6e6e9b-49e0-47e6-025e-b15ff1e7a872.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=27b23023fdd43a83c3fe432e8f79af1a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"645:1-645:246\"\u003eそして、我々のルートデータの情報の検証に役立てるために、\u003ca href=\"https://databrickslabs.github.io/mosaic/usage/kepler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eKepler visualization\u003c/a\u003eを用いてこの標準ジオメトリを可視化することができます。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"647:1-650:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"648:1-649:267\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://databrickslabs.github.io/mosaic/usage/kepler.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003emosaic_kepler magic\u003c/em\u003e command\u003c/a\u003eの構文は、\u003cem\u003edataset\u003c/em\u003e \u003cem\u003ecolumn_name\u003c/em\u003e \u003cem\u003efeature_type\u003c/em\u003e [\u003cem\u003erow_limit\u003c/em\u003e]です。表示結果の右上のトグルを用いて、可視化の調整を行うことができます。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch3 data-sourcepos=\"652:1-652:25\"\u003e\n\u003cspan id=\"ルートの可視化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%88%E3%81%AE%E5%8F%AF%E8%A6%96%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルートの可視化\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"654:1-658:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e%%\u003c/span\u003e\u003cspan class=\"n\"\u003emosaic_kepler\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003enyc_taxi_geometry\u003c/span\u003e \u003cspan class=\"n\"\u003egeom\u003c/span\u003e  \u003cspan class=\"n\"\u003egeometry\u003c/span\u003e \u003cspan class=\"mi\"\u003e5000\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"659:1-659:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/aa8946a7901d8877e15c7a056f34029b3194eb0c/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f61333734653036392d376261622d666533352d623039352d3736613139383836656664392e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fa374e069-7bab-fe35-b095-76a19886efd9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0fe254bc5287d48e6f94abac3de7c381\" alt=\"Screen Shot 2022-09-18 at 19.58.03.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/a374e069-7bab-fe35-b095-76a19886efd9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fa374e069-7bab-fe35-b095-76a19886efd9.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f3db14505b2089fc4dfeabd1997cf3a8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"661:1-661:512\"\u003eしかし、もちろんですが、我々はOSRMバックエンドサーバーからルーティングデータを取得することに限定されません。我々のゴールがポイント間の移動の最適化であるのならば、移動時間のテーブルを作成する必要があるかもしれません。このためには、OSRMバックエンドサーバーの\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#table-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cem\u003etable\u003c/em\u003e method\u003c/a\u003eを呼び出す関数を記述することができます。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"663:1-663:43\"\u003e\n\u003cspan id=\"ドライブ時間テーブルの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E6%99%82%E9%96%93%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eドライブ時間テーブルの取得\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"665:1-684:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epandas_udf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget_driving_table\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003epoints_arrays\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epd\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eSeries\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e# internal function to get table for points in an array\n\u003c/span\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003e_table\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoints_array\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \n    \u003cspan class=\"n\"\u003epoints\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e';'\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epoints_array\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \n    \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e'http://127.0.0.1:5000/table/v1/driving/\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003epoints\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\n  \n  \u003cspan class=\"c1\"\u003e# apply table function row by row\n\u003c/span\u003e  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003epoints_arrays\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e_table\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"686:1-686:307\"\u003eこの関数を呼び出すためにはポイントのコレクションを提供する必要があります。NYCタクシーデータはこれに適した良い方法を提供していませんので、勝手に1秒周期ですべてのポイントに取り込む必要があることにしましょう。\u003c/p\u003e\n\u003cdiv data-sourcepos=\"688:1-691:3\" class=\"note info\"\u003e\n\u003cspan class=\"fa fa-fw fa-check-circle\"\u003e\u003c/span\u003e\u003cdiv\u003e\n\u003cp data-sourcepos=\"689:1-690:205\"\u003e\u003cstrong\u003e注意\u003c/strong\u003e\u003cbr\u003e\nこの例の集計は、上で定義した\u003cem\u003eget_driving_table\u003c/em\u003e関数にどの様に値を渡すのかをデモンストレーションするための、ある意味不自然なものとなっています。\u003c/p\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"693:1-731:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# schema for driving table\n\u003c/span\u003e\u003cspan class=\"n\"\u003eresponse_schema\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eStructType\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'code'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'destinations'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStructType\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'hint'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'distance'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'name'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'location'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatType\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e])\u003c/span\u003e\n     \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'durations'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatType\u003c/span\u003e\u003cspan class=\"p\"\u003e()))),\u003c/span\u003e\n  \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'sources'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eStructType\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'hint'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'distance'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'name'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eStringType\u003c/span\u003e\u003cspan class=\"p\"\u003e()),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eStructField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'location'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eFloatType\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e])\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# retrieve driving table and extract matrix\n\u003c/span\u003e\u003cspan class=\"n\"\u003edriving_tables\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"n\"\u003enyc_taxi\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_point'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"concat(pickup_longitude,',',pickup_latitude)\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_window'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"window(pickup_datetime, '1 SECONDS')\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egroupBy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_window'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eagg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecollect_set\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_point'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_points'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexpr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'size(pickup_points) \u0026gt; 1'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"c1\"\u003e# more than one point required for table\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'driving_table'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eget_driving_table\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'pickup_points'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'driving_table'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_json\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'driving_table'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse_schema\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewithColumn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'driving_table_durations'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecol\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'driving_table.durations'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e  \n\n\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edriving_tables\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"732:1-732:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/865ea600e6faab57f32d0089266208077b40b130/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f64636239613830362d353766352d663562302d343237312d3332303034633634306662342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fdcb9a806-57f5-f5b0-4271-32004c640fb4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2d969be005362701100fa4be000e08f6\" alt=\"Screen Shot 2022-09-18 at 19.59.42.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/dcb9a806-57f5-f5b0-4271-32004c640fb4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2Fdcb9a806-57f5-f5b0-4271-32004c640fb4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=99df65265f742b4fb800cb60605c4f71 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"734:1-734:360\"\u003eドライビングテーブルから抽出したマトリクスを検証する際には、ルーティングが異なる場合があるため、方向が異なる際は推定されたドライビング時間に対称性がないことに注意することが重要です。データセットから取得したマトリクスの一つを以下に示します。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"736:1-736:52\"\u003e\n\u003cspan id=\"単一のドライビングテーブルの表示\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%B8%80%E3%81%AE%E3%83%89%E3%83%A9%E3%82%A4%E3%83%93%E3%83%B3%E3%82%B0%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%81%AE%E8%A1%A8%E7%A4%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単一のドライビングテーブルの表示\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"py\" data-sourcepos=\"738:1-749:3\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003ePython\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# generate a single table\n\u003c/span\u003e\u003cspan class=\"n\"\u003edriving_table\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriving_tables\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elimit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ecollect\u003c/span\u003e\u003cspan class=\"p\"\u003e()[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"s\"\u003e'driving_table_durations'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# print driving table\n\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etabulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edriving_table\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etablefmt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'grid'\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003cp data-sourcepos=\"751:1-751:151\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/c407546cd6c0f6563861b3754c6ff8fb581da7c3/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f313136383838322f30373532323738362d313533392d646564612d383939382d3461373630633164383831332e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F07522786-1539-deda-8998-4a760c1d8813.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=55baf7c59929f849d67eb0e8f0ab67ab\" alt=\"Screen Shot 2022-09-18 at 20.00.28.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/07522786-1539-deda-8998-4a760c1d8813.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F1168882%2F07522786-1539-deda-8998-4a760c1d8813.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3f173b43a94de0056d9c37fdf4fc4c66 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"753:1-753:221\"\u003eOSRMバックエンドサーバーの\u003cem\u003eroute\u003c/em\u003e と \u003cem\u003etable\u003c/em\u003eメソッドはサーバーのREST API経由で利用できるメソッドの2つです。利用できるメソッドの完全なリストを以下に示します。\u003c/p\u003e\n\n\u003cul data-sourcepos=\"756:1-762:0\"\u003e\n\u003cli data-sourcepos=\"756:1-756:149\"\u003e\n\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#route-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003eroute\u003c/a\u003e - 指定された順序の座標間で最も早いルートを見つけ出します\u003c/li\u003e\n\u003cli data-sourcepos=\"757:1-757:172\"\u003e\n\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#nearest-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003enearest\u003c/a\u003e - 座標をストリートネットワークにスナップし、近傍のnマッチを返却します\u003c/li\u003e\n\u003cli data-sourcepos=\"758:1-758:161\"\u003e\n\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#table-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003etable\u003c/a\u003e - 指定された座標のすべてのペア間で最速のルートの時間を計算します\u003c/li\u003e\n\u003cli data-sourcepos=\"759:1-759:173\"\u003e\n\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#match-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003ematch\u003c/a\u003e - 指定されたGPS地点を最も納得いく方法で道路のネットワークにスナップします\u003c/li\u003e\n\u003cli data-sourcepos=\"760:1-760:189\"\u003e\n\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#trip-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003etrip\u003c/a\u003e - 貪欲なヒューリスティック(farthest-insertion algorithm)を用いてセールスマン巡回問題を解きます\u003c/li\u003e\n\u003cli data-sourcepos=\"761:1-762:0\"\u003e\n\u003ca href=\"http://project-osrm.org/docs/v5.5.1/api/#tile-service\" rel=\"nofollow noopener\" target=\"_blank\"\u003etile\u003c/a\u003e - ベクタータイルの能力を持つslippy-mapビューアーで参照可能なMapbox Vector Tileを生成します\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"763:1-763:332\"\u003eSparkデータフレームの処理過程でこれらにアクセスできる様にするには、上述した様にシンプルにHTTP REST API呼び出しを行うpandas UDFを構築し、文字列として結果のJSONを返却し、上の例で示した様に結果に対して適切なスキーマを適用するだけです。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"765:1-765:36\"\u003e\n\u003cspan id=\"databricks-無料トライアル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#databricks-%E7%84%A1%E6%96%99%E3%83%88%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDatabricks 無料トライアル\u003c/h3\u003e\n\u003cp data-sourcepos=\"767:1-767:76\"\u003e\u003ca href=\"https://databricks.com/jp/try-databricks\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDatabricks 無料トライアル\u003c/a\u003e\u003c/p\u003e\n","body":"こちらのソリューションアクセラレータをウォークスルーします。\n\nhttps://qiita.com/taka_yayoi/items/6b064914642f022b9cc5\n\nアクセラレータの翻訳版はこちらです。\n\nhttps://github.com/taka-yayoi/public_repo/tree/main/OSRM\n\n# イントロダクション\n\n多くの物流シナリオにおける共通のニーズは、2点間以上での移動距離と移動時間を推定することです。Euclidean、Haversine、Manhattanなど類似の距離計算手法はあるシナリオにおいては適切な値を算出しますが、その他のケースではポイント間を移動するために通過すべき経路や道路を考慮しなくてはなりません。\n\n[Project OSRM](http://project-osrm.org/)のゴールは、[OpenStreetMap Foundation](https://wiki.osmfoundation.org/wiki/Main_Page)によって提供される地図詳細を用いてルートの計算を行うためのソフトウェアを利用できるようにするというものです。OSRMバックエンドサーバーは、世界中のどこにおいても自動車や徒歩のルーティングに活用できる容易にデプロイできるソリューションを提供します。\n\nOSRMバックエンドサーバーは、シンプルかつ高速なREST APIを表現するウェブサービスをデプロイします。多くの企業において、このサーバーはさまざまな内部アプリケーションにアクセスできるコンテナ化されたサービスとしてデプロイされます。大規模な履歴データ、シミュレートされたデータに対してルートを生成する分析チームにとっては、多くの場合専用のデプロイメントが必要となります。このようなニーズを持つ分析を支援するために、OSRMバックエンドサーバーがDatabricksクラスターにどのようにデプロイできるのか、さまざまなデータ処理の取り組みの一部としてアクセスできるのかを説明します。\n\n## デプロイメントの要件\n\nどのようにOSRMソフトウェアがデプロイされるのかをより理解するには、Databricksクラスターがどのように動作するのかに関して知識を持つことが重要です。\n\nDatabricksクラスターは、共有データ処理のワークロードを実行するために動作するサーバーコンピューターから構成されます。Sparkデータフレームにロードされたデータはクラスターのワーカーノードとして知られる複数台のコンピュータのリソースに分散されます。別のコンピューターであるドライバーノードは、ワーカーノードに割り当てられたデータ処理をコーディネートします。すべてのノードはさまざまなデータセットや他のアセットを読み書きする共有ストレージロケーションにアクセスできます。これは非常に単純化したDatabricksクラスターの説明ですが、我々のアプローチの説明には十分です。\u003c/p\u003e\n\n\u003cimg src='https://brysmiwasb.blob.core.windows.net/demos/images/osrm_cluster.png' width=500\u003e\n\n大規模なルーティング情報を生成するために、クラスターのワーカーノードのそれぞれにOSRMバックエンドサーバーをデプロイします。これは、ノードが配備されるとそれぞれのノードで実行されるクラスターinitスクリプトを通じて処理されます。このスクリプトを通じて、OSRMバックエンドサーバーのローカルインスタンスがそれぞれのワーカーにデプロイされます。これらのOSRMソフトウェアのインスタンスによって、Sparkデータフレームでデータを処理する際にローカルにルートを生成できるようになります:\n\u003c/p\u003e\n\u003cimg src='https://brysmiwasb.blob.core.windows.net/demos/images/osrm_scaled_deployment2.png' width=500\u003e\n\nOSRMバックエンドサーバーのそれぞれのインスタンスは、地図データへのアクセスを必要とします。それぞれのワーカーノードが共有され一貫性のあるロケーションから容易にアクセスできるように、このデータは共有ストレージに保存されます。このデータはOSRMソフトウェアが使用する前にダウンロードされ前処理される必要があります。このデータを使用できるように準備する(そして、OSRMバックエンドサーバーソフトウェア自体をコンパイルする)ために、ワーカーノードを持たない軽量クラスター、すなわちシングルノードクラスターを使用します。Databricksワークスペースの任意のクラスターからアクセスできる共有ストレージロケーションに処理済み地図データ(とコンパイル済みのソフトウェア)を格納します。\n\u003c/p\u003e\n\u003cimg src='https://brysmiwasb.blob.core.windows.net/demos/images/osrm_preprocessing_deployment2.png' width=500\u003e\n\nクラスターデプロイメントのトポロジーを計画する際、OSRMソフトウェアがメモリーに幾分大きな地図ファイルをロードすることに留意することが重要です。これは、ルート解決を高速にしますが、OSRMソフトウェアインスタンスをホストするそれぞれのコンピューターにある一定量のRAMを持つ必要があります。十分なメモリーがない場合、OSRMソフトウェアは多くの場合、明確なメッセージを出さずにシャットダウンしてしまいます。前処理のステップが成功した際に得られる地図ファイルによって必要なRAMの総量に注意してください。そして、必要に応じてルーティングのクラスターデプロイメントのワーカーノードのサイズを調整してください。\n\n## ソリューションアクセラレータのノートブック\n\nこのソリューションアクセラレータは3つのノートブックから構成されます。それぞれがOSRMがインテグレーションされたデプロイメントの固有の用途に取り組んでおり、順番に実行する必要があります。\n\u003c/p\u003e\n\n* RT 00: Introduction - ソリューションアクセラレータのシナリオを紹介します\n* RT 01: Setup OSRM Server - OSRMソフトウェアをコンパイルし、OpenStreetMapファイルを前処理します\n* RT 02: Generate Routes - データ処理の一環としてルートを生成するためにOSRMソフトウェアを使用します\n\n# OSRMサーバーのセットアップ\n\n## イントロダクション\n\nこのノートブックで行うステップは、DatabricksクラスターでOSRMバックエンドサーバーを実行するために必要なアセットをどのように準備するのかを説明します。これらのステップは頻繁には実行せず、OSRMを装備したDatabricksクラスターを起動する前に一度実行する場合が多いです。\n\nこの作業を行うためには、シングルノードクラスター、すなわち、ドライバーのみでワーカーノードを持たないクラスターを使用することをお勧めします。(シングルノードクラスターをデプロイするには*Create Cluster*ページの*Cluster Mode*ドロップダウンから*single node*を選択します) ドライバーノードには、処理する地図ファイルのサイズよりも遥かに大きいRAMを割り当てる必要があります。ドライバーノードのサイジングに関するガイドラインとしては、[GeoFabrik website](https://download.geofabrik.de/)からダウンロードした11.5GBの北米の *.osm.pbf* 地図ファイルの処理に128GBのRAMのドライバーノードが必要となりました。\n\u003c/p\u003e\n\u003cimg src='https://brysmiwasb.blob.core.windows.net/demos/images/osrm_preprocessing_deployment2.png' width=500\u003e\n\n## Step 1: サーバーソフトウェアの構築\n\nスタートするには、[its GitHub repository](https://github.com/Project-OSRM/osrm-backend)から利用できる現在のソースコードからOSRMバックエンドサーバーを構築する必要があります。プロジェクトチームによって提供されている[*Build from Source* instructions](https://github.com/Project-OSRM/osrm-backend#building-from-source)は、このための基本的なステップをカバーしています。以下のように我々の環境にパッケージの依存関係をインストールするところからスタートします。\n\n### 依存関係のインストール\n\n```sh\n%sh -e\n\nsudo apt -qq install -y build-essential git cmake pkg-config \\\nlibbz2-dev libxml2-dev libzip-dev libboost-all-dev \\\nlua5.2 liblua5.2-dev libtbb-dev\n```\n\n次に、我々のローカルシステムにOSRMバックエンドサーバーリポジトリをクローンします。\n\n```sh\n%sh -e \n\n# make directory for repo clone\nmkdir -p /srv/git\ncd /srv/git\n\n# clone the osrm backend server repo\nrm -rf osrm-backend\ngit clone --depth 1 -b v5.26.0 https://github.com/Project-OSRM/osrm-backend\n```\n\nそしてサーバーを構築します:\n\n:::note\n**注意** \nこのステップは、お使いのDatabrikcsクラスターのサイズに応じて完了するまでに20分以上かかることがあります。\n:::\n\n### OSRMバックエンドサーバーの構築\n\n```sh\n%sh -e\n\ncd /srv/git/osrm-backend\n\nmkdir -p build\ncd build\n\ncmake ..\ncmake --build .\nsudo cmake --build . --target install\n```\n\n## Step 2: 地図ファイルの準備\n\nOSRMバックエンドサーバーは地図データを使ってルートを生成します。特定リージョンの地図は *.osm.pbf* ファイルとして[GeoFabrik download site](https://download.geofabrik.de/)から利用することができます。要件に応じて、特定の大陸、国、リージョンレベルの地図ファイルを活用しても構いません。\n\n使用するファイルはOSRMソフトウェアが利用する前にダウンロードして前処理する必要があります。前処理の過程では、2つの前処理のパスから選択し、ルーティングが車によるものなのか、徒歩や他の移動手段によるものなのかを選択する必要があります。これらのオプションの詳細に関しては、[こちら](https://github.com/Project-OSRM/osrm-backend/wiki/Running-OSRM)を参照ください。ここでは、前処理のパスとしては、車移動を選択する際にはOSRMドキュメントで好まれているMulti-Level Dijkstra (MLD)を選択しました。\n\n:::note\n**注意**\n地図ファイルのサイズによっては、ダウンロードと前処理ステップが完了するまである程度の時間を要する場合があります。\n:::\n\n最初のステップは使用する地図ファイルのダウンロードです:\n\n:::note\n**注意** \nこのステップは北米の地図ファイルの場合は15分程度必要とします。\n:::\n\n### 地図ファイルのダウンロード\n\n```sh\n%sh -e \n\n# create clean folder to house downloaded map file\nrm -rf /srv/git/osrm-backend/maps/north-america\nmkdir -p /srv/git/osrm-backend/maps/north-america\n\n# download map file to appropriate folder\ncd /srv/git/osrm-backend/maps/north-america\nwget --quiet https://download.geofabrik.de/north-america-latest.osm.pbf\n\n# list folder contents\nls -l .\n```\n\n次に、我々が選択した移動手段を示すプロファイルを指定する地図ファイルアセットを抽出します。*osrm-extract* コマンドの出力は非常に多いことに注意してください。セルの出力を溢れさせないために、ログファイルに標準出力をリダイレクトし、完了したことを検証するためにそのファイルの最後の数行を確認します:\n\n:::note\n**注意**\nこのステップは北米地図ファイルの場合1時間程度必要とします。\n:::\n\n### 地図ファイルのコンテンツの抽出\n\n```sh\n%sh -e\n\n# setup location to house log files\nmkdir -p /srv/git/osrm-backend/logs\n\n# move to folder housing map file\ncd /srv/git/osrm-backend/maps/north-america\n\n# extract map file contents\n/srv/git/osrm-backend/build/osrm-extract north-america-latest.osm.pbf -p /srv/git/osrm-backend/profiles/car.lua \u003e /srv/git/osrm-backend/logs/extract_log.txt\n\n# review output from extract command\n#echo '----------------------------------------'\n#tail /srv/git/osrm-backend/logs/extract_log.txt\n```\n\n続ける前に、*osrm-extract*コマンドの出力の最後の数行をチェックするようにしてください。***\\[info\\] RAM: peak bytes used***で終わるメッセージを受け取らなかった場合、クラスターのドライバーノードに十分なメモリーがなかったことから抽出プロセスがクラッシュしている可能性が高いです。クラッシュした場合には、コマンド出力でエラーが確認できない場合があります。\n\nRAM使用に関するメッセージを受け取ったとしても、 *.osm.pbf* ファイルが保存されているフォルダーに大量のファイルが存在していることを確認することで、抽出が成功したことを検証することは良いアイデアです。\n\nMLD前処理パスの次のステップは抽出ファイルからコンテンツをパーティショニングすることとなります。\n\n:::note\n**注意**\nこのステップは北米地図ファイルの場合、1時間程度要します。\n:::\n\n### 抽出地図ファイルのパーティション\n\n```sh\n%sh -e \n\ncd /srv/git/osrm-backend/maps/north-america\n\n/srv/git/osrm-backend/build/osrm-partition north-america-latest.osrm\n```\n\nそして、最後にこの前処理パスに関連づけられた指示に従ってコンテンツをカスタマイズします:\n\n:::note\n**注意**\n5分程度かかります。\n:::\n\n### 抽出地図ファイルのカスタマイズ\n\n```sh\n%sh -e \n\ncd /srv/git/osrm-backend/maps/north-america\n\n/srv/git/osrm-backend/build/osrm-customize north-america-latest.osrm\n```\n\n## Step 3: OSRMアセットの永続化\n\nOSRMバックエンドサーバーと関連する地図アセットは、クラスターのドライバーノードの */srv/git* フォルダーに作成されました。このフォルダーは一時的なものであり、ドライバーノードからしかアクセスすることができません。これは、クラスターが停止されると、これらすべてのアセットは失われることを意味します。クラスターが再起動しても再利用できる様に、これらのアセットを永続化するには、これらを永続化ロケーションにコピーする必要があります。Databricksでは、[クラウドストレージのマウント](https://docs.databricks.com/data/databricks-file-system.html#mount-object-storage-to-dbfs)を利用することができます。また、シンプルにビルトインの[FileStore](https://docs.databricks.com/data/filestore.html)ストレージロケーションを使用することもできます。\n\n:::note\n**注意**\n15分程度かかります。\n:::\n\n### OSRMアセットを永続化ロケーションにコピー\n\n```sh\n%sh -e\n\nrm -rf /dbfs/FileStore/osrm-backend\ncp -L -R /srv/git/osrm-backend /dbfs/FileStore/osrm-backend\n```\n\n## Step 4: initスクリプトの作成\n\nこの時点で、OSRMバックエンドサーバーを実行するために必要なすべての要素が揃いました。ここでは、Databricksクラスターのそれぞれのワーカーノードにサーバーがデプロイされる様に、[クラスターinitスクリプト](https://docs.databricks.com/clusters/init-scripts.html#cluster-scoped-init-scripts)を定義する必要があります。\n\nこのスクリプトのロジックは非常にわかりやすいものとなっています。パッケージの依存関係をインストール(すでに大部分は行いました)し、ルーティングサーバーを起動します。\n\nルーティングサーバーがルーティングのリクエストに反応するまでには少々の時間を要します。我々はサーバーをテストし、完全に起動するまで待つロジックを追加しました。このスクリプトを用いるクラスターにおいては、ジョブを完全に実行できるようになるまで数分の遅れが生じることになりますが、ワークフロー(ジョブ)の一部として実行されるロジックの様に、クラスターの起動後即座にロジックが実行され、成功することを保証することができる様になります。\n\ninitスクリプトはDBFSファイルシステムの中のアクセス可能なロケーションに書き込む様にしてください。この様なロケーションは、クラスターのスタートアップの過程でスクリプトにアクセスするために必要となります。\n\n:::note\n**注意**\ninitスクリプトを設定したクラスターの起動には10分程度要します。\n:::\n\n### initスクリプトの作成\n\n```py:Python\n# make folder to house init script\ndbutils.fs.mkdirs('dbfs:/databricks/scripts')\n\n# write init script\ndbutils.fs.put(\n  '/databricks/scripts/osrm-backend.sh',\n  '''\n#!/bin/bash\n\nif [[ $DB_IS_DRIVER != \"TRUE\" ]]; then  \n\n  echo \"installing osrm backend server dependencies\"\n  sudo apt -qq install -y build-essential git cmake pkg-config libbz2-dev libxml2-dev libzip-dev libboost-all-dev lua5.2 liblua5.2-dev libtbb-dev\n  \n  echo \"launching osrm backend server\"\n  /dbfs/FileStore/osrm-backend/build/osrm-routed --algorithm=MLD /dbfs/FileStore/osrm-backend/maps/north-america/north-america-latest.osrm \u0026\n  \n  echo \"wait until osrm backend server becomes responsive\"\n  res=-1\n  i=1\n\n  # while no response\n  while [ $res -ne 0 ]\n  do\n\n    # test connectivity\n    curl --silent \"http://127.0.0.1:5000/route/v1/driving/-74.005310,40.708750;-73.978691,40.744850\"\n    res=$?\n    \n    # increment the loop counter\n    if [ $i -gt 40 ] \n    then \n      break\n    fi\n    i=$(( $i + 1 ))\n\n    # if no response, sleep\n    if [ $res -ne 0 ]\n    then\n      sleep 30\n    fi\n\n  done  \n  \nfi\n''', \n  True\n  )\n\n# show script content\nprint(\n  dbutils.fs.head('dbfs:/databricks/scripts/osrm-backend.sh')\n  )\n```\n\ninitスクリプトを定義すると、OSRMバックエンドサーバーが実行されるクラスターを設定することができます。このクラスターのワーカーノードのサイジングに関しては、ノートブック *RT 00* のガイダンスを参照してください。\n\nこのアクセラレータのジョブとクラスターを作成するために、このフォルダーにあるRUNMEファイルを使用している場合、initスクリプトのセットアップステップが自動化されることに注意してください。手動でクラスターの設定を定義する場合は、上のセルで書き込まれるinitスクリプトのパスを指定してください。クラスターが起動すると、クラスターのそれぞれのノードは設定を反映するためにこのスクリプトを実行します。\n\n:::note\n**注意**\nこのノートブックを実行する際に使用するクラスターにおいても十分なメモリーを搭載したインスタンスタイプ(128GBのRAM以上)を使用する様にしてください。そうしないと、initスクリプトでOSRMサーバーが起動しません。OSRMサーバーに接続できない場合には、[クラスターログ](https://qiita.com/taka_yayoi/items/8d951b660cd87c6c5f18#%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%AD%E3%82%B0%E3%83%87%E3%83%AA%E3%83%90%E3%83%AA%E3%83%BC)や[Webターミナル](https://qiita.com/taka_yayoi/items/b3be567839a6fcb84136)でデバッグすることをお勧めします。\n:::\n\u003c/p\u003e\n\n\u003cimg src='https://brysmiwasb.blob.core.windows.net/demos/images/osrm_cluster_config.PNG' width=600\u003e\n\n# ルート生成\n\n## イントロダクション\n\nソフトウェアと地図ファイルを準備することで、それぞれのワーカーにOSRMバックエンドサーバーのインスタンスがデプロイされた(複数のワーカーノードを持つ)クラスターを起動することができました。\n\u003c/p\u003e\n\n\u003cimg src='https://brysmiwasb.blob.core.windows.net/demos/images/osrm_scaled_deployment2.png' width=500\u003e\n\u003c/p\u003e\nデフォルトでワーカーノードに分散されるSparkデータフレームにあるポイントデータを用いることで、スケーラブルな方法でルーティングデータを生成するために、これらのサーバーインスタンスに対してローカルの呼び出しを行う一連の関数を定義することができます。\n\n## 必要なライブラリのインストール\n\n```\n%pip install tabulate databricks-mosaic\n```\n\n## 必要なライブラリのインポート\n\n```py:Python\nimport requests\n\nimport pandas as pd\nimport numpy as np\nimport json\n\nimport itertools\n\nimport subprocess\n\nimport pyspark.sql.functions as fn\nfrom pyspark.sql.types import *\n\n# mosaic import and configuration\nimport mosaic as mos\nspark.conf.set('spark.databricks.labs.mosaic.geometry.api', 'ESRI')\nspark.conf.set('spark.databricks.labs.mosaic.index.system', 'H3')\nmos.enable_mosaic(spark, dbutils)\n\nfrom tabulate import tabulate\n```\n\n## Step 1: それぞれのワーカーで稼働するサーバーの検証\n\n最初のステップは、それぞれのワーカーノードで実行されるOSRMバックエンドサーバーが期待通りに動作していることを確認することになります。このためには、クラスターのワーカーに対して小規模なデータセットの分散を強制するいにしえのSpark RDDを用いて、クラスターのそれぞれのIPアドレスを明らかにする必要があります。\n\nさらにこれを理解するためには、それぞれのワーカーノードにおいて利用できるメモリーとプロセッサーのリソースが、Java Virtual Machines (JVM)でどのように分割されるのかを知ることが助けとなります。これらのJVMは *Executors* として参照され、Spark RDDやSparkデータフレームのデータのサブセットを保持します。多くの場合、エグゼキューターとワーカーノードには1対1の関係がありますが、常にそうと言う訳ではありません。\n\n[*sc.defaultParallelism*](https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.defaultParallelism.html#pyspark.SparkContext.defaultParallelism)プロパティは、クラスターのワーカーノードで利用できるプロセッサーの数をトラックし、この数に等しい値のレンジの並列度を用いてSpark RDDを用いることで、それぞれの仮想コアに1つの整数値を関連づけます。そして、[*sc.runJob*](https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.SparkContext.runJob.html)メソッドが、RDDのそれぞれの値が存在するマシンのパブリックIPアドレスを収集する *hostname -I* コマンドのローカルインスタンスを実行するPythonの[*subprocess.run*](https://docs.python.org/3/library/subprocess.html#subprocess.run)メソッドを強制します。出力はコマンドによって識別されるユニークなIPの値を返却するために、Pythonのsetに変換されるlistとして返却されます。\n\nこのようなシンプルなタスクに対して多くの説明があるように聞こえますが、このノートブックの後半で別の関数呼び出しを行う際に同じパターンを用いることに注意してください。\n\n### ワーカーノードのIPアドレスの取得\n\n```py:Python\n# generate RDD to span each executor on each worker\nmyRDD = sc.parallelize(range(sc.defaultParallelism))\n\n# get set of ip addresses\nip_addresses = set( # conversion to set deduplicates output\n  sc.runJob(\n    myRDD, \n    lambda _: [subprocess.run(['hostname','-I'], capture_output=True).stdout.decode('utf-8').strip()] # run hostname -I on each executor\n    )\n  )\n\nip_addresses\n```\n![Screen Shot 2022-09-18 at 19.48.52.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/f2e8ac4d-14c1-383f-363e-059524d14ef6.png)\n\nワーカーノードのIPアドレスがわかったので、それぞれからルーティングのレスポンスをリクエストすることで、デフォルトポート5000でリッスンしているそれぞれのOSRMバックエンドサーバーのレスポンスをクイックにテストすることができます。\n\n### ルーティングレスポンスに対するそれぞれのワーカーのテスト\n\n```py:Python\nresponses = []\n\n# for each worker ip address\nfor ip in ip_addresses:\n  print(ip)\n  \n  # get a response from the osrm backend server\n  resp = requests.get(f'http://{ip}:5000/route/v1/driving/-74.005310,40.708750;-73.978691,40.744850').text\n  responses += [(ip, resp)]\n  \n# display responses generated by each worker\ndisplay(\n  pd.DataFrame(responses, columns=['ip','response'])\n  )\n```\n![Screen Shot 2022-09-18 at 19.49.47.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/9efce09a-d984-69ac-f11b-a16ac91e58e9.png)\n\n## Step 2: ルート生成データの取得\n\nどのようにクラスターでルーティング能力を活用できるのかをデモンストレーションするためには、ルートを生成するためのデータを取得する必要があります。それぞれのDatabricksワークスペースには、この様なデータへの容易なアクセスを提供する[*NYC Taxi* dataset](https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page)があります。\n\nNYC Taxi (*yellow cab*)データセットは現時点で1.6億レコードから構成されています。この作業を管理できるようにするために、狭い範囲の期間のタクシーの乗車にフォーカスします。\n\n### NYC Taxiデータへのアクセス\n\n```py:Python\nnyc_taxi = (\n  spark.read\n  .format('delta')\n  .load('dbfs:/databricks-datasets/nyctaxi/tables/nyctaxi_yellow/')\n  .filter(fn.expr(\"pickup_datetime \u003c '2016-01-01 00:00:00' AND dropoff_datetime \u003e '2016-01-01 00:00:00'\")) # stuck in cab at midnight on new years day\n  .filter(fn.expr('pickup_latitude is not null and dropoff_latitude is not null')) # valid coordinates\n  .withColumn('trip_meters', fn.expr('trip_distance * 1609.34'))\n  .withColumn('trip_seconds', fn.expr('datediff(second, pickup_datetime, dropoff_datetime)'))\n  )\n\ndisplay(nyc_taxi)\n```\n![Screen Shot 2022-09-18 at 19.51.07.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/c249d60e-e7af-08bf-6377-9667d72798c0.png)\n\nデータプロバイダーによって提供されるデータ辞書情報によると、このデータセットのフィールドは以下を表現しています。\n\u003c/p\u003e\n\n- **vendor_id** - レコードを提供したTPEPプロバイダーのコード:\n    - 1= Creative Mobile Technologies, LLC.\n    - 2= VeriFone Inc.\u003cbr\u003e\n- **pickup_datetime** - メーターが倒された日時です。\n- **dropoff_datetime** - メーターが解除された日時です。\n- **passenger_count** 乗客数。ドライバーによる入力値です。\n- **trip_distance** - タクシーメーターで報告された移動距離(マイル)です。\n- **pickup_longitude, pickup_latitude** - タクシーメーターが倒されたTLC Taxiのゾーンです。\n- **rate_code_id** - 移動後に入力された最終的なレートコード:\u003cbr\u003e\n    - 1 = Standard rate\u003cbr\u003e\n    - 2 = JFK\u003cbr\u003e\n    - 3 = Newark\u003cbr\u003e\n    - 4 = Nassau or Westchester\u003cbr\u003e\n    - 5 = Negotiated fare\u003cbr\u003e\n    - 6 = Group ride\u003cbr\u003e\n- **store_and_fwd_flag** - このフラグはベンダーに送信する前に移動記録が車両のメモリーに登録されたかどうかを示します。自動車にサーバーに接続する能力がない場合にはメモリーに格納されます。「格納して転送」を意味します:\u003cbr\u003e\n    - Y= store and forward trip\u003cbr\u003e\n    - N= not a store and forward trip.\n- **dropoff_longitude, dropoff_latitude** - タクシーメーターが解除されたTLC Taxiゾーンです。\n- **payment_type** 乗客が移動に対してどの様に支払いを示したのかを示す数値のコードです:\u003cbr\u003e\n    - 1= Credit card\u003cbr\u003e\n    - 2= Cash\u003cbr\u003e\n    - 3= No charge\u003cbr\u003e\n    - 4= Dispute\u003cbr\u003e\n    - 5= Unknown\u003cbr\u003e\n    - 6= Voided trip\n- **fare_amount** - メーターによって計算された、時間と距離の料金です。\n- **extra** - 追加料金とサーチャージです。現在、これにラッシュアワーと深夜料金の`$0.50`と`$1`のみが含まれます。\n- **mta_tax** - 使用中のメーターレートに応じて`$0.50`のMTA税が自動で適用されます。\n- **tip_amount** – クレジットカードのチップがある場合に自動でこのフィールドが埋められます。現金のキャッシュは含まれません。\n- **tolls_amount** - 移動で支払われた通行料の総額です。Total amount of all tolls paid in trip.\n- **total_amount** - 乗客にチャージされた総額です。現金のチップは含まれません。\n\nこれらのフィールドに加えて、OSRMバックエンドサーバーから受け取る内容と一貫性がある形で、距離と時間の情報を提供するために2つのフィールド**trip_meters**と**trip_seconds**を計算しました。\n\n\n## Step 3: 移動ルートの取得\n\nNYC Taxiデータセットにはそれぞれの移動の開始地点と終了地点が記録されています。我々は正確なルートを知らないので、本日移動する際にベストなルートを特定するために、OSRMバックエンドサーバーの[*route* メソッド](http://project-osrm.org/docs/v5.5.1/api/#route-service)を使用することができます。これを有効化するために、それぞれの移動のピックアップ地点、降車地点の緯度経度を引き渡す関数を記述します。この関数は、OSRMバックエンドサーバーからのルートをリクエストし、結果のJSONドキュメントを返却するためにこのデータを使用します。\n\n### ルートを取得すための関数の定義\n\n```py:Python\n@fn.pandas_udf(StringType())\ndef get_osrm_route(\n  start_longitudes: pd.Series, \n  start_latitudes:pd.Series, \n  end_longitudes: pd.Series, \n  end_latitudes: pd.Series\n  ) -\u003e pd.Series:\n   \n  # combine inputs to form dataframe\n  df = pd.concat([start_longitudes, start_latitudes, end_longitudes, end_latitudes], axis=1)\n  df.columns = ['start_lon','start_lat','end_lon','end_lat']\n\n  # internal function to get route for a given row\n  def _route(row):\n    r = requests.get(\n      f'http://127.0.0.1:5000/route/v1/driving/{row.start_lon},{row.start_lat};{row.end_lon},{row.end_lat}?alternatives=true\u0026steps=false\u0026geometries=geojson\u0026overview=simplified\u0026annotations=false'\n    )\n    return r.text\n  \n  # apply routing function row by row\n  return df.apply(_route, axis=1)\n```\n\nこの関数を理解するためには、データフレームのデータがクラスターのワーカーノードの仮想コアに割り当てられたエグゼキューターに対して分散されるサブセット(パーティション)に分割されることに注意してください。(エグゼキューターの概念に関しては、IPアドレスを取得しているセクションの説明をご覧ください) この関数をSparkデータフレームに適用すると、データフレーム自身の並列性に基づき、それぞれのパーティションに並列で適用されます。\n\nこの関数に指定される引数を通じて、それぞれのパーティションから値を受け取ります。それぞれの引数はカラムにマッピングされ、それぞれのカラムから、値に対応する複数の行がそれぞれの引数のpandasのSeriesとして受け取ります。Seriesによって受け取られる値の数は、パーティションのサイズと設定 *spark.databricks.execution.pandasUDF.maxBatchesToPrefetch* に依存します。\n\nそれぞれのseriesの値は同じ順番でソートされます。これらのseriesを結合すると、パーティションにあるデータの行を際作成することができます。結果のpandasデータフレームのそれぞれの行に対して、OSRMバックエンドサーバーのローカルインスタンスにリクエストを行う内部で定義した関数を適用します。バックエンドサーバーはJSON文字列としてルーティング情報を返却します。このJSON文字列は、pandasデータフレームのそれぞれに対して返却され、返却された値の結果の文字列は、Sparkデータフレームに組み込むために外部関数からSparkエンジンに送信されます。\n\nユーザー定義関数(UDF)で定義されたそれぞれの引数に対するpandasのSeriesとして値のセットを受け取り、pandasのシリーズとして対応する結果セットを返却する、この全体的なパターンによって、この関数をpandasのSeries-to-Seriesユーザー定義関数にします。このタイプのpandas UDFに関しては[こちら](https://docs.databricks.com/spark/latest/spark-sql/udf-python-pandas.html)を参照ください。\n\n我々のデータにpandas UDFを適用するには、以下の様にシンプルに[*withColumn*](https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.DataFrame.withColumn.html)メソッド呼び出しのコンテキストでUDFを使用するだけです。\n\n### ルートの取得\n\n```py:Python\ndisplay(\n  nyc_taxi\n    .withColumn(\n      'osrm_route',\n      get_osrm_route('pickup_longitude','pickup_latitude','dropoff_longitude','dropoff_latitude')\n      )\n    .selectExpr(\n      'pickup_datetime',\n      'dropoff_datetime',\n      'pickup_longitude',\n      'pickup_latitude',\n      'dropoff_longitude',\n      'dropoff_latitude',\n      'osrm_route',\n      'fare_amount',\n      'trip_meters',\n      'trip_seconds'\n      )\n  )\n```\n![Screen Shot 2022-09-18 at 19.54.09.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/2fbb637f-b47e-e270-a214-5b7ca8d94835.png)\n\n関数呼び出しの結果はJSON文字列となります。pandas UDFはpandas UDFとSparkエンジンの間ですべての複雑な型をまとめる能力を持たないので、複雑なデータ型ではなく文字列を返却する様にしました。このため、文字列を複雑なデータ表現に変換する必要がある場合には、関数がこの処理を終えた後に行う必要があります。\n\n例えば、戻り値を希望の複雑な型に変換するために、文字列ベースのJSONスキーマの表現を指定し、このスキーマを引数として[*from_json*](https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.from_json.html#pyspark.sql.functions.from_json)を適用します。\n\n:::note\n**注意**\n従来のPySparkデータ型表現を用いてスキーマを定義したいのであれば、同様に動作する様子をこのノートブックの後半で説明しています。\n:::\n\n### ルートのJSONを複雑なデータ型表現に変換\n\n```py:Python\n# schema for the json document\nresponse_schema = '''\n  STRUCT\u003c\n    code: STRING, \n    routes: \n      ARRAY\u003c\n        STRUCT\u003c\n          distance: DOUBLE, \n          duration: DOUBLE, \n          geometry: STRUCT\u003c\n            coordinates: ARRAY\u003cARRAY\u003cDOUBLE\u003e\u003e, \n            type: STRING\n            \u003e, \n          legs: ARRAY\u003c\n            STRUCT\u003c\n              distance: DOUBLE, \n              duration: DOUBLE, \n              steps: ARRAY\u003cSTRING\u003e, \n              summary: STRING, \n              weight: DOUBLE\n              \u003e\n            \u003e, \n          weight: DOUBLE, \n          weight_name: STRING\n          \u003e\n        \u003e,\n      waypoints: ARRAY\u003c\n        STRUCT\u003c\n          distance: DOUBLE, \n          hint: STRING, \n          location: ARRAY\u003cDOUBLE\u003e, \n          name: STRING\n          \u003e\n        \u003e\n      \u003e\n  '''\n\n# retrieve routes and convert json to struct\nnyc_taxi_routes = (\n  nyc_taxi\n  .withColumn(\n    'osrm_route',\n    get_osrm_route('pickup_longitude','pickup_latitude','dropoff_longitude','dropoff_latitude')\n    )\n  .withColumn(\n    'osrm_route',\n    fn.from_json('osrm_route',response_schema)\n    )\n  .selectExpr(\n    'pickup_datetime',\n    'dropoff_datetime',\n    'osrm_route',\n    'trip_meters',\n    'trip_seconds'\n    )\n  )\n\n\ndisplay(\n  nyc_taxi_routes\n  )\n```\n![Screen Shot 2022-09-18 at 19.55.15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/a2413d00-294e-15e2-d161-672e13e6adf0.png)\n\nJSONドキュメントの構造はOSRMバックエンドサーバーによって定義されます。これらの要素はシンプルなドット表記参照で抽出することができます。\n\n:::note\n**注意**\nJSONドキュメント内では、ドキュメントあたり一つのルートのみ存在したとしても、ルートは配列として表現されます。[*explode*](https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.explode.html#pyspark.sql.functions.explode)関数は配列を展開し、配列のそれぞれの要素のフィールドの重複を発生させます。ルートの配列に1つのルートしかないので、この関数呼び出しはデータセットのサイズは増加しません。\n:::\n\n### ルートから距離と時間を取得\n\n```py:Python\ndisplay(\n   nyc_taxi_routes\n    .withColumn('route', fn.explode('osrm_route.routes'))\n    .withColumn('route_meters', fn.col('route.distance'))\n    .withColumn('route_seconds', fn.col('route.duration'))\n    .selectExpr(\n      'pickup_datetime',\n      'dropoff_datetime',\n      'trip_meters',\n      'route_meters',\n      'trip_seconds',\n      'route_seconds'\n      )\n  )\n```\n![Screen Shot 2022-09-18 at 19.56.08.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/52525cbb-e8b2-a562-9238-b47c12219f52.png)\n\n距離や時間のような属性に加え、OSRMバックエンドサーバーによって返却されるルート情報には[GeoJSON format](https://datatracker.ietf.org/doc/html/rfc7946)に準拠した*geometry*要素が含まれています。[Databricks Mosaic](https://databricks.com/blog/2022/05/02/high-scale-geospatial-processing-with-mosaic.html)ライブラリの[*st_geomfromgeojson*](https://databrickslabs.github.io/mosaic/api/geometry-constructors.html#st-geomfromgeojson) と[*st_aswkb*](https://databrickslabs.github.io/mosaic/api/geometry-accessors.html#st-aswkb)メソッドを用いることで、この要素を標準的な表現に変換します。\n\n### ルートジオメトリの取得\n\n```py:Python\nnyc_taxi_geometry = (\n  nyc_taxi_routes\n    .withColumn('route', fn.explode('osrm_route.routes')) # explode routes array\n    .withColumn('geojson', fn.to_json(fn.col('route.geometry')))\n    .withColumn('geom', mos.st_aswkb(mos.st_geomfromgeojson('geojson')))\n    .drop('osrm_route')\n  )\n\ndisplay(nyc_taxi_geometry)\n```\n![Screen Shot 2022-09-18 at 19.56.59.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/7e6e6e9b-49e0-47e6-025e-b15ff1e7a872.png)\n\nそして、我々のルートデータの情報の検証に役立てるために、[Kepler visualization](https://databrickslabs.github.io/mosaic/usage/kepler.html)を用いてこの標準ジオメトリを可視化することができます。\n\n:::note\n**注意**\n[*mosaic_kepler magic* command](https://databrickslabs.github.io/mosaic/usage/kepler.html)の構文は、*dataset* *column_name* *feature_type* \\[*row_limit*\\]です。表示結果の右上のトグルを用いて、可視化の調整を行うことができます。\n:::\n\n### ルートの可視化\n\n```py:Python\n%%mosaic_kepler\n\nnyc_taxi_geometry geom  geometry 5000\n```\n![Screen Shot 2022-09-18 at 19.58.03.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/a374e069-7bab-fe35-b095-76a19886efd9.png)\n\nしかし、もちろんですが、我々はOSRMバックエンドサーバーからルーティングデータを取得することに限定されません。我々のゴールがポイント間の移動の最適化であるのならば、移動時間のテーブルを作成する必要があるかもしれません。このためには、OSRMバックエンドサーバーの[*table* method](http://project-osrm.org/docs/v5.5.1/api/#table-service)を呼び出す関数を記述することができます。\n\n### ドライブ時間テーブルの取得\n\n```py:Python\n@fn.pandas_udf(StringType())\ndef get_driving_table(\n  points_arrays: pd.Series\n  ) -\u003e pd.Series:\n\n  # internal function to get table for points in an array\n  def _table(points_array):\n    \n    points = ';'.join(points_array)\n    \n    r = requests.get(\n      f'http://127.0.0.1:5000/table/v1/driving/{points}'\n    )\n    \n    return r.text\n  \n  # apply table function row by row\n  return points_arrays.apply(_table)\n```\n\nこの関数を呼び出すためにはポイントのコレクションを提供する必要があります。NYCタクシーデータはこれに適した良い方法を提供していませんので、勝手に1秒周期ですべてのポイントに取り込む必要があることにしましょう。\n\n:::note\n**注意**\nこの例の集計は、上で定義した*get_driving_table*関数にどの様に値を渡すのかをデモンストレーションするための、ある意味不自然なものとなっています。\n:::\n\n```py:Python\n# schema for driving table\nresponse_schema = StructType([\n  StructField('code',StringType()),\n  StructField('destinations',ArrayType(\n    StructType([\n      StructField('hint',StringType()),\n      StructField('distance',FloatType()),\n      StructField('name',StringType()),\n      StructField('location',ArrayType(FloatType()))\n      ])\n     )\n   ),\n  StructField('durations',ArrayType(ArrayType(FloatType()))),\n  StructField('sources',ArrayType(\n    StructType([\n      StructField('hint',StringType()),\n      StructField('distance',FloatType()),\n      StructField('name',StringType()),\n      StructField('location',ArrayType(FloatType()))\n      ])\n    ))\n  ])\n\n# retrieve driving table and extract matrix\ndriving_tables = (\n  nyc_taxi\n  .withColumn('pickup_point', fn.expr(\"concat(pickup_longitude,',',pickup_latitude)\"))\n  .withColumn('pickup_window', fn.expr(\"window(pickup_datetime, '1 SECONDS')\"))\n  .groupBy('pickup_window')\n    .agg(fn.collect_set('pickup_point').alias('pickup_points'))\n  .filter(fn.expr('size(pickup_points) \u003e 1')) # more than one point required for table\n  .withColumn('driving_table', get_driving_table('pickup_points'))\n  .withColumn('driving_table', fn.from_json('driving_table', response_schema))\n  .withColumn('driving_table_durations', fn.col('driving_table.durations'))\n  )  \n\ndisplay(driving_tables)\n```\n![Screen Shot 2022-09-18 at 19.59.42.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/dcb9a806-57f5-f5b0-4271-32004c640fb4.png)\n\nドライビングテーブルから抽出したマトリクスを検証する際には、ルーティングが異なる場合があるため、方向が異なる際は推定されたドライビング時間に対称性がないことに注意することが重要です。データセットから取得したマトリクスの一つを以下に示します。\n\n### 単一のドライビングテーブルの表示\n\n```py:Python\n# generate a single table\ndriving_table = driving_tables.limit(1).collect()[0]['driving_table_durations']\n\n# print driving table\nprint(\n    tabulate(\n      np.array(driving_table),\n      tablefmt='grid'\n      )\n    )\n```\n\n![Screen Shot 2022-09-18 at 20.00.28.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1168882/07522786-1539-deda-8998-4a760c1d8813.png)\n\nOSRMバックエンドサーバーの*route* と *table*メソッドはサーバーのREST API経由で利用できるメソッドの2つです。利用できるメソッドの完全なリストを以下に示します。\n\u003c/p\u003e\n\n* [route](http://project-osrm.org/docs/v5.5.1/api/#route-service) - 指定された順序の座標間で最も早いルートを見つけ出します\n* [nearest](http://project-osrm.org/docs/v5.5.1/api/#nearest-service) - 座標をストリートネットワークにスナップし、近傍のnマッチを返却します\n* [table](http://project-osrm.org/docs/v5.5.1/api/#table-service) - 指定された座標のすべてのペア間で最速のルートの時間を計算します\n* [match](http://project-osrm.org/docs/v5.5.1/api/#match-service) - 指定されたGPS地点を最も納得いく方法で道路のネットワークにスナップします\n* [trip](http://project-osrm.org/docs/v5.5.1/api/#trip-service) - 貪欲なヒューリスティック(farthest-insertion algorithm)を用いてセールスマン巡回問題を解きます\n* [tile](http://project-osrm.org/docs/v5.5.1/api/#tile-service) - ベクタータイルの能力を持つslippy-mapビューアーで参照可能なMapbox Vector Tileを生成します\n\nSparkデータフレームの処理過程でこれらにアクセスできる様にするには、上述した様にシンプルにHTTP REST API呼び出しを行うpandas UDFを構築し、文字列として結果のJSONを返却し、上の例で示した様に結果に対して適切なスキーマを適用するだけです。\n\n### Databricks 無料トライアル\n\n[Databricks 無料トライアル](https://databricks.com/jp/try-databricks)\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:03:44+09:00","group":null,"id":"5b2c2a601b8e66fb8af8","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"osrm","versions":[]},{"name":"Databricks","versions":[]}],"title":"ソリューションアクセラレータ：DatabricksとOSMRによるスケーラブルなルート生成(実践編)","updated_at":"2022-09-18T20:04:24+09:00","url":"https://qiita.com/taka_yayoi/items/5b2c2a601b8e66fb8af8","user":{"description":"Databricksのシニアソリューションアーキテクトです。こちらでDatabricks/Spark関連の情報をシェアできたらと考えています。","facebook_id":"takaaki.yayoi","followees_count":6,"followers_count":107,"github_login_name":"taka-yayoi","id":"taka_yayoi","items_count":715,"linkedin_id":"takaaki-yayoi","location":"Tokyo","name":"Takaaki Yayoi","organization":"Databricks","permanent_id":1168882,"profile_image_url":"https://lh3.googleusercontent.com/a-/AOh14GiHDumucs3o6fmzfrEsScv2xRCHlOlUpn5zNq5u=s50","team_only":false,"twitter_screen_name":"taka_aki","website_url":"https://databricks.com/jp/"},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-4:96\"\u003eいつもどんな内容をreturnしていますか？\u003cbr\u003e\nreturn $user;\u003cbr\u003e\nreturn \"登録しました\";\u003cbr\u003e\nこのように、何かしらの「結果」を返していることが多いと思います。\u003c/p\u003e\n\u003cp data-sourcepos=\"7:1-7:72\"\u003e以下は、お皿の数が足りているか確認する関数です。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"php\" data-sourcepos=\"8:1-24:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'9'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nf\"\u003eanswerFromIdo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"n\"\u003eanswerFromIdo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$less\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$less\u003c/span\u003e \u003cspan class=\"mf\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"枚足りなぃぃい！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"足りてる。\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// 出力結果\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"n\"\u003e枚足りなぃぃい\u003c/span\u003e\u003cspan class=\"err\"\u003e！\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"25:1-25:46\"\u003eなるほど、1枚足りないようです。\u003c/p\u003e\n\u003cp data-sourcepos=\"28:1-30:66\"\u003eif文の中で一度 \"$plateNumが10枚より少ないか\" を確認していますね。\u003cbr\u003e\n今回は10枚でしたが、次回は11枚数えないといけなくなるかもしれません。\u003cbr\u003e\n枚数が変わっても対応できるようにしましょう。\u003c/p\u003e\n\u003cp data-sourcepos=\"32:1-32:65\"\u003e今回の小技はこのif文内を関数にすることです。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"33:1-33:44\"\u003e\n\u003cspan id=\"本題--if文内の条件をreturnする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E9%A1%8C--if%E6%96%87%E5%86%85%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%82%92return%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本題 : if文内の条件をreturnする\u003c/h2\u003e\n\u003cp data-sourcepos=\"34:1-34:117\"\u003e\"用意したお皿が$num枚より少ないかどうか\"を関数にしてみると以下のようになります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"php\" data-sourcepos=\"36:1-41:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"n\"\u003echeckLessThanNum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"42:1-42:72\"\u003eこの関数を使用して、再度コーディングしてみます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"php\" data-sourcepos=\"43:1-64:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'10'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e'8'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eecho\u003c/span\u003e \u003cspan class=\"nf\"\u003eanswerFromIdo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"n\"\u003eanswerFromIdo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003echeckLessThanNum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e)){\u003c/span\u003e\n        \u003cspan class=\"nv\"\u003e$less\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$less\u003c/span\u003e \u003cspan class=\"mf\"\u003e.\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"枚足りなぃぃい！\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"足りてる。\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efunction\u003c/span\u003e \u003cspan class=\"n\"\u003echeckLessThanNum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$plateNum\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$needPlateNum\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// 出力結果\u003c/span\u003e\n\u003cspan class=\"n\"\u003e足りてる\u003c/span\u003e\u003cspan class=\"err\"\u003e。\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"65:1-65:90\"\u003e足りているようで安心しました。これで井戸も当分静かでしょう！\u003c/p\u003e\n\u003cp data-sourcepos=\"67:1-70:72\"\u003eif文内の条件をreturnすることで、どのような条件のif文なのか把握することができますね！\u003cbr\u003e\n私は英語が苦手なので、どのような状況か見当もつかなくなりそうですが\u003cbr\u003e\n他の人がわかるのならばこれでよしとしましょう！\u003cbr\u003e\nここまで読んでいただいてありがとうございました！\u003c/p\u003e\n","body":"いつもどんな内容をreturnしていますか？\nreturn $user;\nreturn \"登録しました\";\nこのように、何かしらの「結果」を返していることが多いと思います。\n\n\n以下は、お皿の数が足りているか確認する関数です。\n```php\n$plateNum = '9';\necho answerFromIdo($plateNum);\n\nfunction answerFromIdo($plateNum)\n{\n    if($plateNum \u003c 10){\n        $less = 10 - $plateNum;\n        return $less . \"枚足りなぃぃい！\";\n    } else {\n        return \"足りてる。\";\n    }\n}\n\n// 出力結果\n1枚足りなぃぃい！\n```\nなるほど、1枚足りないようです。\n\n\nif文の中で一度 \"$plateNumが10枚より少ないか\" を確認していますね。\n今回は10枚でしたが、次回は11枚数えないといけなくなるかもしれません。\n枚数が変わっても対応できるようにしましょう。\n\n今回の小技はこのif文内を関数にすることです。\n## 本題 : if文内の条件をreturnする\n\"用意したお皿が$num枚より少ないかどうか\"を関数にしてみると以下のようになります。\n\n```php\nfunction checkLessThanNum($plateNum, $needPlateNum)\n{\n    return $plateNum \u003c $needPlateNum;\n}\n```\nこの関数を使用して、再度コーディングしてみます。\n```php\n$plateNum = '10';\n$needPlateNum = '8';\necho answerFromIdo($plateNum, $needPlateNum);\n\nfunction answerFromIdo($plateNum, $needPlateNum)\n{\n    if(checkLessThanNum($plateNum, $needPlateNum)){\n        $less = $needPlateNum - $plateNum;\n        return $less . \"枚足りなぃぃい！\";\n    } else {\n        return \"足りてる。\";\n    }\n}\n\nfunction checkLessThanNum($plateNum, $needPlateNum)\n{\n    return $plateNum \u003c $needPlateNum;\n}\n// 出力結果\n足りてる。\n```\n足りているようで安心しました。これで井戸も当分静かでしょう！\n\nif文内の条件をreturnすることで、どのような条件のif文なのか把握することができますね！\n私は英語が苦手なので、どのような状況か見当もつかなくなりそうですが\n他の人がわかるのならばこれでよしとしましょう！\nここまで読んでいただいてありがとうございました！\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T20:00:46+09:00","group":null,"id":"1eda2144097d861e7e4f","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"PHP","versions":[]},{"name":"初心者","versions":[]}],"title":"【背伸び初心者授業③】returnの小技！if文内の条件をreturnする","updated_at":"2022-09-18T20:00:46+09:00","url":"https://qiita.com/h-san/items/1eda2144097d861e7e4f","user":{"description":null,"facebook_id":null,"followees_count":1,"followers_count":0,"github_login_name":null,"id":"h-san","items_count":11,"linkedin_id":null,"location":null,"name":"","organization":null,"permanent_id":2820657,"profile_image_url":"https://secure.gravatar.com/avatar/324c6358559f8bf3737eed63aed2072c","team_only":false,"twitter_screen_name":"suimin_irimasu","website_url":null},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-1:6\"\u003e未完\u003c/p\u003e\n\u003ch1 data-sourcepos=\"2:1-2:16\"\u003e\n\u003cspan id=\"pixelcnnとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pixelcnn%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePixelCNNとは\u003c/h1\u003e\n\u003cp data-sourcepos=\"3:1-3:312\"\u003ePixelCNNは\u003ca href=\"https://arxiv.org/abs/1601.06759\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePixel Recurrent Neural Networks\u003c/a\u003e (Aaron van den Oord)で発表された自己回帰型の生成モデルです。画像の右上から順にピクセルが並んでいると考えて、予測したいピクセルをより前のピクセルを基に予測します。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"5:1-5:18\"\u003e\n\u003cspan id=\"pixelcnnとは-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#pixelcnn%E3%81%A8%E3%81%AF-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePixelCNN++とは\u003c/h1\u003e\n\u003cp data-sourcepos=\"6:1-8:116\"\u003e概要\u003cbr\u003e\nPixelCNNは最近提案された扱いやすい尤度を持つ強力な生成モデルのクラスです。ここでは、\u003ca href=\"https://github.com/openai/pixel-cnn\" rel=\"nofollow noopener\" target=\"_blank\"\u003egithub\u003c/a\u003eで利用可能なPixelCNNの実装について述べます。私たちの実装は構造の単純化とパフォーマンス改善のため多くの修正を元のモデルに加えました。(1)学習のスピードを上げることが分かっている256-wayのソフトマックスでなく、離散混合ロジスティック尤度をピクセルに使います。(2)モデル構造を簡単にするため、R/G/Bのサブピクセルでなく、全てのピクセルで条件付けします。(3)複数の解像度の構造を効率的に捉えるためにダウンサンプリングを使います。(4)最適化をよりスピードアップするため追加のショートカットコネクションを導入します。(5)ドロップアウトを使ってモデルをregularizeします。\u003cbr\u003e\n最後にこれらの修正の有効性を示すためCIFAR-10の最新の対数尤度の結果を提示します。\u003c/p\u003e\n\u003cp data-sourcepos=\"10:1-11:134\"\u003e1、Introduction\u003cbr\u003e\nvan den Oordらによって提唱されたPixelCNNは扱いやすい尤度を持つ画像の生成モデルです。このモデルは\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"math\" data-sourcepos=\"12:1-14:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ep(x)= \\prod_{i}p(x_i|x_{\u0026lt;i})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"15:1-16:18\"\u003eとして、画像Xの確率密度関数を全てのサブピクセルに対して(カラーチャンネルも含む)完全に分解します。\u003cbr\u003e\n条件付き分布\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"math\" data-sourcepos=\"17:1-19:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ep(x_i|x_{\u0026lt;i})\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"20:1-20:1084\"\u003eはCNNでパラメータ化され、全てのパラメータを共有する。PixelCNNはこれらの条件付けのfunctional form がとても柔軟な強力なモデルである。加えて、観測された画像xに対し、GPUで全ての条件を並列に処理できるので、計算が効率的になる。これらのプロパティのおかげで、PixelCNNは、生成モデリングで対数尤度評価した際、現在のstate-of-the-artを示す。画像生成に使われる以外に、PixelCNNモデルは最近、オーディオ、ビデオ、テキストをモデル化するよう拡張された。私たちの研究に使用するため、PixelCNNの内部実装を発展し、構造を簡素化し、パフォーマンスを改善するため、ベースモデルに多くの修正を施した。コミュニティへ広がるように役立つ事を期待し、\u003ca href=\"https://github.com/openai/pixel-cnn\" rel=\"nofollow noopener\" target=\"_blank\"\u003egithub\u003c/a\u003eに実装を公開する。修正はsection2、評価実験はsection3で。state-of-the-artの対数尤度の結果は有用性を裏付けている。\u003c/p\u003e\n\u003cp data-sourcepos=\"22:1-23:152\"\u003e2 PixelCNNの修正\u003cbr\u003e\nvan den oordによって述べられたPixelCNNのモデルアーキテクチャに行った最も重要な修正を説明する。詳細はgithubへ。\u003c/p\u003e\n\u003cp data-sourcepos=\"25:1-26:1821\"\u003e2.1 離散混合ロジスティック尤度\u003cbr\u003e\n標準のPixelCNNモデルはサブピクセル、またはピクセルのカラーチャンネル条件付き分布をfull 256-way softmaxで指定する。これはモデルに多くの柔軟性をもたらすが、メモリのコストが多くかかる。さらに、特にトレーニングの初期にネットワークのパラメータに関する勾配をとてもまばらにできる。標準的なパラメタ化では、モデルは128が127や129に近い値であると知らないので、モデルをよりハイレベルの構造にする前に、この関係を初めに学習する。特定のサブピクセル値が観測されない極端な場合は、モデルは確率0を割り当てる事を学習する。これは通常の8bitよりも高い精度でピクセルが観察されたデータに特に問題になる。非常に高い精度で値が観測される極端な場合、現在の形式のPixelCNNは法外な量のメモリと計算が必要となるが、学習はとても遅い。したがって、観察された離散ピクセル値の条件付き確率を計算するため別のメカニズムを提案する。わたしたちのモデルではVAEのように、連続分布を持つ潜在color intensity v を仮定し、観測されたサブピクセル値xを与えるために最も近い8ビット表現に丸める。vのモデル化にシンプルな連続分布を選ぶ事で、(like the logistic distribution as done by Kingma et al.)xの滑らかでメモリ効率が良い予測分布を得る。ここで式(2)としてこの連続一変量分布を、観測された離散値xに対し確率を簡単に計算できる混合ロジスティック分布とする。0と255のエッジケースを除く全てのサブピクセル値xに対し、以下である。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"math\" data-sourcepos=\"27:1-30:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ev \\sim \\sum_{i=1}^K \\pi_illogistic(\\mu_i,s_i) (1) \\\\\nP(x|\\pi, \\mu, s) = \\sum_{i=1}^K \\pi_i[\\sigma((x+0.5-\\mu_i)/s_i) - \\sigma((x-0.5-\\mu_i)/s_i)](2)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"31:1-31:1400\"\u003eただし、$ \\sigma() $はロジスティックシグモイド関数である。エッジケース0は$ x-0.5 $を$ -\\infty $に、255は$ x+0.5 $を$ \\infty $に置き換える。コードには、(2) の確率の対数を計算するための数値的に安定した実装が含まれている。私たちのアプローチは連続混合モデルを使った以前の研究(Domke et al., 2008; Theis et al., 2012; Uria et al., 2013; Theis \u0026amp; Bethge, 2015)を踏まえているが、vをxへ丸める事を明示的にモデリングする事で、有効範囲[0,255]の外に確率質量を割り当てる事を回避する。加えてedge values0と255に隣接する値よりも、figure1に示すように観測されたデータ分布とよく一致する自然に高い確率を割り当てる。実験的に、正確にピクセルの条件付き分布をモデル化するためには比較的少ないmixture components (たとえば5)のみが必要とされる。よって、ネットワークのアウトプットはかなり低い次元で、パラメータに関して損失の勾配がより密集する事になる。実験では、最適化の間、特に学習の初期段階で収束がとても高速化した。しかし、pixelcnnと比べ、私たちのアーキテクチャは他にも変更があるため、これが元のpixelcnnにも当てはまるとは言えない。\u003c/p\u003e\n\u003cp data-sourcepos=\"33:1-33:264\"\u003efigure1 cifar-10の全てのサブピクセルの周辺分布。edge value 255は周辺値よりもかなり多い。これは、rounding based approach を使ってモデル化すると用意だが、連続または打ち切り分布を使うと困難になる。\u003c/p\u003e\n\u003cp data-sourcepos=\"35:1-36:1673\"\u003e2.2　ピクセル全体の条件付け\u003cbr\u003e\nカラー画像のピクセルはR,G,Bの色の強度から与えられる3つの実数からなる。元のpixelCNNはこれらの3つのサブピクセルに対し生成モデルを分解する。これはとても一般的な依存構造を許すが、モデルが複雑になる。feature mapの空間位置を追跡し続けるだけでなく、現在位置のR/G/Bのサブピクセルが見えるかによって、全てのfeature mapを3つのグループに分けなければならない。ピクセルのカラーチャンネル間の依存関係は比較的シンプルでモデル化に深いネットワークを必要としないように思えるので、この複雑さの追加は必要ないようである。したがって、代わりに画像の左上のピクセル全体のみを条件として、予測ピクセルの3チャンネルに対して結合予測分布を出力する。ピクセル自身の予測分布は、シンプルな分解されたモデルとして解釈できる。2.1で説明したように、離散混合ロジスティック分布を使って、初めにRチャンネルを予測する。次に、同様の形式の予測分布を使用して、Gチャンネルを予測する。ここで、混合成分の平均がRのサブピクセル値に線形依存する事を許可する。最後に同様にして、Bチャネルをモデル化する。ここでも、RとGチャンネルの線形依存のみを許可する。画像の(i,j)に位置するピクセル$(r_{i,j},g_{i,j},b_{i,j})$に対して、context$C_{i,j}$を条件とする分布は、混合指標と前のピクセルから構成せれ、次のようになる\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"math\" data-sourcepos=\"37:1-39:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eP(r_{i,j},g_{i,j},b_{i,j}|C_{i,j}) = \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"40:1-46:901\"\u003e$\\alpha, \\beta, \\gamma$のスカラー係数は混合成分と前のピクセルに依存する。\u003cbr\u003e\n混合インジケータは3つの全てのチャンネルで共有される。すなわち、私たちの生成モデルは、最初に混合インジケータをサンプリングし、次に対応する混合コンポーネントからカラーチャンネルを１つずつサンプリングする。ロジスティックの代わりに離散混合一変量ガウス分布をサブピクセルに使用すると、これは完全な共分散を持つ(離散)混合3次元ガウス分布を使って完全なピクセルを予測する事に相当する。ロジスティックとガウス分布はとても似ているので、これは私たちが最終的に行うことにとても近いものだ。詳細の完全な実装はgithub。\u003cbr\u003e\n2.3 ダウンサンプリングとdilated畳み込み\u003cbr\u003e\n元のpixelcnnは小さな受容野の畳み込みのみを使用する。このような畳み込みは局所的な依存性をキャプチャするのに良いが、広範囲の構造のモデル化には適さない。大抵はこれらの局所的な依存性をキャプチャすることで非常に優れた対数尤度を得るのに十分であることが分かるが(table 2)、モデルが広範囲の依存関係をキャプチャするように明示的に奨励する事で、生成画像の知覚的なクオリティを向上させることができる(fig3 compare fig5)。ネットワークが複数の解像度で構造をモデル化することを可能にする方法の一つは、Oordらが提案したdilated convolutionをモデルに導入することだ。ここでは、代わりにストライド2の畳み込みを使ってダウンサンプリングする事を提案する。ダウンサンプリングは、dilated convolutionsによって行われるのと同じ複数の解像度処理を成し遂げるが、計算コストは削減される。dilated convolutionが増加するサイズ(ゼロパディングのため)の入力に対して動作する場合、ダウンサンプリングは入力サイズを1/4に縮小する(ストライドが2で2次元)。ダウンサンプリングを使用することの欠点は情報の損失だが、次のセクションで述べるように、ネットワークに追加のショートカット接続を導入することでこれを補うことができる。これらの追加のショートカット接続により、ダウンサンプリングのパフォーマンスが膨張畳み込みと同じであることがわかった。\u003cbr\u003e\n2.4 ショートカットコネクションの追加\u003cbr\u003e\nサイズ32*32の入力には5 ResNet layerの6 blockから構成されるモデルが提案される。1番目と2番目のブロックの間、また2番目と3番目も同様にstrided convolutionによるサブサンプリングを行う。4番目と5番目、5番目と6番目のブロックの間で、transposed strided convolutionによって、アップサンプリングを行う。このサブサンプリングとアップサンプリングプロセスは情報を失うので、モデルの低レイヤから情報を復元するために、追加のショートカットコネクションをモデルに導入する。ショートカットコネクションは最初のブロックのResNet layerから6番目のブロックの対応するレイヤまで行われ、同様に2番目と5番目のブロック、3番目と4番目のブロックの間でも行われる。この構造はthe VAE model with top down inference used by Kingma et al. (2016), と　画像セグメンテーションのためのthe U-net used by Ronneberger et al. (2015) に似ている。Figure 2はモデル構造をグラフィカルに表す。\u003cbr\u003e\nFigure2:van den Oord et al. (2016c)のように、私たちのモデルはresidual connectionを持つ畳み込みアーキテクチャの2つのストリーム(downward, downward+rightward)に従う。しかし接続性には2つの大きな違いがある。初めに、私たちのアーキテクチャはダウンサンプリングとアップサンプリングを含むため、ネットワークの内部パーツはより大きなspatial scaleに対し働き、計算効率が向上する。次に、long-range skip-connectionを使うことで、それぞれのk番目のレイヤは直接入力を(K-k)番目のレイヤに提供する。ここで、Kはネットワークのレイヤの総数である。ネットワークは6レイヤのシーケンスにグループ化され、ほとんどのシーケンスはダウンサンプリングかアップサンプリングに分けられる。\u003c/p\u003e\n\u003cp data-sourcepos=\"48:1-49:813\"\u003e2.5 ドロップアウトを使ったREGULARIZATION\u003cbr\u003e\nPixelCNNモデルはトレーニングデータに過学習になるほどパワフルだ。さらにトレーニング画像を単に再生成するのでなく、過学習モデルは低いperceptual qualityの画像を生成することがわかった。Figure 8に示す。NNのregularizingする効果的な一つの方法はドロップアウトだ。私たちのモデルは最初の畳み込みの後のresidual pathに標準のバイナリドロップアウトを適用する。これはZagoruyko \u0026amp; Komodakis (2016)の幅広いresidual networksに適用されるドロップアウトを適用する方法に似ている。ドロップアウトを使うと過学習を避け、高品質の生成を行いながら、正常に高いキャパシティのモデルを学習できる。(figure 8と3を比較)\u003c/p\u003e\n","body":"未完\n# PixelCNNとは\nPixelCNNは[Pixel Recurrent Neural Networks](https://arxiv.org/abs/1601.06759) (Aaron van den Oord)で発表された自己回帰型の生成モデルです。画像の右上から順にピクセルが並んでいると考えて、予測したいピクセルをより前のピクセルを基に予測します。\n\n# PixelCNN++とは\n概要\nPixelCNNは最近提案された扱いやすい尤度を持つ強力な生成モデルのクラスです。ここでは、[github](https://github.com/openai/pixel-cnn)で利用可能なPixelCNNの実装について述べます。私たちの実装は構造の単純化とパフォーマンス改善のため多くの修正を元のモデルに加えました。(1)学習のスピードを上げることが分かっている256-wayのソフトマックスでなく、離散混合ロジスティック尤度をピクセルに使います。(2)モデル構造を簡単にするため、R/G/Bのサブピクセルでなく、全てのピクセルで条件付けします。(3)複数の解像度の構造を効率的に捉えるためにダウンサンプリングを使います。(4)最適化をよりスピードアップするため追加のショートカットコネクションを導入します。(5)ドロップアウトを使ってモデルをregularizeします。\n最後にこれらの修正の有効性を示すためCIFAR-10の最新の対数尤度の結果を提示します。\n\n1、Introduction\nvan den Oordらによって提唱されたPixelCNNは扱いやすい尤度を持つ画像の生成モデルです。このモデルは\n```math\np(x)= \\prod_{i}p(x_i|x_{\u003ci})\n```\nとして、画像Xの確率密度関数を全てのサブピクセルに対して(カラーチャンネルも含む)完全に分解します。\n条件付き分布\n```math\np(x_i|x_{\u003ci})\n```\nはCNNでパラメータ化され、全てのパラメータを共有する。PixelCNNはこれらの条件付けのfunctional form がとても柔軟な強力なモデルである。加えて、観測された画像xに対し、GPUで全ての条件を並列に処理できるので、計算が効率的になる。これらのプロパティのおかげで、PixelCNNは、生成モデリングで対数尤度評価した際、現在のstate-of-the-artを示す。画像生成に使われる以外に、PixelCNNモデルは最近、オーディオ、ビデオ、テキストをモデル化するよう拡張された。私たちの研究に使用するため、PixelCNNの内部実装を発展し、構造を簡素化し、パフォーマンスを改善するため、ベースモデルに多くの修正を施した。コミュニティへ広がるように役立つ事を期待し、[github](https://github.com/openai/pixel-cnn)に実装を公開する。修正はsection2、評価実験はsection3で。state-of-the-artの対数尤度の結果は有用性を裏付けている。\n\n2 PixelCNNの修正\nvan den oordによって述べられたPixelCNNのモデルアーキテクチャに行った最も重要な修正を説明する。詳細はgithubへ。\n\n2.1 離散混合ロジスティック尤度\n標準のPixelCNNモデルはサブピクセル、またはピクセルのカラーチャンネル条件付き分布をfull 256-way softmaxで指定する。これはモデルに多くの柔軟性をもたらすが、メモリのコストが多くかかる。さらに、特にトレーニングの初期にネットワークのパラメータに関する勾配をとてもまばらにできる。標準的なパラメタ化では、モデルは128が127や129に近い値であると知らないので、モデルをよりハイレベルの構造にする前に、この関係を初めに学習する。特定のサブピクセル値が観測されない極端な場合は、モデルは確率0を割り当てる事を学習する。これは通常の8bitよりも高い精度でピクセルが観察されたデータに特に問題になる。非常に高い精度で値が観測される極端な場合、現在の形式のPixelCNNは法外な量のメモリと計算が必要となるが、学習はとても遅い。したがって、観察された離散ピクセル値の条件付き確率を計算するため別のメカニズムを提案する。わたしたちのモデルではVAEのように、連続分布を持つ潜在color intensity v を仮定し、観測されたサブピクセル値xを与えるために最も近い8ビット表現に丸める。vのモデル化にシンプルな連続分布を選ぶ事で、(like the logistic distribution as done by Kingma et al.)xの滑らかでメモリ効率が良い予測分布を得る。ここで式(2)としてこの連続一変量分布を、観測された離散値xに対し確率を簡単に計算できる混合ロジスティック分布とする。0と255のエッジケースを除く全てのサブピクセル値xに対し、以下である。\n```math\nv \\sim \\sum_{i=1}^K \\pi_illogistic(\\mu_i,s_i) (1) \\\\\nP(x|\\pi, \\mu, s) = \\sum_{i=1}^K \\pi_i[\\sigma((x+0.5-\\mu_i)/s_i) - \\sigma((x-0.5-\\mu_i)/s_i)](2)\n```\nただし、$ \\sigma() $はロジスティックシグモイド関数である。エッジケース0は$ x-0.5 $を$ -\\infty $に、255は$ x+0.5 $を$ \\infty $に置き換える。コードには、(2) の確率の対数を計算するための数値的に安定した実装が含まれている。私たちのアプローチは連続混合モデルを使った以前の研究(Domke et al., 2008; Theis et al., 2012; Uria et al., 2013; Theis \u0026 Bethge, 2015)を踏まえているが、vをxへ丸める事を明示的にモデリングする事で、有効範囲[0,255]の外に確率質量を割り当てる事を回避する。加えてedge values0と255に隣接する値よりも、figure1に示すように観測されたデータ分布とよく一致する自然に高い確率を割り当てる。実験的に、正確にピクセルの条件付き分布をモデル化するためには比較的少ないmixture components (たとえば5)のみが必要とされる。よって、ネットワークのアウトプットはかなり低い次元で、パラメータに関して損失の勾配がより密集する事になる。実験では、最適化の間、特に学習の初期段階で収束がとても高速化した。しかし、pixelcnnと比べ、私たちのアーキテクチャは他にも変更があるため、これが元のpixelcnnにも当てはまるとは言えない。\n\nfigure1 cifar-10の全てのサブピクセルの周辺分布。edge value 255は周辺値よりもかなり多い。これは、rounding based approach を使ってモデル化すると用意だが、連続または打ち切り分布を使うと困難になる。\n\n2.2　ピクセル全体の条件付け\nカラー画像のピクセルはR,G,Bの色の強度から与えられる3つの実数からなる。元のpixelCNNはこれらの3つのサブピクセルに対し生成モデルを分解する。これはとても一般的な依存構造を許すが、モデルが複雑になる。feature mapの空間位置を追跡し続けるだけでなく、現在位置のR/G/Bのサブピクセルが見えるかによって、全てのfeature mapを3つのグループに分けなければならない。ピクセルのカラーチャンネル間の依存関係は比較的シンプルでモデル化に深いネットワークを必要としないように思えるので、この複雑さの追加は必要ないようである。したがって、代わりに画像の左上のピクセル全体のみを条件として、予測ピクセルの3チャンネルに対して結合予測分布を出力する。ピクセル自身の予測分布は、シンプルな分解されたモデルとして解釈できる。2.1で説明したように、離散混合ロジスティック分布を使って、初めにRチャンネルを予測する。次に、同様の形式の予測分布を使用して、Gチャンネルを予測する。ここで、混合成分の平均がRのサブピクセル値に線形依存する事を許可する。最後に同様にして、Bチャネルをモデル化する。ここでも、RとGチャンネルの線形依存のみを許可する。画像の(i,j)に位置するピクセル$(r_{i,j},g_{i,j},b_{i,j})$に対して、context$C_{i,j}$を条件とする分布は、混合指標と前のピクセルから構成せれ、次のようになる\n```math\nP(r_{i,j},g_{i,j},b_{i,j}|C_{i,j}) = \n```\n$\\alpha, \\beta, \\gamma$のスカラー係数は混合成分と前のピクセルに依存する。\n混合インジケータは3つの全てのチャンネルで共有される。すなわち、私たちの生成モデルは、最初に混合インジケータをサンプリングし、次に対応する混合コンポーネントからカラーチャンネルを１つずつサンプリングする。ロジスティックの代わりに離散混合一変量ガウス分布をサブピクセルに使用すると、これは完全な共分散を持つ(離散)混合3次元ガウス分布を使って完全なピクセルを予測する事に相当する。ロジスティックとガウス分布はとても似ているので、これは私たちが最終的に行うことにとても近いものだ。詳細の完全な実装はgithub。\n2.3 ダウンサンプリングとdilated畳み込み\n元のpixelcnnは小さな受容野の畳み込みのみを使用する。このような畳み込みは局所的な依存性をキャプチャするのに良いが、広範囲の構造のモデル化には適さない。大抵はこれらの局所的な依存性をキャプチャすることで非常に優れた対数尤度を得るのに十分であることが分かるが(table 2)、モデルが広範囲の依存関係をキャプチャするように明示的に奨励する事で、生成画像の知覚的なクオリティを向上させることができる(fig3 compare fig5)。ネットワークが複数の解像度で構造をモデル化することを可能にする方法の一つは、Oordらが提案したdilated convolutionをモデルに導入することだ。ここでは、代わりにストライド2の畳み込みを使ってダウンサンプリングする事を提案する。ダウンサンプリングは、dilated convolutionsによって行われるのと同じ複数の解像度処理を成し遂げるが、計算コストは削減される。dilated convolutionが増加するサイズ(ゼロパディングのため)の入力に対して動作する場合、ダウンサンプリングは入力サイズを1/4に縮小する(ストライドが2で2次元)。ダウンサンプリングを使用することの欠点は情報の損失だが、次のセクションで述べるように、ネットワークに追加のショートカット接続を導入することでこれを補うことができる。これらの追加のショートカット接続により、ダウンサンプリングのパフォーマンスが膨張畳み込みと同じであることがわかった。\n2.4 ショートカットコネクションの追加\nサイズ32*32の入力には5 ResNet layerの6 blockから構成されるモデルが提案される。1番目と2番目のブロックの間、また2番目と3番目も同様にstrided convolutionによるサブサンプリングを行う。4番目と5番目、5番目と6番目のブロックの間で、transposed strided convolutionによって、アップサンプリングを行う。このサブサンプリングとアップサンプリングプロセスは情報を失うので、モデルの低レイヤから情報を復元するために、追加のショートカットコネクションをモデルに導入する。ショートカットコネクションは最初のブロックのResNet layerから6番目のブロックの対応するレイヤまで行われ、同様に2番目と5番目のブロック、3番目と4番目のブロックの間でも行われる。この構造はthe VAE model with top down inference used by Kingma et al. (2016), と　画像セグメンテーションのためのthe U-net used by Ronneberger et al. (2015) に似ている。Figure 2はモデル構造をグラフィカルに表す。\nFigure2:van den Oord et al. (2016c)のように、私たちのモデルはresidual connectionを持つ畳み込みアーキテクチャの2つのストリーム(downward, downward+rightward)に従う。しかし接続性には2つの大きな違いがある。初めに、私たちのアーキテクチャはダウンサンプリングとアップサンプリングを含むため、ネットワークの内部パーツはより大きなspatial scaleに対し働き、計算効率が向上する。次に、long-range skip-connectionを使うことで、それぞれのk番目のレイヤは直接入力を(K-k)番目のレイヤに提供する。ここで、Kはネットワークのレイヤの総数である。ネットワークは6レイヤのシーケンスにグループ化され、ほとんどのシーケンスはダウンサンプリングかアップサンプリングに分けられる。\n\n2.5 ドロップアウトを使ったREGULARIZATION\nPixelCNNモデルはトレーニングデータに過学習になるほどパワフルだ。さらにトレーニング画像を単に再生成するのでなく、過学習モデルは低いperceptual qualityの画像を生成することがわかった。Figure 8に示す。NNのregularizingする効果的な一つの方法はドロップアウトだ。私たちのモデルは最初の畳み込みの後のresidual pathに標準のバイナリドロップアウトを適用する。これはZagoruyko \u0026 Komodakis (2016)の幅広いresidual networksに適用されるドロップアウトを適用する方法に似ている。ドロップアウトを使うと過学習を避け、高品質の生成を行いながら、正常に高いキャパシティのモデルを学習できる。(figure 8と3を比較)\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T19:47:19+09:00","group":null,"id":"a6682dea8ee9fb1487af","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"機械学習","versions":[]},{"name":"ImageGeneration","versions":[]},{"name":"PixelCNN++","versions":[]}],"title":"PixelCNNの論文メモ","updated_at":"2022-09-18T19:47:19+09:00","url":"https://qiita.com/yamayamma/items/a6682dea8ee9fb1487af","user":{"description":"python, pytorchで機械学習の画像生成。swiftの勉強してます。","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":"yamayamma","id":"yamayamma","items_count":2,"linkedin_id":"","location":"滋賀県","name":"","organization":"","permanent_id":2815034,"profile_image_url":"https://avatars.githubusercontent.com/u/69559726?v=4","team_only":false,"twitter_screen_name":"yama_yamma_","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch2 data-sourcepos=\"1:1-1:21\"\u003e\n\u003cspan id=\"１はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%91%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e１．はじめに\u003c/h2\u003e\n\u003cp data-sourcepos=\"3:1-9:74\"\u003eOpen CVを使って画像を回転させるとき、\u003cbr\u003e\n・アフィン変換\u003cbr\u003e\n　dst_img = cv2.warpAffine(src_img, Mat, (width, height))\u003cbr\u003e\n・射影変換\u003cbr\u003e\n　dst_img = cv2.warpPerspective(src_img, Mat, (width, height))\u003cbr\u003e\nという、よく似た2通りのやり方がある。\u003cbr\u003e\n（実は他にもあるかもしれないが、筆者は知らない）\u003c/p\u003e\n\u003cp data-sourcepos=\"11:1-16:56\"\u003e形の上での違いは、アフィン変換は変換行列が2×3であるのに対して、射影変換は3×3であること。\u003cbr\u003e\nこれは、アフィン変換行列を求める\u003cbr\u003e\n　Mat = getAffineTransform(src_points, dst_points)\u003cbr\u003e\nが3点→3点の対応であるのに対し、射影変換の変換行列を求める\u003cbr\u003e\n　Mat = getPerspectiveTransform(src_points, dst_points)\u003cbr\u003e\nが4点→4点の対応であることと符合する。\u003c/p\u003e\n\u003cp data-sourcepos=\"18:1-21:45\"\u003e厳密性を犠牲にすれば、\u003cbr\u003e\n・アフィン変換は矩形を平行四辺形に移す変換（あるいはその逆）\u003cbr\u003e\n・射影変換は矩形を任意の四角形に移す変換（あるいはその逆）\u003cbr\u003e\nと考えれば感覚的に理解できる。\u003c/p\u003e\n\u003cp data-sourcepos=\"23:1-23:171\"\u003e単なる回転を考える場合はどちらでも構わないように思うが、どちらの処理が速いか、実際に処理時間を測定して調べてみる。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"25:1-25:15\"\u003e\n\u003cspan id=\"２実装\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%92%E5%AE%9F%E8%A3%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e２．実装\u003c/h2\u003e\n\u003ch3 data-sourcepos=\"26:1-26:16\"\u003e\n\u003cspan id=\"21準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#21%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.1　準備\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"29:1-34:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecv2\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003ematplotlib\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003epyplot\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\n\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003ematplotlib\u003c/span\u003e \u003cspan class=\"n\"\u003einline\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"37:1-42:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# OpenCVの画像を画面表示する関数\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eshow_img_cv2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_cv2\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eimg_RGB\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecvtColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_cv2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLOR_BGR2RGB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eplt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimshow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_RGB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"45:1-51:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# 処理の対象となる画像をread\n\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'img/lenna.png'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[:\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e'heit: \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e  width: \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eshow_img_cv2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"53:5-56:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eheit: 512  width: 512\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"57:2-57:122\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/2b8ff8e39d50134aec5d708e512655d8aaca0278/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323633302f35653130376663382d376264382d646261312d656337372d3835323739633130656234362e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352630%2F5e107fc8-7bd8-dba1-ec77-85279c10eb46.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=36eb5f896a078d78028fd274631ffe02\" alt=\"lenna.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/5e107fc8-7bd8-dba1-ec77-85279c10eb46.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352630%2F5e107fc8-7bd8-dba1-ec77-85279c10eb46.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e4b62a7449a9c941a7fe7ca305a70ab8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"62:1-62:74\"\u003e\n\u003cspan id=\"22アフィン変換cv2warpaffineを使って画像を回転\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#22%E3%82%A2%E3%83%95%E3%82%A3%E3%83%B3%E5%A4%89%E6%8F%9Bcv2warpaffine%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E7%94%BB%E5%83%8F%E3%82%92%E5%9B%9E%E8%BB%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.2　アフィン変換：cv2.warpAffine()を使って画像を回転\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"65:1-72:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emat1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetRotationMatrix2D\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e300\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'アフィン行列：'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emat1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003erotated_img1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewarpAffine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emat1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'affine_img.png'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erotated_img1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eshow_img_cv2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erotated_img1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"74:5-77:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003eアフィン行列：\n[[  0.98480775   0.17364818 -30.17196144]\n [ -0.17364818   0.98480775  55.1329027 ]]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"78:1-78:126\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/b503355c4305c69316cc42239049bdc121740b71/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323633302f65633062363336642d306637392d303434382d303363392d3734343566346563663836372e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352630%2Fec0b636d-0f79-0448-03c9-7445f4ecf867.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b008c7752df869cb8db863632b7ad9b2\" alt=\"affine_img.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/ec0b636d-0f79-0448-03c9-7445f4ecf867.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352630%2Fec0b636d-0f79-0448-03c9-7445f4ecf867.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0ec35bd8ffd02e8713b8bd79fa236dfd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch3 data-sourcepos=\"84:1-84:73\"\u003e\n\u003cspan id=\"23射影変換cv2warpperspectiveを使って画像を回転\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#23%E5%B0%84%E5%BD%B1%E5%A4%89%E6%8F%9Bcv2warpperspective%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E7%94%BB%E5%83%8F%E3%82%92%E5%9B%9E%E8%BB%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.3　射影変換：cv2.warpPerspective()を使って画像を回転\u003c/h3\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"87:1-94:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003emat2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econcatenate\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003emat1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e([[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]])],\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'射影変換行列：'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emat2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003erotated_img2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewarpPerspective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emat2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'perspected_img.png'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erotated_img2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"n\"\u003eshow_img_cv2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erotated_img2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"96:5-102:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e射影変換行列：\n[[  0.98480775   0.17364818 -30.17196144]\n [ -0.17364818   0.98480775  55.1329027 ]\n [  0.           0.           1.        ]]\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"103:1-103:130\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/2b8af2c5ea35bf8355afb1e37beb4a2004024660/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3335323633302f39366434636564332d623766642d633265312d323030632d6531653436663231646665342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352630%2F96d4ced3-b7fd-c2e1-200c-e1e46f21dfe4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=760e1a65de51303ab81b4abb6af7b746\" alt=\"perspected_img.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/96d4ced3-b7fd-c2e1-200c-e1e46f21dfe4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F352630%2F96d4ced3-b7fd-c2e1-200c-e1e46f21dfe4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=becb83060f7e80e38db55fd2c89f19ff 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch4 data-sourcepos=\"107:1-107:80\"\u003e\n\u003cspan id=\"アフィン変換射影変換で同じ回転画像が得られた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%95%E3%82%A3%E3%83%B3%E5%A4%89%E6%8F%9B%E5%B0%84%E5%BD%B1%E5%A4%89%E6%8F%9B%E3%81%A7%E5%90%8C%E3%81%98%E5%9B%9E%E8%BB%A2%E7%94%BB%E5%83%8F%E3%81%8C%E5%BE%97%E3%82%89%E3%82%8C%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアフィン変換、射影変換で、同じ回転画像が得られた。\u003c/h4\u003e\n\u003ch3 data-sourcepos=\"109:1-109:31\"\u003e\n\u003cspan id=\"24処理時間の比較\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#24%E5%87%A6%E7%90%86%E6%99%82%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e2.4　処理時間の比較\u003c/h3\u003e\n\u003cp data-sourcepos=\"110:1-110:110\"\u003etimeitモジュールを使って、10000回ずつ処理を繰り返した際の平均処理時間を求める\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"113:1-122:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etimeit\u003c/span\u003e\n\u003cspan class=\"n\"\u003eloop\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000\u003c/span\u003e\n\u003cspan class=\"n\"\u003eresult1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimeit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewarpAffine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emat1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e'warpAffine : \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eresult1\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003eresult2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimeit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etimeit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003elambda\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewarpPerspective\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emat2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e'warpPerspective : \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eresult2\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"n\"\u003eloop\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"124:5-127:0\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003ewarpAffine : 0.0010326173099980225\nwarpPerspective : 0.0012882464599970262\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"128:1-128:15\"\u003e\n\u003cspan id=\"３結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%EF%BC%93%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e３．結論\u003c/h2\u003e\n\u003ch4 data-sourcepos=\"129:1-129:64\"\u003e\n\u003cspan id=\"warpperspectiveはwarpaffineに比べると少し遅い\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#warpperspective%E3%81%AFwarpaffine%E3%81%AB%E6%AF%94%E3%81%B9%E3%82%8B%E3%81%A8%E5%B0%91%E3%81%97%E9%81%85%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ewarpPerspective()はwarpAffine()に比べると少し遅い\u003c/h4\u003e\n","body":"## １．はじめに\n\nOpen CVを使って画像を回転させるとき、  \n・アフィン変換  \n　dst_img = cv2.warpAffine(src_img, Mat, (width, height))  \n・射影変換  \n　dst_img = cv2.warpPerspective(src_img, Mat, (width, height))  \nという、よく似た2通りのやり方がある。  \n（実は他にもあるかもしれないが、筆者は知らない）  \n\n形の上での違いは、アフィン変換は変換行列が2×3であるのに対して、射影変換は3×3であること。  \nこれは、アフィン変換行列を求める  \n　Mat = getAffineTransform(src_points, dst_points)   \nが3点→3点の対応であるのに対し、射影変換の変換行列を求める  \n　Mat = getPerspectiveTransform(src_points, dst_points)  \nが4点→4点の対応であることと符合する。\n  \n厳密性を犠牲にすれば、  \n・アフィン変換は矩形を平行四辺形に移す変換（あるいはその逆）  \n・射影変換は矩形を任意の四角形に移す変換（あるいはその逆）  \nと考えれば感覚的に理解できる。\n  \n単なる回転を考える場合はどちらでも構わないように思うが、どちらの処理が速いか、実際に処理時間を測定して調べてみる。\n\n## ２．実装\n### 2.1　準備\n\n\n```python\nimport cv2\nimport numpy as np\nfrom matplotlib import pyplot as plt\n%matplotlib inline\n```\n\n\n```python\n# OpenCVの画像を画面表示する関数\ndef show_img_cv2(img_cv2):\n    img_RGB = cv2.cvtColor(img_cv2, cv2.COLOR_BGR2RGB)\n    plt.imshow(img_RGB)\n```\n\n\n```python\n# 処理の対象となる画像をread\nimg = cv2.imread('img/lenna.png')\nh, w = img.shape[:2]\nprint(f'heit: {h}  width: {w}')\nshow_img_cv2(img)\n```\n\n    heit: 512  width: 512\n\n\n\n ![lenna.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/5e107fc8-7bd8-dba1-ec77-85279c10eb46.png)\n\n    \n\n\n### 2.2　アフィン変換：cv2.warpAffine()を使って画像を回転\n\n\n```python\nmat1 = cv2.getRotationMatrix2D((300, 200), 10, 1)\nprint('アフィン行列：')\nprint(mat1)\nrotated_img1 = cv2.warpAffine(img, mat1, (w, h))\ncv2.imwrite('affine_img.png', rotated_img1)\nshow_img_cv2(rotated_img1)\n```\n\n    アフィン行列：\n    [[  0.98480775   0.17364818 -30.17196144]\n     [ -0.17364818   0.98480775  55.1329027 ]]\n\n![affine_img.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/ec0b636d-0f79-0448-03c9-7445f4ecf867.png)\n  \n\n    \n\n\n### 2.3　射影変換：cv2.warpPerspective()を使って画像を回転\n\n\n```python\nmat2 = np.concatenate([mat1, np.array([[0, 0, 1]])], 0)\nprint('射影変換行列：')\nprint(mat2)\nrotated_img2 = cv2.warpPerspective(img, mat2, (w, h))\ncv2.imwrite('perspected_img.png', rotated_img2)\nshow_img_cv2(rotated_img2)\n```\n\n    射影変換行列：\n    [[  0.98480775   0.17364818 -30.17196144]\n     [ -0.17364818   0.98480775  55.1329027 ]\n     [  0.           0.           1.        ]]\n\n\n   \n![perspected_img.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/96d4ced3-b7fd-c2e1-200c-e1e46f21dfe4.png)\n    \n\n\n#### アフィン変換、射影変換で、同じ回転画像が得られた。\n\n### 2.4　処理時間の比較\ntimeitモジュールを使って、10000回ずつ処理を繰り返した際の平均処理時間を求める\n\n\n```python\nimport timeit\nloop = 10000\nresult1 = timeit.timeit(lambda: cv2.warpAffine(img, mat1, (w, h)), number=loop)\nprint(f'warpAffine : {result1 / loop}')\n\nresult2 = timeit.timeit(lambda: cv2.warpPerspective(img, mat2, (w, h)), number=loop)\nprint(f'warpPerspective : {result2 / loop}')\n\n```\n\n    warpAffine : 0.0010326173099980225\n    warpPerspective : 0.0012882464599970262\n\n\n## ３．結論\n#### warpPerspective()はwarpAffine()に比べると少し遅い\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T19:45:49+09:00","group":null,"id":"d80e54a7e52d32e38b82","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"OpenCV","versions":[]},{"name":"回転","versions":[]},{"name":"射影変換","versions":[]},{"name":"アフィン変換","versions":[]}],"title":"アフィン変換・射影変換の処理時間比較","updated_at":"2022-09-18T19:45:49+09:00","url":"https://qiita.com/turkey1212/items/d80e54a7e52d32e38b82","user":{"description":"とうの昔に旬を過ぎた中年SEですが、まだまだ好奇心も向上心も旺盛。  \r\nJDLA G検定2017#1／E資格2019#1。\r\nAI Quest 2020(by 経済産業省) 修了(2期生)。  \r\nAWSのSAA(C02)を取得(2021年11月)。\r\n趣味は30年以上続けているボウリング。","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"turkey1212","items_count":2,"linkedin_id":"","location":"","name":"turkey1212","organization":"","permanent_id":352630,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/352630/profile-images/1645857521","team_only":false,"twitter_screen_name":"fatmank300","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:8\"\u003e\n\u003cspan id=\"目的\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E7%9A%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目的\u003c/h1\u003e\n\u003cp data-sourcepos=\"2:1-4:160\"\u003eこちらの記事を投稿しようと考えた目的は、2点あります。\u003cbr\u003e\n1つ目は、チーム開発する上で他の人のことを考えてコードを書く必要があることを再認識したから。\u003cbr\u003e\n2つ目は、今後新たに開発に加わるメンバーのために読みやすいコードを書き、コードを読むコストを減らしたいから。\u003c/p\u003e\n\u003cp data-sourcepos=\"6:1-6:165\"\u003e以上のことから、新米iOSエンジニアの僕がリーダブルコードを読んで各章を簡潔にまとめて不定期でアップしていきます。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"8:1-8:37\"\u003e\n\u003cspan id=\"第1章理解しやすいコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AC%AC1%E7%AB%A0%E7%90%86%E8%A7%A3%E3%81%97%E3%82%84%E3%81%99%E3%81%84%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e第1章:理解しやすいコード\u003c/h1\u003e\n\u003ch2 data-sourcepos=\"9:1-9:9\"\u003e\n\u003cspan id=\"概要\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e概要\u003c/h2\u003e\n\u003cp data-sourcepos=\"10:1-10:187\"\u003e理解しやすいコードに関する根本的な考え方を解説していて、5ページほどで本書を読む上で大事な概念を説明してくれている印象でした。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"12:1-12:13\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h3\u003e\n\u003cp data-sourcepos=\"13:1-15:102\"\u003e・コードは理解しやすくあるべき、かつ他の人が読んでも最短時間で理解できるように書かなければならない。\u003cbr\u003e\n・コードは、短い方がいいがその「短い方がいい」という本質的な意味は、コードを理解する時間が「短い方がいい」という意味で、単に記述されたコードの長さが「短い方がいい」ということではない。\u003cbr\u003e\n・「このコードは理解しやすいだろうか」と自問自答して開発に挑むべき。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"17:1-17:16\"\u003e\n\u003cspan id=\"学んだ点\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AD%A6%E3%82%93%E3%81%A0%E7%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e学んだ点\u003c/h3\u003e\n\u003cp data-sourcepos=\"18:1-19:378\"\u003e・読みやすいコードを書くための根本的な考えは、「コードは理解しやすくなくてはならない」ということ\u003cbr\u003e\n・コードに「簡潔」を求めるのか「安心」を求めるのかを考え直す必要がある。すなわち、コードは、「安心」して読む事ができるものであるべきで、必ずしもコードが「簡潔」であれば読みやすいとは限らないことの理解がまずは必要。短くても理解しにくければ意味がないこと\u003c/p\u003e\n\u003ch3 data-sourcepos=\"21:1-21:25\"\u003e\n\u003cspan id=\"感想と振り返り\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3%E3%81%A8%E6%8C%AF%E3%82%8A%E8%BF%94%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想と振り返り\u003c/h3\u003e\n\u003cp data-sourcepos=\"22:1-24:105\"\u003e第1章で大事だと感じたことは、「個人開発では深く考えなくてもよかったことでも、チーム開発では考慮する点が多い」ということ。ここから業務に活かせるなと感じたことは、「このコードは誰から読んでも同じように理解できるか」ということを考えてコードを書くことです。最近、先輩にレビューしていただいているが、レビューするにも時間をもらっているので負担のないように最低限考慮してプルリクしないといけないと感じました。\u003cbr\u003e\nビギナーの今の時点で、この考えを植え付けておけて良かったです。\u003cbr\u003e\n引き続き、リーダブルコードを読みつつ、開発関連の学習も行っていきます！\u003c/p\u003e\n","body":"# 目的\nこちらの記事を投稿しようと考えた目的は、2点あります。\n1つ目は、チーム開発する上で他の人のことを考えてコードを書く必要があることを再認識したから。\n2つ目は、今後新たに開発に加わるメンバーのために読みやすいコードを書き、コードを読むコストを減らしたいから。\n\n以上のことから、新米iOSエンジニアの僕がリーダブルコードを読んで各章を簡潔にまとめて不定期でアップしていきます。\n\n# 第1章:理解しやすいコード\n## 概要\n理解しやすいコードに関する根本的な考え方を解説していて、5ページほどで本書を読む上で大事な概念を説明してくれている印象でした。\n\n### まとめ\n・コードは理解しやすくあるべき、かつ他の人が読んでも最短時間で理解できるように書かなければならない。\n・コードは、短い方がいいがその「短い方がいい」という本質的な意味は、コードを理解する時間が「短い方がいい」という意味で、単に記述されたコードの長さが「短い方がいい」ということではない。\n・「このコードは理解しやすいだろうか」と自問自答して開発に挑むべき。\n\n### 学んだ点\n・読みやすいコードを書くための根本的な考えは、「コードは理解しやすくなくてはならない」ということ\n・コードに「簡潔」を求めるのか「安心」を求めるのかを考え直す必要がある。すなわち、コードは、「安心」して読む事ができるものであるべきで、必ずしもコードが「簡潔」であれば読みやすいとは限らないことの理解がまずは必要。短くても理解しにくければ意味がないこと\n\n### 感想と振り返り\n第1章で大事だと感じたことは、「個人開発では深く考えなくてもよかったことでも、チーム開発では考慮する点が多い」ということ。ここから業務に活かせるなと感じたことは、「このコードは誰から読んでも同じように理解できるか」ということを考えてコードを書くことです。最近、先輩にレビューしていただいているが、レビューするにも時間をもらっているので負担のないように最低限考慮してプルリクしないといけないと感じました。\nビギナーの今の時点で、この考えを植え付けておけて良かったです。\n引き続き、リーダブルコードを読みつつ、開発関連の学習も行っていきます！\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T19:43:08+09:00","group":null,"id":"71440868ed5d5cbdc8d1","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Beginner","versions":[]},{"name":"development","versions":[]},{"name":"Swift","versions":[]}],"title":"リーダブルコードまとめ(第1章)","updated_at":"2022-09-18T19:43:08+09:00","url":"https://qiita.com/neppana_developer/items/71440868ed5d5cbdc8d1","user":{"description":"","facebook_id":"","followees_count":1,"followers_count":0,"github_login_name":null,"id":"neppana_developer","items_count":1,"linkedin_id":"","location":"大阪","name":"neppashi","organization":"","permanent_id":2630898,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2630898/profile-images/1663497777","team_only":false,"twitter_screen_name":"nyannyanintokyo","website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003ch1 data-sourcepos=\"1:1-1:8\"\u003e\n\u003cspan id=\"目的\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%9B%AE%E7%9A%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e目的\u003c/h1\u003e\n\u003cp data-sourcepos=\"3:1-3:301\"\u003e顔認識のため、適当な画像を集めたかったです。過去にYahoo画像検索からスクレイピングしたスクリプトを再度動かそうとしましたが、Yahoo画像検索のページやライブラリが変わっていたので、改めてメモを作り直しました。\u003c/p\u003e\n\u003cp data-sourcepos=\"5:1-5:111\"\u003e今回はハーフタレントの画像を集めてみました。顔認識した話は別途記載します。\u003c/p\u003e\n\u003ch1 data-sourcepos=\"7:1-7:8\"\u003e\n\u003cspan id=\"内容\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%86%85%E5%AE%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e内容\u003c/h1\u003e\n\u003col data-sourcepos=\"8:1-13:0\"\u003e\n\u003cli data-sourcepos=\"8:1-11:0\"\u003e\n\u003cp data-sourcepos=\"8:4-8:34\"\u003eスクレイピング\u0026amp;顔検出\u003c/p\u003e\n\u003cul data-sourcepos=\"9:4-11:0\"\u003e\n\u003cli data-sourcepos=\"9:4-9:41\"\u003e画像検索のスクレイピング\u003c/li\u003e\n\u003cli data-sourcepos=\"10:4-11:0\"\u003eスクレイピング結果から顔検出してサイズを揃えて保存\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli data-sourcepos=\"12:1-13:0\"\u003e\n\u003cp data-sourcepos=\"12:4-12:63\"\u003e顔画像たちを目視で確認しながらラベル付け\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 data-sourcepos=\"14:1-14:33\"\u003e\n\u003cspan id=\"スクレイピング顔検出\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0%E9%A1%94%E6%A4%9C%E5%87%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクレイピング\u0026amp;顔検出\u003c/h1\u003e\n\u003cp data-sourcepos=\"15:1-16:224\"\u003e今回は｛ウエンツ,ユージ,JOY,ハリー杉山｝を検索した。なんとなく、学習難しそうなので。 max100枚として、フォルダを分けて保存していきました。\u003cbr\u003e\n2022年版ということで、SnowManでやろうとしましたが、あまり詳しくないからか目視でのラベリングが大変そうだったので、今回もハーフタレントでまずは試しました。\u003c/p\u003e\n\u003cp data-sourcepos=\"18:1-18:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/b3aff4212704fe751764327717302980b4526488/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3539393530362f64323937303462612d363539612d616331352d343333612d3337343637616263323333342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F599506%2Fd29704ba-659a-ac15-433a-37467abc2334.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=38f4e2f7bc0c90b918b2f88f7d4432e3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/d29704ba-659a-ac15-433a-37467abc2334.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F599506%2Fd29704ba-659a-ac15-433a-37467abc2334.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9421e87c6e02a2a1c8c410f373643487 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"20:1-33:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e'__main__'\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eword\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'JOY'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'ハリー杉山'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'ウエンツ瑛士'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'ユージ'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edir_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e'Joy'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'Harry'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'Uentsu'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e'Yuji'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# word     = ['岩本照'  ,'深澤辰哉'  ,'渡辺翔太' ,'向井康二','阿部亮平','目黒蓮', '宮舘涼太'  ,'佐久間大介','ラウール']\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# dir_name = ['Iwamoto','Fukazawa','Watanabe','Mukai' ,'Abe'    ,'Meguro','Miyadate','Sakuma'  ,'Raul']\n\u003c/span\u003e    \u003cspan class=\"n\"\u003emax_img\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003e__len__\u003c/span\u003e\u003cspan class=\"p\"\u003e()):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ekeyword\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e'./downloads/'\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003edir_name\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'keyword  = '\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ekeyword\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'save_dir = '\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eyahoo_scraping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekeyword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003emax_img\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003cp data-sourcepos=\"35:1-35:48\"\u003eコード全体はgithubに置く予定です。\u003c/p\u003e\n\u003ch2 data-sourcepos=\"37:1-37:44\"\u003e\n\u003cspan id=\"yahoo画像検索のスクレイピング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#yahoo%E7%94%BB%E5%83%8F%E6%A4%9C%E7%B4%A2%E3%81%AE%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eYahoo画像検索のスクレイピング\u003c/h2\u003e\n\u003cp data-sourcepos=\"38:1-38:286\"\u003eサムネ画像もそこそこ大きい(200x200くらい)ので、こちらで画像を集めることにしました。\u003cdel\u003e1ページ20枚の画像を表示できるようなので、20枚の画像を確認したらページを送る。\u003c/del\u003e 処理の流れは下記のイメージです。\u003c/p\u003e\n\u003cul data-sourcepos=\"40:1-45:0\"\u003e\n\u003cli data-sourcepos=\"40:1-40:28\"\u003eYahoo画像へアクセス\u003c/li\u003e\n\u003cli data-sourcepos=\"41:1-41:47\"\u003e画面最下部まで自動でスクロール\u003c/li\u003e\n\u003cli data-sourcepos=\"42:1-42:47\"\u003e表示されたすべての画像URLを取得\u003c/li\u003e\n\u003cli data-sourcepos=\"43:1-43:29\"\u003eURL先から画像を検出\u003c/li\u003e\n\u003cli data-sourcepos=\"44:1-45:0\"\u003e画像から顔を検出して保存\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp data-sourcepos=\"46:1-46:187\"\u003eSelenium・WebDriverを使ってスクレイピングを行っています。\u003ca href=\"https://www.tomotaku.com/prepare-selenium-webdriver/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【画像あり】Selenium・WebDriverの準備手順\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"48:1-49:150\"\u003eスクレイピングについては下記を参考にさせていただきました。\u003cbr\u003e\n参考：\u003ca href=\"https://www.tomotaku.com/python-scraping-img/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【コピペOK】Pythonによる画像スクレイピング【サンプルコード付き】\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"51:1-51:63\"\u003e詳細は参考サイトに丁寧に記載されています。\u003c/p\u003e\n\u003ch3 data-sourcepos=\"53:1-53:35\"\u003e\n\u003cspan id=\"-バージョン依存あり\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#-%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E4%BE%9D%E5%AD%98%E3%81%82%E3%82%8A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e※ バージョン依存あり\u003c/h3\u003e\n\u003cp data-sourcepos=\"54:1-54:89\"\u003eSeleniumのバージョンによってタグ取得のための記述が異なります。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"55:1-63:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# 画像タグをすべて取得\n# Selenium 3系\n\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efind_elements_by_tag_name\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"img\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\n\u003cspan class=\"c1\"\u003e# Selenium 4系\n\u003c/span\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eselenium.webdriver.common.by\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eBy\u003c/span\u003e  \n\u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efind_elements\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTAG_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"img\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"65:1-65:24\"\u003e\n\u003cspan id=\"スクレイピング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eスクレイピング\u003c/h2\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"67:1-114:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eyahoo_scraping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emax_img\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e'./downloads/'\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# ディレクトリが存在しなければ作成する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emakedirs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eexist_ok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# Webdriverの設定\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd_argument\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'--headless'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# UI無しで操作する\n\u003c/span\u003e    \u003cspan class=\"n\"\u003echrome_service\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexecutable_path\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eCHROMEDRIVER\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edriver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewebdriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eChrome\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eservice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003echrome_service\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# yahoo画像へアクセス\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\"https://search.yahoo.co.jp/image/search?p={}\"\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eword\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 指定したURLへアクセス\n\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eurls\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 画像URLを格納するリスト\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 止まるまでスクロールする\n\u003c/span\u003e    \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprev_html\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epage_source\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# スクロール前のソースコード\n\u003c/span\u003e        \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexecute_script\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"window.scrollTo(0, document.body.scrollHeight);\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 最下部までスクロール\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esleep\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 1秒待機\n\u003c/span\u003e        \u003cspan class=\"n\"\u003ecurrent_html\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epage_source\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# スクロール後のソースコード\n\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# スクロールの前後で変化が無ければループを抜ける\n\u003c/span\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eprev_html\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_html\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprev_html\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecurrent_html\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e# 「もっと見る」ボタンがあればクリック\n\u003c/span\u003e            \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efind_element_by_class_name\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"sw-Button\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclick\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eexcept\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 画像タグをすべて取得\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# elements = driver.find_elements_by_tag_name(\"img\") # Selenium 3系\n\u003c/span\u003e    \u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efind_elements\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTAG_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"img\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Selenium 4系\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# すべての画像URLを抜き出す\n\u003c/span\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eelem\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eelem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget_attribute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"src\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"ow\"\u003enot\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# urlをリストに追加する\n\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edriver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# driverをクローズする\n\u003c/span\u003e    \u003cspan class=\"n\"\u003edownload_faceimgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurls\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emax_img\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 顔画像をダウンロードする\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"116:1-116:42\"\u003e\n\u003cspan id=\"複数の顔画像をダウンロード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A4%87%E6%95%B0%E3%81%AE%E9%A1%94%E7%94%BB%E5%83%8F%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e複数の顔画像をダウンロード\u003c/h2\u003e\n\u003cp data-sourcepos=\"118:1-118:210\"\u003eURLから取得した画像をバイナリから配列の形に変形して、顔検出する関数に入力しています。顔検出の関数を使いまわすためにフォーマットを揃えてます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"120:1-147:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e# 複数の顔画像のダウンロードを行う関数\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edownload_faceimgs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_urls\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emax_img\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003eenumerate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_urls\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n        \u003cspan class=\"n\"\u003efile_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e.png\"\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 画像ファイル名\n\u003c/span\u003e        \u003cspan class=\"n\"\u003esave_img_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esave_dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efile_name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 保存パス\n\u003c/span\u003e\n        \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estatus_code\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e# Binary -\u0026gt; np.asarray\n\u003c/span\u003e            \u003cspan class=\"n\"\u003eimg_base\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003easarray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eio\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBytesIO\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eimg_base\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecvtColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_base\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLOR_RGBA2BGR\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e# Face Detection\n\u003c/span\u003e            \u003cspan class=\"n\"\u003eimg_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg_face\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eface_detect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_base\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_face\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"c1\"\u003e# 顔検出したらカウントアップして保存\n\u003c/span\u003e                \u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eimg_face\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqueeze\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_face\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e][:][:][:])\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eimwrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esave_img_path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eimg_face\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"c1\"\u003e# cv2.imshow('face', img_face)  # imshow()で見たい画像を表示する\n\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"ow\"\u003eor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_urls\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sa\"\u003ef\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e / \u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eimg_urls\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s\"\u003e done\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ecnt_face\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e \u003cspan class=\"n\"\u003emax_img\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch2 data-sourcepos=\"150:1-150:25\"\u003e\n\u003cspan id=\"顔検出リサイズ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%A1%94%E6%A4%9C%E5%87%BA%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e顔検出\u0026amp;リサイズ\u003c/h2\u003e\n\u003cp data-sourcepos=\"152:1-152:138\"\u003eOpenCVの検出器で顔検出して、リサイズして出力する関数です。過去に作ったものを使いまわしてます。\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"154:1-214:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecv2\u003c/span\u003e \u003cspan class=\"c1\"\u003e# OpenCV のインポート\n\u003c/span\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003edatetime\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\n\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003enumpy\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\n\n\u003cspan class=\"n\"\u003ecascade\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCascadeClassifier\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e'cascades/haarcascade_frontalface_default.xml'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e# 顔の検出\n\u003c/span\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eface_detect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eshow_face\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"n\"\u003eface_size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e180\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e180\u003c/span\u003e\u003cspan class=\"p\"\u003e]):\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# そのままの大きさだと処理速度がきついのでリサイズ\n\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# frame = cv2.resize(frame, (int(frame.shape[1] * 0.7), int(frame.shape[0] * 0.7)))\n\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e# 処理速度を高めるために画像をグレースケールに変換したものを用意\n\u003c/span\u003e    \u003cspan class=\"n\"\u003egray\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecvtColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCOLOR_BGR2GRAY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# 顔検出 detecctMultiScale()は検出器のルール(cascade)に従って検出した結果をfacerectに返す関数\n\u003c/span\u003e    \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecascade\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edetectMultiScale\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"n\"\u003egray\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003escaleFactor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.11\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eminNeighbors\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eminSize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e# import pdb; pdb.set_trace()\n\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nb\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# Resize 顔より少し広い範囲を指定\n\u003c/span\u003e        \u003cspan class=\"n\"\u003emag\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e# facerect\n\u003c/span\u003e        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei_det\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emag\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emag\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emag\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_det\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emag\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei_fc\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"nb\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshape\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]):\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei_fc\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e# 顔の部分\n\u003c/span\u003e            \u003cspan class=\"n\"\u003eface\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003eh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e# くり抜いた顔の部分\n\u003c/span\u003e            \u003cspan class=\"n\"\u003eface_resize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eresize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eface\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eface_size\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]),\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eface_size\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])))\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eface_resize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eface_resize\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enewaxis\u003c/span\u003e\u003cspan class=\"p\"\u003e,:,:,:]\u003c/span\u003e\n\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ei_fc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eshow_face\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eface_resize\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eshow_face\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econcatenate\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003eshow_face\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eface_resize\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"c1\"\u003e# cv2.imshow('face', show_face_gray)  # imshow()で見たい画像を表示する\n\u003c/span\u003e            \u003cspan class=\"c1\"\u003e# 顔検出した部分に枠を描画\n\u003c/span\u003e            \u003cspan class=\"s\"\u003e'''\n            cv2.rectangle(\n                frame,\n                (x, y),\n                (x + w, y + h),\n                (255, 255, 255),\n                thickness=2\n            )\n            '''\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eshow_face\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003efacerect\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch1 data-sourcepos=\"216:1-216:26\"\u003e\n\u003cspan id=\"画像のラベル付け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%BB%E5%83%8F%E3%81%AE%E3%83%A9%E3%83%99%E3%83%AB%E4%BB%98%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e画像のラベル付け\u003c/h1\u003e\n\u003cp data-sourcepos=\"217:1-217:203\"\u003e顔画像たちを目視で確認しながらフォルダ分け＝ラベル付けしていきます。関係ない画像も紛れ込んでいるので、”Other”のフォルダへと移動します。\u003c/p\u003e\n\u003cp data-sourcepos=\"219:1-219:183\"\u003e単純にopencvで顔検出をしているだけなので、一つの画像に顔が複数ある場合には間違った画像を取得している場合もたくさんあります。\u003c/p\u003e\n\u003cp data-sourcepos=\"221:1-221:261\"\u003eウエンツの例。ほとんどウエンツだが、たまに小池徹平とか紛れ込みます。ウエンツは芸歴が長いので、幼少期の画像もたまに出てきます。個人的には最近のウエンツが一番かっこいいと思う。\u003c/p\u003e\n\u003cp data-sourcepos=\"223:1-223:121\"\u003e\u003ca href=\"https://camo.qiitausercontent.com/3501cb78489421f4656ccaf7df2a354d956cd144/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3539393530362f33316536323333632d386231622d353130372d303037332d3132393133316330623562342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F599506%2F31e6233c-8b1b-5107-0073-129131c0b5b4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b8dc32fedb704e90b0714e7430ea8dc9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/31e6233c-8b1b-5107-0073-129131c0b5b4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F599506%2F31e6233c-8b1b-5107-0073-129131c0b5b4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ed8648e55e6c3565f9791bd8c6cd9a3c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"225:1-225:445\"\u003eウエンツまでは調子よく分類していったが、ユージ、JOY…と続けていくと、ハーフ系タレントのゲシュタルト崩壊がおきてきて、そもそも目視でみてもわからなくなってきます。画像の解像度が悪いものも無理やり180x180へ拡大しているものもあり、画質がよくないものも含まれます。JOYの中にユージが混ざっていてもわからない。\u003c/p\u003e\n\u003cp data-sourcepos=\"227:1-227:81\"\u003e（最初は安全に嵐とかSMAPとかTOKIOでやればよかったかも。）\u003c/p\u003e\n\u003cp data-sourcepos=\"229:1-230:121\"\u003e画像100枚X4人分をざっくり見るのに10分くらい。これくらいなら目視でなんとかできます。\u003cbr\u003e\n\u003ca href=\"https://camo.qiitausercontent.com/83ad6f36bdbb0335ad2248a1380204f06e809e15/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e61702d6e6f727468656173742d312e616d617a6f6e6177732e636f6d2f302f3539393530362f38393333333439302d663239382d386434662d616263662d6263373837623236636666342e706e67\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F599506%2F89333490-f298-8d4f-abcf-bc787b26cff4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b3adb2829f553039990b6ecef89eef9e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/89333490-f298-8d4f-abcf-bc787b26cff4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F599506%2F89333490-f298-8d4f-abcf-bc787b26cff4.png?ixlib=rb-4.0.0\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d03cbaf27218a161d76ab43c70ae4e14 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"232:1-232:11\"\u003e\n\u003cspan id=\"まとめ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eまとめ\u003c/h1\u003e\n\u003cp data-sourcepos=\"233:1-234:321\"\u003e画像収集はうまくできたので、これから顔認識のテストをしていきます。\u003cbr\u003e\nGoogle画像検索のスクレイピングも過去に試しましたが、うまくいかなかったので、今回もYahoo画像検索で試しました。もっとスクレイピングに適した画像検索があるかもしれません。(\u003ca href=\"https://github.com/iwatadive28/Yahoo_scraping\" rel=\"nofollow noopener\" target=\"_blank\"\u003eソースコードとvenv\u003c/a\u003e)\u003c/p\u003e\n","body":"# 目的\n\n顔認識のため、適当な画像を集めたかったです。過去にYahoo画像検索からスクレイピングしたスクリプトを再度動かそうとしましたが、Yahoo画像検索のページやライブラリが変わっていたので、改めてメモを作り直しました。\n\n今回はハーフタレントの画像を集めてみました。顔認識した話は別途記載します。\n\n# 内容\n1. スクレイピング\u0026顔検出\n   - 画像検索のスクレイピング\n   - スクレイピング結果から顔検出してサイズを揃えて保存\n\n2. 顔画像たちを目視で確認しながらラベル付け\n\n# スクレイピング\u0026顔検出\n今回は｛ウエンツ,ユージ,JOY,ハリー杉山｝を検索した。なんとなく、学習難しそうなので。 max100枚として、フォルダを分けて保存していきました。\n2022年版ということで、SnowManでやろうとしましたが、あまり詳しくないからか目視でのラベリングが大変そうだったので、今回もハーフタレントでまずは試しました。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/d29704ba-659a-ac15-433a-37467abc2334.png)\n\n```python\nif __name__ == '__main__':\n    word     = ['JOY','ハリー杉山','ウエンツ瑛士','ユージ']\n    dir_name = ['Joy','Harry','Uentsu','Yuji']\n    # word     = ['岩本照'  ,'深澤辰哉'  ,'渡辺翔太' ,'向井康二','阿部亮平','目黒蓮', '宮舘涼太'  ,'佐久間大介','ラウール']\n    # dir_name = ['Iwamoto','Fukazawa','Watanabe','Mukai' ,'Abe'    ,'Meguro','Miyadate','Sakuma'  ,'Raul']\n    max_img = 100\n    for i in range(word.__len__()):\n        keyword = word[i]\n        save_dir = './downloads/' + dir_name[i]\n        print('keyword  = ' + keyword)\n        print('save_dir = ' + save_dir)\n        yahoo_scraping(keyword,max_img,save_dir)\n```\n\nコード全体はgithubに置く予定です。\n\n## Yahoo画像検索のスクレイピング\nサムネ画像もそこそこ大きい(200x200くらい)ので、こちらで画像を集めることにしました。~~1ページ20枚の画像を表示できるようなので、20枚の画像を確認したらページを送る。~~ 処理の流れは下記のイメージです。\n\n- Yahoo画像へアクセス\n- 画面最下部まで自動でスクロール\n- 表示されたすべての画像URLを取得\n- URL先から画像を検出\n- 画像から顔を検出して保存\n\nSelenium・WebDriverを使ってスクレイピングを行っています。[【画像あり】Selenium・WebDriverの準備手順](https://www.tomotaku.com/prepare-selenium-webdriver/) \n\nスクレイピングについては下記を参考にさせていただきました。\n参考：[【コピペOK】Pythonによる画像スクレイピング【サンプルコード付き】](https://www.tomotaku.com/python-scraping-img/)\n\n詳細は参考サイトに丁寧に記載されています。\n\n### ※ バージョン依存あり\nSeleniumのバージョンによってタグ取得のための記述が異なります。\n```python\n# 画像タグをすべて取得\n# Selenium 3系\nelements = driver.find_elements_by_tag_name(\"img\") \n\n# Selenium 4系\nfrom selenium.webdriver.common.by import By  \nelements = driver.find_elements(By.TAG_NAME, \"img\") \n```\n\n## スクレイピング\n\n```python\ndef yahoo_scraping(word, max_img=20, save_dir='./downloads/'):\n    # ディレクトリが存在しなければ作成する\n    os.makedirs(save_dir,exist_ok=True)\n\n    # Webdriverの設定\n    options = Options()\n    options.add_argument('--headless')  # UI無しで操作する\n    chrome_service = fs.Service(executable_path=CHROMEDRIVER)\n    driver = webdriver.Chrome(service=chrome_service,options=options)\n\n    # yahoo画像へアクセス\n    url = \"https://search.yahoo.co.jp/image/search?p={}\"\n    driver.get(url.format(word))  # 指定したURLへアクセス\n\n    urls = []  # 画像URLを格納するリスト\n\n    # 止まるまでスクロールする\n    while True:\n        prev_html = driver.page_source  # スクロール前のソースコード\n        driver.execute_script(\"window.scrollTo(0, document.body.scrollHeight);\")  # 最下部までスクロール\n        sleep(1.0)  # 1秒待機\n        current_html = driver.page_source  # スクロール後のソースコード\n\n        # スクロールの前後で変化が無ければループを抜ける\n        if prev_html != current_html:\n            prev_html = current_html\n        else:\n            # 「もっと見る」ボタンがあればクリック\n            try:\n                button = driver.find_element_by_class_name(\"sw-Button\")\n                button.click()\n            except:\n                break\n\n    # 画像タグをすべて取得\n    # elements = driver.find_elements_by_tag_name(\"img\") # Selenium 3系\n    elements = driver.find_elements(By.TAG_NAME, \"img\") # Selenium 4系\n\n    # すべての画像URLを抜き出す\n    for elem in elements:\n        url = elem.get_attribute(\"src\")\n        if url not in urls:\n            urls.append(url)  # urlをリストに追加する\n\n    driver.close()  # driverをクローズする\n    download_faceimgs(urls, save_dir, max_img)  # 顔画像をダウンロードする\n```\n\n## 複数の顔画像をダウンロード\n\nURLから取得した画像をバイナリから配列の形に変形して、顔検出する関数に入力しています。顔検出の関数を使いまわすためにフォーマットを揃えてます。\n\n```python\n# 複数の顔画像のダウンロードを行う関数\ndef download_faceimgs(img_urls, save_dir, max_img=20):\n    cnt_face = 0\n    for i, url in enumerate(img_urls):\n        file_name = f\"{i}.png\"  # 画像ファイル名\n        save_img_path = os.path.join(save_dir, file_name)  # 保存パス\n\n        r = requests.get(url, stream=True)\n        if r.status_code == 200:\n            # Binary -\u003e np.asarray\n            img_base = np.asarray(Image.open(io.BytesIO(r.content)))\n            img_base = cv2.cvtColor(img_base, cv2.COLOR_RGBA2BGR)\n\n            # Face Detection\n            img_det, img_face, facerect = face_detect(img_base)\n\n            if len(img_face) != 0: # 顔検出したらカウントアップして保存\n                cnt_face = cnt_face + 1\n                img_face = np.squeeze(img_face[0][:][:][:])\n                cv2.imwrite(save_img_path, img_face)\n                # cv2.imshow('face', img_face)  # imshow()で見たい画像を表示する\n\n        if (cnt_face + 1) % 10 == 0 or (cnt_face + 1) == len(img_urls):\n            print(f\"{cnt_face + 1} / {len(img_urls)} done\")\n        if cnt_face \u003e= max_img:\n            return()\n```\n\n\n## 顔検出\u0026リサイズ\n\nOpenCVの検出器で顔検出して、リサイズして出力する関数です。過去に作ったものを使いまわしてます。\n\n```python\nimport cv2 # OpenCV のインポート\nimport os\nfrom datetime import datetime\nimport numpy as np\n\ncascade     = cv2.CascadeClassifier('cascades/haarcascade_frontalface_default.xml')\n\n# 顔の検出\ndef face_detect(frame,show_face=[], face_size=[180,180]):\n    # そのままの大きさだと処理速度がきついのでリサイズ\n    # frame = cv2.resize(frame, (int(frame.shape[1] * 0.7), int(frame.shape[0] * 0.7)))\n\n    # 処理速度を高めるために画像をグレースケールに変換したものを用意\n    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)\n\n    # 顔検出 detecctMultiScale()は検出器のルール(cascade)に従って検出した結果をfacerectに返す関数\n    facerect = cascade.detectMultiScale(\n        gray,\n        scaleFactor=1.11,\n        minNeighbors=3,\n        minSize=(20, 20)\n    )\n\n    # import pdb; pdb.set_trace()\n    if len(facerect) != 0:\n        # Resize 顔より少し広い範囲を指定\n        mag = 1\n        # facerect\n        for i_det in range(facerect.shape[0]):\n            facerect[i_det, 0] = int(facerect[i_det, 0] - facerect[i_det, 2] * (mag-1)*0.5)\n            facerect[i_det, 1] = int(facerect[i_det, 1] - facerect[i_det, 3] * (mag-1)*0.5)\n            facerect[i_det, 2] = int(facerect[i_det, 2] * mag)\n            facerect[i_det, 3] = int(facerect[i_det, 3] * mag)\n\n        for i_fc in range(facerect.shape[0]):\n            x, y, w, h = facerect[i_fc]\n            # 顔の部分\n            face = frame[y: y + h, x: x + w]\n            # くり抜いた顔の部分\n            face_resize = cv2.resize(face, (int(face_size[0]), int(face_size[1])))\n            face_resize = face_resize[np.newaxis,:,:,:]\n\n            if i_fc == 0:\n                show_face = face_resize\n            else:\n                show_face = np.concatenate([show_face,face_resize],0)\n\n            # cv2.imshow('face', show_face_gray)  # imshow()で見たい画像を表示する\n            # 顔検出した部分に枠を描画\n            '''\n            cv2.rectangle(\n                frame,\n                (x, y),\n                (x + w, y + h),\n                (255, 255, 255),\n                thickness=2\n            )\n            '''\n    return (frame,show_face,facerect)\n```\n\n# 画像のラベル付け\n顔画像たちを目視で確認しながらフォルダ分け＝ラベル付けしていきます。関係ない画像も紛れ込んでいるので、”Other”のフォルダへと移動します。\n\n単純にopencvで顔検出をしているだけなので、一つの画像に顔が複数ある場合には間違った画像を取得している場合もたくさんあります。\n\nウエンツの例。ほとんどウエンツだが、たまに小池徹平とか紛れ込みます。ウエンツは芸歴が長いので、幼少期の画像もたまに出てきます。個人的には最近のウエンツが一番かっこいいと思う。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/31e6233c-8b1b-5107-0073-129131c0b5b4.png)\n\nウエンツまでは調子よく分類していったが、ユージ、JOY…と続けていくと、ハーフ系タレントのゲシュタルト崩壊がおきてきて、そもそも目視でみてもわからなくなってきます。画像の解像度が悪いものも無理やり180x180へ拡大しているものもあり、画質がよくないものも含まれます。JOYの中にユージが混ざっていてもわからない。\n\n（最初は安全に嵐とかSMAPとかTOKIOでやればよかったかも。）\n\n画像100枚X4人分をざっくり見るのに10分くらい。これくらいなら目視でなんとかできます。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/89333490-f298-8d4f-abcf-bc787b26cff4.png)\n\n# まとめ\n画像収集はうまくできたので、これから顔認識のテストをしていきます。\nGoogle画像検索のスクレイピングも過去に試しましたが、うまくいかなかったので、今回もYahoo画像検索で試しました。もっとスクレイピングに適した画像検索があるかもしれません。([ソースコードとvenv](https://github.com/iwatadive28/Yahoo_scraping))\n\n","coediting":false,"comments_count":1,"created_at":"2022-09-18T19:42:27+09:00","group":null,"id":"8aa53e4afaf3b148ca3f","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"スクレイピング","versions":[]},{"name":"メモ","versions":[]},{"name":"OpenCV","versions":[]}],"title":"顔認識のテストのためにスクレイピングでハーフタレントの画像収集してみた","updated_at":"2022-09-18T21:05:02+09:00","url":"https://qiita.com/kiwsdiv/items/8aa53e4afaf3b148ca3f","user":{"description":"社畜の割には自由です","facebook_id":"","followees_count":1,"followers_count":1,"github_login_name":null,"id":"kiwsdiv","items_count":12,"linkedin_id":"","location":"","name":"","organization":"","permanent_id":599506,"profile_image_url":"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/599506/profile-images/1649256441","team_only":false,"twitter_screen_name":null,"website_url":""},"page_views_count":null,"team_membership":null},{"rendered_body":"\u003cp data-sourcepos=\"1:1-2:113\"\u003eC/C++ コードで(真の) stack overflow が出る...\u003cbr\u003e\n再帰関数の呼び出しが深かったり, local variable が領域取っているのがたぶん原因ネ...\u003c/p\u003e\n\u003cp data-sourcepos=\"4:1-4:53\"\u003eどこで stack を食っているのか調べます.\u003c/p\u003e\n\u003ch1 data-sourcepos=\"6:1-6:13\"\u003e\n\u003cspan id=\"stack-usage\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stack-usage\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003estack-usage\u003c/h1\u003e\n\u003cp data-sourcepos=\"8:1-8:43\"\u003egcc には \u003ccode\u003e-fstack-usage\u003c/code\u003e があります.\u003c/p\u003e\n\u003cp data-sourcepos=\"10:1-11:55\"\u003e\u003ca href=\"https://devlights.hatenablog.com/entry/2020/10/05/201142\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://devlights.hatenablog.com/entry/2020/10/05/201142\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://syohex.hatenablog.com/entry/20110319/1300541703\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://syohex.hatenablog.com/entry/20110319/1300541703\u003c/a\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"13:1-13:84\"\u003eclang も 12 以降あたりから使えるようです(11 では NG. 14 では OK).\u003c/p\u003e\n\u003ch2 data-sourcepos=\"16:1-16:9\"\u003e\n\u003cspan id=\"実例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%9F%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e実例\u003c/h2\u003e\n\u003cp data-sourcepos=\"18:1-18:68\"\u003eTinyUSDZ で再帰する関数で 103 KB も! 食っていました.\u003c/p\u003e\n\u003cdiv class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"20:1-22:3\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003ccode\u003etinyusdz/src/usdc-reader.cc:1344:_ZN8tinyusdz4usdc10USDCReader4Impl26ReconstructPrimRecursivelyEiiPNS_4PrimEiRKSt13unordered_mapIjjSt4hashIjESt8equal_toIjESaISt4pairIKjjEEEPNS_5StageE\t103848\tstatic\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\u003ch1 data-sourcepos=\"24:1-24:17\"\u003e\n\u003cspan id=\"stack-protector\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stack-protector\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003estack protector\u003c/h1\u003e\n\u003cp data-sourcepos=\"26:1-26:58\"\u003e\u003cqiita-embed-ogp src=\"https://qiita.com/kakinaguru_zo/items/f6e37beb2b77223a9282\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"28:1-28:49\"\u003estack protector は intel CPU だけかしらん.\u003c/p\u003e\n\u003cp data-sourcepos=\"30:1-30:63\"\u003eSafeStack は overflow は検出してくれるんじゃろか?\u003c/p\u003e\n\u003cp data-sourcepos=\"32:1-32:78\"\u003e\u003cqiita-embed-ogp src=\"https://www.pwnthebox.net/papers/2021/03/10/understanding-clang-safestack.html\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003ch1 data-sourcepos=\"36:1-36:56\"\u003e\n\u003cspan id=\"linux-で-stack-overfow-の再現をしやすくする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#linux-%E3%81%A7-stack-overfow-%E3%81%AE%E5%86%8D%E7%8F%BE%E3%82%92%E3%81%97%E3%82%84%E3%81%99%E3%81%8F%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLinux で stack overfow の再現をしやすくする\u003c/h1\u003e\n\u003cp data-sourcepos=\"38:1-38:83\"\u003eLinux の場合はランタイム(OS)でスタックサイズを調整できます.\u003c/p\u003e\n\u003cp data-sourcepos=\"40:1-41:131\"\u003eulimit -s 1024 で stack size を減らしてみたり...\u003cbr\u003e\n(ただ, セキュリティ設定によるのか一旦減らしてから戻すには一旦 shell を抜けるしかないっぽい)\u003c/p\u003e\n\u003ch1 data-sourcepos=\"43:1-43:9\"\u003e\n\u003cspan id=\"windows\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#windows\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWindows\u003c/h1\u003e\n\u003cp data-sourcepos=\"45:1-46:68\"\u003eWindows は実行時スタックサイズ調整は出来るのかな?\u003cbr\u003e\nMSVC ではコンパイル時(リンク時)に設定はできます.\u003c/p\u003e\n\u003cp data-sourcepos=\"48:1-48:84\"\u003e\u003cqiita-embed-ogp src=\"https://learn.microsoft.com/en-us/cpp/build/reference/f-set-stack-size?view=msvc-170\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n\u003cp data-sourcepos=\"50:1-50:69\"\u003e\u003cqiita-embed-ogp src=\"https://stackoverflow.com/questions/40157847/increase-stack-size-in-c\"\u003e\u003c/qiita-embed-ogp\u003e\u003c/p\u003e\n","body":"C/C++ コードで(真の) stack overflow が出る...\n再帰関数の呼び出しが深かったり, local variable が領域取っているのがたぶん原因ネ...\n\nどこで stack を食っているのか調べます.\n\n# stack-usage\n\ngcc には `-fstack-usage` があります.\n\nhttps://devlights.hatenablog.com/entry/2020/10/05/201142\nhttps://syohex.hatenablog.com/entry/20110319/1300541703\n\nclang も 12 以降あたりから使えるようです(11 では NG. 14 では OK).\n\n\n## 実例\n\nTinyUSDZ で再帰する関数で 103 KB も! 食っていました.\n\n```\ntinyusdz/src/usdc-reader.cc:1344:_ZN8tinyusdz4usdc10USDCReader4Impl26ReconstructPrimRecursivelyEiiPNS_4PrimEiRKSt13unordered_mapIjjSt4hashIjESt8equal_toIjESaISt4pairIKjjEEEPNS_5StageE\t103848\tstatic\n```\n\n# stack protector\n\nhttps://qiita.com/kakinaguru_zo/items/f6e37beb2b77223a9282\n\nstack protector は intel CPU だけかしらん.\n\nSafeStack は overflow は検出してくれるんじゃろか?\n\nhttps://www.pwnthebox.net/papers/2021/03/10/understanding-clang-safestack.html\n\n\n\n# Linux で stack overfow の再現をしやすくする\n\nLinux の場合はランタイム(OS)でスタックサイズを調整できます.\n\nulimit -s 1024 で stack size を減らしてみたり...\n(ただ, セキュリティ設定によるのか一旦減らしてから戻すには一旦 shell を抜けるしかないっぽい)\n\n# Windows\n\nWindows は実行時スタックサイズ調整は出来るのかな?\nMSVC ではコンパイル時(リンク時)に設定はできます.\n\nhttps://learn.microsoft.com/en-us/cpp/build/reference/f-set-stack-size?view=msvc-170\n\nhttps://stackoverflow.com/questions/40157847/increase-stack-size-in-c\n","coediting":false,"comments_count":0,"created_at":"2022-09-18T19:30:48+09:00","group":null,"id":"043cdf19a11b8946b007","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"StackOverflow","versions":[]}],"title":"clang で C++ コードの stack size をチェックするメモ","updated_at":"2022-09-18T20:19:42+09:00","url":"https://qiita.com/syoyo/items/043cdf19a11b8946b007","user":{"description":"RayWa(Ray and Peace)","facebook_id":"","followees_count":0,"followers_count":265,"github_login_name":"syoyo","id":"syoyo","items_count":804,"linkedin_id":"syoyo","location":"Left handed coordinate","name":"Syoyo Fujita","organization":"","permanent_id":36275,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/36275/profile-images/1473687017","team_only":false,"twitter_screen_name":null,"website_url":"https://syoyo.wordpress.com/"},"page_views_count":null,"team_membership":null}]